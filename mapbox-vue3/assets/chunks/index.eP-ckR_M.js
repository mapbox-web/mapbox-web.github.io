import{g as kt,d as Yt,b as Ma,p as st,r as br,c as Au,h as bi,a as Ru,f as Ou,e as Or,i as Xi,j as Ba,k as Ur,m as Da,n as Rs,l as Os,o as Uu,q as Pu}from"./index.B0YS06CC.js";import{f as Us,g as Fa,c as Mu,e as Pr,h as ni,a as Ln,t as Bu,b as cn}from"./index.j3JAmpb-.js";import{p as Du}from"./csscolorparser.A-VAnCRm.js";import{t as oi,g as He,v as De}from"./v4.BCLFZokq.js";import{d as Te,L as ki,q as ue,o as Se,c as je,p as tt,$ as it,b as Me,k as ce,r as ri,h as Be,a7 as Fu,w as Bt,e as wt,X as zu,v as Gu,x as qu,j as Sr,P as Yu,a1 as $u,n as Hu,N as Vu,al as Ir,a5 as ju,am as Xu,G as Ci,F as Zu,C as Wu}from"./framework.BRu0xxKU.js";import{t as Sn}from"./index.BPO1bIjo.js";import{c as za,g as Mr}from"./commonjsHelpers.Cpj98o6Y.js";import{$ as Ku}from"./mapbox-web-draw.BO1nkz54.js";import"./mapbox-gl-enhance.DI11R9zg.js";function Br(c,f,l,y={}){const p=kt(c),b=Yt(p[0]),I=Yt(p[1]),h=Yt(l),N=Ma(f,y.units),E=Math.asin(Math.sin(I)*Math.cos(N)+Math.cos(I)*Math.sin(N)*Math.cos(h)),S=b+Math.atan2(Math.sin(h)*Math.sin(N)*Math.cos(I),Math.cos(N)-Math.sin(I)*Math.sin(E)),_=br(S),L=br(E);return st([_,L],y.properties)}var We=Br;function Ju(c,f,l={}){let y;return l.final?y=Ps(kt(f),kt(c)):y=Ps(kt(c),kt(f)),y>180?-(360-y):y}function Ps(c,f){const l=Yt(c[1]),y=Yt(f[1]);let p=Yt(f[0]-c[0]);p>Math.PI&&(p-=2*Math.PI),p<-Math.PI&&(p+=2*Math.PI);const b=Math.log(Math.tan(y/2+Math.PI/4)/Math.tan(l/2+Math.PI/4)),I=Math.atan2(p,b);return(br(I)+360)%360}const $t=11102230246251565e-32,rt=134217729,Qu=(3+8*$t)*$t;function Qn(c,f,l,y,p){let b,I,h,N,E=f[0],S=y[0],_=0,L=0;S>E==S>-E?(b=E,E=f[++_]):(b=S,S=y[++L]);let k=0;if(_<c&&L<l)for(S>E==S>-E?(I=E+b,h=b-(I-E),E=f[++_]):(I=S+b,h=b-(I-S),S=y[++L]),b=I,h!==0&&(p[k++]=h);_<c&&L<l;)S>E==S>-E?(I=b+E,N=I-b,h=b-(I-N)+(E-N),E=f[++_]):(I=b+S,N=I-b,h=b-(I-N)+(S-N),S=y[++L]),b=I,h!==0&&(p[k++]=h);for(;_<c;)I=b+E,N=I-b,h=b-(I-N)+(E-N),E=f[++_],b=I,h!==0&&(p[k++]=h);for(;L<l;)I=b+S,N=I-b,h=b-(I-N)+(S-N),S=y[++L],b=I,h!==0&&(p[k++]=h);return(b!==0||k===0)&&(p[k++]=b),k}function el(c,f){let l=f[0];for(let y=1;y<c;y++)l+=f[y];return l}function Wi(c){return new Float64Array(c)}const tl=(3+16*$t)*$t,il=(2+12*$t)*$t,nl=(9+64*$t)*$t*$t,vi=Wi(4),Ms=Wi(8),Bs=Wi(12),Ds=Wi(16),ot=Wi(4);function rl(c,f,l,y,p,b,I){let h,N,E,S,_,L,k,A,t,a,u,g,v,w,T,O,P,D;const z=c-p,j=l-p,$=f-b,X=y-b;w=z*X,L=rt*z,k=L-(L-z),A=z-k,L=rt*X,t=L-(L-X),a=X-t,T=A*a-(w-k*t-A*t-k*a),O=$*j,L=rt*$,k=L-(L-$),A=$-k,L=rt*j,t=L-(L-j),a=j-t,P=A*a-(O-k*t-A*t-k*a),u=T-P,_=T-u,vi[0]=T-(u+_)+(_-P),g=w+u,_=g-w,v=w-(g-_)+(u-_),u=v-O,_=v-u,vi[1]=v-(u+_)+(_-O),D=g+u,_=D-g,vi[2]=g-(D-_)+(u-_),vi[3]=D;let oe=el(4,vi),W=il*I;if(oe>=W||-oe>=W||(_=c-z,h=c-(z+_)+(_-p),_=l-j,E=l-(j+_)+(_-p),_=f-$,N=f-($+_)+(_-b),_=y-X,S=y-(X+_)+(_-b),h===0&&N===0&&E===0&&S===0)||(W=nl*I+Qu*Math.abs(oe),oe+=z*S+X*h-($*E+j*N),oe>=W||-oe>=W))return oe;w=h*X,L=rt*h,k=L-(L-h),A=h-k,L=rt*X,t=L-(L-X),a=X-t,T=A*a-(w-k*t-A*t-k*a),O=N*j,L=rt*N,k=L-(L-N),A=N-k,L=rt*j,t=L-(L-j),a=j-t,P=A*a-(O-k*t-A*t-k*a),u=T-P,_=T-u,ot[0]=T-(u+_)+(_-P),g=w+u,_=g-w,v=w-(g-_)+(u-_),u=v-O,_=v-u,ot[1]=v-(u+_)+(_-O),D=g+u,_=D-g,ot[2]=g-(D-_)+(u-_),ot[3]=D;const Y=Qn(4,vi,4,ot,Ms);w=z*S,L=rt*z,k=L-(L-z),A=z-k,L=rt*S,t=L-(L-S),a=S-t,T=A*a-(w-k*t-A*t-k*a),O=$*E,L=rt*$,k=L-(L-$),A=$-k,L=rt*E,t=L-(L-E),a=E-t,P=A*a-(O-k*t-A*t-k*a),u=T-P,_=T-u,ot[0]=T-(u+_)+(_-P),g=w+u,_=g-w,v=w-(g-_)+(u-_),u=v-O,_=v-u,ot[1]=v-(u+_)+(_-O),D=g+u,_=D-g,ot[2]=g-(D-_)+(u-_),ot[3]=D;const Z=Qn(Y,Ms,4,ot,Bs);w=h*S,L=rt*h,k=L-(L-h),A=h-k,L=rt*S,t=L-(L-S),a=S-t,T=A*a-(w-k*t-A*t-k*a),O=N*E,L=rt*N,k=L-(L-N),A=N-k,L=rt*E,t=L-(L-E),a=E-t,P=A*a-(O-k*t-A*t-k*a),u=T-P,_=T-u,ot[0]=T-(u+_)+(_-P),g=w+u,_=g-w,v=w-(g-_)+(u-_),u=v-O,_=v-u,ot[1]=v-(u+_)+(_-O),D=g+u,_=D-g,ot[2]=g-(D-_)+(u-_),ot[3]=D;const ee=Qn(Z,Bs,4,ot,Ds);return Ds[ee-1]}function sl(c,f,l,y,p,b){const I=(f-b)*(l-p),h=(c-p)*(y-b),N=I-h,E=Math.abs(I+h);return Math.abs(N)>=tl*E?N:-rl(c,f,l,y,p,b,E)}function al(c,f){var l,y,p=0,b,I,h,N,E,S,_,L=c[0],k=c[1],A=f.length;for(l=0;l<A;l++){y=0;var t=f[l],a=t.length-1;if(S=t[0],S[0]!==t[a][0]&&S[1]!==t[a][1])throw new Error("First and last coordinates in a ring must be the same");for(I=S[0]-L,h=S[1]-k,y;y<a;y++){if(_=t[y+1],N=_[0]-L,E=_[1]-k,h===0&&E===0){if(N<=0&&I>=0||I<=0&&N>=0)return 0}else if(E>=0&&h<0||E<0&&h>=0){if(b=sl(I,N,h,E,0,0),b===0)return 0;(b>0&&E>0&&h<=0||b<0&&E<=0&&h>0)&&p++}S=_,h=E,I=N}}return p%2!==0}function ol(c,f,l={}){if(!c)throw new Error("point is required");if(!f)throw new Error("polygon is required");const y=kt(c),p=Au(f),b=p.type,I=f.bbox;let h=p.coordinates;if(I&&ul(y,I)===!1)return!1;b==="Polygon"&&(h=[h]);let N=!1;for(var E=0;E<h.length;++E){const S=al(y,h[E]);if(S===0)return!l.ignoreBoundary;S&&(N=!0)}return N}function ul(c,f){return f[0]<=c[0]&&f[1]<=c[1]&&f[2]>=c[0]&&f[3]>=c[1]}var Dr=ol,Ga={exports:{}};(function(c,f){(function(l,y){c.exports=y()})(za,function(){function l(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function y(o,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}function p(o,e,n){return e&&y(o.prototype,e),n&&y(o,n),o}function b(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),e&&h(o,e)}function I(o){return I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},I(o)}function h(o,e){return h=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},h(o,e)}function N(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function E(o,e,n){return E=N()?Reflect.construct:function(r,s,d){var m=[null];m.push.apply(m,s);var x=new(Function.bind.apply(r,m));return d&&h(x,d.prototype),x},E.apply(null,arguments)}function S(o){var e=typeof Map=="function"?new Map:void 0;return S=function(n){if(n===null||(r=n,Function.toString.call(r).indexOf("[native code]")===-1))return n;var r;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(n))return e.get(n);e.set(n,s)}function s(){return E(n,arguments,I(this).constructor)}return s.prototype=Object.create(n.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),h(s,n)},S(o)}function _(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function L(o,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _(o)}function k(o){var e=N();return function(){var n,r=I(o);if(e){var s=I(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return L(this,n)}}function A(o,e,n){return A=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(r,s,d){var m=function(C,R){for(;!Object.prototype.hasOwnProperty.call(C,R)&&(C=I(C))!==null;);return C}(r,s);if(m){var x=Object.getOwnPropertyDescriptor(m,s);return x.get?x.get.call(d):x.value}},A(o,e,n||o)}function t(o){return function(e){if(Array.isArray(e))return u(e)}(o)||function(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}(o)||a(o)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function a(o,e){if(o){if(typeof o=="string")return u(o,e);var n=Object.prototype.toString.call(o).slice(8,-1);return n==="Object"&&o.constructor&&(n=o.constructor.name),n==="Map"||n==="Set"?Array.from(o):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(o,e):void 0}}function u(o,e){(e==null||e>o.length)&&(e=o.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=o[n];return r}function g(o,e){var n=typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(!n){if(Array.isArray(o)||(n=a(o))||e){n&&(o=n);var r=0,s=function(){};return{s,n:function(){return r>=o.length?{done:!0}:{done:!1,value:o[r++]}},e:function(C){throw C},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d,m=!0,x=!1;return{s:function(){n=n.call(o)},n:function(){var C=n.next();return m=C.done,C},e:function(C){x=!0,d=C},f:function(){try{m||n.return==null||n.return()}finally{if(x)throw d}}}}var v=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(e){this._quadrantSegments=e,this._quadrantSegments===0&&(this._joinStyle=o.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=o.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==o.JOIN_ROUND&&(this._quadrantSegments=o.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(e){this._joinStyle=e}},{key:"setSimplifyFactor",value:function(e){this._simplifyFactor=e<0?0:e}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(e){this._endCapStyle=e}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(e){this._mitreLimit=e}},{key:"setSingleSided",value:function(e){this._isSingleSided=e}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=o.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=o.CAP_ROUND,this._joinStyle=o.JOIN_ROUND,this._mitreLimit=o.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=o.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setQuadrantSegments(e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(arguments.length===4){var s=arguments[0],d=arguments[1],m=arguments[2],x=arguments[3];this.setQuadrantSegments(s),this.setEndCapStyle(d),this.setJoinStyle(m),this.setMitreLimit(x)}}}},{key:"bufferDistanceError",value:function(e){var n=Math.PI/2/e;return 1-Math.cos(n/2)}}]),o}();v.CAP_ROUND=1,v.CAP_FLAT=2,v.CAP_SQUARE=3,v.JOIN_ROUND=1,v.JOIN_MITRE=2,v.JOIN_BEVEL=3,v.DEFAULT_QUADRANT_SEGMENTS=8,v.DEFAULT_MITRE_LIMIT=5,v.DEFAULT_SIMPLIFY_FACTOR=.01;var w=function(o){b(n,o);var e=k(n);function n(r){var s;return l(this,n),(s=e.call(this,r)).name=Object.keys({Exception:n})[0],s}return p(n,[{key:"toString",value:function(){return this.message}}]),n}(S(Error)),T=function(o){b(n,o);var e=k(n);function n(r){var s;return l(this,n),(s=e.call(this,r)).name=Object.keys({IllegalArgumentException:n})[0],s}return n}(w),O=function(){function o(){l(this,o)}return p(o,[{key:"filter",value:function(e){}}]),o}();function P(){}function D(){}function z(){}var j,$,X,oe,W,Y,Z,ee,V=function(){function o(){l(this,o)}return p(o,null,[{key:"equalsWithTolerance",value:function(e,n,r){return Math.abs(e-n)<=r}}]),o}(),Q=function(){function o(e,n){l(this,o),this.low=n||0,this.high=e||0}return p(o,null,[{key:"toBinaryString",value:function(e){var n,r="";for(n=2147483648;n>0;n>>>=1)r+=(e.high&n)===n?"1":"0";for(n=2147483648;n>0;n>>>=1)r+=(e.low&n)===n?"1":"0";return r}}]),o}();function J(){}function ve(){}J.NaN=NaN,J.isNaN=function(o){return Number.isNaN(o)},J.isInfinite=function(o){return!Number.isFinite(o)},J.MAX_VALUE=Number.MAX_VALUE,J.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,J.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(Y=2146435072,Z=new Float64Array(1),ee=new Int32Array(Z.buffer),J.doubleToLongBits=function(o){Z[0]=o;var e=0|ee[0],n=0|ee[1];return(n&Y)===Y&&1048575&n&&e!==0&&(e=0,n=2146959360),new Q(n,e)},J.longBitsToDouble=function(o){return ee[0]=o.low,ee[1]=o.high,Z[0]}):(j=1023,$=Math.log2,X=Math.floor,oe=Math.pow,W=function(){for(var o=53;o>0;o--){var e=oe(2,o)-1;if(X($(e))+1===o)return e}return 0}(),J.doubleToLongBits=function(o){var e,n,r,s,d,m,x,C,R;if(o<0||1/o===Number.NEGATIVE_INFINITY?(m=1<<31,o=-o):m=0,o===0)return new Q(C=m,R=0);if(o===1/0)return new Q(C=2146435072|m,R=0);if(o!=o)return new Q(C=2146959360,R=0);if(s=0,R=0,(e=X(o))>1)if(e<=W)(s=X($(e)))<=20?(R=0,C=e<<20-s&1048575):(R=e%(n=oe(2,r=s-20))<<32-r,C=e/n&1048575);else for(r=e,R=0;(r=X(n=r/2))!==0;)s++,R>>>=1,R|=(1&C)<<31,C>>>=1,n!==r&&(C|=524288);if(x=s+j,d=e===0,e=o-e,s<52&&e!==0)for(r=0;;){if((n=2*e)>=1?(e=n-1,d?(x--,d=!1):(r<<=1,r|=1,s++)):(e=n,d?--x==0&&(s++,d=!1):(r<<=1,s++)),s===20)C|=r,r=0;else if(s===52){R|=r;break}if(n===1){s<20?C|=r<<20-s:s<52&&(R|=r<<52-s);break}}return C|=x<<20,new Q(C|=m,R)},J.longBitsToDouble=function(o){var e,n,r,s,d=o.high,m=o.low,x=d&1<<31?-1:1;for(r=((2146435072&d)>>20)-j,s=0,n=1<<19,e=1;e<=20;e++)d&n&&(s+=oe(2,-e)),n>>>=1;for(n=1<<31,e=21;e<=52;e++)m&n&&(s+=oe(2,-e)),n>>>=1;if(r===-1023){if(s===0)return 0*x;r=-1022}else{if(r===1024)return s===0?x/0:NaN;s+=1}return x*s*oe(2,r)});var le=function(o){b(n,o);var e=k(n);function n(r){var s;return l(this,n),(s=e.call(this,r)).name=Object.keys({RuntimeException:n})[0],s}return n}(w),fe=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,null,[{key:"constructor_",value:function(){if(arguments.length===0)le.constructor_.call(this);else if(arguments.length===1){var r=arguments[0];le.constructor_.call(this,r)}}}]),n}(le),re=function(){function o(){l(this,o)}return p(o,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)o.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new fe("Should never reach here"+(e!==null?": "+e:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var e=arguments[0];o.isTrue(e,null)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];if(!n)throw r===null?new fe:new fe(r)}}},{key:"equals",value:function(){if(arguments.length===2){var e=arguments[0],n=arguments[1];o.equals(e,n,null)}else if(arguments.length===3){var r=arguments[0],s=arguments[1],d=arguments[2];if(!s.equals(r))throw new fe("Expected "+r+" but encountered "+s+(d!==null?": "+d:""))}}}]),o}(),de=new ArrayBuffer(8),be=new Float64Array(de),me=new Int32Array(de),F=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getM",value:function(){return J.NaN}},{key:"setOrdinate",value:function(e,n){switch(e){case o.X:this.x=n;break;case o.Y:this.y=n;break;case o.Z:this.setZ(n);break;default:throw new T("Invalid ordinate index: "+e)}}},{key:"equals2D",value:function(){if(arguments.length===1){var e=arguments[0];return this.x===e.x&&this.y===e.y}if(arguments.length===2){var n=arguments[0],r=arguments[1];return!!V.equalsWithTolerance(this.x,n.x,r)&&!!V.equalsWithTolerance(this.y,n.y,r)}}},{key:"setM",value:function(e){throw new T("Invalid ordinate index: "+o.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(e){switch(e){case o.X:return this.x;case o.Y:return this.y;case o.Z:return this.getZ()}throw new T("Invalid ordinate index: "+e)}},{key:"equals3D",value:function(e){return this.x===e.x&&this.y===e.y&&(this.getZ()===e.getZ()||J.isNaN(this.getZ())&&J.isNaN(e.getZ()))}},{key:"equals",value:function(e){return e instanceof o&&this.equals2D(e)}},{key:"equalInZ",value:function(e,n){return V.equalsWithTolerance(this.getZ(),e.getZ(),n)}},{key:"setX",value:function(e){this.x=e}},{key:"compareTo",value:function(e){var n=e;return this.x<n.x?-1:this.x>n.x?1:this.y<n.y?-1:this.y>n.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(e){this.z=e}},{key:"clone",value:function(){try{return null}catch(e){if(e instanceof CloneNotSupportedException)return re.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw e}}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(e){var n=this.x-e.x,r=this.y-e.y,s=this.getZ()-e.getZ();return Math.sqrt(n*n+r*r+s*s)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(e){this.y=e}},{key:"distance",value:function(e){var n=this.x-e.x,r=this.y-e.y;return Math.sqrt(n*n+r*r)}},{key:"hashCode",value:function(){var e=17;return e=37*(e=37*e+o.hashCode(this.x))+o.hashCode(this.y)}},{key:"setCoordinate",value:function(e){this.x=e.x,this.y=e.y,this.z=e.getZ()}},{key:"interfaces_",get:function(){return[P,D,z]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)o.constructor_.call(this,0,0);else if(arguments.length===1){var e=arguments[0];o.constructor_.call(this,e.x,e.y,e.getZ())}else if(arguments.length===2){var n=arguments[0],r=arguments[1];o.constructor_.call(this,n,r,o.NULL_ORDINATE)}else if(arguments.length===3){var s=arguments[0],d=arguments[1],m=arguments[2];this.x=s,this.y=d,this.z=m}}},{key:"hashCode",value:function(e){return be[0]=e,me[0]^me[1]}}]),o}(),Ne=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"compare",value:function(e,n){var r=o.compare(e.x,n.x);if(r!==0)return r;var s=o.compare(e.y,n.y);return s!==0?s:this._dimensionsToTest<=2?0:o.compare(e.getZ(),n.getZ())}},{key:"interfaces_",get:function(){return[ve]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)o.constructor_.call(this,2);else if(arguments.length===1){var e=arguments[0];if(e!==2&&e!==3)throw new T("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}}},{key:"compare",value:function(e,n){return e<n?-1:e>n?1:J.isNaN(e)?J.isNaN(n)?0:-1:J.isNaN(n)?1:0}}]),o}();F.DimensionalComparator=Ne,F.NULL_ORDINATE=J.NaN,F.X=0,F.Y=1,F.Z=2,F.M=3;var G=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(e){if(!(e instanceof o))return!1;var n=e;return this.isNull()?n.isNull():this._maxx===n.getMaxX()&&this._maxy===n.getMaxY()&&this._minx===n.getMinX()&&this._miny===n.getMinY()}},{key:"intersection",value:function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new o;var n=this._minx>e._minx?this._minx:e._minx,r=this._miny>e._miny?this._miny:e._miny;return new o(n,this._maxx<e._maxx?this._maxx:e._maxx,r,this._maxy<e._maxy?this._maxy:e._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof F){var e=arguments[0];return this.covers(e.x,e.y)}if(arguments[0]instanceof o){var n=arguments[0];return!this.isNull()&&!n.isNull()&&n.getMinX()>=this._minx&&n.getMaxX()<=this._maxx&&n.getMinY()>=this._miny&&n.getMaxY()<=this._maxy}}else if(arguments.length===2){var r=arguments[0],s=arguments[1];return!this.isNull()&&r>=this._minx&&r<=this._maxx&&s>=this._miny&&s<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var e=arguments[0];return!this.isNull()&&!e.isNull()&&!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}if(arguments[0]instanceof F){var n=arguments[0];return this.intersects(n.x,n.y)}}else if(arguments.length===2){if(arguments[0]instanceof F&&arguments[1]instanceof F){var r=arguments[0],s=arguments[1];if(this.isNull())return!1;var d=r.x<s.x?r.x:s.x;if(d>this._maxx)return!1;var m=r.x>s.x?r.x:s.x;if(m<this._minx)return!1;var x=r.y<s.y?r.y:s.y;if(x>this._maxy)return!1;var C=r.y>s.y?r.y:s.y;return!(C<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var R=arguments[0],M=arguments[1];return!this.isNull()&&!(R>this._maxx||R<this._minx||M>this._maxy||M<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var e=this.getWidth(),n=this.getHeight();return Math.sqrt(e*e+n*n)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof F){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof o){var n=arguments[0];if(n.isNull())return null;this.isNull()?(this._minx=n.getMinX(),this._maxx=n.getMaxX(),this._miny=n.getMinY(),this._maxy=n.getMaxY()):(n._minx<this._minx&&(this._minx=n._minx),n._maxx>this._maxx&&(this._maxx=n._maxx),n._miny<this._miny&&(this._miny=n._miny),n._maxy>this._maxy&&(this._maxy=n._maxy))}}else if(arguments.length===2){var r=arguments[0],s=arguments[1];this.isNull()?(this._minx=r,this._maxx=r,this._miny=s,this._maxy=s):(r<this._minx&&(this._minx=r),r>this._maxx&&(this._maxx=r),s<this._miny&&(this._miny=s),s>this._maxy&&(this._maxy=s))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var e=this.getWidth(),n=this.getHeight();return e<n?e:n}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(e){var n=e;return this.isNull()?n.isNull()?0:-1:n.isNull()?1:this._minx<n._minx?-1:this._minx>n._minx?1:this._miny<n._miny?-1:this._miny>n._miny?1:this._maxx<n._maxx?-1:this._maxx>n._maxx?1:this._maxy<n._maxy?-1:this._maxy>n._maxy?1:0}},{key:"translate",value:function(e,n){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+n,this.getMaxY()+n)}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(e){return!(!this.isNull()&&!e.isNull())||e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var e=this.getWidth(),n=this.getHeight();return e>n?e:n}},{key:"expandBy",value:function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];if(this.isNull())return null;this._minx-=n,this._maxx+=n,this._miny-=r,this._maxy+=r,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var e=arguments[0];return this.covers(e)}if(arguments[0]instanceof F){var n=arguments[0];return this.covers(n)}}else if(arguments.length===2){var r=arguments[0],s=arguments[1];return this.covers(r,s)}}},{key:"centre",value:function(){return this.isNull()?null:new F((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof F){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof o){var n=arguments[0];this._minx=n._minx,this._maxx=n._maxx,this._miny=n._miny,this._maxy=n._maxy}}else if(arguments.length===2){var r=arguments[0],s=arguments[1];this.init(r.x,s.x,r.y,s.y)}else if(arguments.length===4){var d=arguments[0],m=arguments[1],x=arguments[2],C=arguments[3];d<m?(this._minx=d,this._maxx=m):(this._minx=m,this._maxx=d),x<C?(this._miny=x,this._maxy=C):(this._miny=C,this._maxy=x)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(e){if(this.intersects(e))return 0;var n=0;this._maxx<e._minx?n=e._minx-this._maxx:this._minx>e._maxx&&(n=this._minx-e._maxx);var r=0;return this._maxy<e._miny?r=e._miny-this._maxy:this._miny>e._maxy&&(r=this._miny-e._maxy),n===0?r:r===0?n:Math.sqrt(n*n+r*r)}},{key:"hashCode",value:function(){var e=17;return e=37*(e=37*(e=37*(e=37*e+F.hashCode(this._minx))+F.hashCode(this._maxx))+F.hashCode(this._miny))+F.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[P,z]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof F){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof o){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var r=arguments[0],s=arguments[1];this.init(r.x,s.x,r.y,s.y)}else if(arguments.length===4){var d=arguments[0],m=arguments[1],x=arguments[2],C=arguments[3];this.init(d,m,x,C)}}},{key:"intersects",value:function(){if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2];return r.x>=(e.x<n.x?e.x:n.x)&&r.x<=(e.x>n.x?e.x:n.x)&&r.y>=(e.y<n.y?e.y:n.y)&&r.y<=(e.y>n.y?e.y:n.y)}if(arguments.length===4){var s=arguments[0],d=arguments[1],m=arguments[2],x=arguments[3],C=Math.min(m.x,x.x),R=Math.max(m.x,x.x),M=Math.min(s.x,d.x),q=Math.max(s.x,d.x);return!(M>R)&&!(q<C)&&(C=Math.min(m.y,x.y),R=Math.max(m.y,x.y),M=Math.min(s.y,d.y),q=Math.max(s.y,d.y),!(M>R)&&!(q<C))}}}]),o}(),ie=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===o.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(e){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(e){return this===e||this.equalsExact(e,0)}},{key:"geometryChanged",value:function(){this.apply(o.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(e){return e!==null&&this.norm().equalsExact(e.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var e;if(arguments.length===1){var n=arguments[0];return e=n,this.getTypeCode()!==e.getTypeCode()?this.getTypeCode()-e.getTypeCode():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(n)}if(arguments.length===2){var r=arguments[0],s=arguments[1];return e=r,this.getTypeCode()!==e.getTypeCode()?this.getTypeCode()-e.getTypeCode():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(r,s)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(e){if(e.getTypeCode()===o.TYPECODE_GEOMETRYCOLLECTION)throw new T("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(e,n,r){return r===0?e.equals(n):e.distance(n)<=r}},{key:"norm",value:function(){var e=this.copy();return e.normalize(),e}},{key:"reverse",value:function(){var e=this.reverseInternal();return this.envelope!=null&&(e.envelope=this.envelope.copy()),e.setSRID(this.getSRID()),e}},{key:"copy",value:function(){var e=this.copyInternal();return e.envelope=this._envelope==null?null:this._envelope.copy(),e._SRID=this._SRID,e._userData=this._userData,e}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new G(this._envelope)}},{key:"setSRID",value:function(e){this._SRID=e}},{key:"setUserData",value:function(e){this._userData=e}},{key:"compare",value:function(e,n){for(var r=e.iterator(),s=n.iterator();r.hasNext()&&s.hasNext();){var d=r.next(),m=s.next(),x=d.compareTo(m);if(x!==0)return x}return r.hasNext()?1:s.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(e){return this.getClass()===e.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===o.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===o.TYPECODE_MULTIPOINT||this.getTypeCode()===o.TYPECODE_MULTILINESTRING||this.getTypeCode()===o.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[D,P,z]}},{key:"getClass",value:function(){return o}}],[{key:"hasNonEmptyElements",value:function(e){for(var n=0;n<e.length;n++)if(!e[n].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(e){for(var n=0;n<e.length;n++)if(e[n]===null)return!0;return!1}}]),o}();ie.constructor_=function(o){o&&(this._envelope=null,this._userData=null,this._factory=o,this._SRID=o.getSRID())},ie.TYPECODE_POINT=0,ie.TYPECODE_MULTIPOINT=1,ie.TYPECODE_LINESTRING=2,ie.TYPECODE_LINEARRING=3,ie.TYPECODE_MULTILINESTRING=4,ie.TYPECODE_POLYGON=5,ie.TYPECODE_MULTIPOLYGON=6,ie.TYPECODE_GEOMETRYCOLLECTION=7,ie.TYPENAME_POINT="Point",ie.TYPENAME_MULTIPOINT="MultiPoint",ie.TYPENAME_LINESTRING="LineString",ie.TYPENAME_LINEARRING="LinearRing",ie.TYPENAME_MULTILINESTRING="MultiLineString",ie.TYPENAME_POLYGON="Polygon",ie.TYPENAME_MULTIPOLYGON="MultiPolygon",ie.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",ie.geometryChangedFilter={get interfaces_(){return[O]},filter:function(o){o.geometryChangedAction()}};var U=function(){function o(){l(this,o)}return p(o,null,[{key:"toLocationSymbol",value:function(e){switch(e){case o.EXTERIOR:return"e";case o.BOUNDARY:return"b";case o.INTERIOR:return"i";case o.NONE:return"-"}throw new T("Unknown location value: "+e)}}]),o}();U.INTERIOR=0,U.BOUNDARY=1,U.EXTERIOR=2,U.NONE=-1;var H=function(){function o(){l(this,o)}return p(o,[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}]),o}(),B=function(o){b(n,o);var e=k(n);function n(r){var s;return l(this,n),(s=e.call(this,r)).name=Object.keys({NoSuchElementException:n})[0],s}return n}(w),ne=function(o){b(n,o);var e=k(n);function n(r){var s;return l(this,n),(s=e.call(this,r)).name=Object.keys({UnsupportedOperationException:n})[0],s}return n}(w),pe=function(o){b(n,o);var e=k(n);function n(){return l(this,n),e.apply(this,arguments)}return p(n,[{key:"contains",value:function(){}}]),n}(H),Ie=function(o,e){b(r,o);var n=k(r);function r(s){var d;return l(this,r),(d=n.call(this)).map=new Map,s instanceof H&&d.addAll(s),d}return p(r,[{key:"contains",value:function(s){var d=s.hashCode?s.hashCode():s;return!!this.map.has(d)}},{key:"add",value:function(s){var d=s.hashCode?s.hashCode():s;return!this.map.has(d)&&!!this.map.set(d,s)}},{key:"addAll",value:function(s){var d,m=g(s);try{for(m.s();!(d=m.n()).done;){var x=d.value;this.add(x)}}catch(C){m.e(C)}finally{m.f()}return!0}},{key:"remove",value:function(){throw new ne}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new Ce(this.map)}},{key:e,value:function(){return this.map}}]),r}(pe,Symbol.iterator),Ce=function(){function o(e){l(this,o),this.iterator=e.values();var n=this.iterator.next(),r=n.done,s=n.value;this.done=r,this.value=s}return p(o,[{key:"next",value:function(){if(this.done)throw new B;var e=this.value,n=this.iterator.next(),r=n.done,s=n.value;return this.done=r,this.value=s,e}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new ne}}]),o}(),te=function(){function o(){l(this,o)}return p(o,null,[{key:"opposite",value:function(e){return e===o.LEFT?o.RIGHT:e===o.RIGHT?o.LEFT:e}}]),o}();te.ON=0,te.LEFT=1,te.RIGHT=2;var Je=function(o){b(n,o);var e=k(n);function n(r){var s;return l(this,n),(s=e.call(this,r)).name=Object.keys({EmptyStackException:n})[0],s}return n}(w),ht=function(o){b(n,o);var e=k(n);function n(r){var s;return l(this,n),(s=e.call(this,r)).name=Object.keys({IndexOutOfBoundsException:n})[0],s}return n}(w),Qe=function(o){b(n,o);var e=k(n);function n(){return l(this,n),e.apply(this,arguments)}return p(n,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}]),n}(H),et=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),(r=e.call(this)).array=[],r}return p(n,[{key:"add",value:function(r){return this.array.push(r),!0}},{key:"get",value:function(r){if(r<0||r>=this.size())throw new ht;return this.array[r]}},{key:"push",value:function(r){return this.array.push(r),r}},{key:"pop",value:function(){if(this.array.length===0)throw new Je;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new Je;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(r){return this.array.indexOf(r)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}]),n}(Qe);function ge(o,e){return o.interfaces_&&o.interfaces_.indexOf(e)>-1}var Ve=function(){function o(e){l(this,o),this.str=e}return p(o,[{key:"append",value:function(e){this.str+=e}},{key:"setCharAt",value:function(e,n){this.str=this.str.substr(0,e)+n+this.str.substr(e+1)}},{key:"toString",value:function(){return this.str}}]),o}(),Ht=function(){function o(e){l(this,o),this.value=e}return p(o,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(e){return this.value<e?-1:this.value>e?1:0}}],[{key:"compare",value:function(e,n){return e<n?-1:e>n?1:0}},{key:"isNan",value:function(e){return Number.isNaN(e)}},{key:"valueOf",value:function(e){return new o(e)}}]),o}(),Zt=function(){function o(){l(this,o)}return p(o,null,[{key:"isWhitespace",value:function(e){return e<=32&&e>=0||e===127}},{key:"toUpperCase",value:function(e){return e.toUpperCase()}}]),o}(),xe=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"le",value:function(e){return this._hi<e._hi||this._hi===e._hi&&this._lo<=e._lo}},{key:"extractSignificantDigits",value:function(e,n){var r=this.abs(),s=o.magnitude(r._hi),d=o.TEN.pow(s);(r=r.divide(d)).gt(o.TEN)?(r=r.divide(o.TEN),s+=1):r.lt(o.ONE)&&(r=r.multiply(o.TEN),s-=1);for(var m=s+1,x=new Ve,C=o.MAX_PRINT_DIGITS-1,R=0;R<=C;R++){e&&R===m&&x.append(".");var M=Math.trunc(r._hi);if(M<0)break;var q=!1,K=0;M>9?(q=!0,K="9"):K="0"+M,x.append(K),r=r.subtract(o.valueOf(M)).multiply(o.TEN),q&&r.selfAdd(o.TEN);var ae=!0,se=o.magnitude(r._hi);if(se<0&&Math.abs(se)>=C-R&&(ae=!1),!ae)break}return n[0]=s,x.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof o){var e=arguments[0];return this.add(e.negate())}if(typeof arguments[0]=="number"){var n=arguments[0];return this.add(-n)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof o){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof o){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}if(typeof arguments[0]=="number"){var n=arguments[0];return this.isNaN()?this:this.selfAdd(-n,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(e){return this.le(e)?this:e}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}if(typeof arguments[0]=="number"){var n=arguments[0];return this.selfDivide(n,0)}}else if(arguments.length===2){var r=arguments[0],s=arguments[1],d=null,m=null,x=null,C=null,R=null,M=null,q=null,K=null;return R=this._hi/r,K=(d=(M=o.SPLIT*R)-(d=M-R))*(x=(K=o.SPLIT*r)-(x=K-r))-(q=R*r)+d*(C=r-x)+(m=R-d)*x+m*C,K=R+(M=(this._hi-q-K+this._lo-R*s)/r),this._hi=K,this._lo=R-K+M,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof o){var e=arguments[0],n=null,r=null,s=null,d=null,m=null,x=null,C=null,R=null;r=(m=this._hi/e._hi)-(n=(x=o.SPLIT*m)-(n=x-m)),R=n*(s=(R=o.SPLIT*e._hi)-(s=R-e._hi))-(C=m*e._hi)+n*(d=e._hi-s)+r*s+r*d;var M=R=m+(x=(this._hi-C-R+this._lo-m*e._lo)/e._hi),q=m-R+x;return new o(M,q)}if(typeof arguments[0]=="number"){var K=arguments[0];return J.isNaN(K)?o.createNaN():o.copy(this).selfDivide(K,0)}}},{key:"ge",value:function(e){return this._hi>e._hi||this._hi===e._hi&&this._lo>=e._lo}},{key:"pow",value:function(e){if(e===0)return o.valueOf(1);var n=new o(this),r=o.valueOf(1),s=Math.abs(e);if(s>1)for(;s>0;)s%2==1&&r.selfMultiply(n),(s/=2)>0&&(n=n.sqr());else r=n;return e<0?r.reciprocal():r}},{key:"ceil",value:function(){if(this.isNaN())return o.NaN;var e=Math.ceil(this._hi),n=0;return e===this._hi&&(n=Math.ceil(this._lo)),new o(e,n)}},{key:"compareTo",value:function(e){var n=e;return this._hi<n._hi?-1:this._hi>n._hi?1:this._lo<n._lo?-1:this._lo>n._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof o){var e=arguments[0];return this.init(e),this}if(typeof arguments[0]=="number"){var n=arguments[0];return this.init(n),this}}},{key:"max",value:function(e){return this.ge(e)?this:e}},{key:"sqrt",value:function(){if(this.isZero())return o.valueOf(0);if(this.isNegative())return o.NaN;var e=1/Math.sqrt(this._hi),n=this._hi*e,r=o.valueOf(n),s=this.subtract(r.sqr())._hi*(.5*e);return r.add(s)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}if(typeof arguments[0]=="number"){var n=arguments[0],r=null,s=null,d=null,m=null,x=null,C=null;return m=(d=this._hi+n)-(x=d-this._hi),s=(C=(m=n-x+(this._hi-m))+this._lo)+(d-(r=d+C)),this._hi=r+s,this._lo=s+(r-this._hi),this}}else if(arguments.length===2){var R=arguments[0],M=arguments[1],q=null,K=null,ae=null,se=null,ye=null,_e=null,ke=null;se=this._hi+R,K=this._lo+M,ye=se-(_e=se-this._hi),ae=K-(ke=K-this._lo);var Ue=(q=se+(_e=(ye=R-_e+(this._hi-ye))+K))+(_e=(ae=M-ke+(this._lo-ae))+(_e+(se-q))),qe=_e+(q-Ue);return this._hi=Ue,this._lo=qe,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}if(typeof arguments[0]=="number"){var n=arguments[0];return this.selfMultiply(n,0)}}else if(arguments.length===2){var r=arguments[0],s=arguments[1],d=null,m=null,x=null,C=null,R=null,M=null;d=(R=o.SPLIT*this._hi)-this._hi,M=o.SPLIT*r,d=R-d,m=this._hi-d,x=M-r;var q=(R=this._hi*r)+(M=d*(x=M-x)-R+d*(C=r-x)+m*x+m*C+(this._hi*s+this._lo*r)),K=M+(d=R-q);return this._hi=q,this._lo=K,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return o.NaN;var e=Math.floor(this._hi),n=0;return e===this._hi&&(n=Math.floor(this._lo)),new o(e,n)}},{key:"negate",value:function(){return this.isNaN()?this:new o(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(e){if(e instanceof CloneNotSupportedException)return null;throw e}}},{key:"multiply",value:function(){if(arguments[0]instanceof o){var e=arguments[0];return e.isNaN()?o.createNaN():o.copy(this).selfMultiply(e)}if(typeof arguments[0]=="number"){var n=arguments[0];return J.isNaN(n)?o.createNaN():o.copy(this).selfMultiply(n,0)}}},{key:"isNaN",value:function(){return J.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var e=o.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var e=this.getSpecialNumberString();if(e!==null)return e;var n=new Array(1).fill(null),r=this.extractSignificantDigits(!0,n),s=n[0]+1,d=r;if(r.charAt(0)===".")d="0"+r;else if(s<0)d="0."+o.stringOfChar("0",-s)+r;else if(r.indexOf(".")===-1){var m=s-r.length;d=r+o.stringOfChar("0",m)+".0"}return this.isNegative()?"-"+d:d}},{key:"reciprocal",value:function(){var e,n,r,s,d=null,m=null,x=null,C=null;e=(r=1/this._hi)-(d=(x=o.SPLIT*r)-(d=x-r)),m=(C=o.SPLIT*this._hi)-this._hi;var R=r+(x=(1-(s=r*this._hi)-(C=d*(m=C-m)-s+d*(n=this._hi-m)+e*m+e*n)-r*this._lo)/this._hi);return new o(R,r-R+x)}},{key:"toSciNotation",value:function(){if(this.isZero())return o.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var n=new Array(1).fill(null),r=this.extractSignificantDigits(!1,n),s=o.SCI_NOT_EXPONENT_CHAR+n[0];if(r.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+r);var d="";r.length>1&&(d=r.substring(1));var m=r.charAt(0)+"."+d;return this.isNegative()?"-"+m+s:m+s}},{key:"abs",value:function(){return this.isNaN()?o.NaN:this.isNegative()?this.negate():new o(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(e){return this._hi<e._hi||this._hi===e._hi&&this._lo<e._lo}},{key:"add",value:function(){if(arguments[0]instanceof o){var e=arguments[0];return o.copy(this).selfAdd(e)}if(typeof arguments[0]=="number"){var n=arguments[0];return o.copy(this).selfAdd(n)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof o){var n=arguments[0];this._hi=n._hi,this._lo=n._lo}}else if(arguments.length===2){var r=arguments[0],s=arguments[1];this._hi=r,this._lo=s}}},{key:"gt",value:function(e){return this._hi>e._hi||this._hi===e._hi&&this._lo>e._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?o.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[z,P,D]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof o){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var r=arguments[0];o.constructor_.call(this,o.parse(r))}}else if(arguments.length===2){var s=arguments[0],d=arguments[1];this.init(s,d)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1],r=arguments[2],s=arguments[3];return o.determinant(o.valueOf(e),o.valueOf(n),o.valueOf(r),o.valueOf(s))}if(arguments[3]instanceof o&&arguments[2]instanceof o&&arguments[0]instanceof o&&arguments[1]instanceof o){var d=arguments[0],m=arguments[1],x=arguments[2],C=arguments[3],R=d.multiply(C).selfSubtract(m.multiply(x));return R}}},{key:"sqr",value:function(e){return o.valueOf(e).selfMultiply(e)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var e=arguments[0];return o.parse(e)}if(typeof arguments[0]=="number"){var n=arguments[0];return new o(n)}}},{key:"sqrt",value:function(e){return o.valueOf(e).sqrt()}},{key:"parse",value:function(e){for(var n=0,r=e.length;Zt.isWhitespace(e.charAt(n));)n++;var s=!1;if(n<r){var d=e.charAt(n);d!=="-"&&d!=="+"||(n++,d==="-"&&(s=!0))}for(var m=new o,x=0,C=0,R=0,M=!1;!(n>=r);){var q=e.charAt(n);if(n++,Zt.isDigit(q)){var K=q-"0";m.selfMultiply(o.TEN),m.selfAdd(K),x++}else{if(q!=="."){if(q==="e"||q==="E"){var ae=e.substring(n);try{R=Ht.parseInt(ae)}catch(Ue){throw Ue instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+ae+" in string "+e):Ue}break}throw new NumberFormatException("Unexpected character '"+q+"' at position "+n+" in string "+e)}C=x,M=!0}}var se=m;M||(C=x);var ye=x-C-R;if(ye===0)se=m;else if(ye>0){var _e=o.TEN.pow(ye);se=m.divide(_e)}else if(ye<0){var ke=o.TEN.pow(-ye);se=m.multiply(ke)}return s?se.negate():se}},{key:"createNaN",value:function(){return new o(J.NaN,J.NaN)}},{key:"copy",value:function(e){return new o(e)}},{key:"magnitude",value:function(e){var n=Math.abs(e),r=Math.log(n)/Math.log(10),s=Math.trunc(Math.floor(r));return 10*Math.pow(10,s)<=n&&(s+=1),s}},{key:"stringOfChar",value:function(e,n){for(var r=new Ve,s=0;s<n;s++)r.append(e);return r.toString()}}]),o}();xe.PI=new xe(3.141592653589793,12246467991473532e-32),xe.TWO_PI=new xe(6.283185307179586,24492935982947064e-32),xe.PI_2=new xe(1.5707963267948966,6123233995736766e-32),xe.E=new xe(2.718281828459045,14456468917292502e-32),xe.NaN=new xe(J.NaN,J.NaN),xe.EPS=123259516440783e-46,xe.SPLIT=134217729,xe.MAX_PRINT_DIGITS=32,xe.TEN=xe.valueOf(10),xe.ONE=xe.valueOf(1),xe.SCI_NOT_EXPONENT_CHAR="E",xe.SCI_NOT_ZERO="0.0E0";var Un=function(){function o(){l(this,o)}return p(o,null,[{key:"orientationIndex",value:function(e,n,r){var s=o.orientationIndexFilter(e,n,r);if(s<=1)return s;var d=xe.valueOf(n.x).selfAdd(-e.x),m=xe.valueOf(n.y).selfAdd(-e.y),x=xe.valueOf(r.x).selfAdd(-n.x),C=xe.valueOf(r.y).selfAdd(-n.y);return d.selfMultiply(C).selfSubtract(m.selfMultiply(x)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof xe&&arguments[2]instanceof xe&&arguments[0]instanceof xe&&arguments[1]instanceof xe){var e=arguments[0],n=arguments[1],r=arguments[2],s=arguments[3],d=e.multiply(s).selfSubtract(n.multiply(r));return d.signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var m=arguments[0],x=arguments[1],C=arguments[2],R=arguments[3],M=xe.valueOf(m),q=xe.valueOf(x),K=xe.valueOf(C),ae=xe.valueOf(R),se=M.multiply(ae).selfSubtract(q.multiply(K));return se.signum()}}},{key:"intersection",value:function(e,n,r,s){var d=new xe(e.y).selfSubtract(n.y),m=new xe(n.x).selfSubtract(e.x),x=new xe(e.x).selfMultiply(n.y).selfSubtract(new xe(n.x).selfMultiply(e.y)),C=new xe(r.y).selfSubtract(s.y),R=new xe(s.x).selfSubtract(r.x),M=new xe(r.x).selfMultiply(s.y).selfSubtract(new xe(s.x).selfMultiply(r.y)),q=m.multiply(M).selfSubtract(R.multiply(x)),K=C.multiply(x).selfSubtract(d.multiply(M)),ae=d.multiply(R).selfSubtract(C.multiply(m)),se=q.selfDivide(ae).doubleValue(),ye=K.selfDivide(ae).doubleValue();return J.isNaN(se)||J.isInfinite(se)||J.isNaN(ye)||J.isInfinite(ye)?null:new F(se,ye)}},{key:"orientationIndexFilter",value:function(e,n,r){var s=null,d=(e.x-r.x)*(n.y-r.y),m=(e.y-r.y)*(n.x-r.x),x=d-m;if(d>0){if(m<=0)return o.signum(x);s=d+m}else{if(!(d<0)||m>=0)return o.signum(x);s=-d-m}var C=o.DP_SAFE_EPSILON*s;return x>=C||-x>=C?o.signum(x):2}},{key:"signum",value:function(e){return e>0?1:e<0?-1:0}}]),o}();Un.DP_SAFE_EPSILON=1e-15;var Le=function(){function o(){l(this,o)}return p(o,[{key:"getM",value:function(e){if(this.hasM()){var n=this.getDimension()-this.getMeasures();return this.getOrdinate(e,n)}return J.NaN}},{key:"setOrdinate",value:function(e,n,r){}},{key:"getZ",value:function(e){return this.hasZ()?this.getOrdinate(e,2):J.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(e,n){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(e){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(e){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(e){}},{key:"copy",value:function(){}},{key:"getY",value:function(e){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[D]}}]),o}();Le.X=0,Le.Y=1,Le.Z=2,Le.M=3;var we=function(){function o(){l(this,o)}return p(o,null,[{key:"index",value:function(e,n,r){return Un.orientationIndex(e,n,r)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var e=arguments[0],n=e.length-1;if(n<3)throw new T("Ring has fewer than 4 points, so orientation cannot be determined");for(var r=e[0],s=0,d=1;d<=n;d++){var m=e[d];m.y>r.y&&(r=m,s=d)}var x=s;do(x-=1)<0&&(x=n);while(e[x].equals2D(r)&&x!==s);var C=s;do C=(C+1)%n;while(e[C].equals2D(r)&&C!==s);var R=e[x],M=e[C];if(R.equals2D(r)||M.equals2D(r)||R.equals2D(M))return!1;var q=o.index(R,r,M),K=null;return K=q===0?R.x>M.x:q>0,K}if(ge(arguments[0],Le)){var ae=arguments[0],se=ae.size()-1;if(se<3)throw new T("Ring has fewer than 4 points, so orientation cannot be determined");for(var ye=ae.getCoordinate(0),_e=0,ke=1;ke<=se;ke++){var Ue=ae.getCoordinate(ke);Ue.y>ye.y&&(ye=Ue,_e=ke)}var qe=null,nt=_e;do(nt-=1)<0&&(nt=se),qe=ae.getCoordinate(nt);while(qe.equals2D(ye)&&nt!==_e);var gt=null,Lt=_e;do Lt=(Lt+1)%se,gt=ae.getCoordinate(Lt);while(gt.equals2D(ye)&&Lt!==_e);if(qe.equals2D(ye)||gt.equals2D(ye)||qe.equals2D(gt))return!1;var qt=o.index(qe,ye,gt);return qt===0?qe.x>gt.x:qt>0}}}]),o}();we.CLOCKWISE=-1,we.RIGHT=we.CLOCKWISE,we.COUNTERCLOCKWISE=1,we.LEFT=we.COUNTERCLOCKWISE,we.COLLINEAR=0,we.STRAIGHT=we.COLLINEAR;var Co=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(e,n){var r=this.getRightmostSideOfSegment(e,n);return r<0&&(r=this.getRightmostSideOfSegment(e,n-1)),r<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),r}},{key:"findRightmostEdgeAtVertex",value:function(){var e=this._minDe.getEdge().getCoordinates();re.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var n=e[this._minIndex-1],r=e[this._minIndex+1],s=we.index(this._minCoord,r,n),d=!1;(n.y<this._minCoord.y&&r.y<this._minCoord.y&&s===we.COUNTERCLOCKWISE||n.y>this._minCoord.y&&r.y>this._minCoord.y&&s===we.CLOCKWISE)&&(d=!0),d&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(e,n){var r=e.getEdge().getCoordinates();if(n<0||n+1>=r.length||r[n].y===r[n+1].y)return-1;var s=te.LEFT;return r[n].y<r[n+1].y&&(s=te.RIGHT),s}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(e){for(var n=e.getEdge().getCoordinates(),r=0;r<n.length-1;r++)(this._minCoord===null||n[r].x>this._minCoord.x)&&(this._minDe=e,this._minIndex=r,this._minCoord=n[r])}},{key:"findRightmostEdgeAtNode",value:function(){var e=this._minDe.getNode().getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(e){for(var n=e.iterator();n.hasNext();){var r=n.next();r.isForward()&&this.checkForRightmostCoordinate(r)}re.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===te.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}]),o}(),Ft=function(o){b(n,o);var e=k(n);function n(r,s){var d;return l(this,n),(d=e.call(this,s?r+" [ "+s+" ]":r)).pt=s?new F(s):void 0,d.name=Object.keys({TopologyException:n})[0],d}return p(n,[{key:"getCoordinate",value:function(){return this.pt}}]),n}(le),No=function(){function o(){l(this,o),this.array=[]}return p(o,[{key:"addLast",value:function(e){this.array.push(e)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}]),o}(),Ee=function(o,e){b(r,o);var n=k(r);function r(s){var d;return l(this,r),(d=n.call(this)).array=[],s instanceof H&&d.addAll(s),d}return p(r,[{key:"interfaces_",get:function(){return[Qe,H]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(s){return arguments.length===1?this.array.push(s):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(s){var d,m=g(s);try{for(m.s();!(d=m.n()).done;){var x=d.value;this.array.push(x)}}catch(C){m.e(C)}finally{m.f()}}},{key:"set",value:function(s,d){var m=this.array[s];return this.array[s]=d,m}},{key:"iterator",value:function(){return new Lo(this)}},{key:"get",value:function(s){if(s<0||s>=this.size())throw new ht;return this.array[s]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(s){s?this.array.sort(function(d,m){return s.compare(d,m)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(s){for(var d=0,m=this.array.length;d<m;d++)if(this.array[d]===s)return!!this.array.splice(d,1);return!1}},{key:e,value:function(){return this.array.values()}}]),r}(Qe,Symbol.iterator),Lo=function(){function o(e){l(this,o),this.arrayList=e,this.position=0}return p(o,[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new B;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(e){return this.arrayList.set(this.position-1,e)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}]),o}(),To=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"clearVisitedEdges",value:function(){for(var e=this._dirEdgeList.iterator();e.hasNext();)e.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(e){for(var n=null,r=e.getEdges().iterator();r.hasNext();){var s=r.next();if(s.isVisited()||s.getSym().isVisited()){n=s;break}}if(n===null)throw new Ft("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(n);for(var d=e.getEdges().iterator();d.hasNext();){var m=d.next();m.setVisited(!0),this.copySymDepths(m)}}},{key:"computeDepth",value:function(e){this.clearVisitedEdges();var n=this._finder.getEdge();n.getNode(),n.getLabel(),n.setEdgeDepths(te.RIGHT,e),this.copySymDepths(n),this.computeDepths(n)}},{key:"create",value:function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var n=e.next();n.getDepth(te.RIGHT)>=1&&n.getDepth(te.LEFT)<=0&&!n.isInteriorAreaEdge()&&n.setInResult(!0)}}},{key:"computeDepths",value:function(e){var n=new Ie,r=new No,s=e.getNode();for(r.addLast(s),n.add(s),e.setVisited(!0);!r.isEmpty();){var d=r.removeFirst();n.add(d),this.computeNodeDepth(d);for(var m=d.getEdges().iterator();m.hasNext();){var x=m.next().getSym();if(!x.isVisited()){var C=x.getNode();n.contains(C)||(r.addLast(C),n.add(C))}}}}},{key:"compareTo",value:function(e){var n=e;return this._rightMostCoord.x<n._rightMostCoord.x?-1:this._rightMostCoord.x>n._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var e=new G,n=this._dirEdgeList.iterator();n.hasNext();)for(var r=n.next().getEdge().getCoordinates(),s=0;s<r.length-1;s++)e.expandToInclude(r[s]);this._env=e}return this._env}},{key:"addReachable",value:function(e){var n=new et;for(n.add(e);!n.empty();){var r=n.pop();this.add(r,n)}}},{key:"copySymDepths",value:function(e){var n=e.getSym();n.setDepth(te.LEFT,e.getDepth(te.RIGHT)),n.setDepth(te.RIGHT,e.getDepth(te.LEFT))}},{key:"add",value:function(e,n){e.setVisited(!0),this._nodes.add(e);for(var r=e.getEdges().iterator();r.hasNext();){var s=r.next();this._dirEdgeList.add(s);var d=s.getSym().getNode();d.isVisited()||n.push(d)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[P]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new Ee,this._nodes=new Ee,this._rightMostCoord=null,this._env=null,this._finder=new Co}}]),o}(),Pn=function(){function o(){l(this,o)}return p(o,null,[{key:"intersection",value:function(e,n,r,s){var d=e.x<n.x?e.x:n.x,m=e.y<n.y?e.y:n.y,x=e.x>n.x?e.x:n.x,C=e.y>n.y?e.y:n.y,R=r.x<s.x?r.x:s.x,M=r.y<s.y?r.y:s.y,q=r.x>s.x?r.x:s.x,K=r.y>s.y?r.y:s.y,ae=((d>R?d:R)+(x<q?x:q))/2,se=((m>M?m:M)+(C<K?C:K))/2,ye=e.x-ae,_e=e.y-se,ke=n.x-ae,Ue=n.y-se,qe=r.x-ae,nt=r.y-se,gt=s.x-ae,Lt=s.y-se,qt=_e-Ue,ii=ke-ye,Yi=ye*Ue-ke*_e,$i=nt-Lt,mi=gt-qe,Ts=qe*Lt-gt*nt,As=qt*mi-$i*ii,Kn=(ii*Ts-mi*Yi)/As,Jn=($i*Yi-qt*Ts)/As;return J.isNaN(Kn)||J.isInfinite(Kn)||J.isNaN(Jn)||J.isInfinite(Jn)?null:new F(Kn+ae,Jn+se)}}]),o}(),_t=function(){function o(){l(this,o)}return p(o,null,[{key:"arraycopy",value:function(e,n,r,s,d){for(var m=0,x=n;x<n+d;x++)r[s+m]=e[x],m++}},{key:"getProperty",value:function(e){return{"line.separator":`
`}[e]}}]),o}(),Pi=function(){function o(){l(this,o)}return p(o,null,[{key:"log10",value:function(e){var n=Math.log(e);return J.isInfinite(n)||J.isNaN(n)?n:n/o.LOG_10}},{key:"min",value:function(e,n,r,s){var d=e;return n<d&&(d=n),r<d&&(d=r),s<d&&(d=s),d}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1],r=arguments[2];return e<n?n:e>r?r:e}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var s=arguments[0],d=arguments[1],m=arguments[2];return s<d?d:s>m?m:s}}},{key:"wrap",value:function(e,n){return e<0?n- -e%n:e%n}},{key:"max",value:function(){if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2],s=e;return n>s&&(s=n),r>s&&(s=r),s}if(arguments.length===4){var d=arguments[0],m=arguments[1],x=arguments[2],C=arguments[3],R=d;return m>R&&(R=m),x>R&&(R=x),C>R&&(R=C),R}}},{key:"average",value:function(e,n){return(e+n)/2}}]),o}();Pi.LOG_10=Math.log(10);var At=function(){function o(){l(this,o)}return p(o,null,[{key:"segmentToSegment",value:function(e,n,r,s){if(e.equals(n))return o.pointToSegment(e,r,s);if(r.equals(s))return o.pointToSegment(s,e,n);var d=!1;if(G.intersects(e,n,r,s)){var m=(n.x-e.x)*(s.y-r.y)-(n.y-e.y)*(s.x-r.x);if(m===0)d=!0;else{var x=(e.y-r.y)*(s.x-r.x)-(e.x-r.x)*(s.y-r.y),C=((e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y))/m,R=x/m;(R<0||R>1||C<0||C>1)&&(d=!0)}}else d=!0;return d?Pi.min(o.pointToSegment(e,r,s),o.pointToSegment(n,r,s),o.pointToSegment(r,e,n),o.pointToSegment(s,e,n)):0}},{key:"pointToSegment",value:function(e,n,r){if(n.x===r.x&&n.y===r.y)return e.distance(n);var s=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y),d=((e.x-n.x)*(r.x-n.x)+(e.y-n.y)*(r.y-n.y))/s;if(d<=0)return e.distance(n);if(d>=1)return e.distance(r);var m=((n.y-e.y)*(r.x-n.x)-(n.x-e.x)*(r.y-n.y))/s;return Math.abs(m)*Math.sqrt(s)}},{key:"pointToLinePerpendicular",value:function(e,n,r){var s=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y),d=((n.y-e.y)*(r.x-n.x)-(n.x-e.x)*(r.y-n.y))/s;return Math.abs(d)*Math.sqrt(s)}},{key:"pointToSegmentString",value:function(e,n){if(n.length===0)throw new T("Line array must contain at least one vertex");for(var r=e.distance(n[0]),s=0;s<n.length-1;s++){var d=o.pointToSegment(e,n[s],n[s+1]);d<r&&(r=d)}return r}}]),o}(),Hr=function(){function o(){l(this,o)}return p(o,[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||ge(arguments[0],Le);else if(arguments.length!==2){if(arguments.length===3){var e=arguments[0],n=arguments[1];return this.create(e,n)}}}}]),o}(),en=function(){function o(){l(this,o)}return p(o,[{key:"filter",value:function(e){}}]),o}(),Ao=function(){function o(){l(this,o)}return p(o,null,[{key:"ofLine",value:function(e){var n=e.size();if(n<=1)return 0;var r=0,s=new F;e.getCoordinate(0,s);for(var d=s.x,m=s.y,x=1;x<n;x++){e.getCoordinate(x,s);var C=s.x,R=s.y,M=C-d,q=R-m;r+=Math.sqrt(M*M+q*q),d=C,m=R}return r}}]),o}(),Vr=function o(){l(this,o)},Wt=function(){function o(){l(this,o)}return p(o,null,[{key:"copyCoord",value:function(e,n,r,s){for(var d=Math.min(e.getDimension(),r.getDimension()),m=0;m<d;m++)r.setOrdinate(s,m,e.getOrdinate(n,m))}},{key:"isRing",value:function(e){var n=e.size();return n===0||!(n<=3)&&e.getOrdinate(0,Le.X)===e.getOrdinate(n-1,Le.X)&&e.getOrdinate(0,Le.Y)===e.getOrdinate(n-1,Le.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(ge(arguments[0],Le)&&Number.isInteger(arguments[1])){var e=arguments[0],n=arguments[1];o.scroll(e,n,o.isRing(e))}else if(ge(arguments[0],Le)&&arguments[1]instanceof F){var r=arguments[0],s=arguments[1],d=o.indexOf(s,r);if(d<=0)return null;o.scroll(r,d)}}else if(arguments.length===3){var m=arguments[0],x=arguments[1],C=arguments[2],R=x;if(R<=0)return null;for(var M=m.copy(),q=C?m.size()-1:m.size(),K=0;K<q;K++)for(var ae=0;ae<m.getDimension();ae++)m.setOrdinate(K,ae,M.getOrdinate((x+K)%q,ae));if(C)for(var se=0;se<m.getDimension();se++)m.setOrdinate(q,se,m.getOrdinate(0,se))}}},{key:"isEqual",value:function(e,n){var r=e.size();if(r!==n.size())return!1;for(var s=Math.min(e.getDimension(),n.getDimension()),d=0;d<r;d++)for(var m=0;m<s;m++){var x=e.getOrdinate(d,m),C=n.getOrdinate(d,m);if(e.getOrdinate(d,m)!==n.getOrdinate(d,m)&&(!J.isNaN(x)||!J.isNaN(C)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var e=arguments[0];return o.minCoordinateIndex(e,0,e.size()-1)}if(arguments.length===3){for(var n=arguments[0],r=arguments[1],s=arguments[2],d=-1,m=null,x=r;x<=s;x++){var C=n.getCoordinate(x);(m===null||m.compareTo(C)>0)&&(m=C,d=x)}return d}}},{key:"extend",value:function(e,n,r){var s=e.create(r,n.getDimension()),d=n.size();if(o.copy(n,0,s,0,d),d>0)for(var m=d;m<r;m++)o.copy(n,d-1,s,m,1);return s}},{key:"reverse",value:function(e){for(var n=e.size()-1,r=Math.trunc(n/2),s=0;s<=r;s++)o.swap(e,s,n-s)}},{key:"swap",value:function(e,n,r){if(n===r)return null;for(var s=0;s<e.getDimension();s++){var d=e.getOrdinate(n,s);e.setOrdinate(n,s,e.getOrdinate(r,s)),e.setOrdinate(r,s,d)}}},{key:"copy",value:function(e,n,r,s,d){for(var m=0;m<d;m++)o.copyCoord(e,n+m,r,s+m)}},{key:"ensureValidRing",value:function(e,n){var r=n.size();return r===0?n:r<=3?o.createClosedRing(e,n,4):n.getOrdinate(0,Le.X)===n.getOrdinate(r-1,Le.X)&&n.getOrdinate(0,Le.Y)===n.getOrdinate(r-1,Le.Y)?n:o.createClosedRing(e,n,r+1)}},{key:"indexOf",value:function(e,n){for(var r=0;r<n.size();r++)if(e.x===n.getOrdinate(r,Le.X)&&e.y===n.getOrdinate(r,Le.Y))return r;return-1}},{key:"createClosedRing",value:function(e,n,r){var s=e.create(r,n.getDimension()),d=n.size();o.copy(n,0,s,0,d);for(var m=d;m<r;m++)o.copy(n,0,s,m,1);return s}},{key:"minCoordinate",value:function(e){for(var n=null,r=0;r<e.size();r++){var s=e.getCoordinate(r);(n===null||n.compareTo(s)>0)&&(n=s)}return n}}]),o}(),he=function(){function o(){l(this,o)}return p(o,null,[{key:"toDimensionSymbol",value:function(e){switch(e){case o.FALSE:return o.SYM_FALSE;case o.TRUE:return o.SYM_TRUE;case o.DONTCARE:return o.SYM_DONTCARE;case o.P:return o.SYM_P;case o.L:return o.SYM_L;case o.A:return o.SYM_A}throw new T("Unknown dimension value: "+e)}},{key:"toDimensionValue",value:function(e){switch(Zt.toUpperCase(e)){case o.SYM_FALSE:return o.FALSE;case o.SYM_TRUE:return o.TRUE;case o.SYM_DONTCARE:return o.DONTCARE;case o.SYM_P:return o.P;case o.SYM_L:return o.L;case o.SYM_A:return o.A}throw new T("Unknown dimension symbol: "+e)}}]),o}();he.P=0,he.L=1,he.A=2,he.FALSE=-1,he.TRUE=-2,he.DONTCARE=-3,he.SYM_FALSE="F",he.SYM_TRUE="T",he.SYM_DONTCARE="*",he.SYM_P="0",he.SYM_L="1",he.SYM_A="2";var tn=function(){function o(){l(this,o)}return p(o,[{key:"filter",value:function(e){}}]),o}(),nn=function(){function o(){l(this,o)}return p(o,[{key:"filter",value:function(e,n){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}]),o}(),Mi=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new G:this._points.expandEnvelope(new G)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new n(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof ie){var r=arguments[0],s=arguments[1];if(!this.isEquivalentClass(r))return!1;var d=r;if(this._points.size()!==d._points.size())return!1;for(var m=0;m<this._points.size();m++)if(!this.equal(this._points.getCoordinate(m),d._points.getCoordinate(m),s))return!1;return!0}return A(I(n.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var r=0;r<Math.trunc(this._points.size()/2);r++){var s=this._points.size()-1-r;if(!this._points.getCoordinate(r).equals(this._points.getCoordinate(s))){if(this._points.getCoordinate(r).compareTo(this._points.getCoordinate(s))>0){var d=this._points.copy();Wt.reverse(d),this._points=d}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?he.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var r=this._points.copy();return Wt.reverse(r),this.getFactory().createLineString(r)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return ie.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return Ao.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var r=arguments[0],s=r,d=0,m=0;d<this._points.size()&&m<s._points.size();){var x=this._points.getCoordinate(d).compareTo(s._points.getCoordinate(m));if(x!==0)return x;d++,m++}return d<this._points.size()?1:m<s._points.size()?-1:0}if(arguments.length===2){var C=arguments[0],R=arguments[1],M=C;return R.compare(this._points,M._points)}}},{key:"apply",value:function(){if(ge(arguments[0],en))for(var r=arguments[0],s=0;s<this._points.size();s++)r.filter(this._points.getCoordinate(s));else if(ge(arguments[0],nn)){var d=arguments[0];if(this._points.size()===0)return null;for(var m=0;m<this._points.size()&&(d.filter(this._points,m),!d.isDone());m++);d.isGeometryChanged()&&this.geometryChanged()}else if(ge(arguments[0],tn)){var x=arguments[0];x.filter(this)}else if(ge(arguments[0],O)){var C=arguments[0];C.filter(this)}}},{key:"getBoundary",value:function(){throw new ne}},{key:"isEquivalentClass",value:function(r){return r instanceof n}},{key:"getCoordinateN",value:function(r){return this._points.getCoordinate(r)}},{key:"getGeometryType",value:function(){return ie.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(r){if(r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),r.size()===1)throw new T("Invalid number of points in LineString (found "+r.size()+" - must be 0 or >= 2)");this._points=r}},{key:"isCoordinate",value:function(r){for(var s=0;s<this._points.size();s++)if(this._points.getCoordinate(s).equals(r))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(r){return this.getFactory().createPoint(this._points.getCoordinate(r))}},{key:"interfaces_",get:function(){return[Vr]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var r=arguments[0],s=arguments[1];ie.constructor_.call(this,s),this.init(r)}}}}]),n}(ie),jr=function o(){l(this,o)},Mn=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new G;var r=new G;return r.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),r}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new n(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof ie){var r=arguments[0],s=arguments[1];return!!this.isEquivalentClass(r)&&(!(!this.isEmpty()||!r.isEmpty())||this.isEmpty()===r.isEmpty()&&this.equal(r.getCoordinate(),this.getCoordinate(),s))}return A(I(n.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return he.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return ie.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var r=arguments[0],s=r;return this.getCoordinate().compareTo(s.getCoordinate())}if(arguments.length===2){var d=arguments[0],m=arguments[1],x=d;return m.compare(this._coordinates,x._coordinates)}}},{key:"apply",value:function(){if(ge(arguments[0],en)){var r=arguments[0];if(this.isEmpty())return null;r.filter(this.getCoordinate())}else if(ge(arguments[0],nn)){var s=arguments[0];if(this.isEmpty())return null;s.filter(this._coordinates,0),s.isGeometryChanged()&&this.geometryChanged()}else if(ge(arguments[0],tn)){var d=arguments[0];d.filter(this)}else if(ge(arguments[0],O)){var m=arguments[0];m.filter(this)}}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return ie.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(r){r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),re.isTrue(r.size()<=1),this._coordinates=r}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[jr]}}],[{key:"constructor_",value:function(){this._coordinates=null;var r=arguments[0],s=arguments[1];ie.constructor_.call(this,s),this.init(r)}}]),n}(ie),Xr=function(){function o(){l(this,o)}return p(o,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var e=arguments[0];return Math.abs(o.ofRingSigned(e))}if(ge(arguments[0],Le)){var n=arguments[0];return Math.abs(o.ofRingSigned(n))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var n=0,r=e[0].x,s=1;s<e.length-1;s++){var d=e[s].x-r,m=e[s+1].y,x=e[s-1].y;n+=d*(x-m)}return n/2}if(ge(arguments[0],Le)){var C=arguments[0],R=C.size();if(R<3)return 0;var M=new F,q=new F,K=new F;C.getCoordinate(0,q),C.getCoordinate(1,K);var ae=q.x;K.x-=ae;for(var se=0,ye=1;ye<R-1;ye++)M.y=q.y,q.x=K.x,q.y=K.y,C.getCoordinate(ye+1,K),K.x-=ae,se+=q.x*(M.y-K.y);return se/2}}}]),o}(),Kt=function(){function o(){l(this,o)}return p(o,null,[{key:"sort",value:function(){var e=arguments,n=arguments[0];if(arguments.length===1)n.sort(function(ae,se){return ae.compareTo(se)});else if(arguments.length===2)n.sort(function(ae,se){return e[1].compare(ae,se)});else if(arguments.length===3){var r=n.slice(arguments[1],arguments[2]);r.sort();var s=n.slice(0,arguments[1]).concat(r,n.slice(arguments[2],n.length));n.splice(0,n.length);var d,m=g(s);try{for(m.s();!(d=m.n()).done;){var x=d.value;n.push(x)}}catch(ae){m.e(ae)}finally{m.f()}}else if(arguments.length===4){var C=n.slice(arguments[1],arguments[2]);C.sort(function(ae,se){return e[3].compare(ae,se)});var R=n.slice(0,arguments[1]).concat(C,n.slice(arguments[2],n.length));n.splice(0,n.length);var M,q=g(R);try{for(q.s();!(M=q.n()).done;){var K=M.value;n.push(K)}}catch(ae){q.e(ae)}finally{q.f()}}}},{key:"asList",value:function(e){var n,r=new Ee,s=g(e);try{for(s.s();!(n=s.n()).done;){var d=n.value;r.add(d)}}catch(m){s.e(m)}finally{s.f()}return r}},{key:"copyOf",value:function(e,n){return e.slice(0,n)}}]),o}(),Zr=function o(){l(this,o)},rn=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var r=new Array(this.getNumPoints()).fill(null),s=-1,d=this._shell.getCoordinates(),m=0;m<d.length;m++)r[++s]=d[m];for(var x=0;x<this._holes.length;x++)for(var C=this._holes[x].getCoordinates(),R=0;R<C.length;R++)r[++s]=C[R];return r}},{key:"getArea",value:function(){var r=0;r+=Xr.ofRing(this._shell.getCoordinateSequence());for(var s=0;s<this._holes.length;s++)r-=Xr.ofRing(this._holes[s].getCoordinateSequence());return r}},{key:"copyInternal",value:function(){for(var r=this._shell.copy(),s=new Array(this._holes.length).fill(null),d=0;d<this._holes.length;d++)s[d]=this._holes[d].copy();return new n(r,s,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var r=this._shell.getCoordinateSequence(),s=this.getEnvelopeInternal(),d=0;d<5;d++){var m=r.getX(d);if(m!==s.getMinX()&&m!==s.getMaxX())return!1;var x=r.getY(d);if(x!==s.getMinY()&&x!==s.getMaxY())return!1}for(var C=r.getX(0),R=r.getY(0),M=1;M<=4;M++){var q=r.getX(M),K=r.getY(M);if(q!==C==(K!==R))return!1;C=q,R=K}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof ie){var r=arguments[0],s=arguments[1];if(!this.isEquivalentClass(r))return!1;var d=r,m=this._shell,x=d._shell;if(!m.equalsExact(x,s)||this._holes.length!==d._holes.length)return!1;for(var C=0;C<this._holes.length;C++)if(!this._holes[C].equalsExact(d._holes[C],s))return!1;return!0}return A(I(n.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var r=0;r<this._holes.length;r++)this._holes[r]=this.normalized(this._holes[r],!1);Kt.sort(this._holes)}else if(arguments.length===2){var s=arguments[0],d=arguments[1];if(s.isEmpty())return null;var m=s.getCoordinateSequence(),x=Wt.minCoordinateIndex(m,0,m.size()-2);Wt.scroll(m,x,!0),we.isCCW(m)===d&&Wt.reverse(m)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var r=this.getExteriorRing().reverse(),s=new Array(this.getNumInteriorRing()).fill(null),d=0;d<s.length;d++)s[d]=this.getInteriorRingN(d).reverse();return this.getFactory().createPolygon(r,s)}},{key:"getTypeCode",value:function(){return ie.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var r=0;r+=this._shell.getLength();for(var s=0;s<this._holes.length;s++)r+=this._holes[s].getLength();return r}},{key:"getNumPoints",value:function(){for(var r=this._shell.getNumPoints(),s=0;s<this._holes.length;s++)r+=this._holes[s].getNumPoints();return r}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(r,s){var d=r.copy();return this.normalize(d,s),d}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var r=arguments[0],s=this._shell,d=r._shell;return s.compareToSameClass(d)}if(arguments.length===2){var m=arguments[0],x=arguments[1],C=m,R=this._shell,M=C._shell,q=R.compareToSameClass(M,x);if(q!==0)return q;for(var K=this.getNumInteriorRing(),ae=C.getNumInteriorRing(),se=0;se<K&&se<ae;){var ye=this.getInteriorRingN(se),_e=C.getInteriorRingN(se),ke=ye.compareToSameClass(_e,x);if(ke!==0)return ke;se++}return se<K?1:se<ae?-1:0}}},{key:"apply",value:function(){if(ge(arguments[0],en)){var r=arguments[0];this._shell.apply(r);for(var s=0;s<this._holes.length;s++)this._holes[s].apply(r)}else if(ge(arguments[0],nn)){var d=arguments[0];if(this._shell.apply(d),!d.isDone())for(var m=0;m<this._holes.length&&(this._holes[m].apply(d),!d.isDone());m++);d.isGeometryChanged()&&this.geometryChanged()}else if(ge(arguments[0],tn)){var x=arguments[0];x.filter(this)}else if(ge(arguments[0],O)){var C=arguments[0];C.filter(this),this._shell.apply(C);for(var R=0;R<this._holes.length;R++)this._holes[R].apply(C)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var r=new Array(this._holes.length+1).fill(null);r[0]=this._shell;for(var s=0;s<this._holes.length;s++)r[s+1]=this._holes[s];return r.length<=1?this.getFactory().createLinearRing(r[0].getCoordinateSequence()):this.getFactory().createMultiLineString(r)}},{key:"getGeometryType",value:function(){return ie.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(r){return this._holes[r]}},{key:"interfaces_",get:function(){return[Zr]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var r=arguments[0],s=arguments[1],d=arguments[2];if(ie.constructor_.call(this,d),r===null&&(r=this.getFactory().createLinearRing()),s===null&&(s=[]),ie.hasNullElements(s))throw new T("holes must not contain null elements");if(r.isEmpty()&&ie.hasNonEmptyElements(s))throw new T("shell is empty but holes are not");this._shell=r,this._holes=s}}]),n}(ie),Ro=function(o){b(n,o);var e=k(n);function n(){return l(this,n),e.apply(this,arguments)}return n}(pe),Wr=function(o){b(n,o);var e=k(n);function n(r){var s;return l(this,n),(s=e.call(this)).array=[],r instanceof H&&s.addAll(r),s}return p(n,[{key:"contains",value:function(r){var s,d=g(this.array);try{for(d.s();!(s=d.n()).done;)if(s.value.compareTo(r)===0)return!0}catch(m){d.e(m)}finally{d.f()}return!1}},{key:"add",value:function(r){if(this.contains(r))return!1;for(var s=0,d=this.array.length;s<d;s++)if(this.array[s].compareTo(r)===1)return!!this.array.splice(s,0,r);return this.array.push(r),!0}},{key:"addAll",value:function(r){var s,d=g(r);try{for(d.s();!(s=d.n()).done;){var m=s.value;this.add(m)}}catch(x){d.e(x)}finally{d.f()}return!0}},{key:"remove",value:function(){throw new ne}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new Oo(this.array)}}]),n}(Ro),Oo=function(){function o(e){l(this,o),this.array=e,this.position=0}return p(o,[{key:"next",value:function(){if(this.position===this.array.length)throw new B;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new ne}}]),o}(),ct=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"computeEnvelopeInternal",value:function(){for(var r=new G,s=0;s<this._geometries.length;s++)r.expandToInclude(this._geometries[s].getEnvelopeInternal());return r}},{key:"getGeometryN",value:function(r){return this._geometries[r]}},{key:"getCoordinates",value:function(){for(var r=new Array(this.getNumPoints()).fill(null),s=-1,d=0;d<this._geometries.length;d++)for(var m=this._geometries[d].getCoordinates(),x=0;x<m.length;x++)r[++s]=m[x];return r}},{key:"getArea",value:function(){for(var r=0,s=0;s<this._geometries.length;s++)r+=this._geometries[s].getArea();return r}},{key:"copyInternal",value:function(){for(var r=new Array(this._geometries.length).fill(null),s=0;s<r.length;s++)r[s]=this._geometries[s].copy();return new n(r,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof ie){var r=arguments[0],s=arguments[1];if(!this.isEquivalentClass(r))return!1;var d=r;if(this._geometries.length!==d._geometries.length)return!1;for(var m=0;m<this._geometries.length;m++)if(!this._geometries[m].equalsExact(d._geometries[m],s))return!1;return!0}return A(I(n.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var r=0;r<this._geometries.length;r++)this._geometries[r].normalize();Kt.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var r=he.FALSE,s=0;s<this._geometries.length;s++)r=Math.max(r,this._geometries[s].getBoundaryDimension());return r}},{key:"reverseInternal",value:function(){for(var r=this._geometries.length,s=new Ee(r),d=0;d<r;d++)s.add(this._geometries[d].reverse());return this.getFactory().buildGeometry(s)}},{key:"getTypeCode",value:function(){return ie.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var r=he.FALSE,s=0;s<this._geometries.length;s++)r=Math.max(r,this._geometries[s].getDimension());return r}},{key:"getLength",value:function(){for(var r=0,s=0;s<this._geometries.length;s++)r+=this._geometries[s].getLength();return r}},{key:"getNumPoints",value:function(){for(var r=0,s=0;s<this._geometries.length;s++)r+=this._geometries[s].getNumPoints();return r}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var r=arguments[0],s=new Wr(Kt.asList(this._geometries)),d=new Wr(Kt.asList(r._geometries));return this.compare(s,d)}if(arguments.length===2){for(var m=arguments[0],x=arguments[1],C=m,R=this.getNumGeometries(),M=C.getNumGeometries(),q=0;q<R&&q<M;){var K=this.getGeometryN(q),ae=C.getGeometryN(q),se=K.compareToSameClass(ae,x);if(se!==0)return se;q++}return q<R?1:q<M?-1:0}}},{key:"apply",value:function(){if(ge(arguments[0],en))for(var r=arguments[0],s=0;s<this._geometries.length;s++)this._geometries[s].apply(r);else if(ge(arguments[0],nn)){var d=arguments[0];if(this._geometries.length===0)return null;for(var m=0;m<this._geometries.length&&(this._geometries[m].apply(d),!d.isDone());m++);d.isGeometryChanged()&&this.geometryChanged()}else if(ge(arguments[0],tn)){var x=arguments[0];x.filter(this);for(var C=0;C<this._geometries.length;C++)this._geometries[C].apply(x)}else if(ge(arguments[0],O)){var R=arguments[0];R.filter(this);for(var M=0;M<this._geometries.length;M++)this._geometries[M].apply(R)}}},{key:"getBoundary",value:function(){return ie.checkNotGeometryCollection(this),re.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return ie.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var r=0;r<this._geometries.length;r++)if(!this._geometries[r].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var r=arguments[0],s=arguments[1];if(ie.constructor_.call(this,s),r===null&&(r=[]),ie.hasNullElements(r))throw new T("geometries must not contain null elements");this._geometries=r}}}}]),n}(ie),Bn=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"copyInternal",value:function(){for(var r=new Array(this._geometries.length).fill(null),s=0;s<r.length;s++)r[s]=this._geometries[s].copy();return new n(r,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof ie){var r=arguments[0],s=arguments[1];return!!this.isEquivalentClass(r)&&A(I(n.prototype),"equalsExact",this).call(this,r,s)}return A(I(n.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var r=arguments[0];return this._geometries[r].getCoordinate()}return A(I(n.prototype),"getCoordinate",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return he.FALSE}},{key:"getTypeCode",value:function(){return ie.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return ie.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[jr]}}],[{key:"constructor_",value:function(){var r=arguments[0],s=arguments[1];ct.constructor_.call(this,r,s)}}]),n}(ct),Bi=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"copyInternal",value:function(){return new n(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return he.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||A(I(n.prototype),"isClosed",this).call(this)}},{key:"reverseInternal",value:function(){var r=this._points.copy();return Wt.reverse(r),this.getFactory().createLinearRing(r)}},{key:"getTypeCode",value:function(){return ie.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!A(I(n.prototype),"isClosed",this).call(this))throw new T("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<n.MINIMUM_VALID_SIZE)throw new T("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return ie.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var r=arguments[0],s=arguments[1];Mi.constructor_.call(this,r,s),this.validateConstruction()}}]),n}(Mi);Bi.MINIMUM_VALID_SIZE=4;var Jt=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"setOrdinate",value:function(r,s){switch(r){case n.X:this.x=s;break;case n.Y:this.y=s;break;default:throw new T("Invalid ordinate index: "+r)}}},{key:"getZ",value:function(){return F.NULL_ORDINATE}},{key:"getOrdinate",value:function(r){switch(r){case n.X:return this.x;case n.Y:return this.y}throw new T("Invalid ordinate index: "+r)}},{key:"setZ",value:function(r){throw new T("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new n(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(r){this.x=r.x,this.y=r.y,this.z=r.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)F.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof n){var r=arguments[0];F.constructor_.call(this,r.x,r.y)}else if(arguments[0]instanceof F){var s=arguments[0];F.constructor_.call(this,s.x,s.y)}}else if(arguments.length===2){var d=arguments[0],m=arguments[1];F.constructor_.call(this,d,m,F.NULL_ORDINATE)}}}]),n}(F);Jt.X=0,Jt.Y=1,Jt.Z=-1,Jt.M=-1;var Qt=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(r,s){switch(r){case n.X:this.x=s;break;case n.Y:this.y=s;break;case n.M:this._m=s;break;default:throw new T("Invalid ordinate index: "+r)}}},{key:"setM",value:function(r){this._m=r}},{key:"getZ",value:function(){return F.NULL_ORDINATE}},{key:"getOrdinate",value:function(r){switch(r){case n.X:return this.x;case n.Y:return this.y;case n.M:return this._m}throw new T("Invalid ordinate index: "+r)}},{key:"setZ",value:function(r){throw new T("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new n(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(r){this.x=r.x,this.y=r.y,this.z=r.getZ(),this._m=r.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)F.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof n){var r=arguments[0];F.constructor_.call(this,r.x,r.y),this._m=r._m}else if(arguments[0]instanceof F){var s=arguments[0];F.constructor_.call(this,s.x,s.y),this._m=this.getM()}}else if(arguments.length===3){var d=arguments[0],m=arguments[1],x=arguments[2];F.constructor_.call(this,d,m,F.NULL_ORDINATE),this._m=x}}}]),n}(F);Qt.X=0,Qt.Y=1,Qt.Z=-1,Qt.M=2;var Dn=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(r,s){switch(r){case F.X:this.x=s;break;case F.Y:this.y=s;break;case F.Z:this.z=s;break;case F.M:this._m=s;break;default:throw new T("Invalid ordinate index: "+r)}}},{key:"setM",value:function(r){this._m=r}},{key:"getOrdinate",value:function(r){switch(r){case F.X:return this.x;case F.Y:return this.y;case F.Z:return this.getZ();case F.M:return this.getM()}throw new T("Invalid ordinate index: "+r)}},{key:"copy",value:function(){return new n(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(r){this.x=r.x,this.y=r.y,this.z=r.getZ(),this._m=r.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)F.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof n){var r=arguments[0];F.constructor_.call(this,r),this._m=r._m}else if(arguments[0]instanceof F){var s=arguments[0];F.constructor_.call(this,s),this._m=this.getM()}}else if(arguments.length===4){var d=arguments[0],m=arguments[1],x=arguments[2],C=arguments[3];F.constructor_.call(this,d,m,x),this._m=C}}}]),n}(F),sn=function(){function o(){l(this,o)}return p(o,null,[{key:"measures",value:function(e){return e instanceof Jt?0:e instanceof Qt||e instanceof Dn?1:0}},{key:"dimension",value:function(e){return e instanceof Jt?2:e instanceof Qt?3:e instanceof Dn?4:3}},{key:"create",value:function(){if(arguments.length===1){var e=arguments[0];return o.create(e,0)}if(arguments.length===2){var n=arguments[0],r=arguments[1];return n===2?new Jt:n===3&&r===0?new F:n===3&&r===1?new Qt:n===4&&r===1?new Dn:new F}}}]),o}(),Di=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"getCoordinate",value:function(r){return this.get(r)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&ge(arguments[0],H)){for(var r=arguments[0],s=arguments[1],d=!1,m=r.iterator();m.hasNext();)this.add(m.next(),s),d=!0;return d}return A(I(n.prototype),"addAll",this).apply(this,arguments)}},{key:"clone",value:function(){for(var r=A(I(n.prototype),"clone",this).call(this),s=0;s<this.size();s++)r.add(s,this.get(s).clone());return r}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(n.coordArrayType);if(arguments.length===1){var r=arguments[0];if(r)return this.toArray(n.coordArrayType);for(var s=this.size(),d=new Array(s).fill(null),m=0;m<s;m++)d[m]=this.get(s-m-1);return d}}},{key:"add",value:function(){if(arguments.length===1){var r=arguments[0];return A(I(n.prototype),"add",this).call(this,r)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var s=arguments[0],d=arguments[1];return this.add(s,d,!0),!0}if(arguments[0]instanceof F&&typeof arguments[1]=="boolean"){var m=arguments[0],x=arguments[1];if(!x&&this.size()>=1){var C=this.get(this.size()-1);if(C.equals2D(m))return null}A(I(n.prototype),"add",this).call(this,m)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var R=arguments[0],M=arguments[1];return this.add(R,M),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var q=arguments[0],K=arguments[1],ae=arguments[2];if(ae)for(var se=0;se<q.length;se++)this.add(q[se],K);else for(var ye=q.length-1;ye>=0;ye--)this.add(q[ye],K);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof F){var _e=arguments[0],ke=arguments[1],Ue=arguments[2];if(!Ue){var qe=this.size();if(qe>0){if(_e>0){var nt=this.get(_e-1);if(nt.equals2D(ke))return null}if(_e<qe){var gt=this.get(_e);if(gt.equals2D(ke))return null}}}A(I(n.prototype),"add",this).call(this,_e,ke)}}else if(arguments.length===4){var Lt=arguments[0],qt=arguments[1],ii=arguments[2],Yi=arguments[3],$i=1;ii>Yi&&($i=-1);for(var mi=ii;mi!==Yi;mi+=$i)this.add(Lt[mi],qt);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var r=this.get(0).copy();this.add(r,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var r=arguments[0];this.ensureCapacity(r.length),this.add(r,!0)}else if(arguments.length===2){var s=arguments[0],d=arguments[1];this.ensureCapacity(s.length),this.add(s,d)}}}}]),n}(Ee);Di.coordArrayType=new Array(0).fill(null);var Xe=function(){function o(){l(this,o)}return p(o,null,[{key:"isRing",value:function(e){return!(e.length<4)&&!!e[0].equals2D(e[e.length-1])}},{key:"ptNotInList",value:function(e,n){for(var r=0;r<e.length;r++){var s=e[r];if(o.indexOf(s,n)<0)return s}return null}},{key:"scroll",value:function(e,n){var r=o.indexOf(n,e);if(r<0)return null;var s=new Array(e.length).fill(null);_t.arraycopy(e,r,s,0,e.length-r),_t.arraycopy(e,0,s,e.length-r,r),_t.arraycopy(s,0,e,0,e.length)}},{key:"equals",value:function(){if(arguments.length===2){var e=arguments[0],n=arguments[1];if(e===n)return!0;if(e===null||n===null||e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(!e[r].equals(n[r]))return!1;return!0}if(arguments.length===3){var s=arguments[0],d=arguments[1],m=arguments[2];if(s===d)return!0;if(s===null||d===null||s.length!==d.length)return!1;for(var x=0;x<s.length;x++)if(m.compare(s[x],d[x])!==0)return!1;return!0}}},{key:"intersection",value:function(e,n){for(var r=new Di,s=0;s<e.length;s++)n.intersects(e[s])&&r.add(e[s],!0);return r.toCoordinateArray()}},{key:"measures",value:function(e){if(e===null||e.length===0)return 0;var n,r=0,s=g(e);try{for(s.s();!(n=s.n()).done;){var d=n.value;r=Math.max(r,sn.measures(d))}}catch(m){s.e(m)}finally{s.f()}return r}},{key:"hasRepeatedPoints",value:function(e){for(var n=1;n<e.length;n++)if(e[n-1].equals(e[n]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(e){return o.hasRepeatedPoints(e)?new Di(e,!1).toCoordinateArray():e}},{key:"reverse",value:function(e){for(var n=e.length-1,r=Math.trunc(n/2),s=0;s<=r;s++){var d=e[s];e[s]=e[n-s],e[n-s]=d}}},{key:"removeNull",value:function(e){for(var n=0,r=0;r<e.length;r++)e[r]!==null&&n++;var s=new Array(n).fill(null);if(n===0)return s;for(var d=0,m=0;m<e.length;m++)e[m]!==null&&(s[d++]=e[m]);return s}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var e=arguments[0],n=new Array(e.length).fill(null),r=0;r<e.length;r++)n[r]=e[r].copy();return n}if(arguments.length===5)for(var s=arguments[0],d=arguments[1],m=arguments[2],x=arguments[3],C=arguments[4],R=0;R<C;R++)m[x+R]=s[d+R].copy()}},{key:"isEqualReversed",value:function(e,n){for(var r=0;r<e.length;r++){var s=e[r],d=n[e.length-r-1];if(s.compareTo(d)!==0)return!1}return!0}},{key:"envelope",value:function(e){for(var n=new G,r=0;r<e.length;r++)n.expandToInclude(e[r]);return n}},{key:"toCoordinateArray",value:function(e){return e.toArray(o.coordArrayType)}},{key:"dimension",value:function(e){if(e===null||e.length===0)return 3;var n,r=0,s=g(e);try{for(s.s();!(n=s.n()).done;){var d=n.value;r=Math.max(r,sn.dimension(d))}}catch(m){s.e(m)}finally{s.f()}return r}},{key:"atLeastNCoordinatesOrNothing",value:function(e,n){return n.length>=e?n:[]}},{key:"indexOf",value:function(e,n){for(var r=0;r<n.length;r++)if(e.equals(n[r]))return r;return-1}},{key:"increasingDirection",value:function(e){for(var n=0;n<Math.trunc(e.length/2);n++){var r=e.length-1-n,s=e[n].compareTo(e[r]);if(s!==0)return s}return 1}},{key:"compare",value:function(e,n){for(var r=0;r<e.length&&r<n.length;){var s=e[r].compareTo(n[r]);if(s!==0)return s;r++}return r<n.length?-1:r<e.length?1:0}},{key:"minCoordinate",value:function(e){for(var n=null,r=0;r<e.length;r++)(n===null||n.compareTo(e[r])>0)&&(n=e[r]);return n}},{key:"extract",value:function(e,n,r){n=Pi.clamp(n,0,e.length);var s=(r=Pi.clamp(r,-1,e.length))-n+1;r<0&&(s=0),n>=e.length&&(s=0),r<n&&(s=0);var d=new Array(s).fill(null);if(s===0)return d;for(var m=0,x=n;x<=r;x++)d[m++]=e[x];return d}}]),o}(),Uo=function(){function o(){l(this,o)}return p(o,[{key:"compare",value:function(e,n){var r=e,s=n;return Xe.compare(r,s)}},{key:"interfaces_",get:function(){return[ve]}}]),o}(),Po=function(){function o(){l(this,o)}return p(o,[{key:"compare",value:function(e,n){var r=e,s=n;if(r.length<s.length)return-1;if(r.length>s.length)return 1;if(r.length===0)return 0;var d=Xe.compare(r,s);return Xe.isEqualReversed(r,s)?0:d}},{key:"OLDcompare",value:function(e,n){var r=e,s=n;if(r.length<s.length)return-1;if(r.length>s.length)return 1;if(r.length===0)return 0;for(var d=Xe.increasingDirection(r),m=Xe.increasingDirection(s),x=d>0?0:r.length-1,C=m>0?0:r.length-1,R=0;R<r.length;R++){var M=r[x].compareTo(s[C]);if(M!==0)return M;x+=d,C+=m}return 0}},{key:"interfaces_",get:function(){return[ve]}}]),o}();Xe.ForwardComparator=Uo,Xe.BidirectionalComparator=Po,Xe.coordArrayType=new Array(0).fill(null);var an=function(){function o(e){l(this,o),this.str=e}return p(o,[{key:"append",value:function(e){this.str+=e}},{key:"setCharAt",value:function(e,n){this.str=this.str.substr(0,e)+n+this.str.substr(e+1)}},{key:"toString",value:function(){return this.str}}]),o}(),Fi=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getM",value:function(e){return this.hasM()?this._coordinates[e].getM():J.NaN}},{key:"setOrdinate",value:function(e,n,r){switch(n){case Le.X:this._coordinates[e].x=r;break;case Le.Y:this._coordinates[e].y=r;break;default:this._coordinates[e].setOrdinate(n,r)}}},{key:"getZ",value:function(e){return this.hasZ()?this._coordinates[e].getZ():J.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(e,n){switch(n){case Le.X:return this._coordinates[e].x;case Le.Y:return this._coordinates[e].y;default:return this._coordinates[e].getOrdinate(n)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var e=arguments[0];return this._coordinates[e]}if(arguments.length===2){var n=arguments[0],r=arguments[1];r.setCoordinate(this._coordinates[n])}}},{key:"getCoordinateCopy",value:function(e){var n=this.createCoordinate();return n.setCoordinate(this._coordinates[e]),n}},{key:"createCoordinate",value:function(){return sn.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(e){return this._coordinates[e].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(e){for(var n=0;n<this._coordinates.length;n++)e.expandToInclude(this._coordinates[n]);return e}},{key:"copy",value:function(){for(var e=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++){var r=this.createCoordinate();r.setCoordinate(this._coordinates[n]),e[n]=r}return new o(e,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var e=new an(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)e.append(", "),e.append(this._coordinates[n]);return e.append(")"),e.toString()}return"()"}},{key:"getY",value:function(e){return this._coordinates[e].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[Le,z]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];o.constructor_.call(this,e,Xe.dimension(e),Xe.measures(e))}else if(Number.isInteger(arguments[0])){var n=arguments[0];this._coordinates=new Array(n).fill(null);for(var r=0;r<n;r++)this._coordinates[r]=new F}else if(ge(arguments[0],Le)){var s=arguments[0];if(s===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=s.getDimension(),this._measures=s.getMeasures(),this._coordinates=new Array(s.size()).fill(null);for(var d=0;d<this._coordinates.length;d++)this._coordinates[d]=s.getCoordinateCopy(d)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var m=arguments[0],x=arguments[1];o.constructor_.call(this,m,x,Xe.measures(m))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var C=arguments[0],R=arguments[1];this._coordinates=new Array(C).fill(null),this._dimension=R;for(var M=0;M<C;M++)this._coordinates[M]=sn.create(R)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var q=arguments[0],K=arguments[1],ae=arguments[2];this._dimension=K,this._measures=ae,this._coordinates=q===null?new Array(0).fill(null):q}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var se=arguments[0],ye=arguments[1],_e=arguments[2];this._coordinates=new Array(se).fill(null),this._dimension=ye,this._measures=_e;for(var ke=0;ke<se;ke++)this._coordinates[ke]=this.createCoordinate()}}}}]),o}(),Fn=function(){function o(){l(this,o)}return p(o,[{key:"readResolve",value:function(){return o.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new Fi(e)}if(ge(arguments[0],Le)){var n=arguments[0];return new Fi(n)}}else{if(arguments.length===2){var r=arguments[0],s=arguments[1];return s>3&&(s=3),s<2&&(s=2),new Fi(r,s)}if(arguments.length===3){var d=arguments[0],m=arguments[1],x=arguments[2],C=m-x;return x>1&&(x=1),C>3&&(C=3),C<2&&(C=2),new Fi(d,C+x,x)}}}},{key:"interfaces_",get:function(){return[Hr,z]}}],[{key:"instance",value:function(){return o.instanceObject}}]),o}();Fn.instanceObject=new Fn;var zn=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"copyInternal",value:function(){for(var r=new Array(this._geometries.length).fill(null),s=0;s<r.length;s++)r[s]=this._geometries[s].copy();return new n(r,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof ie){var r=arguments[0],s=arguments[1];return!!this.isEquivalentClass(r)&&A(I(n.prototype),"equalsExact",this).call(this,r,s)}return A(I(n.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return ie.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var r=new Ee,s=0;s<this._geometries.length;s++)for(var d=this._geometries[s].getBoundary(),m=0;m<d.getNumGeometries();m++)r.add(d.getGeometryN(m));var x=new Array(r.size()).fill(null);return this.getFactory().createMultiLineString(r.toArray(x))}},{key:"getGeometryType",value:function(){return ie.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Zr]}}],[{key:"constructor_",value:function(){var r=arguments[0],s=arguments[1];ct.constructor_.call(this,r,s)}}]),n}(ct),Kr=function(){function o(){l(this,o)}return p(o,[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}]),o}(),Mo=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),(r=e.call(this)).map=new Map,r}return p(n,[{key:"get",value:function(r){return this.map.get(r)||null}},{key:"put",value:function(r,s){return this.map.set(r,s),s}},{key:"values",value:function(){for(var r=new Ee,s=this.map.values(),d=s.next();!d.done;)r.add(d.value),d=s.next();return r}},{key:"entrySet",value:function(){var r=new Ie;return this.map.entries().forEach(function(s){return r.add(s)}),r}},{key:"size",value:function(){return this.map.size()}}]),n}(Kr),Ct=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"equals",value:function(e){if(!(e instanceof o))return!1;var n=e;return this._modelType===n._modelType&&this._scale===n._scale}},{key:"compareTo",value:function(e){var n=e,r=this.getMaximumSignificantDigits(),s=n.getMaximumSignificantDigits();return Ht.compare(r,s)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===o.FLOATING||this._modelType===o.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var e="UNKNOWN";return this._modelType===o.FLOATING?e="Floating":this._modelType===o.FLOATING_SINGLE?e="Floating-Single":this._modelType===o.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var e=arguments[0];return J.isNaN(e)||this._modelType===o.FLOATING_SINGLE?e:this._modelType===o.FIXED?Math.round(e*this._scale)/this._scale:e}if(arguments[0]instanceof F){var n=arguments[0];if(this._modelType===o.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}}},{key:"getMaximumSignificantDigits",value:function(){var e=16;return this._modelType===o.FLOATING?e=16:this._modelType===o.FLOATING_SINGLE?e=6:this._modelType===o.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e}},{key:"setScale",value:function(e){this._scale=Math.abs(e)}},{key:"interfaces_",get:function(){return[z,P]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=o.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof hi){var e=arguments[0];this._modelType=e,e===o.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=o.FIXED,this.setScale(n)}else if(arguments[0]instanceof o){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}}}},{key:"mostPrecise",value:function(e,n){return e.compareTo(n)>=0?e:n}}]),o}(),hi=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"readResolve",value:function(){return o.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[z]}}],[{key:"constructor_",value:function(){this._name=null;var e=arguments[0];this._name=e,o.nameToTypeMap.put(e,this)}}]),o}();hi.nameToTypeMap=new Mo,Ct.Type=hi,Ct.FIXED=new hi("FIXED"),Ct.FLOATING=new hi("FLOATING"),Ct.FLOATING_SINGLE=new hi("FLOATING SINGLE"),Ct.maximumPreciseValue=9007199254740992;var Gn=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"copyInternal",value:function(){for(var r=new Array(this._geometries.length).fill(null),s=0;s<r.length;s++)r[s]=this._geometries[s].copy();return new n(r,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof ie){var r=arguments[0],s=arguments[1];return!!this.isEquivalentClass(r)&&A(I(n.prototype),"equalsExact",this).call(this,r,s)}return A(I(n.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?he.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var r=0;r<this._geometries.length;r++)if(!this._geometries[r].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return ie.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new ne}},{key:"getGeometryType",value:function(){return ie.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[Vr]}}],[{key:"constructor_",value:function(){var r=arguments[0],s=arguments[1];ct.constructor_.call(this,r,s)}}]),n}(ct),ci=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"createEmpty",value:function(e){switch(e){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new T("Invalid dimension: "+e)}}},{key:"toGeometry",value:function(e){return e.isNull()?this.createPoint():e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new F(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new F(e.getMinX(),e.getMinY()),new F(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new F(e.getMinX(),e.getMinY()),new F(e.getMinX(),e.getMaxY()),new F(e.getMaxX(),e.getMaxY()),new F(e.getMaxX(),e.getMinY()),new F(e.getMinX(),e.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLineString(e!==null?this.getCoordinateSequenceFactory().create(e):null)}if(ge(arguments[0],Le)){var n=arguments[0];return new Mi(n,this)}}}},{key:"createMultiLineString",value:function(){if(arguments.length===0)return new Gn(null,this);if(arguments.length===1){var e=arguments[0];return new Gn(e,this)}}},{key:"buildGeometry",value:function(e){for(var n=null,r=!1,s=!1,d=e.iterator();d.hasNext();){var m=d.next(),x=m.getTypeCode();n===null&&(n=x),x!==n&&(r=!0),m instanceof ct&&(s=!0)}if(n===null)return this.createGeometryCollection();if(r||s)return this.createGeometryCollection(o.toGeometryArray(e));var C=e.iterator().next();if(e.size()>1){if(C instanceof rn)return this.createMultiPolygon(o.toPolygonArray(e));if(C instanceof Mi)return this.createMultiLineString(o.toLineStringArray(e));if(C instanceof Mn)return this.createMultiPoint(o.toPointArray(e));re.shouldNeverReachHere("Unhandled geometry type: "+C.getGeometryType())}return C}},{key:"createMultiPointFromCoords",value:function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof F){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}if(ge(arguments[0],Le)){var n=arguments[0];return new Mn(n,this)}}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(ge(arguments[0],Le)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof Array){var n=arguments[0];return this.createPolygon(this.createLinearRing(n))}if(arguments[0]instanceof Bi){var r=arguments[0];return this.createPolygon(r,null)}}else if(arguments.length===2){var s=arguments[0],d=arguments[1];return new rn(s,d,this)}}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){if(arguments.length===0)return new ct(null,this);if(arguments.length===1){var e=arguments[0];return new ct(e,this)}}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}if(ge(arguments[0],Le)){var n=arguments[0];return new Bi(n,this)}}}},{key:"createMultiPolygon",value:function(){if(arguments.length===0)return new zn(null,this);if(arguments.length===1){var e=arguments[0];return new zn(e,this)}}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Bn(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new Bn(e,this)}if(ge(arguments[0],Le)){var n=arguments[0];if(n===null)return this.createMultiPoint(new Array(0).fill(null));for(var r=new Array(n.size()).fill(null),s=0;s<n.size();s++){var d=this.getCoordinateSequenceFactory().create(1,n.getDimension(),n.getMeasures());Wt.copy(n,s,d,0,1),r[s]=this.createPoint(d)}return this.createMultiPoint(r)}}}},{key:"interfaces_",get:function(){return[z]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)o.constructor_.call(this,new Ct,0);else if(arguments.length===1){if(ge(arguments[0],Hr)){var e=arguments[0];o.constructor_.call(this,new Ct,0,e)}else if(arguments[0]instanceof Ct){var n=arguments[0];o.constructor_.call(this,n,0,o.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var r=arguments[0],s=arguments[1];o.constructor_.call(this,r,s,o.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var d=arguments[0],m=arguments[1],x=arguments[2];this._precisionModel=d,this._coordinateSequenceFactory=x,this._SRID=m}}},{key:"toMultiPolygonArray",value:function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)}},{key:"toGeometryArray",value:function(e){if(e===null)return null;var n=new Array(e.size()).fill(null);return e.toArray(n)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return Fn.instance()}},{key:"toMultiLineStringArray",value:function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)}},{key:"toLineStringArray",value:function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)}},{key:"toMultiPointArray",value:function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)}},{key:"toLinearRingArray",value:function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)}},{key:"toPointArray",value:function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)}},{key:"toPolygonArray",value:function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)}},{key:"createPointFromInternalCoord",value:function(e,n){return n.getPrecisionModel().makePrecise(e),n.getFactory().createPoint(e)}}]),o}(),qn="XY",Bo="XYZ",Do="XYM",Fo="XYZM",Jr={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},Qr="EMPTY",on=1,zt=2,Vt=3,es=4,fi=5,zo=6;for(var Go in Jr)Jr[Go].toUpperCase();var qo=function(){function o(e){l(this,o),this.wkt=e,this.index_=-1}return p(o,[{key:"isAlpha_",value:function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}},{key:"isNumeric_",value:function(e,n){return e>="0"&&e<="9"||e=="."&&!(n!==void 0&&n)}},{key:"isWhiteSpace_",value:function(e){return e==" "||e=="	"||e=="\r"||e==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var e,n=this.nextChar_(),r=this.index_,s=n;if(n=="(")e=zt;else if(n==",")e=fi;else if(n==")")e=Vt;else if(this.isNumeric_(n)||n=="-")e=es,s=this.readNumber_();else if(this.isAlpha_(n))e=on,s=this.readText_();else{if(this.isWhiteSpace_(n))return this.nextToken();if(n!=="")throw new Error("Unexpected character: "+n);e=zo}return{position:r,value:s,type:e}}},{key:"readNumber_",value:function(){var e,n=this.index_,r=!1,s=!1;do e=="."?r=!0:e!="e"&&e!="E"||(s=!0),e=this.nextChar_();while(this.isNumeric_(e,r)||!s&&(e=="e"||e=="E")||s&&(e=="-"||e=="+"));return parseFloat(this.wkt.substring(n,this.index_--))}},{key:"readText_",value:function(){var e,n=this.index_;do e=this.nextChar_();while(this.isAlpha_(e));return this.wkt.substring(n,this.index_--).toUpperCase()}}]),o}(),Yo=function(){function o(e,n){l(this,o),this.lexer_=e,this.token_,this.layout_=qn,this.factory=n}return p(o,[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(e){return this.token_.type==e}},{key:"match",value:function(e){var n=this.isTokenType(e);return n&&this.consume_(),n}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var e=qn,n=this.token_;if(this.isTokenType(on)){var r=n.value;r==="Z"?e=Bo:r==="M"?e=Do:r==="ZM"&&(e=Fo),e!==qn&&this.consume_()}return e}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(zt)){var e=[];do e.push(this.parseGeometry_());while(this.match(fi));if(this.match(Vt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(zt)){var e=this.parsePoint_();if(this.match(Vt))return e}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(zt)){var e=this.parsePointList_();if(this.match(Vt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(zt)){var e=this.parseLineStringTextList_();if(this.match(Vt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var e;if(this.match(zt)){if(e=this.token_.type==zt?this.parsePointTextList_():this.parsePointList_(),this.match(Vt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(zt)){var e=this.parseLineStringTextList_();if(this.match(Vt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(zt)){var e=this.parsePolygonTextList_();if(this.match(Vt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var e=[],n=this.layout_.length,r=0;r<n;++r){var s=this.token_;if(!this.match(es))break;e.push(s.value)}if(e.length==n)return e;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var e=[this.parsePoint_()];this.match(fi);)e.push(this.parsePoint_());return e}},{key:"parsePointTextList_",value:function(){for(var e=[this.parsePointText_()];this.match(fi);)e.push(this.parsePointText_());return e}},{key:"parseLineStringTextList_",value:function(){for(var e=[this.parseLineStringText_()];this.match(fi);)e.push(this.parseLineStringText_());return e}},{key:"parsePolygonTextList_",value:function(){for(var e=[this.parsePolygonText_()];this.match(fi);)e.push(this.parsePolygonText_());return e}},{key:"isEmptyGeometry_",value:function(){var e=this.isTokenType(on)&&this.token_.value==Qr;return e&&this.consume_(),e}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var e=this.factory,n=function(_e){return E(F,t(_e))},r=function(_e){var ke=_e.map(function(Ue){return e.createLinearRing(Ue.map(n))});return ke.length>1?e.createPolygon(ke[0],ke.slice(1)):e.createPolygon(ke[0])},s=this.token_;if(this.match(on)){var d=s.value;if(this.layout_=this.parseGeometryLayout_(),d=="GEOMETRYCOLLECTION"){var m=this.parseGeometryCollectionText_();return e.createGeometryCollection(m)}switch(d){case"POINT":var x=this.parsePointText_();return x?e.createPoint(E(F,t(x))):e.createPoint();case"LINESTRING":var C=this.parseLineStringText_().map(n);return e.createLineString(C);case"LINEARRING":var R=this.parseLineStringText_().map(n);return e.createLinearRing(R);case"POLYGON":var M=this.parsePolygonText_();return M&&M.length!==0?r(M):e.createPolygon();case"MULTIPOINT":var q=this.parseMultiPointText_();if(!q||q.length===0)return e.createMultiPoint();var K=q.map(n).map(function(_e){return e.createPoint(_e)});return e.createMultiPoint(K);case"MULTILINESTRING":var ae=this.parseMultiLineStringText_().map(function(_e){return e.createLineString(_e.map(n))});return e.createMultiLineString(ae);case"MULTIPOLYGON":var se=this.parseMultiPolygonText_();if(!se||se.length===0)return e.createMultiPolygon();var ye=se.map(r);return e.createMultiPolygon(ye);default:throw new Error("Invalid geometry type: "+d)}}throw new Error(this.formatErrorMessage_())}}]),o}();function ts(o){if(o.isEmpty())return"";var e=o.getCoordinate(),n=[e.x,e.y];return e.z===void 0||Number.isNaN(e.z)||n.push(e.z),e.m===void 0||Number.isNaN(e.m)||n.push(e.m),n.join(" ")}function zi(o){for(var e=o.getCoordinates().map(function(d){var m=[d.x,d.y];return d.z===void 0||Number.isNaN(d.z)||m.push(d.z),d.m===void 0||Number.isNaN(d.m)||m.push(d.m),m}),n=[],r=0,s=e.length;r<s;++r)n.push(e[r].join(" "));return n.join(", ")}function is(o){var e=[];e.push("("+zi(o.getExteriorRing())+")");for(var n=0,r=o.getNumInteriorRing();n<r;++n)e.push("("+zi(o.getInteriorRingN(n))+")");return e.join(", ")}var $o={Point:ts,LineString:zi,LinearRing:zi,Polygon:is,MultiPoint:function(o){for(var e=[],n=0,r=o.getNumGeometries();n<r;++n)e.push("("+ts(o.getGeometryN(n))+")");return e.join(", ")},MultiLineString:function(o){for(var e=[],n=0,r=o.getNumGeometries();n<r;++n)e.push("("+zi(o.getGeometryN(n))+")");return e.join(", ")},MultiPolygon:function(o){for(var e=[],n=0,r=o.getNumGeometries();n<r;++n)e.push("("+is(o.getGeometryN(n))+")");return e.join(", ")},GeometryCollection:function(o){for(var e=[],n=0,r=o.getNumGeometries();n<r;++n)e.push(ns(o.getGeometryN(n)));return e.join(", ")}};function ns(o){var e=o.getGeometryType(),n=$o[e];e=e.toUpperCase();var r=function(s){var d="";if(s.isEmpty())return d;var m=s.getCoordinate();return m.z===void 0||Number.isNaN(m.z)||(d+="Z"),m.m===void 0||Number.isNaN(m.m)||(d+="M"),d}(o);return r.length>0&&(e+=" "+r),o.isEmpty()?e+" "+Qr:e+" ("+n(o)+")"}var Ho=function(){function o(e){l(this,o),this.geometryFactory=e||new ci,this.precisionModel=this.geometryFactory.getPrecisionModel()}return p(o,[{key:"read",value:function(e){var n=new qo(e);return new Yo(n,this.geometryFactory).parse()}},{key:"write",value:function(e){return ns(e)}}]),o}(),Yn=function(){function o(e){l(this,o),this.parser=new Ho(e)}return p(o,[{key:"write",value:function(e){return this.parser.write(e)}}],[{key:"toLineString",value:function(e,n){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+n.x+" "+n.y+" )"}}]),o}(),Ge=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getIndexAlongSegment",value:function(e,n){return this.computeIntLineIndex(),this._intLineIndex[e][n]}},{key:"getTopologySummary",value:function(){var e=new an;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()}},{key:"computeIntersection",value:function(e,n,r,s){this._inputLines[0][0]=e,this._inputLines[0][1]=n,this._inputLines[1][0]=r,this._inputLines[1][1]=s,this._result=this.computeIntersect(e,n,r,s)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0],n=this.getEdgeDistance(e,0),r=this.getEdgeDistance(e,1);n>r?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(e){this._precisionModel=e}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var e=arguments[0],n=0;n<this._result;n++)if(!this._intPt[n].equals2D(this._inputLines[e][0])&&!this._intPt[n].equals2D(this._inputLines[e][1]))return!0;return!1}}},{key:"getIntersection",value:function(e){return this._intPt[e]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==o.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(e,n){return o.computeEdgeDistance(this._intPt[n],this._inputLines[e][0],this._inputLines[e][1])}},{key:"isCollinear",value:function(){return this._result===o.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return Yn.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Yn.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(e,n){return this._inputLines[e][n]}},{key:"isIntersection",value:function(e){for(var n=0;n<this._result;n++)if(this._intPt[n].equals2D(e))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(e,n){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][n]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new F,this._intPt[1]=new F,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(e,n,r){var s=Math.abs(r.x-n.x),d=Math.abs(r.y-n.y),m=-1;if(e.equals(n))m=0;else if(e.equals(r))m=s>d?s:d;else{var x=Math.abs(e.x-n.x),C=Math.abs(e.y-n.y);(m=s>d?x:C)!==0||e.equals(n)||(m=Math.max(x,C))}return re.isTrue(!(m===0&&!e.equals(n)),"Bad distance calculation"),m}},{key:"nonRobustComputeEdgeDistance",value:function(e,n,r){var s=e.x-n.x,d=e.y-n.y,m=Math.sqrt(s*s+d*d);return re.isTrue(!(m===0&&!e.equals(n)),"Invalid distance calculation"),m}}]),o}();Ge.DONT_INTERSECT=0,Ge.DO_INTERSECT=1,Ge.COLLINEAR=2,Ge.NO_INTERSECTION=0,Ge.POINT_INTERSECTION=1,Ge.COLLINEAR_INTERSECTION=2;var ei=function(o){b(n,o);var e=k(n);function n(){return l(this,n),e.call(this)}return p(n,[{key:"isInSegmentEnvelopes",value:function(r){var s=new G(this._inputLines[0][0],this._inputLines[0][1]),d=new G(this._inputLines[1][0],this._inputLines[1][1]);return s.contains(r)&&d.contains(r)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return A(I(n.prototype),"computeIntersection",this).apply(this,arguments);var r=arguments[0],s=arguments[1],d=arguments[2];if(this._isProper=!1,G.intersects(s,d,r)&&we.index(s,d,r)===0&&we.index(d,s,r)===0)return this._isProper=!0,(r.equals(s)||r.equals(d))&&(this._isProper=!1),this._result=Ge.POINT_INTERSECTION,null;this._result=Ge.NO_INTERSECTION}},{key:"intersection",value:function(r,s,d,m){var x=this.intersectionSafe(r,s,d,m);return this.isInSegmentEnvelopes(x)||(x=new F(n.nearestEndpoint(r,s,d,m))),this._precisionModel!==null&&this._precisionModel.makePrecise(x),x}},{key:"checkDD",value:function(r,s,d,m,x){var C=Un.intersection(r,s,d,m),R=this.isInSegmentEnvelopes(C);_t.out.println("DD in env = "+R+"  --------------------- "+C),x.distance(C)>1e-4&&_t.out.println("Distance = "+x.distance(C))}},{key:"intersectionSafe",value:function(r,s,d,m){var x=Pn.intersection(r,s,d,m);return x===null&&(x=n.nearestEndpoint(r,s,d,m)),x}},{key:"computeCollinearIntersection",value:function(r,s,d,m){var x=G.intersects(r,s,d),C=G.intersects(r,s,m),R=G.intersects(d,m,r),M=G.intersects(d,m,s);return x&&C?(this._intPt[0]=d,this._intPt[1]=m,Ge.COLLINEAR_INTERSECTION):R&&M?(this._intPt[0]=r,this._intPt[1]=s,Ge.COLLINEAR_INTERSECTION):x&&R?(this._intPt[0]=d,this._intPt[1]=r,!d.equals(r)||C||M?Ge.COLLINEAR_INTERSECTION:Ge.POINT_INTERSECTION):x&&M?(this._intPt[0]=d,this._intPt[1]=s,!d.equals(s)||C||R?Ge.COLLINEAR_INTERSECTION:Ge.POINT_INTERSECTION):C&&R?(this._intPt[0]=m,this._intPt[1]=r,!m.equals(r)||x||M?Ge.COLLINEAR_INTERSECTION:Ge.POINT_INTERSECTION):C&&M?(this._intPt[0]=m,this._intPt[1]=s,!m.equals(s)||x||R?Ge.COLLINEAR_INTERSECTION:Ge.POINT_INTERSECTION):Ge.NO_INTERSECTION}},{key:"computeIntersect",value:function(r,s,d,m){if(this._isProper=!1,!G.intersects(r,s,d,m))return Ge.NO_INTERSECTION;var x=we.index(r,s,d),C=we.index(r,s,m);if(x>0&&C>0||x<0&&C<0)return Ge.NO_INTERSECTION;var R=we.index(d,m,r),M=we.index(d,m,s);return R>0&&M>0||R<0&&M<0?Ge.NO_INTERSECTION:x===0&&C===0&&R===0&&M===0?this.computeCollinearIntersection(r,s,d,m):(x===0||C===0||R===0||M===0?(this._isProper=!1,r.equals2D(d)||r.equals2D(m)?this._intPt[0]=r:s.equals2D(d)||s.equals2D(m)?this._intPt[0]=s:x===0?this._intPt[0]=new F(d):C===0?this._intPt[0]=new F(m):R===0?this._intPt[0]=new F(r):M===0&&(this._intPt[0]=new F(s))):(this._isProper=!0,this._intPt[0]=this.intersection(r,s,d,m)),Ge.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(r,s,d,m){var x=r,C=At.pointToSegment(r,d,m),R=At.pointToSegment(s,d,m);return R<C&&(C=R,x=s),(R=At.pointToSegment(d,r,s))<C&&(C=R,x=d),(R=At.pointToSegment(m,r,s))<C&&(C=R,x=m),x}}]),n}(Ge),Vo=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"countSegment",value:function(e,n){if(e.x<this._p.x&&n.x<this._p.x)return null;if(this._p.x===n.x&&this._p.y===n.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&n.y===this._p.y){var r=e.x,s=n.x;return r>s&&(r=n.x,s=e.x),this._p.x>=r&&this._p.x<=s&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&n.y<=this._p.y||n.y>this._p.y&&e.y<=this._p.y){var d=we.index(e,n,this._p);if(d===we.COLLINEAR)return this._isPointOnSegment=!0,null;n.y<e.y&&(d=-d),d===we.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==U.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?U.BOUNDARY:this._crossingCount%2==1?U.INTERIOR:U.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof F&&ge(arguments[1],Le)){for(var e=arguments[0],n=arguments[1],r=new o(e),s=new F,d=new F,m=1;m<n.size();m++)if(n.getCoordinate(m,s),n.getCoordinate(m-1,d),r.countSegment(s,d),r.isOnSegment())return r.getLocation();return r.getLocation()}if(arguments[0]instanceof F&&arguments[1]instanceof Array){for(var x=arguments[0],C=arguments[1],R=new o(x),M=1;M<C.length;M++){var q=C[M],K=C[M-1];if(R.countSegment(q,K),R.isOnSegment())return R.getLocation()}return R.getLocation()}}}]),o}(),$n=function(){function o(){l(this,o)}return p(o,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof F&&ge(arguments[1],Le)){for(var e=arguments[0],n=arguments[1],r=new ei,s=new F,d=new F,m=n.size(),x=1;x<m;x++)if(n.getCoordinate(x-1,s),n.getCoordinate(x,d),r.computeIntersection(e,s,d),r.hasIntersection())return!0;return!1}if(arguments[0]instanceof F&&arguments[1]instanceof Array){for(var C=arguments[0],R=arguments[1],M=new ei,q=1;q<R.length;q++){var K=R[q-1],ae=R[q];if(M.computeIntersection(C,K,ae),M.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(e,n){return Vo.locatePointInRing(e,n)}},{key:"isInRing",value:function(e,n){return o.locateInRing(e,n)!==U.EXTERIOR}}]),o}(),xt=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"setAllLocations",value:function(e){for(var n=0;n<this.location.length;n++)this.location[n]=e}},{key:"isNull",value:function(){for(var e=0;e<this.location.length;e++)if(this.location[e]!==U.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(e){for(var n=0;n<this.location.length;n++)this.location[n]===U.NONE&&(this.location[n]=e)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(e){if(e.location.length>this.location.length){var n=new Array(3).fill(null);n[te.ON]=this.location[te.ON],n[te.LEFT]=U.NONE,n[te.RIGHT]=U.NONE,this.location=n}for(var r=0;r<this.location.length;r++)this.location[r]===U.NONE&&r<e.location.length&&(this.location[r]=e.location[r])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var e=this.location[te.LEFT];this.location[te.LEFT]=this.location[te.RIGHT],this.location[te.RIGHT]=e}},{key:"toString",value:function(){var e=new Ve;return this.location.length>1&&e.append(U.toLocationSymbol(this.location[te.LEFT])),e.append(U.toLocationSymbol(this.location[te.ON])),this.location.length>1&&e.append(U.toLocationSymbol(this.location[te.RIGHT])),e.toString()}},{key:"setLocations",value:function(e,n,r){this.location[te.ON]=e,this.location[te.LEFT]=n,this.location[te.RIGHT]=r}},{key:"get",value:function(e){return e<this.location.length?this.location[e]:U.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var e=0;e<this.location.length;e++)if(this.location[e]===U.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var e=arguments[0];this.setLocation(te.ON,e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.location[n]=r}}},{key:"init",value:function(e){this.location=new Array(e).fill(null),this.setAllLocations(U.NONE)}},{key:"isEqualOnSide",value:function(e,n){return this.location[n]===e.location[n]}},{key:"allPositionsEqual",value:function(e){for(var n=0;n<this.location.length;n++)if(this.location[n]!==e)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];this.init(e.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[te.ON]=n}else if(arguments[0]instanceof o){var r=arguments[0];if(this.init(r.location.length),r!==null)for(var s=0;s<this.location.length;s++)this.location[s]=r.location[s]}}else if(arguments.length===3){var d=arguments[0],m=arguments[1],x=arguments[2];this.init(3),this.location[te.ON]=d,this.location[te.LEFT]=m,this.location[te.RIGHT]=x}}}]),o}(),Et=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getGeometryCount",value:function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e}},{key:"setAllLocations",value:function(e,n){this.elt[e].setAllLocations(n)}},{key:"isNull",value:function(e){return this.elt[e].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.elt[n].setAllLocationsIfNull(r)}}},{key:"isLine",value:function(e){return this.elt[e].isLine()}},{key:"merge",value:function(e){for(var n=0;n<2;n++)this.elt[n]===null&&e.elt[n]!==null?this.elt[n]=new xt(e.elt[n]):this.elt[n].merge(e.elt[n])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(te.ON)}if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.elt[n].get(r)}}},{key:"toString",value:function(){var e=new Ve;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}}},{key:"isAnyNull",value:function(e){return this.elt[e].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var e=arguments[0],n=arguments[1];this.elt[e].setLocation(te.ON,n)}else if(arguments.length===3){var r=arguments[0],s=arguments[1],d=arguments[2];this.elt[r].setLocation(s,d)}}},{key:"isEqualOnSide",value:function(e,n){return this.elt[0].isEqualOnSide(e.elt[0],n)&&this.elt[1].isEqualOnSide(e.elt[1],n)}},{key:"allPositionsEqual",value:function(e,n){return this.elt[e].allPositionsEqual(n)}},{key:"toLine",value:function(e){this.elt[e].isArea()&&(this.elt[e]=new xt(this.elt[e].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new xt(e),this.elt[1]=new xt(e)}else if(arguments[0]instanceof o){var n=arguments[0];this.elt[0]=new xt(n.elt[0]),this.elt[1]=new xt(n.elt[1])}}else if(arguments.length===2){var r=arguments[0],s=arguments[1];this.elt[0]=new xt(U.NONE),this.elt[1]=new xt(U.NONE),this.elt[r].setLocation(s)}else if(arguments.length===3){var d=arguments[0],m=arguments[1],x=arguments[2];this.elt[0]=new xt(d,m,x),this.elt[1]=new xt(d,m,x)}else if(arguments.length===4){var C=arguments[0],R=arguments[1],M=arguments[2],q=arguments[3];this.elt[0]=new xt(U.NONE,U.NONE,U.NONE),this.elt[1]=new xt(U.NONE,U.NONE,U.NONE),this.elt[C].setLocations(R,M,q)}}},{key:"toLineLabel",value:function(e){for(var n=new o(U.NONE),r=0;r<2;r++)n.setLocation(r,e.getLocation(r));return n}}]),o}(),un=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var e=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)e[n]=this._pts.get(n);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=we.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(e){this._startDe=e;var n=e,r=!0;do{if(n===null)throw new Ft("Found null DirectedEdge");if(n.getEdgeRing()===this)throw new Ft("Directed Edge visited twice during ring-building at "+n.getCoordinate());this._edges.add(n);var s=n.getLabel();re.isTrue(s.isArea()),this.mergeLabel(s),this.addPoints(n.getEdge(),n.isForward(),r),r=!1,this.setEdgeRing(n,this),n=this.getNext(n)}while(n!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(e){return this._pts.get(e)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var e=this._startDe;do{var n=e.getNode().getEdges().getOutgoingDegree(this);n>this._maxNodeDegree&&(this._maxNodeDegree=n),e=this.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(e,n,r){var s=e.getCoordinates();if(n){var d=1;r&&(d=0);for(var m=d;m<s.length;m++)this._pts.add(s[m])}else{var x=s.length-2;r&&(x=s.length-1);for(var C=x;C>=0;C--)this._pts.add(s[C])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var e=this._startDe;do e.getEdge().setInResult(!0),e=e.getNext();while(e!==this._startDe)}},{key:"containsPoint",value:function(e){var n=this.getLinearRing();if(!n.getEnvelopeInternal().contains(e)||!$n.isInRing(e,n.getCoordinates()))return!1;for(var r=this._holes.iterator();r.hasNext();)if(r.next().containsPoint(e))return!1;return!0}},{key:"addHole",value:function(e){this._holes.add(e)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(arguments.length===2){var n=arguments[0],r=arguments[1],s=n.getLocation(r,te.RIGHT);if(s===U.NONE)return null;if(this._label.getLocation(r)===U.NONE)return this._label.setLocation(r,s),null}}},{key:"setShell",value:function(e){this._shell=e,e!==null&&e.addHole(this)}},{key:"toPolygon",value:function(e){for(var n=new Array(this._holes.size()).fill(null),r=0;r<this._holes.size();r++)n[r]=this._holes.get(r).getLinearRing();return e.createPolygon(this.getLinearRing(),n)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new Ee,this._pts=new Ee,this._label=new Et(U.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Ee,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var e=arguments[0],n=arguments[1];this._geometryFactory=n,this.computePoints(e),this.computeRing()}}}}]),o}(),jo=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"setEdgeRing",value:function(r,s){r.setMinEdgeRing(s)}},{key:"getNext",value:function(r){return r.getNextMin()}}],[{key:"constructor_",value:function(){var r=arguments[0],s=arguments[1];un.constructor_.call(this,r,s)}}]),n}(un),Xo=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"buildMinimalRings",value:function(){var r=new Ee,s=this._startDe;do{if(s.getMinEdgeRing()===null){var d=new jo(s,this._geometryFactory);r.add(d)}s=s.getNext()}while(s!==this._startDe);return r}},{key:"setEdgeRing",value:function(r,s){r.setEdgeRing(s)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var r=this._startDe;do r.getNode().getEdges().linkMinimalDirectedEdges(this),r=r.getNext();while(r!==this._startDe)}},{key:"getNext",value:function(r){return r.getNext()}}],[{key:"constructor_",value:function(){var r=arguments[0],s=arguments[1];un.constructor_.call(this,r,s)}}]),n}(un),rs=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"setVisited",value:function(e){this._isVisited=e}},{key:"setInResult",value:function(e){this._isInResult=e}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(e){this._label=e}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(e){this._isCovered=e,this._isCoveredSet=!0}},{key:"updateIM",value:function(e){re.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this._label=e}}}}]),o}(),ln=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"isIncidentEdgeInResult",value:function(){for(var r=this.getEdges().getEdges().iterator();r.hasNext();)if(r.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(r){r.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(r){}},{key:"computeMergedLocation",value:function(r,s){var d=U.NONE;if(d=this._label.getLocation(s),!r.isNull(s)){var m=r.getLocation(s);d!==U.BOUNDARY&&(d=m)}return d}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return A(I(n.prototype),"setLabel",this).apply(this,arguments);var r=arguments[0],s=arguments[1];this._label===null?this._label=new Et(r,s):this._label.setLocation(r,s)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof n){var r=arguments[0];this.mergeLabel(r._label)}else if(arguments[0]instanceof Et)for(var s=arguments[0],d=0;d<2;d++){var m=this.computeMergedLocation(s,d),x=this._label.getLocation(d);x===U.NONE&&this._label.setLocation(d,m)}}},{key:"add",value:function(r){this._edges.insert(r),r.setNode(this)}},{key:"setLabelBoundary",value:function(r){if(this._label===null)return null;var s=U.NONE;this._label!==null&&(s=this._label.getLocation(r));var d=null;switch(s){case U.BOUNDARY:d=U.INTERIOR;break;case U.INTERIOR:default:d=U.BOUNDARY}this._label.setLocation(r,d)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var r=arguments[0],s=arguments[1];this._coord=r,this._edges=s,this._label=new Et(0,U.NONE)}}]),n}(rs),Zo=function(o){b(n,o);var e=k(n);function n(){return l(this,n),e.apply(this,arguments)}return n}(Kr);function ss(o){return o==null?0:o.color}function Oe(o){return o==null?null:o.parent}function Rt(o,e){o!==null&&(o.color=e)}function Hn(o){return o==null?null:o.left}function as(o){return o==null?null:o.right}var Gi=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),(r=e.call(this)).root_=null,r.size_=0,r}return p(n,[{key:"get",value:function(r){for(var s=this.root_;s!==null;){var d=r.compareTo(s.key);if(d<0)s=s.left;else{if(!(d>0))return s.value;s=s.right}}return null}},{key:"put",value:function(r,s){if(this.root_===null)return this.root_={key:r,value:s,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var d,m,x=this.root_;do if(d=x,(m=r.compareTo(x.key))<0)x=x.left;else{if(!(m>0)){var C=x.value;return x.value=s,C}x=x.right}while(x!==null);var R={key:r,left:null,right:null,value:s,parent:d,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return m<0?d.left=R:d.right=R,this.fixAfterInsertion(R),this.size_++,null}},{key:"fixAfterInsertion",value:function(r){var s;for(r.color=1;r!=null&&r!==this.root_&&r.parent.color===1;)Oe(r)===Hn(Oe(Oe(r)))?ss(s=as(Oe(Oe(r))))===1?(Rt(Oe(r),0),Rt(s,0),Rt(Oe(Oe(r)),1),r=Oe(Oe(r))):(r===as(Oe(r))&&(r=Oe(r),this.rotateLeft(r)),Rt(Oe(r),0),Rt(Oe(Oe(r)),1),this.rotateRight(Oe(Oe(r)))):ss(s=Hn(Oe(Oe(r))))===1?(Rt(Oe(r),0),Rt(s,0),Rt(Oe(Oe(r)),1),r=Oe(Oe(r))):(r===Hn(Oe(r))&&(r=Oe(r),this.rotateRight(r)),Rt(Oe(r),0),Rt(Oe(Oe(r)),1),this.rotateLeft(Oe(Oe(r))));this.root_.color=0}},{key:"values",value:function(){var r=new Ee,s=this.getFirstEntry();if(s!==null)for(r.add(s.value);(s=n.successor(s))!==null;)r.add(s.value);return r}},{key:"entrySet",value:function(){var r=new Ie,s=this.getFirstEntry();if(s!==null)for(r.add(s);(s=n.successor(s))!==null;)r.add(s);return r}},{key:"rotateLeft",value:function(r){if(r!=null){var s=r.right;r.right=s.left,s.left!=null&&(s.left.parent=r),s.parent=r.parent,r.parent==null?this.root_=s:r.parent.left===r?r.parent.left=s:r.parent.right=s,s.left=r,r.parent=s}}},{key:"rotateRight",value:function(r){if(r!=null){var s=r.left;r.left=s.right,s.right!=null&&(s.right.parent=r),s.parent=r.parent,r.parent==null?this.root_=s:r.parent.right===r?r.parent.right=s:r.parent.left=s,s.right=r,r.parent=s}}},{key:"getFirstEntry",value:function(){var r=this.root_;if(r!=null)for(;r.left!=null;)r=r.left;return r}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(r){for(var s=this.root_;s!==null;){var d=r.compareTo(s.key);if(d<0)s=s.left;else{if(!(d>0))return!0;s=s.right}}return!1}}],[{key:"successor",value:function(r){var s;if(r===null)return null;if(r.right!==null){for(s=r.right;s.left!==null;)s=s.left;return s}s=r.parent;for(var d=r;s!==null&&d===s.right;)d=s,s=s.parent;return s}}]),n}(Zo),os=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"find",value:function(e){return this.nodeMap.get(e)}},{key:"addNode",value:function(){if(arguments[0]instanceof F){var e=arguments[0],n=this.nodeMap.get(e);return n===null&&(n=this.nodeFact.createNode(e),this.nodeMap.put(e,n)),n}if(arguments[0]instanceof ln){var r=arguments[0],s=this.nodeMap.get(r.getCoordinate());return s===null?(this.nodeMap.put(r.getCoordinate(),r),r):(s.mergeLabel(r),s)}}},{key:"print",value:function(e){for(var n=this.iterator();n.hasNext();)n.next().print(e)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(e){for(var n=new Ee,r=this.iterator();r.hasNext();){var s=r.next();s.getLabel().getLocation(e)===U.BOUNDARY&&n.add(s)}return n}},{key:"add",value:function(e){var n=e.getCoordinate();this.addNode(n).add(e)}}],[{key:"constructor_",value:function(){this.nodeMap=new Gi,this.nodeFact=null;var e=arguments[0];this.nodeFact=e}}]),o}(),at=function(){function o(){l(this,o)}return p(o,null,[{key:"isNorthern",value:function(e){return e===o.NE||e===o.NW}},{key:"isOpposite",value:function(e,n){return e!==n&&(e-n+4)%4===2}},{key:"commonHalfPlane",value:function(e,n){if(e===n)return e;if((e-n+4)%4===2)return-1;var r=e<n?e:n;return r===0&&(e>n?e:n)===3?3:r}},{key:"isInHalfPlane",value:function(e,n){return n===o.SE?e===o.SE||e===o.SW:e===n||e===n+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1];if(e===0&&n===0)throw new T("Cannot compute the quadrant for point ( "+e+", "+n+" )");return e>=0?n>=0?o.NE:o.SE:n>=0?o.NW:o.SW}if(arguments[0]instanceof F&&arguments[1]instanceof F){var r=arguments[0],s=arguments[1];if(s.x===r.x&&s.y===r.y)throw new T("Cannot compute the quadrant for two identical points "+r);return s.x>=r.x?s.y>=r.y?o.NE:o.SE:s.y>=r.y?o.NW:o.SW}}}]),o}();at.NE=0,at.NW=1,at.SW=2,at.SE=3;var us=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"compareDirection",value:function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:we.index(e._p0,e._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(e){this._node=e}},{key:"print",value:function(e){var n=Math.atan2(this._dy,this._dx),r=this.getClass().getName(),s=r.lastIndexOf("."),d=r.substring(s+1);e.print("  "+d+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+n+"   "+this._label)}},{key:"compareTo",value:function(e){var n=e;return this.compareDirection(n)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf(".");return"  "+n.substring(r+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label}},{key:"computeLabel",value:function(e){}},{key:"init",value:function(e,n){this._p0=e,this._p1=n,this._dx=n.x-e.x,this._dy=n.y-e.y,this._quadrant=at.quadrant(this._dx,this._dy),re.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[P]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var e=arguments[0];this._edge=e}else if(arguments.length===3){var n=arguments[0],r=arguments[1],s=arguments[2];o.constructor_.call(this,n,r,s,null)}else if(arguments.length===4){var d=arguments[0],m=arguments[1],x=arguments[2],C=arguments[3];o.constructor_.call(this,d),this.init(m,x),this._label=C}}}]),o}(),Vn=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(r){return this._depth[r]}},{key:"setVisited",value:function(r){this._isVisited=r}},{key:"computeDirectedLabel",value:function(){this._label=new Et(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(r,s){if(this._depth[r]!==-999&&this._depth[r]!==s)throw new Ft("assigned depths do not match",this.getCoordinate());this._depth[r]=s}},{key:"isInteriorAreaEdge",value:function(){for(var r=!0,s=0;s<2;s++)this._label.isArea(s)&&this._label.getLocation(s,te.LEFT)===U.INTERIOR&&this._label.getLocation(s,te.RIGHT)===U.INTERIOR||(r=!1);return r}},{key:"setNextMin",value:function(r){this._nextMin=r}},{key:"print",value:function(r){A(I(n.prototype),"print",this).call(this,r),r.print(" "+this._depth[te.LEFT]+"/"+this._depth[te.RIGHT]),r.print(" ("+this.getDepthDelta()+")"),this._isInResult&&r.print(" inResult")}},{key:"setMinEdgeRing",value:function(r){this._minEdgeRing=r}},{key:"isLineEdge",value:function(){var r=this._label.isLine(0)||this._label.isLine(1),s=!this._label.isArea(0)||this._label.allPositionsEqual(0,U.EXTERIOR),d=!this._label.isArea(1)||this._label.allPositionsEqual(1,U.EXTERIOR);return r&&s&&d}},{key:"setEdgeRing",value:function(r){this._edgeRing=r}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var r=this._edge.getDepthDelta();return this._isForward||(r=-r),r}},{key:"setInResult",value:function(r){this._isInResult=r}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(r){this.print(r),r.print(" "),this._isForward?this._edge.print(r):this._edge.printReverse(r)}},{key:"setSym",value:function(r){this._sym=r}},{key:"setVisitedEdge",value:function(r){this.setVisited(r),this._sym.setVisited(r)}},{key:"setEdgeDepths",value:function(r,s){var d=this.getEdge().getDepthDelta();this._isForward||(d=-d);var m=1;r===te.LEFT&&(m=-1);var x=te.opposite(r),C=s+d*m;this.setDepth(r,s),this.setDepth(x,C)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(r){this._next=r}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var r=arguments[0],s=arguments[1];if(us.constructor_.call(this,r),this._isForward=s,s)this.init(r.getCoordinate(0),r.getCoordinate(1));else{var d=r.getNumPoints()-1;this.init(r.getCoordinate(d),r.getCoordinate(d-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(r,s){return r===U.EXTERIOR&&s===U.INTERIOR?1:r===U.INTERIOR&&s===U.EXTERIOR?-1:0}}]),n}(us),ls=function(){function o(){l(this,o)}return p(o,[{key:"createNode",value:function(e){return new ln(e,null)}}]),o}(),hs=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"printEdges",value:function(e){e.println("Edges:");for(var n=0;n<this._edges.size();n++){e.println("edge "+n+":");var r=this._edges.get(n);r.print(e),r.eiList.print(e)}}},{key:"find",value:function(e){return this._nodes.find(e)}},{key:"addNode",value:function(){if(arguments[0]instanceof ln){var e=arguments[0];return this._nodes.addNode(e)}if(arguments[0]instanceof F){var n=arguments[0];return this._nodes.addNode(n)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var e=this._nodes.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(e){_t.out.println(e)}},{key:"isBoundaryNode",value:function(e,n){var r=this._nodes.find(n);if(r===null)return!1;var s=r.getLabel();return s!==null&&s.getLocation(e)===U.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var e=this._nodes.iterator();e.hasNext();)e.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(e,n,r,s){return!!e.equals(r)&&we.index(e,n,s)===we.COLLINEAR&&at.quadrant(e,n)===at.quadrant(r,s)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(e){_t.out.print(e)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(e,n){for(var r=0;r<this._edges.size();r++){var s=this._edges.get(r),d=s.getCoordinates();if(this.matchInSameDirection(e,n,d[0],d[1])||this.matchInSameDirection(e,n,d[d.length-1],d[d.length-2]))return s}return null}},{key:"insertEdge",value:function(e){this._edges.add(e)}},{key:"findEdgeEnd",value:function(e){for(var n=this.getEdgeEnds().iterator();n.hasNext();){var r=n.next();if(r.getEdge()===e)return r}return null}},{key:"addEdges",value:function(e){for(var n=e.iterator();n.hasNext();){var r=n.next();this._edges.add(r);var s=new Vn(r,!0),d=new Vn(r,!1);s.setSym(d),d.setSym(s),this.add(s),this.add(d)}}},{key:"add",value:function(e){this._nodes.add(e),this._edgeEndList.add(e)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(e,n){for(var r=0;r<this._edges.size();r++){var s=this._edges.get(r),d=s.getCoordinates();if(e.equals(d[0])&&n.equals(d[1]))return s}return null}}],[{key:"constructor_",value:function(){if(this._edges=new Ee,this._nodes=null,this._edgeEndList=new Ee,arguments.length===0)this._nodes=new os(new ls);else if(arguments.length===1){var e=arguments[0];this._nodes=new os(e)}}},{key:"linkResultDirectedEdges",value:function(e){for(var n=e.iterator();n.hasNext();)n.next().getEdges().linkResultDirectedEdges()}}]),o}(),Wo=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"sortShellsAndHoles",value:function(e,n,r){for(var s=e.iterator();s.hasNext();){var d=s.next();d.isHole()?r.add(d):n.add(d)}}},{key:"computePolygons",value:function(e){for(var n=new Ee,r=e.iterator();r.hasNext();){var s=r.next().toPolygon(this._geometryFactory);n.add(s)}return n}},{key:"placeFreeHoles",value:function(e,n){for(var r=n.iterator();r.hasNext();){var s=r.next();if(s.getShell()===null){var d=o.findEdgeRingContaining(s,e);if(d===null)throw new Ft("unable to assign hole to a shell",s.getCoordinate(0));s.setShell(d)}}}},{key:"buildMinimalEdgeRings",value:function(e,n,r){for(var s=new Ee,d=e.iterator();d.hasNext();){var m=d.next();if(m.getMaxNodeDegree()>2){m.linkDirectedEdgesForMinimalEdgeRings();var x=m.buildMinimalRings(),C=this.findShell(x);C!==null?(this.placePolygonHoles(C,x),n.add(C)):r.addAll(x)}else s.add(m)}return s}},{key:"buildMaximalEdgeRings",value:function(e){for(var n=new Ee,r=e.iterator();r.hasNext();){var s=r.next();if(s.isInResult()&&s.getLabel().isArea()&&s.getEdgeRing()===null){var d=new Xo(s,this._geometryFactory);n.add(d),d.setInResult()}}return n}},{key:"placePolygonHoles",value:function(e,n){for(var r=n.iterator();r.hasNext();){var s=r.next();s.isHole()&&s.setShell(e)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(e){for(var n=0,r=null,s=e.iterator();s.hasNext();){var d=s.next();d.isHole()||(r=d,n++)}return re.isTrue(n<=1,"found two shells in MinimalEdgeRing list"),r}},{key:"add",value:function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var n=arguments[0],r=arguments[1];hs.linkResultDirectedEdges(r);var s=this.buildMaximalEdgeRings(n),d=new Ee,m=this.buildMinimalEdgeRings(s,this._shellList,d);this.sortShellsAndHoles(m,this._shellList,d),this.placeFreeHoles(this._shellList,d)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new Ee;var e=arguments[0];this._geometryFactory=e}},{key:"findEdgeRingContaining",value:function(e,n){for(var r=e.getLinearRing(),s=r.getEnvelopeInternal(),d=r.getCoordinateN(0),m=null,x=null,C=n.iterator();C.hasNext();){var R=C.next(),M=R.getLinearRing(),q=M.getEnvelopeInternal();if(!q.equals(s)&&q.contains(s)){d=Xe.ptNotInList(r.getCoordinates(),M.getCoordinates());var K=!1;$n.isInRing(d,M.getCoordinates())&&(K=!0),K&&(m===null||x.contains(q))&&(x=(m=R).getLinearRing().getEnvelopeInternal())}}return m}}]),o}(),cs=function(){function o(){l(this,o)}return p(o,[{key:"getBounds",value:function(){}}]),o}(),Gt=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[cs,z]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var e=arguments[0],n=arguments[1];this._bounds=e,this._item=n}}]),o}(),hn=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"poll",value:function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(e){for(var n=null,r=this._items.get(e);2*e<=this._size&&((n=2*e)!==this._size&&this._items.get(n+1).compareTo(this._items.get(n))<0&&n++,this._items.get(n).compareTo(r)<0);e=n)this._items.set(e,this._items.get(n));this._items.set(e,r)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(e){this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)this._items.set(n,this._items.get(Math.trunc(n/2)));this._items.set(n,e)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new Ee,this._items.add(null)}}]),o}(),Ko=function(){function o(){l(this,o)}return p(o,[{key:"insert",value:function(e,n){}},{key:"remove",value:function(e,n){}},{key:"query",value:function(){}}]),o}(),bt=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(e){re.isTrue(this._bounds===null),this._childBoundables.add(e)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[cs,z]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new Ee,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this._level=e}}}}]),o}(),di={reverseOrder:function(){return{compare:function(o,e){return e.compareTo(o)}}},min:function(o){return di.sort(o),o.get(0)},sort:function(o,e){var n=o.toArray();e?Kt.sort(n,e):Kt.sort(n);for(var r=o.iterator(),s=0,d=n.length;s<d;s++)r.next(),r.set(n[s])},singletonList:function(o){var e=new Ee;return e.add(o),e}},Jo=function(){function o(){l(this,o)}return p(o,null,[{key:"maxDistance",value:function(e,n,r,s,d,m,x,C){var R=o.distance(e,n,d,m);return R=Math.max(R,o.distance(e,n,x,C)),R=Math.max(R,o.distance(r,s,d,m)),R=Math.max(R,o.distance(r,s,x,C))}},{key:"distance",value:function(e,n,r,s){var d=r-e,m=s-n;return Math.sqrt(d*d+m*m)}},{key:"maximumDistance",value:function(e,n){var r=Math.min(e.getMinX(),n.getMinX()),s=Math.min(e.getMinY(),n.getMinY()),d=Math.max(e.getMaxX(),n.getMaxX()),m=Math.max(e.getMaxY(),n.getMaxY());return o.distance(r,s,d,m)}},{key:"minMaxDistance",value:function(e,n){var r=e.getMinX(),s=e.getMinY(),d=e.getMaxX(),m=e.getMaxY(),x=n.getMinX(),C=n.getMinY(),R=n.getMaxX(),M=n.getMaxY(),q=o.maxDistance(r,s,r,m,x,C,x,M);return q=Math.min(q,o.maxDistance(r,s,r,m,x,C,R,C)),q=Math.min(q,o.maxDistance(r,s,r,m,R,M,x,M)),q=Math.min(q,o.maxDistance(r,s,r,m,R,M,R,C)),q=Math.min(q,o.maxDistance(r,s,d,s,x,C,x,M)),q=Math.min(q,o.maxDistance(r,s,d,s,x,C,R,C)),q=Math.min(q,o.maxDistance(r,s,d,s,R,M,x,M)),q=Math.min(q,o.maxDistance(r,s,d,s,R,M,R,C)),q=Math.min(q,o.maxDistance(d,m,r,m,x,C,x,M)),q=Math.min(q,o.maxDistance(d,m,r,m,x,C,R,C)),q=Math.min(q,o.maxDistance(d,m,r,m,R,M,x,M)),q=Math.min(q,o.maxDistance(d,m,r,m,R,M,R,C)),q=Math.min(q,o.maxDistance(d,m,d,s,x,C,x,M)),q=Math.min(q,o.maxDistance(d,m,d,s,x,C,R,C)),q=Math.min(q,o.maxDistance(d,m,d,s,R,M,x,M)),q=Math.min(q,o.maxDistance(d,m,d,s,R,M,R,C))}}]),o}(),gi=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"maximumDistance",value:function(){return Jo.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(e,n){var r=o.isComposite(this._boundable1),s=o.isComposite(this._boundable2);if(r&&s)return o.area(this._boundable1)>o.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,e,n),null):(this.expand(this._boundable2,this._boundable1,!0,e,n),null);if(r)return this.expand(this._boundable1,this._boundable2,!1,e,n),null;if(s)return this.expand(this._boundable2,this._boundable1,!0,e,n),null;throw new T("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(o.isComposite(this._boundable1)||o.isComposite(this._boundable2))}},{key:"compareTo",value:function(e){var n=e;return this._distance<n._distance?-1:this._distance>n._distance?1:0}},{key:"expand",value:function(e,n,r,s,d){for(var m=e.getChildBoundables().iterator();m.hasNext();){var x=m.next(),C=null;(C=r?new o(n,x,this._itemDistance):new o(x,n,this._itemDistance)).getDistance()<d&&s.add(C)}}},{key:"getBoundable",value:function(e){return e===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[P]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],n=arguments[1],r=arguments[2];this._boundable1=e,this._boundable2=n,this._itemDistance=r,this._distance=this.distance()}},{key:"area",value:function(e){return e.getBounds().getArea()}},{key:"isComposite",value:function(e){return e instanceof bt}}]),o}(),fs=function(){function o(){l(this,o)}return p(o,[{key:"visitItem",value:function(e){}}]),o}(),pi=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"queryInternal",value:function(){if(ge(arguments[2],fs)&&arguments[0]instanceof Object&&arguments[1]instanceof bt)for(var e=arguments[0],n=arguments[1],r=arguments[2],s=n.getChildBoundables(),d=0;d<s.size();d++){var m=s.get(d);this.getIntersectsOp().intersects(m.getBounds(),e)&&(m instanceof bt?this.queryInternal(e,m,r):m instanceof Gt?r.visitItem(m.getItem()):re.shouldNeverReachHere())}else if(ge(arguments[2],Qe)&&arguments[0]instanceof Object&&arguments[1]instanceof bt)for(var x=arguments[0],C=arguments[1],R=arguments[2],M=C.getChildBoundables(),q=0;q<M.size();q++){var K=M.get(q);this.getIntersectsOp().intersects(K.getBounds(),x)&&(K instanceof bt?this.queryInternal(x,K,R):K instanceof Gt?R.add(K.getItem()):re.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(e){return e.get(e.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var s=r.next();s instanceof bt?n+=this.size(s):s instanceof Gt&&(n+=1)}return n}}},{key:"removeItem",value:function(e,n){for(var r=null,s=e.getChildBoundables().iterator();s.hasNext();){var d=s.next();d instanceof Gt&&d.getItem()===n&&(r=d)}return r!==null&&(e.getChildBoundables().remove(r),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var e=this.itemsTree(this._root);return e===null?new Ee:e}if(arguments.length===1){for(var n=arguments[0],r=new Ee,s=n.getChildBoundables().iterator();s.hasNext();){var d=s.next();if(d instanceof bt){var m=this.itemsTree(d);m!==null&&r.add(m)}else d instanceof Gt?r.add(d.getItem()):re.shouldNeverReachHere()}return r.size()<=0?null:r}}},{key:"insert",value:function(e,n){re.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Gt(e,n))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var e=arguments[0],n=new Ee;return this.boundablesAtLevel(e,this._root,n),n}if(arguments.length===3){var r=arguments[0],s=arguments[1],d=arguments[2];if(re.isTrue(r>-2),s.getLevel()===r)return d.add(s),null;for(var m=s.getChildBoundables().iterator();m.hasNext();){var x=m.next();x instanceof bt?this.boundablesAtLevel(r,x,d):(re.isTrue(x instanceof Gt),r===-1&&d.add(x))}return null}}},{key:"query",value:function(){if(arguments.length===1){var e=arguments[0];this.build();var n=new Ee;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.queryInternal(e,this._root,n),n}if(arguments.length===2){var r=arguments[0],s=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.queryInternal(r,this._root,s)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var e=arguments[0],n=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.remove(e,this._root,n)}if(arguments.length===3){var r=arguments[0],s=arguments[1],d=arguments[2],m=this.removeItem(s,d);if(m)return!0;for(var x=null,C=s.getChildBoundables().iterator();C.hasNext();){var R=C.next();if(this.getIntersectsOp().intersects(R.getBounds(),r)&&R instanceof bt&&(m=this.remove(r,R,d))){x=R;break}}return x!==null&&x.getChildBoundables().isEmpty()&&s.getChildBoundables().remove(x),m}}},{key:"createHigherLevels",value:function(e,n){re.isTrue(!e.isEmpty());var r=this.createParentBoundables(e,n+1);return r.size()===1?r.get(0):this.createHigherLevels(r,n+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var s=r.next();if(s instanceof bt){var d=this.depth(s);d>n&&(n=d)}}return n+1}}},{key:"createParentBoundables",value:function(e,n){re.isTrue(!e.isEmpty());var r=new Ee;r.add(this.createNode(n));var s=new Ee(e);di.sort(s,this.getComparator());for(var d=s.iterator();d.hasNext();){var m=d.next();this.lastNode(r).getChildBoundables().size()===this.getNodeCapacity()&&r.add(this.createNode(n)),this.lastNode(r).addChildBoundable(m)}return r}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[z]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new Ee,this._nodeCapacity=null,arguments.length===0)o.constructor_.call(this,o.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var e=arguments[0];re.isTrue(e>1,"Node capacity must be greater than 1"),this._nodeCapacity=e}}},{key:"compareDoubles",value:function(e,n){return e>n?1:e<n?-1:0}}]),o}();pi.IntersectsOp=function(){},pi.DEFAULT_NODE_CAPACITY=10;var Qo=function(){function o(){l(this,o)}return p(o,[{key:"distance",value:function(e,n){}}]),o}(),Ot=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"createParentBoundablesFromVerticalSlices",value:function(r,s){re.isTrue(r.length>0);for(var d=new Ee,m=0;m<r.length;m++)d.addAll(this.createParentBoundablesFromVerticalSlice(r[m],s));return d}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var r=arguments[0],s=arguments[1];return this.nearestNeighbourK(r,J.POSITIVE_INFINITY,s)}if(arguments.length===3){var d=arguments[0],m=arguments[1],x=arguments[2],C=m,R=new hn;R.add(d);for(var M=new hn;!R.isEmpty()&&C>=0;){var q=R.poll(),K=q.getDistance();if(K>=C)break;if(q.isLeaves())if(M.size()<x)M.add(q);else{var ae=M.peek();ae.getDistance()>K&&(M.poll(),M.add(q));var se=M.peek();C=se.getDistance()}else q.expandToQueue(R,C)}return n.getItems(M)}}},{key:"createNode",value:function(r){return new ds(r)}},{key:"size",value:function(){return arguments.length===0?A(I(n.prototype),"size",this).call(this):A(I(n.prototype),"size",this).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof G))return A(I(n.prototype),"insert",this).apply(this,arguments);var r=arguments[0],s=arguments[1];if(r.isNull())return null;A(I(n.prototype),"insert",this).call(this,r,s)}},{key:"getIntersectsOp",value:function(){return n.intersectsOp}},{key:"verticalSlices",value:function(r,s){for(var d=Math.trunc(Math.ceil(r.size()/s)),m=new Array(s).fill(null),x=r.iterator(),C=0;C<s;C++){m[C]=new Ee;for(var R=0;x.hasNext()&&R<d;){var M=x.next();m[C].add(M),R++}}return m}},{key:"query",value:function(){if(arguments.length===1){var r=arguments[0];return A(I(n.prototype),"query",this).call(this,r)}if(arguments.length===2){var s=arguments[0],d=arguments[1];A(I(n.prototype),"query",this).call(this,s,d)}}},{key:"getComparator",value:function(){return n.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(r,s){return A(I(n.prototype),"createParentBoundables",this).call(this,r,s)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof G){var r=arguments[0],s=arguments[1];return A(I(n.prototype),"remove",this).call(this,r,s)}return A(I(n.prototype),"remove",this).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?A(I(n.prototype),"depth",this).call(this):A(I(n.prototype),"depth",this).apply(this,arguments)}},{key:"createParentBoundables",value:function(r,s){re.isTrue(!r.isEmpty());var d=Math.trunc(Math.ceil(r.size()/this.getNodeCapacity())),m=new Ee(r);di.sort(m,n.xComparator);var x=this.verticalSlices(m,Math.trunc(Math.ceil(Math.sqrt(d))));return this.createParentBoundablesFromVerticalSlices(x,s)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(ge(arguments[0],Qo)){var r=arguments[0];if(this.isEmpty())return null;var s=new gi(this.getRoot(),this.getRoot(),r);return this.nearestNeighbour(s)}if(arguments[0]instanceof gi){var d=arguments[0],m=J.POSITIVE_INFINITY,x=null,C=new hn;for(C.add(d);!C.isEmpty()&&m>0;){var R=C.poll(),M=R.getDistance();if(M>=m)break;R.isLeaves()?(m=M,x=R):R.expandToQueue(C,m)}return x===null?null:[x.getBoundable(0).getItem(),x.getBoundable(1).getItem()]}}else{if(arguments.length===2){var q=arguments[0],K=arguments[1];if(this.isEmpty()||q.isEmpty())return null;var ae=new gi(this.getRoot(),q.getRoot(),K);return this.nearestNeighbour(ae)}if(arguments.length===3){var se=arguments[0],ye=arguments[1],_e=arguments[2],ke=new Gt(se,ye),Ue=new gi(this.getRoot(),ke,_e);return this.nearestNeighbour(Ue)[0]}if(arguments.length===4){var qe=arguments[0],nt=arguments[1],gt=arguments[2],Lt=arguments[3],qt=new Gt(qe,nt),ii=new gi(this.getRoot(),qt,gt);return this.nearestNeighbourK(ii,Lt)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var r=arguments[0],s=arguments[1],d=J.POSITIVE_INFINITY,m=new hn;for(m.add(r);!m.isEmpty();){var x=m.poll(),C=x.getDistance();if(C>s)return!1;if(x.maximumDistance()<=s)return!0;if(x.isLeaves()){if((d=C)<=s)return!0}else x.expandToQueue(m,d)}return!1}if(arguments.length===3){var R=arguments[0],M=arguments[1],q=arguments[2],K=new gi(this.getRoot(),R.getRoot(),M);return this.isWithinDistance(K,q)}}},{key:"interfaces_",get:function(){return[Ko,z]}}],[{key:"constructor_",value:function(){if(arguments.length===0)n.constructor_.call(this,n.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var r=arguments[0];pi.constructor_.call(this,r)}}},{key:"centreX",value:function(r){return n.avg(r.getMinX(),r.getMaxX())}},{key:"avg",value:function(r,s){return(r+s)/2}},{key:"getItems",value:function(r){for(var s=new Array(r.size()).fill(null),d=0;!r.isEmpty();){var m=r.poll();s[d]=m.getBoundable(0).getItem(),d++}return s}},{key:"centreY",value:function(r){return n.avg(r.getMinY(),r.getMaxY())}}]),n}(pi),ds=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"computeBounds",value:function(){for(var r=null,s=this.getChildBoundables().iterator();s.hasNext();){var d=s.next();r===null?r=new G(d.getBounds()):r.expandToInclude(d.getBounds())}return r}}],[{key:"constructor_",value:function(){var r=arguments[0];bt.constructor_.call(this,r)}}]),n}(bt);Ot.STRtreeNode=ds,Ot.xComparator=new(function(){function o(){l(this,o)}return p(o,[{key:"interfaces_",get:function(){return[ve]}},{key:"compare",value:function(e,n){return pi.compareDoubles(Ot.centreX(e.getBounds()),Ot.centreX(n.getBounds()))}}]),o}()),Ot.yComparator=new(function(){function o(){l(this,o)}return p(o,[{key:"interfaces_",get:function(){return[ve]}},{key:"compare",value:function(e,n){return pi.compareDoubles(Ot.centreY(e.getBounds()),Ot.centreY(n.getBounds()))}}]),o}()),Ot.intersectsOp=new(function(){function o(){l(this,o)}return p(o,[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(e,n){return e.intersects(n)}}]),o}()),Ot.DEFAULT_NODE_CAPACITY=10;var eu=function(){function o(){l(this,o)}return p(o,null,[{key:"relativeSign",value:function(e,n){return e<n?-1:e>n?1:0}},{key:"compare",value:function(e,n,r){if(n.equals2D(r))return 0;var s=o.relativeSign(n.x,r.x),d=o.relativeSign(n.y,r.y);switch(e){case 0:return o.compareValue(s,d);case 1:return o.compareValue(d,s);case 2:return o.compareValue(d,-s);case 3:return o.compareValue(-s,d);case 4:return o.compareValue(-s,-d);case 5:return o.compareValue(-d,-s);case 6:return o.compareValue(-d,s);case 7:return o.compareValue(s,-d)}return re.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(e,n){return e<0?-1:e>0?1:n<0?-1:n>0?1:0}}]),o}(),tu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(e){var n=e;return this.segmentIndex<n.segmentIndex?-1:this.segmentIndex>n.segmentIndex?1:this.coord.equals2D(n.coord)?0:this._isInterior?n._isInterior?eu.compare(this._segmentOctant,this.coord,n.coord):1:-1}},{key:"isEndPoint",value:function(e){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===e}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[P]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],n=arguments[1],r=arguments[2],s=arguments[3];this._segString=e,this.coord=new F(n),this.segmentIndex=r,this._segmentOctant=s,this._isInterior=!n.equals2D(e.getCoordinate(r))}}]),o}(),iu=function(){function o(){l(this,o)}return p(o,[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}]),o}(),nu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getSplitCoordinates",value:function(){var e=new Di;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var s=n.next();this.addEdgeCoordinates(r,s,e),r=s}return e.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var e=new Ee;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var n=e.iterator();n.hasNext();){var r=n.next().intValue();this.add(this._edge.getCoordinate(r),r)}}},{key:"createSplitEdgePts",value:function(e,n){var r=n.segmentIndex-e.segmentIndex+2;if(r===2)return[new F(e.coord),new F(n.coord)];var s=this._edge.getCoordinate(n.segmentIndex),d=n.isInterior()||!n.coord.equals2D(s);d||r--;var m=new Array(r).fill(null),x=0;m[x++]=new F(e.coord);for(var C=e.segmentIndex+1;C<=n.segmentIndex;C++)m[x++]=this._edge.getCoordinate(C);return d&&(m[x]=new F(n.coord)),m}},{key:"print",value:function(e){e.println("Intersections:");for(var n=this.iterator();n.hasNext();)n.next().print(e)}},{key:"findCollapsesFromExistingVertices",value:function(e){for(var n=0;n<this._edge.size()-2;n++){var r=this._edge.getCoordinate(n);this._edge.getCoordinate(n+1);var s=this._edge.getCoordinate(n+2);r.equals2D(s)&&e.add(Ht.valueOf(n+1))}}},{key:"addEdgeCoordinates",value:function(e,n,r){var s=this.createSplitEdgePts(e,n);r.add(s,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(e){this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),r=n.next();n.hasNext();){var s=n.next(),d=this.createSplitEdge(r,s);e.add(d),r=s}}},{key:"findCollapseIndex",value:function(e,n,r){if(!e.coord.equals2D(n.coord))return!1;var s=n.segmentIndex-e.segmentIndex;return n.isInterior()||s--,s===1&&(r[0]=e.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(e){for(var n=new Array(1).fill(null),r=this.iterator(),s=r.next();r.hasNext();){var d=r.next();this.findCollapseIndex(s,d,n)&&e.add(Ht.valueOf(n[0])),s=d}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)}},{key:"createSplitEdge",value:function(e,n){var r=this.createSplitEdgePts(e,n);return new ti(r,this._edge.getData())}},{key:"add",value:function(e,n){var r=new tu(this._edge,e,n,this._edge.getSegmentOctant(n)),s=this._nodeMap.get(r);return s!==null?(re.isTrue(s.coord.equals2D(e),"Found equal nodes with different coordinates"),s):(this._nodeMap.put(r,r),r)}},{key:"checkSplitEdgesCorrectness",value:function(e){var n=this._edge.getCoordinates(),r=e.get(0).getCoordinate(0);if(!r.equals2D(n[0]))throw new le("bad split edge start point at "+r);var s=e.get(e.size()-1).getCoordinates(),d=s[s.length-1];if(!d.equals2D(n[n.length-1]))throw new le("bad split edge end point at "+d)}}],[{key:"constructor_",value:function(){this._nodeMap=new Gi,this._edge=null;var e=arguments[0];this._edge=e}}]),o}(),ru=function(){function o(){l(this,o)}return p(o,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1];if(e===0&&n===0)throw new T("Cannot compute the octant for point ( "+e+", "+n+" )");var r=Math.abs(e),s=Math.abs(n);return e>=0?n>=0?r>=s?0:1:r>=s?7:6:n>=0?r>=s?3:2:r>=s?4:5}if(arguments[0]instanceof F&&arguments[1]instanceof F){var d=arguments[0],m=arguments[1],x=m.x-d.x,C=m.y-d.y;if(x===0&&C===0)throw new T("Cannot compute the octant for two identical points "+d);return o.octant(x,C)}}}]),o}(),su=function(){function o(){l(this,o)}return p(o,[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(e){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(e){}},{key:"getData",value:function(){}}]),o}(),au=function(){function o(){l(this,o)}return p(o,[{key:"addIntersection",value:function(e,n){}},{key:"interfaces_",get:function(){return[su]}}]),o}(),ti=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(e){return this._pts[e]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))}},{key:"setData",value:function(e){this._data=e}},{key:"safeOctant",value:function(e,n){return e.equals2D(n)?0:ru.octant(e,n)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var e=arguments[0],n=arguments[1];this.addIntersectionNode(e,n)}else if(arguments.length===4){var r=arguments[0],s=arguments[1],d=arguments[3],m=new F(r.getIntersection(d));this.addIntersection(m,s)}}},{key:"toString",value:function(){return Yn.toLineString(new Fi(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(e,n){var r=n,s=r+1;if(s<this._pts.length){var d=this._pts[s];e.equals2D(d)&&(r=s)}return this._nodeList.add(e,r)}},{key:"addIntersections",value:function(e,n,r){for(var s=0;s<e.getIntersectionNum();s++)this.addIntersection(e,n,r,s)}},{key:"interfaces_",get:function(){return[au]}}],[{key:"constructor_",value:function(){this._nodeList=new nu(this),this._pts=null,this._data=null;var e=arguments[0],n=arguments[1];this._pts=e,this._data=n}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var e=arguments[0],n=new Ee;return o.getNodedSubstrings(e,n),n}if(arguments.length===2)for(var r=arguments[0],s=arguments[1],d=r.iterator();d.hasNext();){var m=d.next();m.getNodeList().addSplitEdges(s)}}}]),o}(),ft=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof o){var e=arguments[0],n=we.index(this.p0,this.p1,e.p0),r=we.index(this.p0,this.p1,e.p1);return n>=0&&r>=0||n<=0&&r<=0?Math.max(n,r):0}if(arguments[0]instanceof F){var s=arguments[0];return we.index(this.p0,this.p1,s)}}},{key:"toGeometry",value:function(e){return e.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(e){if(!(e instanceof o))return!1;var n=e;return this.p0.equals(n.p0)&&this.p1.equals(n.p1)}},{key:"intersection",value:function(e){var n=new ei;return n.computeIntersection(this.p0,this.p1,e.p0,e.p1),n.hasIntersection()?n.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof F){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new F(e);var n=this.projectionFactor(e),r=new F;return r.x=this.p0.x+n*(this.p1.x-this.p0.x),r.y=this.p0.y+n*(this.p1.y-this.p0.y),r}if(arguments[0]instanceof o){var s=arguments[0],d=this.projectionFactor(s.p0),m=this.projectionFactor(s.p1);if(d>=1&&m>=1||d<=0&&m<=0)return null;var x=this.project(s.p0);d<0&&(x=this.p0),d>1&&(x=this.p1);var C=this.project(s.p1);return m<0&&(C=this.p0),m>1&&(C=this.p1),new o(x,C)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(e){return e===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(e){return At.pointToLinePerpendicular(e,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return o.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var n=this.p1.x-this.p0.x,r=this.p1.y-this.p0.y,s=n*n+r*r;return s<=0?J.NaN:((e.x-this.p0.x)*n+(e.y-this.p0.y)*r)/s}},{key:"closestPoints",value:function(e){var n=this.intersection(e);if(n!==null)return[n,n];var r=new Array(2).fill(null),s=J.MAX_VALUE,d=null,m=this.closestPoint(e.p0);s=m.distance(e.p0),r[0]=m,r[1]=e.p0;var x=this.closestPoint(e.p1);(d=x.distance(e.p1))<s&&(s=d,r[0]=x,r[1]=e.p1);var C=e.closestPoint(this.p0);(d=C.distance(this.p0))<s&&(s=d,r[0]=this.p0,r[1]=C);var R=e.closestPoint(this.p1);return(d=R.distance(this.p1))<s&&(s=d,r[0]=this.p1,r[1]=R),r}},{key:"closestPoint",value:function(e){var n=this.projectionFactor(e);return n>0&&n<1?this.project(e):this.p0.distance(e)<this.p1.distance(e)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(e){var n=e,r=this.p0.compareTo(n.p0);return r!==0?r:this.p1.compareTo(n.p1)}},{key:"reverse",value:function(){var e=this.p0;this.p0=this.p1,this.p1=e}},{key:"equalsTopo",value:function(e){return this.p0.equals(e.p0)&&this.p1.equals(e.p1)||this.p0.equals(e.p1)&&this.p1.equals(e.p0)}},{key:"lineIntersection",value:function(e){return Pn.intersection(this.p0,this.p1,e.p0,e.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(e,n){var r=this.p0.x+e*(this.p1.x-this.p0.x),s=this.p0.y+e*(this.p1.y-this.p0.y),d=this.p1.x-this.p0.x,m=this.p1.y-this.p0.y,x=Math.sqrt(d*d+m*m),C=0,R=0;if(n!==0){if(x<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");C=n*d/x,R=n*m/x}return new F(r-R,s+C)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.p0.x=n.x,this.p0.y=n.y,this.p1.x=r.x,this.p1.y=r.y}}},{key:"segmentFraction",value:function(e){var n=this.projectionFactor(e);return n<0?n=0:(n>1||J.isNaN(n))&&(n=1),n}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(e){var n=this.p1.getY()-this.p0.getY(),r=this.p0.getX()-this.p1.getX(),s=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),d=n*n+r*r,m=n*n-r*r,x=e.getX(),C=e.getY();return new F((-m*x-2*n*r*C-2*n*s)/d,(m*C-2*n*r*x-2*r*s)/d)}},{key:"distance",value:function(){if(arguments[0]instanceof o){var e=arguments[0];return At.segmentToSegment(this.p0,this.p1,e.p0,e.p1)}if(arguments[0]instanceof F){var n=arguments[0];return At.pointToSegment(n,this.p0,this.p1)}}},{key:"pointAlong",value:function(e){var n=new F;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}},{key:"hashCode",value:function(){var e=J.doubleToLongBits(this.p0.x);e^=31*J.doubleToLongBits(this.p0.y);var n=Math.trunc(e)^Math.trunc(e>>32),r=J.doubleToLongBits(this.p1.x);return r^=31*J.doubleToLongBits(this.p1.y),n^(Math.trunc(r)^Math.trunc(r>>32))}},{key:"interfaces_",get:function(){return[P,z]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)o.constructor_.call(this,new F,new F);else if(arguments.length===1){var e=arguments[0];o.constructor_.call(this,e.p0,e.p1)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.p0=n,this.p1=r}else if(arguments.length===4){var s=arguments[0],d=arguments[1],m=arguments[2],x=arguments[3];o.constructor_.call(this,new F(s,d),new F(m,x))}}},{key:"midPoint",value:function(e,n){return new F((e.x+n.x)/2,(e.y+n.y)/2)}}]),o}(),ou=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var e=arguments[0],n=arguments[1],r=arguments[2],s=arguments[3];e.getLineSegment(n,this._overlapSeg1),r.getLineSegment(s,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new ft,this._overlapSeg2=new ft}}]),o}(),gs=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getLineSegment",value:function(e,n){n.p0=this._pts[e],n.p1=this._pts[e+1]}},{key:"computeSelect",value:function(e,n,r,s){var d=this._pts[n],m=this._pts[r];if(r-n==1)return s.select(this,n),null;if(!e.intersects(d,m))return null;var x=Math.trunc((n+r)/2);n<x&&this.computeSelect(e,n,x,s),x<r&&this.computeSelect(e,x,r,s)}},{key:"getCoordinates",value:function(){for(var e=new Array(this._end-this._start+1).fill(null),n=0,r=this._start;r<=this._end;r++)e[n++]=this._pts[r];return e}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var e=arguments[0],n=arguments[1];this.computeOverlaps(this._start,this._end,e,e._start,e._end,n)}else if(arguments.length===6){var r=arguments[0],s=arguments[1],d=arguments[2],m=arguments[3],x=arguments[4],C=arguments[5];if(s-r==1&&x-m==1)return C.overlap(this,r,d,m),null;if(!this.overlaps(r,s,d,m,x))return null;var R=Math.trunc((r+s)/2),M=Math.trunc((m+x)/2);r<R&&(m<M&&this.computeOverlaps(r,R,d,m,M,C),M<x&&this.computeOverlaps(r,R,d,M,x,C)),R<s&&(m<M&&this.computeOverlaps(R,s,d,m,M,C),M<x&&this.computeOverlaps(R,s,d,M,x,C))}}},{key:"setId",value:function(e){this._id=e}},{key:"select",value:function(e,n){this.computeSelect(e,this._start,this._end,n)}},{key:"getEnvelope",value:function(){if(this._env===null){var e=this._pts[this._start],n=this._pts[this._end];this._env=new G(e,n)}return this._env}},{key:"overlaps",value:function(e,n,r,s,d){return G.intersects(this._pts[e],this._pts[n],r._pts[s],r._pts[d])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],n=arguments[1],r=arguments[2],s=arguments[3];this._pts=e,this._start=n,this._end=r,this._context=s}}]),o}(),uu=function(){function o(){l(this,o)}return p(o,null,[{key:"findChainEnd",value:function(e,n){for(var r=n;r<e.length-1&&e[r].equals2D(e[r+1]);)r++;if(r>=e.length-1)return e.length-1;for(var s=at.quadrant(e[r],e[r+1]),d=n+1;d<e.length&&!(!e[d-1].equals2D(e[d])&&at.quadrant(e[d-1],e[d])!==s);)d++;return d-1}},{key:"getChains",value:function(){if(arguments.length===1){var e=arguments[0];return o.getChains(e,null)}if(arguments.length===2){var n=arguments[0],r=arguments[1],s=new Ee,d=0;do{var m=o.findChainEnd(n,d),x=new gs(n,d,m,r);s.add(x),d=m}while(d<n.length-1);return s}}}]),o}(),jn=function(){function o(){l(this,o)}return p(o,[{key:"computeNodes",value:function(e){}},{key:"getNodedSubstrings",value:function(){}}]),o}(),ps=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"setSegmentIntersector",value:function(e){this._segInt=e}},{key:"interfaces_",get:function(){return[jn]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setSegmentIntersector(e)}}}}]),o}(),Xn=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return ti.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(r){for(var s=uu.getChains(r.getCoordinates(),r).iterator();s.hasNext();){var d=s.next();d.setId(this._idCounter++),this._index.insert(d.getEnvelope(),d),this._monoChains.add(d)}}},{key:"computeNodes",value:function(r){this._nodedSegStrings=r;for(var s=r.iterator();s.hasNext();)this.add(s.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var r=new ys(this._segInt),s=this._monoChains.iterator();s.hasNext();)for(var d=s.next(),m=this._index.query(d.getEnvelope()).iterator();m.hasNext();){var x=m.next();if(x.getId()>d.getId()&&(d.computeOverlaps(x,r),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new Ee,this._index=new Ot,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var r=arguments[0];ps.constructor_.call(this,r)}}}}]),n}(ps),ys=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"overlap",value:function(){if(arguments.length!==4)return A(I(n.prototype),"overlap",this).apply(this,arguments);var r=arguments[0],s=arguments[1],d=arguments[2],m=arguments[3],x=r.getContext(),C=d.getContext();this._si.processIntersections(x,s,C,m)}}],[{key:"constructor_",value:function(){this._si=null;var r=arguments[0];this._si=r}}]),n}(ou);Xn.SegmentOverlapAction=ys;var Nt=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"isDeletable",value:function(e,n,r,s){var d=this._inputLine[e],m=this._inputLine[n],x=this._inputLine[r];return!!this.isConcave(d,m,x)&&!!this.isShallow(d,m,x,s)&&this.isShallowSampled(d,m,e,r,s)}},{key:"deleteShallowConcavities",value:function(){for(var e=1,n=this.findNextNonDeletedIndex(e),r=this.findNextNonDeletedIndex(n),s=!1;r<this._inputLine.length;){var d=!1;this.isDeletable(e,n,r,this._distanceTol)&&(this._isDeleted[n]=o.DELETE,d=!0,s=!0),e=d?r:n,n=this.findNextNonDeletedIndex(e),r=this.findNextNonDeletedIndex(n)}return s}},{key:"isShallowConcavity",value:function(e,n,r,s){return we.index(e,n,r)===this._angleOrientation&&At.pointToSegment(n,e,r)<s}},{key:"isShallowSampled",value:function(e,n,r,s,d){var m=Math.trunc((s-r)/o.NUM_PTS_TO_CHECK);m<=0&&(m=1);for(var x=r;x<s;x+=m)if(!this.isShallow(e,n,this._inputLine[x],d))return!1;return!0}},{key:"isConcave",value:function(e,n,r){var s=we.index(e,n,r)===this._angleOrientation;return s}},{key:"simplify",value:function(e){this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=we.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do n=this.deleteShallowConcavities();while(n);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(e){for(var n=e+1;n<this._inputLine.length&&this._isDeleted[n]===o.DELETE;)n++;return n}},{key:"isShallow",value:function(e,n,r,s){return At.pointToSegment(n,e,r)<s}},{key:"collapseLine",value:function(){for(var e=new Di,n=0;n<this._inputLine.length;n++)this._isDeleted[n]!==o.DELETE&&e.add(this._inputLine[n]);return e.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=we.COUNTERCLOCKWISE;var e=arguments[0];this._inputLine=e}},{key:"simplify",value:function(e,n){return new o(e).simplify(n)}}]),o}();Nt.INIT=0,Nt.DELETE=1,Nt.KEEP=1,Nt.NUM_PTS_TO_CHECK=10;var ms=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getCoordinates",value:function(){return this._ptList.toArray(o.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(e){this._precisionModel=e}},{key:"addPt",value:function(e){var n=new F(e);if(this._precisionModel.makePrecise(n),this.isRedundant(n))return null;this._ptList.add(n)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(e,n){if(n)for(var r=0;r<e.length;r++)this.addPt(e[r]);else for(var s=e.length-1;s>=0;s--)this.addPt(e[s])}},{key:"isRedundant",value:function(e){if(this._ptList.size()<1)return!1;var n=this._ptList.get(this._ptList.size()-1);return e.distance(n)<this._minimimVertexDistance}},{key:"toString",value:function(){return new ci().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var e=new F(this._ptList.get(0)),n=this._ptList.get(this._ptList.size()-1);if(e.equals(n))return null;this._ptList.add(e)}},{key:"setMinimumVertexDistance",value:function(e){this._minimimVertexDistance=e}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Ee}}]),o}();ms.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var dt=function(){function o(){l(this,o)}return p(o,null,[{key:"toDegrees",value:function(e){return 180*e/Math.PI}},{key:"normalize",value:function(e){for(;e>Math.PI;)e-=o.PI_TIMES_2;for(;e<=-Math.PI;)e+=o.PI_TIMES_2;return e}},{key:"angle",value:function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}if(arguments.length===2){var n=arguments[0],r=arguments[1],s=r.x-n.x,d=r.y-n.y;return Math.atan2(d,s)}}},{key:"isAcute",value:function(e,n,r){var s=e.x-n.x,d=e.y-n.y;return s*(r.x-n.x)+d*(r.y-n.y)>0}},{key:"isObtuse",value:function(e,n,r){var s=e.x-n.x,d=e.y-n.y;return s*(r.x-n.x)+d*(r.y-n.y)<0}},{key:"interiorAngle",value:function(e,n,r){var s=o.angle(n,e),d=o.angle(n,r);return Math.abs(d-s)}},{key:"normalizePositive",value:function(e){if(e<0){for(;e<0;)e+=o.PI_TIMES_2;e>=o.PI_TIMES_2&&(e=0)}else{for(;e>=o.PI_TIMES_2;)e-=o.PI_TIMES_2;e<0&&(e=0)}return e}},{key:"angleBetween",value:function(e,n,r){var s=o.angle(n,e),d=o.angle(n,r);return o.diff(s,d)}},{key:"diff",value:function(e,n){var r=null;return(r=e<n?n-e:e-n)>Math.PI&&(r=2*Math.PI-r),r}},{key:"toRadians",value:function(e){return e*Math.PI/180}},{key:"getTurn",value:function(e,n){var r=Math.sin(n-e);return r>0?o.COUNTERCLOCKWISE:r<0?o.CLOCKWISE:o.NONE}},{key:"angleBetweenOriented",value:function(e,n,r){var s=o.angle(n,e),d=o.angle(n,r)-s;return d<=-Math.PI?d+o.PI_TIMES_2:d>Math.PI?d-o.PI_TIMES_2:d}}]),o}();dt.PI_TIMES_2=2*Math.PI,dt.PI_OVER_2=Math.PI/2,dt.PI_OVER_4=Math.PI/4,dt.COUNTERCLOCKWISE=we.COUNTERCLOCKWISE,dt.CLOCKWISE=we.CLOCKWISE,dt.NONE=we.COLLINEAR;var qi=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"addNextSegment",value:function(e,n){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var r=we.index(this._s0,this._s1,this._s2),s=r===we.CLOCKWISE&&this._side===te.LEFT||r===we.COUNTERCLOCKWISE&&this._side===te.RIGHT;r===0?this.addCollinear(n):s?this.addOutsideTurn(r,n):this.addInsideTurn(r,n)}},{key:"addLineEndCap",value:function(e,n){var r=new ft(e,n),s=new ft;this.computeOffsetSegment(r,te.LEFT,this._distance,s);var d=new ft;this.computeOffsetSegment(r,te.RIGHT,this._distance,d);var m=n.x-e.x,x=n.y-e.y,C=Math.atan2(x,m);switch(this._bufParams.getEndCapStyle()){case v.CAP_ROUND:this._segList.addPt(s.p1),this.addDirectedFillet(n,C+Math.PI/2,C-Math.PI/2,we.CLOCKWISE,this._distance),this._segList.addPt(d.p1);break;case v.CAP_FLAT:this._segList.addPt(s.p1),this._segList.addPt(d.p1);break;case v.CAP_SQUARE:var R=new F;R.x=Math.abs(this._distance)*Math.cos(C),R.y=Math.abs(this._distance)*Math.sin(C);var M=new F(s.p1.x+R.x,s.p1.y+R.y),q=new F(d.p1.x+R.x,d.p1.y+R.y);this._segList.addPt(M),this._segList.addPt(q)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(e,n,r,s){var d=Pn.intersection(n.p0,n.p1,r.p0,r.p1);if(d!==null&&(s<=0?1:d.distance(e)/Math.abs(s))<=this._bufParams.getMitreLimit())return this._segList.addPt(d),null;this.addLimitedMitreJoin(n,r,s,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(e,n){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*o.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===v.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===v.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(n&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(e){this._segList.addPt(new F(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new F(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new F(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new F(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(e,n){this._segList.addPts(e,n)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(e,n,r,s,d){var m=n.x-e.x,x=n.y-e.y,C=Math.atan2(x,m),R=r.x-e.x,M=r.y-e.y,q=Math.atan2(M,R);s===we.CLOCKWISE?C<=q&&(C+=2*Math.PI):C>=q&&(C-=2*Math.PI),this._segList.addPt(n),this.addDirectedFillet(e,C,q,s,d),this._segList.addPt(r)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(e,n,r){this._s1=e,this._s2=n,this._side=r,this._seg1.setCoordinates(e,n),this.computeOffsetSegment(this._seg1,r,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(e,n,r,s){var d=this._seg0.p1,m=dt.angle(d,this._seg0.p0),x=dt.angleBetweenOriented(this._seg0.p0,d,this._seg1.p1)/2,C=dt.normalize(m+x),R=dt.normalize(C+Math.PI),M=s*r,q=r-M*Math.abs(Math.sin(x)),K=d.x+M*Math.cos(R),ae=d.y+M*Math.sin(R),se=new F(K,ae),ye=new ft(d,se),_e=ye.pointAlongOffset(1,q),ke=ye.pointAlongOffset(1,-q);this._side===te.LEFT?(this._segList.addPt(_e),this._segList.addPt(ke)):(this._segList.addPt(ke),this._segList.addPt(_e))}},{key:"addDirectedFillet",value:function(e,n,r,s,d){var m=s===we.CLOCKWISE?-1:1,x=Math.abs(n-r),C=Math.trunc(x/this._filletAngleQuantum+.5);if(C<1)return null;for(var R=x/C,M=new F,q=0;q<C;q++){var K=n+m*q*R;M.x=e.x+d*Math.cos(K),M.y=e.y+d*Math.sin(K),this._segList.addPt(M)}}},{key:"computeOffsetSegment",value:function(e,n,r,s){var d=n===te.LEFT?1:-1,m=e.p1.x-e.p0.x,x=e.p1.y-e.p0.y,C=Math.sqrt(m*m+x*x),R=d*r*m/C,M=d*r*x/C;s.p0.x=e.p0.x-M,s.p0.y=e.p0.y+R,s.p1.x=e.p1.x-M,s.p1.y=e.p1.y+R}},{key:"addInsideTurn",value:function(e,n){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*o.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var r=new F((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r);var s=new F((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(s)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(e){var n=new F(e.x+this._distance,e.y);this._segList.addPt(n),this.addDirectedFillet(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(e,n){this._segList.addPt(e.p1),this._segList.addPt(n.p0)}},{key:"init",value:function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new ms,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*o.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===v.JOIN_BEVEL||this._bufParams.getJoinStyle()===v.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,we.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new ft,this._seg1=new ft,this._offset0=new ft,this._offset1=new ft,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=e,this._bufParams=n,this._li=new ei,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===v.JOIN_ROUND&&(this._closingSegLengthFactor=o.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)}}]),o}();qi.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,qi.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,qi.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,qi.MAX_CLOSING_SEG_LEN_FACTOR=80;var lu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getOffsetCurve",value:function(e,n){if(this._distance=n,n===0)return null;var r=n<0,s=Math.abs(n),d=this.getSegGen(s);e.length<=1?this.computePointCurve(e[0],d):this.computeOffsetCurve(e,r,d);var m=d.getCoordinates();return r&&Xe.reverse(m),m}},{key:"computeSingleSidedBufferCurve",value:function(e,n,r){var s=this.simplifyTolerance(this._distance);if(n){r.addSegments(e,!0);var d=Nt.simplify(e,-s),m=d.length-1;r.initSideSegments(d[m],d[m-1],te.LEFT),r.addFirstSegment();for(var x=m-2;x>=0;x--)r.addNextSegment(d[x],!0)}else{r.addSegments(e,!1);var C=Nt.simplify(e,s),R=C.length-1;r.initSideSegments(C[0],C[1],te.LEFT),r.addFirstSegment();for(var M=2;M<=R;M++)r.addNextSegment(C[M],!0)}r.addLastSegment(),r.closeRing()}},{key:"computeRingBufferCurve",value:function(e,n,r){var s=this.simplifyTolerance(this._distance);n===te.RIGHT&&(s=-s);var d=Nt.simplify(e,s),m=d.length-1;r.initSideSegments(d[m-1],d[0],n);for(var x=1;x<=m;x++){var C=x!==1;r.addNextSegment(d[x],C)}r.closeRing()}},{key:"computeLineBufferCurve",value:function(e,n){var r=this.simplifyTolerance(this._distance),s=Nt.simplify(e,r),d=s.length-1;n.initSideSegments(s[0],s[1],te.LEFT);for(var m=2;m<=d;m++)n.addNextSegment(s[m],!0);n.addLastSegment(),n.addLineEndCap(s[d-1],s[d]);var x=Nt.simplify(e,-r),C=x.length-1;n.initSideSegments(x[C],x[C-1],te.LEFT);for(var R=C-2;R>=0;R--)n.addNextSegment(x[R],!0);n.addLastSegment(),n.addLineEndCap(x[1],x[0]),n.closeRing()}},{key:"computePointCurve",value:function(e,n){switch(this._bufParams.getEndCapStyle()){case v.CAP_ROUND:n.createCircle(e);break;case v.CAP_SQUARE:n.createSquare(e)}}},{key:"getLineCurve",value:function(e,n){if(this._distance=n,this.isLineOffsetEmpty(n))return null;var r=Math.abs(n),s=this.getSegGen(r);if(e.length<=1)this.computePointCurve(e[0],s);else if(this._bufParams.isSingleSided()){var d=n<0;this.computeSingleSidedBufferCurve(e,d,s)}else this.computeLineBufferCurve(e,s);return s.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(e){return e*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(e,n,r){if(this._distance=r,e.length<=2)return this.getLineCurve(e,r);if(r===0)return o.copyCoordinates(e);var s=this.getSegGen(r);return this.computeRingBufferCurve(e,n,s),s.getCoordinates()}},{key:"computeOffsetCurve",value:function(e,n,r){var s=this.simplifyTolerance(this._distance);if(n){var d=Nt.simplify(e,-s),m=d.length-1;r.initSideSegments(d[m],d[m-1],te.LEFT),r.addFirstSegment();for(var x=m-2;x>=0;x--)r.addNextSegment(d[x],!0)}else{var C=Nt.simplify(e,s),R=C.length-1;r.initSideSegments(C[0],C[1],te.LEFT),r.addFirstSegment();for(var M=2;M<=R;M++)r.addNextSegment(C[M],!0)}r.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(e){return e===0||e<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(e){return new qi(this._precisionModel,this._bufParams,e)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],n=arguments[1];this._precisionModel=e,this._bufParams=n}},{key:"copyCoordinates",value:function(e){for(var n=new Array(e.length).fill(null),r=0;r<n.length;r++)n[r]=new F(e[r]);return n}}]),o}(),vs=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var e=arguments[0],n=new Ee,r=this._subgraphs.iterator();r.hasNext();){var s=r.next(),d=s.getEnvelope();e.y<d.getMinY()||e.y>d.getMaxY()||this.findStabbedSegments(e,s.getDirectedEdges(),n)}return n}if(arguments.length===3){if(ge(arguments[2],Qe)&&arguments[0]instanceof F&&arguments[1]instanceof Vn)for(var m=arguments[0],x=arguments[1],C=arguments[2],R=x.getEdge().getCoordinates(),M=0;M<R.length-1;M++){this._seg.p0=R[M],this._seg.p1=R[M+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse();var q=Math.max(this._seg.p0.x,this._seg.p1.x);if(!(q<m.x)&&!(this._seg.isHorizontal()||m.y<this._seg.p0.y||m.y>this._seg.p1.y||we.index(this._seg.p0,this._seg.p1,m)===we.RIGHT)){var K=x.getDepth(te.LEFT);this._seg.p0.equals(R[M])||(K=x.getDepth(te.RIGHT));var ae=new _s(this._seg,K);C.add(ae)}}else if(ge(arguments[2],Qe)&&arguments[0]instanceof F&&ge(arguments[1],Qe))for(var se=arguments[0],ye=arguments[1],_e=arguments[2],ke=ye.iterator();ke.hasNext();){var Ue=ke.next();Ue.isForward()&&this.findStabbedSegments(se,Ue,_e)}}}},{key:"getDepth",value:function(e){var n=this.findStabbedSegments(e);return n.size()===0?0:di.min(n)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new ft;var e=arguments[0];this._subgraphs=e}}]),o}(),_s=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"compareTo",value:function(e){var n=e;if(this._upwardSeg.minX()>=n._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=n._upwardSeg.minX())return-1;var r=this._upwardSeg.orientationIndex(n._upwardSeg);return r!==0||(r=-1*n._upwardSeg.orientationIndex(this._upwardSeg))!==0?r:this._upwardSeg.compareTo(n._upwardSeg)}},{key:"compareX",value:function(e,n){var r=e.p0.compareTo(n.p0);return r!==0?r:e.p1.compareTo(n.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[P]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],n=arguments[1];this._upwardSeg=new ft(e),this._leftDepth=n}}]),o}();vs.DepthSegment=_s;var xs=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,null,[{key:"constructor_",value:function(){w.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}]),n}(w),Zn=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getY",value:function(){var e=this.y/this.w;if(J.isNaN(e)||J.isInfinite(e))throw new xs;return e}},{key:"getX",value:function(){var e=this.x/this.w;if(J.isNaN(e)||J.isInfinite(e))throw new xs;return e}},{key:"getCoordinate",value:function(){var e=new F;return e.x=this.getX(),e.y=this.getY(),e}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof o&&arguments[1]instanceof o){var s=arguments[0],d=arguments[1];this.x=s.y*d.w-d.y*s.w,this.y=d.x*s.w-s.x*d.w,this.w=s.x*d.y-d.x*s.y}else if(arguments[0]instanceof F&&arguments[1]instanceof F){var m=arguments[0],x=arguments[1];this.x=m.y-x.y,this.y=x.x-m.x,this.w=m.x*x.y-x.x*m.y}}else if(arguments.length===3){var C=arguments[0],R=arguments[1],M=arguments[2];this.x=C,this.y=R,this.w=M}else if(arguments.length===4){var q=arguments[0],K=arguments[1],ae=arguments[2],se=arguments[3],ye=q.y-K.y,_e=K.x-q.x,ke=q.x*K.y-K.x*q.y,Ue=ae.y-se.y,qe=se.x-ae.x,nt=ae.x*se.y-se.x*ae.y;this.x=_e*nt-qe*ke,this.y=Ue*ke-ye*nt,this.w=ye*qe-Ue*_e}}}]),o}(),hu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"area",value:function(){return o.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return o.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(e){if(e===null)throw new T("Supplied point is null.");return o.interpolateZ(e,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return o.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return o.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return o.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return o.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return o.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return o.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var e=arguments[0],n=arguments[1],r=arguments[2];this.p0=e,this.p1=n,this.p2=r}},{key:"area",value:function(e,n,r){return Math.abs(((r.x-e.x)*(n.y-e.y)-(n.x-e.x)*(r.y-e.y))/2)}},{key:"signedArea",value:function(e,n,r){return((r.x-e.x)*(n.y-e.y)-(n.x-e.x)*(r.y-e.y))/2}},{key:"det",value:function(e,n,r,s){return e*s-n*r}},{key:"interpolateZ",value:function(e,n,r,s){var d=n.x,m=n.y,x=r.x-d,C=s.x-d,R=r.y-m,M=s.y-m,q=x*M-C*R,K=e.x-d,ae=e.y-m,se=(M*K-C*ae)/q,ye=(-R*K+x*ae)/q;return n.getZ()+se*(r.getZ()-n.getZ())+ye*(s.getZ()-n.getZ())}},{key:"longestSideLength",value:function(e,n,r){var s=e.distance(n),d=n.distance(r),m=r.distance(e),x=s;return d>x&&(x=d),m>x&&(x=m),x}},{key:"circumcentreDD",value:function(e,n,r){var s=xe.valueOf(e.x).subtract(r.x),d=xe.valueOf(e.y).subtract(r.y),m=xe.valueOf(n.x).subtract(r.x),x=xe.valueOf(n.y).subtract(r.y),C=xe.determinant(s,d,m,x).multiply(2),R=s.sqr().add(d.sqr()),M=m.sqr().add(x.sqr()),q=xe.determinant(d,R,x,M),K=xe.determinant(s,R,m,M),ae=xe.valueOf(r.x).subtract(q.divide(C)).doubleValue(),se=xe.valueOf(r.y).add(K.divide(C)).doubleValue();return new F(ae,se)}},{key:"isAcute",value:function(e,n,r){return!!dt.isAcute(e,n,r)&&!!dt.isAcute(n,r,e)&&!!dt.isAcute(r,e,n)}},{key:"circumcentre",value:function(e,n,r){var s=r.x,d=r.y,m=e.x-s,x=e.y-d,C=n.x-s,R=n.y-d,M=2*o.det(m,x,C,R),q=o.det(x,m*m+x*x,R,C*C+R*R),K=o.det(m,m*m+x*x,C,C*C+R*R);return new F(s-q/M,d+K/M)}},{key:"perpendicularBisector",value:function(e,n){var r=n.x-e.x,s=n.y-e.y,d=new Zn(e.x+r/2,e.y+s/2,1),m=new Zn(e.x-s+r/2,e.y+r+s/2,1);return new Zn(d,m)}},{key:"angleBisector",value:function(e,n,r){var s=n.distance(e),d=s/(s+n.distance(r)),m=r.x-e.x,x=r.y-e.y;return new F(e.x+d*m,e.y+d*x)}},{key:"area3D",value:function(e,n,r){var s=n.x-e.x,d=n.y-e.y,m=n.getZ()-e.getZ(),x=r.x-e.x,C=r.y-e.y,R=r.getZ()-e.getZ(),M=d*R-m*C,q=m*x-s*R,K=s*C-d*x,ae=M*M+q*q+K*K,se=Math.sqrt(ae)/2;return se}},{key:"centroid",value:function(e,n,r){var s=(e.x+n.x+r.x)/3,d=(e.y+n.y+r.y)/3;return new F(s,d)}},{key:"inCentre",value:function(e,n,r){var s=n.distance(r),d=e.distance(r),m=e.distance(n),x=s+d+m,C=(s*e.x+d*n.x+m*r.x)/x,R=(s*e.y+d*n.y+m*r.y)/x;return new F(C,R)}}]),o}(),cu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"addRingSide",value:function(e,n,r,s,d){if(n===0&&e.length<Bi.MINIMUM_VALID_SIZE)return null;var m=s,x=d;e.length>=Bi.MINIMUM_VALID_SIZE&&we.isCCW(e)&&(m=d,x=s,r=te.opposite(r));var C=this._curveBuilder.getRingCurve(e,r,n);this.addCurve(C,m,x)}},{key:"addRingBothSides",value:function(e,n){this.addRingSide(e,n,te.LEFT,U.EXTERIOR,U.INTERIOR),this.addRingSide(e,n,te.RIGHT,U.INTERIOR,U.EXTERIOR)}},{key:"addPoint",value:function(e){if(this._distance<=0)return null;var n=e.getCoordinates(),r=this._curveBuilder.getLineCurve(n,this._distance);this.addCurve(r,U.EXTERIOR,U.INTERIOR)}},{key:"addPolygon",value:function(e){var n=this._distance,r=te.LEFT;this._distance<0&&(n=-this._distance,r=te.RIGHT);var s=e.getExteriorRing(),d=Xe.removeRepeatedPoints(s.getCoordinates());if(this._distance<0&&this.isErodedCompletely(s,this._distance)||this._distance<=0&&d.length<3)return null;this.addRingSide(d,n,r,U.EXTERIOR,U.INTERIOR);for(var m=0;m<e.getNumInteriorRing();m++){var x=e.getInteriorRingN(m),C=Xe.removeRepeatedPoints(x.getCoordinates());this._distance>0&&this.isErodedCompletely(x,-this._distance)||this.addRingSide(C,n,te.opposite(r),U.INTERIOR,U.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(e,n){var r=new hu(e[0],e[1],e[2]),s=r.inCentre();return At.pointToSegment(s,r.p0,r.p1)<Math.abs(n)}},{key:"addLineString",value:function(e){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var n=Xe.removeRepeatedPoints(e.getCoordinates());if(Xe.isRing(n)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(n,this._distance);else{var r=this._curveBuilder.getLineCurve(n,this._distance);this.addCurve(r,U.EXTERIOR,U.INTERIOR)}}},{key:"addCurve",value:function(e,n,r){if(e===null||e.length<2)return null;var s=new ti(e,new Et(0,U.BOUNDARY,n,r));this._curveList.add(s)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(e){if(e.isEmpty())return null;if(e instanceof rn)this.addPolygon(e);else if(e instanceof Mi)this.addLineString(e);else if(e instanceof Mn)this.addPoint(e);else if(e instanceof Bn)this.addCollection(e);else if(e instanceof Gn)this.addCollection(e);else if(e instanceof zn)this.addCollection(e);else{if(!(e instanceof ct))throw new ne(e.getGeometryType());this.addCollection(e)}}},{key:"isErodedCompletely",value:function(e,n){var r=e.getCoordinates();if(r.length<4)return n<0;if(r.length===4)return this.isTriangleErodedCompletely(r,n);var s=e.getEnvelopeInternal(),d=Math.min(s.getHeight(),s.getWidth());return n<0&&2*Math.abs(n)>d}},{key:"addCollection",value:function(e){for(var n=0;n<e.getNumGeometries();n++){var r=e.getGeometryN(n);this.add(r)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Ee;var e=arguments[0],n=arguments[1],r=arguments[2];this._inputGeom=e,this._distance=n,this._curveBuilder=r}}]),o}(),fu=function(){function o(){l(this,o)}return p(o,[{key:"locate",value:function(e){}}]),o}(),du=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,o.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new B;var e=this._parent.getGeometryN(this._index++);return e instanceof ct?(this._subcollectionIterator=new o(e),this._subcollectionIterator.next()):e}},{key:"remove",value:function(){throw new ne(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[iu]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()}},{key:"isAtomic",value:function(e){return!(e instanceof ct)}}]),o}(),gu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"locate",value:function(e){return o.locate(e,this._geom)}},{key:"interfaces_",get:function(){return[fu]}}],[{key:"constructor_",value:function(){this._geom=null;var e=arguments[0];this._geom=e}},{key:"locatePointInPolygon",value:function(e,n){if(n.isEmpty())return U.EXTERIOR;var r=n.getExteriorRing(),s=o.locatePointInRing(e,r);if(s!==U.INTERIOR)return s;for(var d=0;d<n.getNumInteriorRing();d++){var m=n.getInteriorRingN(d),x=o.locatePointInRing(e,m);if(x===U.BOUNDARY)return U.BOUNDARY;if(x===U.INTERIOR)return U.EXTERIOR}return U.INTERIOR}},{key:"locatePointInRing",value:function(e,n){return n.getEnvelopeInternal().intersects(e)?$n.locateInRing(e,n.getCoordinates()):U.EXTERIOR}},{key:"containsPointInPolygon",value:function(e,n){return U.EXTERIOR!==o.locatePointInPolygon(e,n)}},{key:"locateInGeometry",value:function(e,n){if(n instanceof rn)return o.locatePointInPolygon(e,n);if(n instanceof ct)for(var r=new du(n);r.hasNext();){var s=r.next();if(s!==n){var d=o.locateInGeometry(e,s);if(d!==U.EXTERIOR)return d}}return U.EXTERIOR}},{key:"isContained",value:function(e,n){return U.EXTERIOR!==o.locate(e,n)}},{key:"locate",value:function(e,n){return n.isEmpty()?U.EXTERIOR:n.getEnvelopeInternal().intersects(e)?o.locateInGeometry(e,n):U.EXTERIOR}}]),o}(),pu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getNextCW",value:function(e){this.getEdges();var n=this._edgeList.indexOf(e),r=n-1;return n===0&&(r=this._edgeList.size()-1),this._edgeList.get(r)}},{key:"propagateSideLabels",value:function(e){for(var n=U.NONE,r=this.iterator();r.hasNext();){var s=r.next().getLabel();s.isArea(e)&&s.getLocation(e,te.LEFT)!==U.NONE&&(n=s.getLocation(e,te.LEFT))}if(n===U.NONE)return null;for(var d=n,m=this.iterator();m.hasNext();){var x=m.next(),C=x.getLabel();if(C.getLocation(e,te.ON)===U.NONE&&C.setLocation(e,te.ON,d),C.isArea(e)){var R=C.getLocation(e,te.LEFT),M=C.getLocation(e,te.RIGHT);if(M!==U.NONE){if(M!==d)throw new Ft("side location conflict",x.getCoordinate());R===U.NONE&&re.shouldNeverReachHere("found single null side (at "+x.getCoordinate()+")"),d=R}else re.isTrue(C.getLocation(e,te.LEFT)===U.NONE,"found single null side"),C.setLocation(e,te.RIGHT,d),C.setLocation(e,te.LEFT,d)}}}},{key:"getCoordinate",value:function(){var e=this.iterator();return e.hasNext()?e.next().getCoordinate():null}},{key:"print",value:function(e){_t.out.println("EdgeEndStar:   "+this.getCoordinate());for(var n=this.iterator();n.hasNext();)n.next().print(e)}},{key:"isAreaLabelsConsistent",value:function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(e){var n=this.getEdges();if(n.size()<=0)return!0;var r=n.size()-1,s=n.get(r).getLabel().getLocation(e,te.LEFT);re.isTrue(s!==U.NONE,"Found unlabelled area edge");for(var d=s,m=this.iterator();m.hasNext();){var x=m.next().getLabel();re.isTrue(x.isArea(e),"Found non-area edge");var C=x.getLocation(e,te.LEFT),R=x.getLocation(e,te.RIGHT);if(C===R||R!==d)return!1;d=C}return!0}},{key:"findIndex",value:function(e){this.iterator();for(var n=0;n<this._edgeList.size();n++)if(this._edgeList.get(n)===e)return n;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new Ee(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(e,n,r){return this._ptInAreaLocation[e]===U.NONE&&(this._ptInAreaLocation[e]=gu.locate(n,r[e].getGeometry())),this._ptInAreaLocation[e]}},{key:"toString",value:function(){var e=new Ve;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append(`
`);for(var n=this.iterator();n.hasNext();){var r=n.next();e.append(r),e.append(`
`)}return e.toString()}},{key:"computeEdgeEndLabels",value:function(e){for(var n=this.iterator();n.hasNext();)n.next().computeLabel(e)}},{key:"computeLabelling",value:function(e){this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],r=this.iterator();r.hasNext();)for(var s=r.next().getLabel(),d=0;d<2;d++)s.isLine(d)&&s.getLocation(d)===U.BOUNDARY&&(n[d]=!0);for(var m=this.iterator();m.hasNext();)for(var x=m.next(),C=x.getLabel(),R=0;R<2;R++)if(C.isAnyNull(R)){var M=U.NONE;if(n[R])M=U.EXTERIOR;else{var q=x.getCoordinate();M=this.getLocation(R,q,e)}C.setAllLocationsIfNull(R,M)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(e,n){this._edgeMap.put(e,n),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Gi,this._edgeList=null,this._ptInAreaLocation=[U.NONE,U.NONE]}}]),o}(),yu=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var r=null,s=null,d=this._SCANNING_FOR_INCOMING,m=0;m<this._resultAreaEdgeList.size();m++){var x=this._resultAreaEdgeList.get(m),C=x.getSym();if(x.getLabel().isArea())switch(r===null&&x.isInResult()&&(r=x),d){case this._SCANNING_FOR_INCOMING:if(!C.isInResult())continue;s=C,d=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!x.isInResult())continue;s.setNext(x),d=this._SCANNING_FOR_INCOMING}}if(d===this._LINKING_TO_OUTGOING){if(r===null)throw new Ft("no outgoing dirEdge found",this.getCoordinate());re.isTrue(r.isInResult(),"unable to link last incoming dirEdge"),s.setNext(r)}}},{key:"insert",value:function(r){var s=r;this.insertEdgeEnd(s,s)}},{key:"getRightmostEdge",value:function(){var r=this.getEdges(),s=r.size();if(s<1)return null;var d=r.get(0);if(s===1)return d;var m=r.get(s-1),x=d.getQuadrant(),C=m.getQuadrant();return at.isNorthern(x)&&at.isNorthern(C)?d:at.isNorthern(x)||at.isNorthern(C)?d.getDy()!==0?d:m.getDy()!==0?m:(re.shouldNeverReachHere("found two horizontal edges incident on node"),null):m}},{key:"print",value:function(r){_t.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var s=this.iterator();s.hasNext();){var d=s.next();r.print("out "),d.print(r),r.println(),r.print("in "),d.getSym().print(r),r.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Ee;for(var r=this.iterator();r.hasNext();){var s=r.next();(s.isInResult()||s.getSym().isInResult())&&this._resultAreaEdgeList.add(s)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(r){for(var s=this.iterator();s.hasNext();){var d=s.next().getLabel();d.setAllLocationsIfNull(0,r.getLocation(0)),d.setAllLocationsIfNull(1,r.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var r=null,s=null,d=this._edgeList.size()-1;d>=0;d--){var m=this._edgeList.get(d),x=m.getSym();s===null&&(s=x),r!==null&&x.setNext(r),r=m}s.setNext(r)}},{key:"computeDepths",value:function(){if(arguments.length===1){var r=arguments[0],s=this.findIndex(r),d=r.getDepth(te.LEFT),m=r.getDepth(te.RIGHT),x=this.computeDepths(s+1,this._edgeList.size(),d),C=this.computeDepths(0,s,x);if(C!==m)throw new Ft("depth mismatch at "+r.getCoordinate())}else if(arguments.length===3){for(var R=arguments[0],M=arguments[1],q=arguments[2],K=q,ae=R;ae<M;ae++){var se=this._edgeList.get(ae);se.setEdgeDepths(te.RIGHT,K),K=se.getDepth(te.LEFT)}return K}}},{key:"mergeSymLabels",value:function(){for(var r=this.iterator();r.hasNext();){var s=r.next();s.getLabel().merge(s.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(r){for(var s=null,d=null,m=this._SCANNING_FOR_INCOMING,x=this._resultAreaEdgeList.size()-1;x>=0;x--){var C=this._resultAreaEdgeList.get(x),R=C.getSym();switch(s===null&&C.getEdgeRing()===r&&(s=C),m){case this._SCANNING_FOR_INCOMING:if(R.getEdgeRing()!==r)continue;d=R,m=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(C.getEdgeRing()!==r)continue;d.setNextMin(C),m=this._SCANNING_FOR_INCOMING}}m===this._LINKING_TO_OUTGOING&&(re.isTrue(s!==null,"found null for first outgoing dirEdge"),re.isTrue(s.getEdgeRing()===r,"unable to link last incoming dirEdge"),d.setNextMin(s))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var r=0,s=this.iterator();s.hasNext();){var d=s.next();d.isInResult()&&r++}return r}if(arguments.length===1){for(var m=arguments[0],x=0,C=this.iterator();C.hasNext();){var R=C.next();R.getEdgeRing()===m&&x++}return x}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var r=U.NONE,s=this.iterator();s.hasNext();){var d=s.next(),m=d.getSym();if(!d.isLineEdge()){if(d.isInResult()){r=U.INTERIOR;break}if(m.isInResult()){r=U.EXTERIOR;break}}}if(r===U.NONE)return null;for(var x=r,C=this.iterator();C.hasNext();){var R=C.next(),M=R.getSym();R.isLineEdge()?R.getEdge().setCovered(x===U.INTERIOR):(R.isInResult()&&(x=U.EXTERIOR),M.isInResult()&&(x=U.INTERIOR))}}},{key:"computeLabelling",value:function(r){A(I(n.prototype),"computeLabelling",this).call(this,r),this._label=new Et(U.NONE);for(var s=this.iterator();s.hasNext();)for(var d=s.next().getEdge().getLabel(),m=0;m<2;m++){var x=d.getLocation(m);x!==U.INTERIOR&&x!==U.BOUNDARY||this._label.setLocation(m,U.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}]),n}(pu),mu=function(o){b(n,o);var e=k(n);function n(){return l(this,n),e.call(this)}return p(n,[{key:"createNode",value:function(r){return new ln(r,new yu)}}]),n}(ls),Es=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"compareTo",value:function(e){var n=e;return o.compareOriented(this._pts,this._orientation,n._pts,n._orientation)}},{key:"interfaces_",get:function(){return[P]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=o.orientation(e)}},{key:"orientation",value:function(e){return Xe.increasingDirection(e)===1}},{key:"compareOriented",value:function(e,n,r,s){for(var d=n?1:-1,m=s?1:-1,x=n?e.length:-1,C=s?r.length:-1,R=n?0:e.length-1,M=s?0:r.length-1;;){var q=e[R].compareTo(r[M]);if(q!==0)return q;var K=(R+=d)===x,ae=(M+=m)===C;if(K&&!ae)return-1;if(!K&&ae)return 1;if(K&&ae)return 0}}}]),o}(),vu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"print",value:function(e){e.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var r=this._edges.get(n);n>0&&e.print(","),e.print("(");for(var s=r.getCoordinates(),d=0;d<s.length;d++)d>0&&e.print(","),e.print(s[d].x+" "+s[d].y);e.println(")")}e.print(")  ")}},{key:"addAll",value:function(e){for(var n=e.iterator();n.hasNext();)this.add(n.next())}},{key:"findEdgeIndex",value:function(e){for(var n=0;n<this._edges.size();n++)if(this._edges.get(n).equals(e))return n;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(e){return this._edges.get(e)}},{key:"findEqualEdge",value:function(e){var n=new Es(e.getCoordinates());return this._ocaMap.get(n)}},{key:"add",value:function(e){this._edges.add(e);var n=new Es(e.getCoordinates());this._ocaMap.put(n,e)}}],[{key:"constructor_",value:function(){this._edges=new Ee,this._ocaMap=new Gi}}]),o}(),bs=function(){function o(){l(this,o)}return p(o,[{key:"processIntersections",value:function(e,n,r,s){}},{key:"isDone",value:function(){}}]),o}(),_u=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"isTrivialIntersection",value:function(e,n,r,s){if(e===r&&this._li.getIntersectionNum()===1){if(o.isAdjacentSegments(n,s))return!0;if(e.isClosed()){var d=e.size()-1;if(n===0&&s===d||s===0&&n===d)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(e,n,r,s){if(e===r&&n===s)return null;this.numTests++;var d=e.getCoordinates()[n],m=e.getCoordinates()[n+1],x=r.getCoordinates()[s],C=r.getCoordinates()[s+1];this._li.computeIntersection(d,m,x,C),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,n,r,s)||(this._hasIntersection=!0,e.addIntersections(this._li,n,0),r.addIntersections(this._li,s,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[bs]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e}},{key:"isAdjacentSegments",value:function(e,n){return Math.abs(e-n)===1}}]),o}(),xu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)}},{key:"compareTo",value:function(e){var n=e;return this.compare(n.segmentIndex,n.dist)}},{key:"isEndPoint",value:function(e){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===e}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(e,n){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<n?-1:this.dist>n?1:0}},{key:"interfaces_",get:function(){return[P]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],n=arguments[1],r=arguments[2];this.coord=new F(e),this.segmentIndex=n,this.dist=r}}]),o}(),Eu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"print",value:function(e){e.println("Intersections:");for(var n=this.iterator();n.hasNext();)n.next().print(e)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(e){this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var s=n.next(),d=this.createSplitEdge(r,s);e.add(d),r=s}}},{key:"addEndpoints",value:function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)}},{key:"createSplitEdge",value:function(e,n){var r=n.segmentIndex-e.segmentIndex+2,s=this.edge.pts[n.segmentIndex],d=n.dist>0||!n.coord.equals2D(s);d||r--;var m=new Array(r).fill(null),x=0;m[x++]=new F(e.coord);for(var C=e.segmentIndex+1;C<=n.segmentIndex;C++)m[x++]=this.edge.pts[C];return d&&(m[x]=n.coord),new Is(m,new Et(this.edge._label))}},{key:"add",value:function(e,n,r){var s=new xu(e,n,r),d=this._nodeMap.get(s);return d!==null?d:(this._nodeMap.put(s,s),s)}},{key:"isIntersection",value:function(e){for(var n=this.iterator();n.hasNext();)if(n.next().coord.equals(e))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Gi,this.edge=null;var e=arguments[0];this.edge=e}}]),o}(),bu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(o.isTrue(this._matrix[U.INTERIOR][U.INTERIOR])||o.isTrue(this._matrix[U.INTERIOR][U.BOUNDARY])||o.isTrue(this._matrix[U.BOUNDARY][U.INTERIOR])||o.isTrue(this._matrix[U.BOUNDARY][U.BOUNDARY]))&&this._matrix[U.EXTERIOR][U.INTERIOR]===he.FALSE&&this._matrix[U.EXTERIOR][U.BOUNDARY]===he.FALSE}},{key:"isCoveredBy",value:function(){return(o.isTrue(this._matrix[U.INTERIOR][U.INTERIOR])||o.isTrue(this._matrix[U.INTERIOR][U.BOUNDARY])||o.isTrue(this._matrix[U.BOUNDARY][U.INTERIOR])||o.isTrue(this._matrix[U.BOUNDARY][U.BOUNDARY]))&&this._matrix[U.INTERIOR][U.EXTERIOR]===he.FALSE&&this._matrix[U.BOUNDARY][U.EXTERIOR]===he.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var e=arguments[0],n=0;n<e.length;n++){var r=Math.trunc(n/3),s=n%3;this._matrix[r][s]=he.toDimensionValue(e.charAt(n))}else if(arguments.length===3){var d=arguments[0],m=arguments[1],x=arguments[2];this._matrix[d][m]=x}}},{key:"isContains",value:function(){return o.isTrue(this._matrix[U.INTERIOR][U.INTERIOR])&&this._matrix[U.EXTERIOR][U.INTERIOR]===he.FALSE&&this._matrix[U.EXTERIOR][U.BOUNDARY]===he.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var e=arguments[0],n=0;n<e.length;n++){var r=Math.trunc(n/3),s=n%3;this.setAtLeast(r,s,he.toDimensionValue(e.charAt(n)))}else if(arguments.length===3){var d=arguments[0],m=arguments[1],x=arguments[2];this._matrix[d][m]<x&&(this._matrix[d][m]=x)}}},{key:"setAtLeastIfValid",value:function(e,n,r){e>=0&&n>=0&&this.setAtLeast(e,n,r)}},{key:"isWithin",value:function(){return o.isTrue(this._matrix[U.INTERIOR][U.INTERIOR])&&this._matrix[U.INTERIOR][U.EXTERIOR]===he.FALSE&&this._matrix[U.BOUNDARY][U.EXTERIOR]===he.FALSE}},{key:"isTouches",value:function(e,n){return e>n?this.isTouches(n,e):(e===he.A&&n===he.A||e===he.L&&n===he.L||e===he.L&&n===he.A||e===he.P&&n===he.A||e===he.P&&n===he.L)&&this._matrix[U.INTERIOR][U.INTERIOR]===he.FALSE&&(o.isTrue(this._matrix[U.INTERIOR][U.BOUNDARY])||o.isTrue(this._matrix[U.BOUNDARY][U.INTERIOR])||o.isTrue(this._matrix[U.BOUNDARY][U.BOUNDARY]))}},{key:"isOverlaps",value:function(e,n){return e===he.P&&n===he.P||e===he.A&&n===he.A?o.isTrue(this._matrix[U.INTERIOR][U.INTERIOR])&&o.isTrue(this._matrix[U.INTERIOR][U.EXTERIOR])&&o.isTrue(this._matrix[U.EXTERIOR][U.INTERIOR]):e===he.L&&n===he.L&&this._matrix[U.INTERIOR][U.INTERIOR]===1&&o.isTrue(this._matrix[U.INTERIOR][U.EXTERIOR])&&o.isTrue(this._matrix[U.EXTERIOR][U.INTERIOR])}},{key:"isEquals",value:function(e,n){return e===n&&o.isTrue(this._matrix[U.INTERIOR][U.INTERIOR])&&this._matrix[U.INTERIOR][U.EXTERIOR]===he.FALSE&&this._matrix[U.BOUNDARY][U.EXTERIOR]===he.FALSE&&this._matrix[U.EXTERIOR][U.INTERIOR]===he.FALSE&&this._matrix[U.EXTERIOR][U.BOUNDARY]===he.FALSE}},{key:"toString",value:function(){for(var e=new an("123456789"),n=0;n<3;n++)for(var r=0;r<3;r++)e.setCharAt(3*n+r,he.toDimensionSymbol(this._matrix[n][r]));return e.toString()}},{key:"setAll",value:function(e){for(var n=0;n<3;n++)for(var r=0;r<3;r++)this._matrix[n][r]=e}},{key:"get",value:function(e,n){return this._matrix[e][n]}},{key:"transpose",value:function(){var e=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=e,e=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=e,e=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=e,this}},{key:"matches",value:function(e){if(e.length!==9)throw new T("Should be length 9: "+e);for(var n=0;n<3;n++)for(var r=0;r<3;r++)if(!o.matches(this._matrix[n][r],e.charAt(3*n+r)))return!1;return!0}},{key:"add",value:function(e){for(var n=0;n<3;n++)for(var r=0;r<3;r++)this.setAtLeast(n,r,e.get(n,r))}},{key:"isDisjoint",value:function(){return this._matrix[U.INTERIOR][U.INTERIOR]===he.FALSE&&this._matrix[U.INTERIOR][U.BOUNDARY]===he.FALSE&&this._matrix[U.BOUNDARY][U.INTERIOR]===he.FALSE&&this._matrix[U.BOUNDARY][U.BOUNDARY]===he.FALSE}},{key:"isCrosses",value:function(e,n){return e===he.P&&n===he.L||e===he.P&&n===he.A||e===he.L&&n===he.A?o.isTrue(this._matrix[U.INTERIOR][U.INTERIOR])&&o.isTrue(this._matrix[U.INTERIOR][U.EXTERIOR]):e===he.L&&n===he.P||e===he.A&&n===he.P||e===he.A&&n===he.L?o.isTrue(this._matrix[U.INTERIOR][U.INTERIOR])&&o.isTrue(this._matrix[U.EXTERIOR][U.INTERIOR]):e===he.L&&n===he.L&&this._matrix[U.INTERIOR][U.INTERIOR]===0}},{key:"interfaces_",get:function(){return[D]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(he.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var e=arguments[0];o.constructor_.call(this),this.set(e)}else if(arguments[0]instanceof o){var n=arguments[0];o.constructor_.call(this),this._matrix[U.INTERIOR][U.INTERIOR]=n._matrix[U.INTERIOR][U.INTERIOR],this._matrix[U.INTERIOR][U.BOUNDARY]=n._matrix[U.INTERIOR][U.BOUNDARY],this._matrix[U.INTERIOR][U.EXTERIOR]=n._matrix[U.INTERIOR][U.EXTERIOR],this._matrix[U.BOUNDARY][U.INTERIOR]=n._matrix[U.BOUNDARY][U.INTERIOR],this._matrix[U.BOUNDARY][U.BOUNDARY]=n._matrix[U.BOUNDARY][U.BOUNDARY],this._matrix[U.BOUNDARY][U.EXTERIOR]=n._matrix[U.BOUNDARY][U.EXTERIOR],this._matrix[U.EXTERIOR][U.INTERIOR]=n._matrix[U.EXTERIOR][U.INTERIOR],this._matrix[U.EXTERIOR][U.BOUNDARY]=n._matrix[U.EXTERIOR][U.BOUNDARY],this._matrix[U.EXTERIOR][U.EXTERIOR]=n._matrix[U.EXTERIOR][U.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var e=arguments[0],n=arguments[1];return n===he.SYM_DONTCARE||n===he.SYM_TRUE&&(e>=0||e===he.TRUE)||n===he.SYM_FALSE&&e===he.FALSE||n===he.SYM_P&&e===he.P||n===he.SYM_L&&e===he.L||n===he.SYM_A&&e===he.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var r=arguments[0],s=arguments[1],d=new o(r);return d.matches(s)}}},{key:"isTrue",value:function(e){return e>=0||e===he.TRUE}}]),o}(),Su=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(e){return e===null||e.length===0?null:(this.ensureCapacity(this._size+e.length),_t.arraycopy(e,0,this._data,this._size,e.length),void(this._size+=e.length))}},{key:"ensureCapacity",value:function(e){if(e<=this._data.length)return null;var n=Math.max(e,2*this._data.length);this._data=Kt.copyOf(this._data,n)}},{key:"toArray",value:function(){var e=new Array(this._size).fill(null);return _t.arraycopy(this._data,0,e,0,this._size),e}},{key:"add",value:function(e){this.ensureCapacity(this._size+1),this._data[this._size]=e,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)o.constructor_.call(this,10);else if(arguments.length===1){var e=arguments[0];this._data=new Array(e).fill(null)}}}]),o}(),Iu=function(){function o(){l(this,o)}return p(o,[{key:"getChainStartIndices",value:function(e){var n=0,r=new Su(Math.trunc(e.length/2));r.add(n);do{var s=this.findChainEnd(e,n);r.add(s),n=s}while(n<e.length-1);return r.toArray()}},{key:"findChainEnd",value:function(e,n){for(var r=at.quadrant(e[n],e[n+1]),s=n+1;s<e.length&&at.quadrant(e[s-1],e[s])===r;)s++;return s-1}},{key:"OLDgetChainStartIndices",value:function(e){var n=0,r=new Ee;r.add(n);do{var s=this.findChainEnd(e,n);r.add(s),n=s}while(n<e.length-1);return o.toIntArray(r)}}],[{key:"toIntArray",value:function(e){for(var n=new Array(e.size()).fill(null),r=0;r<n.length;r++)n[r]=e.get(r).intValue();return n}}]),o}(),wu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(e){var n=this.pts[this.startIndex[e]].x,r=this.pts[this.startIndex[e+1]].x;return n>r?n:r}},{key:"getMinX",value:function(e){var n=this.pts[this.startIndex[e]].x,r=this.pts[this.startIndex[e+1]].x;return n<r?n:r}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var e=arguments[0],n=arguments[1],r=arguments[2],s=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],n,n.startIndex[r],n.startIndex[r+1],s)}else if(arguments.length===6){var d=arguments[0],m=arguments[1],x=arguments[2],C=arguments[3],R=arguments[4],M=arguments[5];if(m-d==1&&R-C==1)return M.addIntersections(this.e,d,x.e,C),null;if(!this.overlaps(d,m,x,C,R))return null;var q=Math.trunc((d+m)/2),K=Math.trunc((C+R)/2);d<q&&(C<K&&this.computeIntersectsForChain(d,q,x,C,K,M),K<R&&this.computeIntersectsForChain(d,q,x,K,R,M)),q<m&&(C<K&&this.computeIntersectsForChain(q,m,x,C,K,M),K<R&&this.computeIntersectsForChain(q,m,x,K,R,M))}}},{key:"overlaps",value:function(e,n,r,s,d){return G.intersects(this.pts[e],this.pts[n],r.pts[s],r.pts[d])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(e,n){for(var r=0;r<this.startIndex.length-1;r++)for(var s=0;s<e.startIndex.length-1;s++)this.computeIntersectsForChain(r,e,s,n)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var n=new Iu;this.startIndex=n.getChainStartIndices(this.pts)}}]),o}(),Ss=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"getDepth",value:function(e,n){return this._depth[e][n]}},{key:"setDepth",value:function(e,n,r){this._depth[e][n]=r}},{key:"isNull",value:function(){if(arguments.length===0){for(var e=0;e<2;e++)for(var n=0;n<3;n++)if(this._depth[e][n]!==o.NULL_VALUE)return!1;return!0}if(arguments.length===1){var r=arguments[0];return this._depth[r][1]===o.NULL_VALUE}if(arguments.length===2){var s=arguments[0],d=arguments[1];return this._depth[s][d]===o.NULL_VALUE}}},{key:"normalize",value:function(){for(var e=0;e<2;e++)if(!this.isNull(e)){var n=this._depth[e][1];this._depth[e][2]<n&&(n=this._depth[e][2]),n<0&&(n=0);for(var r=1;r<3;r++){var s=0;this._depth[e][r]>n&&(s=1),this._depth[e][r]=s}}}},{key:"getDelta",value:function(e){return this._depth[e][te.RIGHT]-this._depth[e][te.LEFT]}},{key:"getLocation",value:function(e,n){return this._depth[e][n]<=0?U.EXTERIOR:U.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var e=arguments[0],n=0;n<2;n++)for(var r=1;r<3;r++){var s=e.getLocation(n,r);s!==U.EXTERIOR&&s!==U.INTERIOR||(this.isNull(n,r)?this._depth[n][r]=o.depthAtLocation(s):this._depth[n][r]+=o.depthAtLocation(s))}else if(arguments.length===3){var d=arguments[0],m=arguments[1],x=arguments[2];x===U.INTERIOR&&this._depth[d][m]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var e=0;e<2;e++)for(var n=0;n<3;n++)this._depth[e][n]=o.NULL_VALUE}},{key:"depthAtLocation",value:function(e){return e===U.EXTERIOR?0:e===U.INTERIOR?1:o.NULL_VALUE}}]),o}();Ss.NULL_VALUE=-1;var Is=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var r=new Array(2).fill(null);return r[0]=this.pts[0],r[1]=this.pts[1],new n(r,Et.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(r){this._isIsolated=r}},{key:"setName",value:function(r){this._name=r}},{key:"equals",value:function(r){if(!(r instanceof n))return!1;var s=r;if(this.pts.length!==s.pts.length)return!1;for(var d=!0,m=!0,x=this.pts.length,C=0;C<this.pts.length;C++)if(this.pts[C].equals2D(s.pts[C])||(d=!1),this.pts[C].equals2D(s.pts[--x])||(m=!1),!d&&!m)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var r=arguments[0];return this.pts[r]}}},{key:"print",value:function(r){r.print("edge "+this._name+": "),r.print("LINESTRING (");for(var s=0;s<this.pts.length;s++)s>0&&r.print(","),r.print(this.pts[s].x+" "+this.pts[s].y);r.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(r){n.updateIM(this._label,r)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(r){r.print("edge "+this._name+": ");for(var s=this.pts.length-1;s>=0;s--)r.print(this.pts[s]+" ");r.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new wu(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new G;for(var r=0;r<this.pts.length;r++)this._env.expandToInclude(this.pts[r])}return this._env}},{key:"addIntersection",value:function(r,s,d,m){var x=new F(r.getIntersection(m)),C=s,R=r.getEdgeDistance(d,m),M=C+1;if(M<this.pts.length){var q=this.pts[M];x.equals2D(q)&&(C=M,R=0)}this.eiList.add(x,C,R)}},{key:"toString",value:function(){var r=new an;r.append("edge "+this._name+": "),r.append("LINESTRING (");for(var s=0;s<this.pts.length;s++)s>0&&r.append(","),r.append(this.pts[s].x+" "+this.pts[s].y);return r.append(")  "+this._label+" "+this._depthDelta),r.toString()}},{key:"isPointwiseEqual",value:function(r){if(this.pts.length!==r.pts.length)return!1;for(var s=0;s<this.pts.length;s++)if(!this.pts[s].equals2D(r.pts[s]))return!1;return!0}},{key:"setDepthDelta",value:function(r){this._depthDelta=r}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(r,s,d){for(var m=0;m<r.getIntersectionNum();m++)this.addIntersection(r,s,d,m)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new Eu(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Ss,this._depthDelta=0,arguments.length===1){var r=arguments[0];n.constructor_.call(this,r,null)}else if(arguments.length===2){var s=arguments[0],d=arguments[1];this.pts=s,this._label=d}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof bu&&arguments[0]instanceof Et))return A(I(n),"updateIM",this).apply(this,arguments);var r=arguments[0],s=arguments[1];s.setAtLeastIfValid(r.getLocation(0,te.ON),r.getLocation(1,te.ON),1),r.isArea()&&(s.setAtLeastIfValid(r.getLocation(0,te.LEFT),r.getLocation(1,te.LEFT),2),s.setAtLeastIfValid(r.getLocation(0,te.RIGHT),r.getLocation(1,te.RIGHT),2))}}]),n}(rs),ws=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"setWorkingPrecisionModel",value:function(e){this._workingPrecisionModel=e}},{key:"insertUniqueEdge",value:function(e){var n=this._edgeList.findEqualEdge(e);if(n!==null){var r=n.getLabel(),s=e.getLabel();n.isPointwiseEqual(e)||(s=new Et(e.getLabel())).flip(),r.merge(s);var d=o.depthDelta(s),m=n.getDepthDelta()+d;n.setDepthDelta(m)}else this._edgeList.add(e),e.setDepthDelta(o.depthDelta(e.getLabel()))}},{key:"buildSubgraphs",value:function(e,n){for(var r=new Ee,s=e.iterator();s.hasNext();){var d=s.next(),m=d.getRightmostCoordinate(),x=new vs(r).getDepth(m);d.computeDepth(x),d.findResultEdges(),r.add(d),n.add(d.getDirectedEdges(),d.getNodes())}}},{key:"createSubgraphs",value:function(e){for(var n=new Ee,r=e.getNodes().iterator();r.hasNext();){var s=r.next();if(!s.isVisited()){var d=new To;d.create(s),n.add(d)}}return di.sort(n,di.reverseOrder()),n}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(e){if(this._workingNoder!==null)return this._workingNoder;var n=new Xn,r=new ei;return r.setPrecisionModel(e),n.setSegmentIntersector(new _u(r)),n}},{key:"buffer",value:function(e,n){var r=this._workingPrecisionModel;r===null&&(r=e.getPrecisionModel()),this._geomFact=e.getFactory();var s=new lu(r,this._bufParams),d=new cu(e,n,s).getCurves();if(d.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(d,r),this._graph=new hs(new mu),this._graph.addEdges(this._edgeList.getEdges());var m=this.createSubgraphs(this._graph),x=new Wo(this._geomFact);this.buildSubgraphs(m,x);var C=x.getPolygons();return C.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(C)}},{key:"computeNodedEdges",value:function(e,n){var r=this.getNoder(n);r.computeNodes(e);for(var s=r.getNodedSubstrings().iterator();s.hasNext();){var d=s.next(),m=d.getCoordinates();if(m.length!==2||!m[0].equals2D(m[1])){var x=d.getData(),C=new Is(d.getCoordinates(),new Et(x));this.insertUniqueEdge(C)}}}},{key:"setNoder",value:function(e){this._workingNoder=e}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new vu;var e=arguments[0];this._bufParams=e}},{key:"depthDelta",value:function(e){var n=e.getLocation(0,te.LEFT),r=e.getLocation(0,te.RIGHT);return n===U.INTERIOR&&r===U.EXTERIOR?1:n===U.EXTERIOR&&r===U.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(e){for(var n=new ci,r=new Ee;e.hasNext();){var s=e.next(),d=n.createLineString(s.getCoordinates());r.add(d)}return n.buildGeometry(r)}}]),o}(),ku=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"rescale",value:function(){if(ge(arguments[0],H))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();this.rescale(r.getCoordinates())}else if(arguments[0]instanceof Array){for(var s=arguments[0],d=0;d<s.length;d++)s[d].x=s[d].x/this._scaleFactor+this._offsetX,s[d].y=s[d].y/this._scaleFactor+this._offsetY;s.length===2&&s[0].equals2D(s[1])&&_t.out.println(s)}}},{key:"scale",value:function(){if(ge(arguments[0],H)){for(var e=arguments[0],n=new Ee(e.size()),r=e.iterator();r.hasNext();){var s=r.next();n.add(new ti(this.scale(s.getCoordinates()),s.getData()))}return n}if(arguments[0]instanceof Array){for(var d=arguments[0],m=new Array(d.length).fill(null),x=0;x<d.length;x++)m[x]=new F(Math.round((d[x].x-this._offsetX)*this._scaleFactor),Math.round((d[x].y-this._offsetY)*this._scaleFactor),d[x].getZ());var C=Xe.removeRepeatedPoints(m);return C}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e}},{key:"computeNodes",value:function(e){var n=e;this._isScaled&&(n=this.scale(e)),this._noder.computeNodes(n)}},{key:"interfaces_",get:function(){return[jn]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var e=arguments[0],n=arguments[1];o.constructor_.call(this,e,n,0,0)}else if(arguments.length===4){var r=arguments[0],s=arguments[1];this._noder=r,this._scaleFactor=s,this._isScaled=!this.isIntegerPrecision()}}}]),o}(),ks=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next(),r=n.getCoordinates();this.checkEndPtVertexIntersections(r[0],this._segStrings),this.checkEndPtVertexIntersections(r[r.length-1],this._segStrings)}else if(arguments.length===2){for(var s=arguments[0],d=arguments[1],m=d.iterator();m.hasNext();)for(var x=m.next(),C=x.getCoordinates(),R=1;R<C.length-1;R++)if(C[R].equals(s))throw new le("found endpt/interior pt intersection at index "+R+" :pt "+s)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();)for(var n=e.next(),r=this._segStrings.iterator();r.hasNext();){var s=r.next();this.checkInteriorIntersections(n,s)}else if(arguments.length===2)for(var d=arguments[0],m=arguments[1],x=d.getCoordinates(),C=m.getCoordinates(),R=0;R<x.length-1;R++)for(var M=0;M<C.length-1;M++)this.checkInteriorIntersections(d,R,m,M);else if(arguments.length===4){var q=arguments[0],K=arguments[1],ae=arguments[2],se=arguments[3];if(q===ae&&K===se)return null;var ye=q.getCoordinates()[K],_e=q.getCoordinates()[K+1],ke=ae.getCoordinates()[se],Ue=ae.getCoordinates()[se+1];if(this._li.computeIntersection(ye,_e,ke,Ue),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,ye,_e)||this.hasInteriorIntersection(this._li,ke,Ue)))throw new le("found non-noded intersection at "+ye+"-"+_e+" and "+ke+"-"+Ue)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next();this.checkCollapses(n)}else if(arguments.length===1)for(var r=arguments[0],s=r.getCoordinates(),d=0;d<s.length-2;d++)this.checkCollapse(s[d],s[d+1],s[d+2])}},{key:"hasInteriorIntersection",value:function(e,n,r){for(var s=0;s<e.getIntersectionNum();s++){var d=e.getIntersection(s);if(!d.equals(n)&&!d.equals(r))return!0}return!1}},{key:"checkCollapse",value:function(e,n,r){if(e.equals(r))throw new le("found non-noded collapse at "+o.fact.createLineString([e,n,r]))}}],[{key:"constructor_",value:function(){this._li=new ei,this._segStrings=null;var e=arguments[0];this._segStrings=e}}]),o}();ks.fact=new ci;var Wn=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"intersectsScaled",value:function(e,n){var r=Math.min(e.x,n.x),s=Math.max(e.x,n.x),d=Math.min(e.y,n.y),m=Math.max(e.y,n.y),x=this._maxx<r||this._minx>s||this._maxy<d||this._miny>m;if(x)return!1;var C=this.intersectsToleranceSquare(e,n);return re.isTrue(!(x&&C),"Found bad envelope test"),C}},{key:"initCorners",value:function(e){var n=.5;this._minx=e.x-n,this._maxx=e.x+n,this._miny=e.y-n,this._maxy=e.y+n,this._corner[0]=new F(this._maxx,this._maxy),this._corner[1]=new F(this._minx,this._maxy),this._corner[2]=new F(this._minx,this._miny),this._corner[3]=new F(this._maxx,this._miny)}},{key:"intersects",value:function(e,n){return this._scaleFactor===1?this.intersectsScaled(e,n):(this.copyScaled(e,this._p0Scaled),this.copyScaled(n,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(e){return Math.round(e*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(e,n){n.x=this.scale(e.x),n.y=this.scale(e.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var e=o.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new G(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(e,n){return this._li.computeIntersection(e,n,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,n,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,n,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,n,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(e,n){var r=!1,s=!1;return this._li.computeIntersection(e,n,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(e,n,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(e,n,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(s=!0),this._li.computeIntersection(e,n,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!r||!s)||!!e.equals(this._pt)||!!n.equals(this._pt))))}},{key:"addSnappedNode",value:function(e,n){var r=e.getCoordinate(n),s=e.getCoordinate(n+1);return!!this.intersects(r,s)&&(e.addIntersection(this.getCoordinate(),n),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],n=arguments[1],r=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=n,this._li=r,n<=0)throw new T("Scale factor must be non-zero");n!==1&&(this._pt=new F(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new F,this._p1Scaled=new F),this.initCorners(this._pt)}}]),o}();Wn.SAFE_ENV_EXPANSION_FACTOR=.75;var Cu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var e=arguments[0],n=arguments[1];e.getLineSegment(n,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new ft}}]),o}(),Cs=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"snap",value:function(){if(arguments.length===1){var e=arguments[0];return this.snap(e,null,-1)}if(arguments.length===3){var n=arguments[0],r=arguments[1],s=arguments[2],d=n.getSafeEnvelope(),m=new Ns(n,r,s);return this._index.query(d,new(function(){function x(){l(this,x)}return p(x,[{key:"interfaces_",get:function(){return[fs]}},{key:"visitItem",value:function(C){C.select(d,m)}}]),x}())),m.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var e=arguments[0];this._index=e}}]),o}(),Ns=function(o){b(n,o);var e=k(n);function n(){var r;return l(this,n),r=e.call(this),n.constructor_.apply(_(r),arguments),r}return p(n,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof gs))return A(I(n.prototype),"select",this).apply(this,arguments);var r=arguments[0],s=arguments[1],d=r.getContext();if(this._parentEdge===d&&(s===this._hotPixelVertexIndex||s+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(d,s)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var r=arguments[0],s=arguments[1],d=arguments[2];this._hotPixel=r,this._parentEdge=s,this._hotPixelVertexIndex=d}}]),n}(Cu);Cs.HotPixelSnapAction=Ns;var Nu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"processIntersections",value:function(e,n,r,s){if(e===r&&n===s)return null;var d=e.getCoordinates()[n],m=e.getCoordinates()[n+1],x=r.getCoordinates()[s],C=r.getCoordinates()[s+1];if(this._li.computeIntersection(d,m,x,C),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var R=0;R<this._li.getIntersectionNum();R++)this._interiorIntersections.add(this._li.getIntersection(R));e.addIntersections(this._li,n,0),r.addIntersections(this._li,s,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[bs]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new Ee}}]),o}(),Lu=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"checkCorrectness",value:function(e){var n=ti.getNodedSubstrings(e),r=new ks(n);try{r.checkValid()}catch(s){if(!(s instanceof w))throw s;s.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return ti.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(e,n){var r=this.findInteriorIntersections(e,n);this.computeIntersectionSnaps(r),this.computeVertexSnaps(e)}},{key:"findInteriorIntersections",value:function(e,n){var r=new Nu(n);return this._noder.setSegmentIntersector(r),this._noder.computeNodes(e),r.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(ge(arguments[0],H))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();this.computeVertexSnaps(r)}else if(arguments[0]instanceof ti)for(var s=arguments[0],d=s.getCoordinates(),m=0;m<d.length;m++){var x=new Wn(d[m],this._scaleFactor,this._li),C=this._pointSnapper.snap(x,s,m);C&&s.addIntersection(d[m],m)}}},{key:"computeNodes",value:function(e){this._nodedSegStrings=e,this._noder=new Xn,this._pointSnapper=new Cs(this._noder.getIndex()),this.snapRound(e,this._li)}},{key:"computeIntersectionSnaps",value:function(e){for(var n=e.iterator();n.hasNext();){var r=n.next(),s=new Wn(r,this._scaleFactor,this._li);this._pointSnapper.snap(s)}}},{key:"interfaces_",get:function(){return[jn]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new ei,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()}}]),o}(),yi=function(){function o(){l(this,o),o.constructor_.apply(this,arguments)}return p(o,[{key:"bufferFixedPrecision",value:function(e){var n=new ku(new Lu(new Ct(1)),e.getScale()),r=new ws(this._bufParams);r.setWorkingPrecisionModel(e),r.setNoder(n),this._resultGeometry=r.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var e=o.MAX_PRECISION_DIGITS;e>=0;e--){try{this.bufferReducedPrecision(e)}catch(d){if(!(d instanceof Ft))throw d;this._saveException=d}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var n=arguments[0],r=o.precisionScaleFactor(this._argGeom,this._distance,n),s=new Ct(r);this.bufferFixedPrecision(s)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===Ct.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(e){this._bufParams.setQuadrantSegments(e)}},{key:"bufferOriginalPrecision",value:function(){try{var e=new ws(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(n){if(!(n instanceof le))throw n;this._saveException=n}}},{key:"getResultGeometry",value:function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(e){this._bufParams.setEndCapStyle(e)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new v,this._resultGeometry=null,this._saveException=null,arguments.length===1){var e=arguments[0];this._argGeom=e}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._argGeom=n,this._bufParams=r}}},{key:"bufferOp",value:function(){if(arguments.length===2){var e=arguments[0],n=arguments[1],r=new o(e),s=r.getResultGeometry(n);return s}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof ie&&typeof arguments[1]=="number"){var d=arguments[0],m=arguments[1],x=arguments[2],C=new o(d);C.setQuadrantSegments(x);var R=C.getResultGeometry(m);return R}if(arguments[2]instanceof v&&arguments[0]instanceof ie&&typeof arguments[1]=="number"){var M=arguments[0],q=arguments[1],K=arguments[2],ae=new o(M,K),se=ae.getResultGeometry(q);return se}}else if(arguments.length===4){var ye=arguments[0],_e=arguments[1],ke=arguments[2],Ue=arguments[3],qe=new o(ye);qe.setQuadrantSegments(ke),qe.setEndCapStyle(Ue);var nt=qe.getResultGeometry(_e);return nt}}},{key:"precisionScaleFactor",value:function(e,n,r){var s=e.getEnvelopeInternal(),d=Pi.max(Math.abs(s.getMaxX()),Math.abs(s.getMaxY()),Math.abs(s.getMinX()),Math.abs(s.getMinY()))+2*(n>0?n:0),m=r-Math.trunc(Math.log(d)/Math.log(10)+1);return Math.pow(10,m)}}]),o}();yi.CAP_ROUND=v.CAP_ROUND,yi.CAP_BUTT=v.CAP_FLAT,yi.CAP_FLAT=v.CAP_FLAT,yi.CAP_SQUARE=v.CAP_SQUARE,yi.MAX_PRECISION_DIGITS=12;var Tu=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Ls=function(){function o(e){l(this,o),this.geometryFactory=e||new ci}return p(o,[{key:"read",value:function(e){var n,r=(n=typeof e=="string"?JSON.parse(e):e).type;if(!St[r])throw new Error("Unknown GeoJSON type: "+n.type);return Tu.indexOf(r)!==-1?St[r].call(this,n.coordinates):r==="GeometryCollection"?St[r].call(this,n.geometries):St[r].call(this,n)}},{key:"write",value:function(e){var n=e.getGeometryType();if(!Ut[n])throw new Error("Geometry is not supported");return Ut[n].call(this,e)}}]),o}(),St={Feature:function(o){var e={};for(var n in o)e[n]=o[n];if(o.geometry){var r=o.geometry.type;if(!St[r])throw new Error("Unknown GeoJSON type: "+o.type);e.geometry=this.read(o.geometry)}return o.bbox&&(e.bbox=St.bbox.call(this,o.bbox)),e},FeatureCollection:function(o){var e={};if(o.features){e.features=[];for(var n=0;n<o.features.length;++n)e.features.push(this.read(o.features[n]))}return o.bbox&&(e.bbox=this.parse.bbox.call(this,o.bbox)),e},coordinates:function(o){for(var e=[],n=0;n<o.length;++n){var r=o[n];e.push(E(F,t(r)))}return e},bbox:function(o){return this.geometryFactory.createLinearRing([new F(o[0],o[1]),new F(o[2],o[1]),new F(o[2],o[3]),new F(o[0],o[3]),new F(o[0],o[1])])},Point:function(o){var e=E(F,t(o));return this.geometryFactory.createPoint(e)},MultiPoint:function(o){for(var e=[],n=0;n<o.length;++n)e.push(St.Point.call(this,o[n]));return this.geometryFactory.createMultiPoint(e)},LineString:function(o){var e=St.coordinates.call(this,o);return this.geometryFactory.createLineString(e)},MultiLineString:function(o){for(var e=[],n=0;n<o.length;++n)e.push(St.LineString.call(this,o[n]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(o){for(var e=St.coordinates.call(this,o[0]),n=this.geometryFactory.createLinearRing(e),r=[],s=1;s<o.length;++s){var d=o[s],m=St.coordinates.call(this,d),x=this.geometryFactory.createLinearRing(m);r.push(x)}return this.geometryFactory.createPolygon(n,r)},MultiPolygon:function(o){for(var e=[],n=0;n<o.length;++n){var r=o[n];e.push(St.Polygon.call(this,r))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(o){for(var e=[],n=0;n<o.length;++n){var r=o[n];e.push(this.read(r))}return this.geometryFactory.createGeometryCollection(e)}},Ut={coordinate:function(o){var e=[o.x,o.y];return o.z&&e.push(o.z),o.m&&e.push(o.m),e},Point:function(o){return{type:"Point",coordinates:Ut.coordinate.call(this,o.getCoordinate())}},MultiPoint:function(o){for(var e=[],n=0;n<o._geometries.length;++n){var r=o._geometries[n],s=Ut.Point.call(this,r);e.push(s.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(o){for(var e=[],n=o.getCoordinates(),r=0;r<n.length;++r){var s=n[r];e.push(Ut.coordinate.call(this,s))}return{type:"LineString",coordinates:e}},MultiLineString:function(o){for(var e=[],n=0;n<o._geometries.length;++n){var r=o._geometries[n],s=Ut.LineString.call(this,r);e.push(s.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(o){var e=[],n=Ut.LineString.call(this,o._shell);e.push(n.coordinates);for(var r=0;r<o._holes.length;++r){var s=o._holes[r],d=Ut.LineString.call(this,s);e.push(d.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(o){for(var e=[],n=0;n<o._geometries.length;++n){var r=o._geometries[n],s=Ut.Polygon.call(this,r);e.push(s.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(o){for(var e=[],n=0;n<o._geometries.length;++n){var r=o._geometries[n],s=r.getGeometryType();e.push(Ut[s].call(this,r))}return{type:"GeometryCollection",geometries:e}}};return{BufferOp:yi,GeoJSONReader:function(){function o(e){l(this,o),this.parser=new Ls(e||new ci)}return p(o,[{key:"read",value:function(e){return this.parser.read(e)}}]),o}(),GeoJSONWriter:function(){function o(){l(this,o),this.parser=new Ls(this.geometryFactory)}return p(o,[{key:"write",value:function(e){return this.parser.write(e)}}]),o}()}})})(Ga);var ll=Ga.exports;const hl=Mr(ll);function Xt(){return new In}function In(){this.reset()}In.prototype={constructor:In,reset:function(){this.s=this.t=0},add:function(c){Fs(fn,c,this.t),Fs(this,fn.s,this.s),this.s?this.t+=fn.t:this.s=fn.t},valueOf:function(){return this.s}};var fn=new In;function Fs(c,f,l){var y=c.s=f+l,p=y-f,b=y-p;c.t=f-b+(l-p)}var Fe=1e-6,Re=Math.PI,Pt=Re/2,zs=Re/4,Mt=Re*2,jt=180/Re,It=Re/180,Ke=Math.abs,cl=Math.atan,Si=Math.atan2,Ye=Math.cos,$e=Math.sin,Ni=Math.sqrt;function qa(c){return c>1?0:c<-1?Re:Math.acos(c)}function si(c){return c>1?Pt:c<-1?-Pt:Math.asin(c)}function Hi(){}function wn(c,f){c&&qs.hasOwnProperty(c.type)&&qs[c.type](c,f)}var Gs={Feature:function(c,f){wn(c.geometry,f)},FeatureCollection:function(c,f){for(var l=c.features,y=-1,p=l.length;++y<p;)wn(l[y].geometry,f)}},qs={Sphere:function(c,f){f.sphere()},Point:function(c,f){c=c.coordinates,f.point(c[0],c[1],c[2])},MultiPoint:function(c,f){for(var l=c.coordinates,y=-1,p=l.length;++y<p;)c=l[y],f.point(c[0],c[1],c[2])},LineString:function(c,f){wr(c.coordinates,f,0)},MultiLineString:function(c,f){for(var l=c.coordinates,y=-1,p=l.length;++y<p;)wr(l[y],f,0)},Polygon:function(c,f){Ys(c.coordinates,f)},MultiPolygon:function(c,f){for(var l=c.coordinates,y=-1,p=l.length;++y<p;)Ys(l[y],f)},GeometryCollection:function(c,f){for(var l=c.geometries,y=-1,p=l.length;++y<p;)wn(l[y],f)}};function wr(c,f,l){var y=-1,p=c.length-l,b;for(f.lineStart();++y<p;)b=c[y],f.point(b[0],b[1],b[2]);f.lineEnd()}function Ys(c,f){var l=-1,y=c.length;for(f.polygonStart();++l<y;)wr(c[l],f,1);f.polygonEnd()}function fl(c,f){c&&Gs.hasOwnProperty(c.type)?Gs[c.type](c,f):wn(c,f)}Xt();Xt();function kr(c){return[Si(c[1],c[0]),si(c[2])]}function Ii(c){var f=c[0],l=c[1],y=Ye(l);return[y*Ye(f),y*$e(f),$e(l)]}function dn(c,f){return c[0]*f[0]+c[1]*f[1]+c[2]*f[2]}function kn(c,f){return[c[1]*f[2]-c[2]*f[1],c[2]*f[0]-c[0]*f[2],c[0]*f[1]-c[1]*f[0]]}function er(c,f){c[0]+=f[0],c[1]+=f[1],c[2]+=f[2]}function gn(c,f){return[c[0]*f,c[1]*f,c[2]*f]}function Cr(c){var f=Ni(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);c[0]/=f,c[1]/=f,c[2]/=f}Xt();function Ya(c,f){function l(y,p){return y=c(y,p),f(y[0],y[1])}return c.invert&&f.invert&&(l.invert=function(y,p){return y=f.invert(y,p),y&&c.invert(y[0],y[1])}),l}function Nr(c,f){return[c>Re?c-Mt:c<-Re?c+Mt:c,f]}Nr.invert=Nr;function dl(c,f,l){return(c%=Mt)?f||l?Ya(Hs(c),Vs(f,l)):Hs(c):f||l?Vs(f,l):Nr}function $s(c){return function(f,l){return f+=c,[f>Re?f-Mt:f<-Re?f+Mt:f,l]}}function Hs(c){var f=$s(c);return f.invert=$s(-c),f}function Vs(c,f){var l=Ye(c),y=$e(c),p=Ye(f),b=$e(f);function I(h,N){var E=Ye(N),S=Ye(h)*E,_=$e(h)*E,L=$e(N),k=L*l+S*y;return[Si(_*p-k*b,S*l-L*y),si(k*p+_*b)]}return I.invert=function(h,N){var E=Ye(N),S=Ye(h)*E,_=$e(h)*E,L=$e(N),k=L*p-_*b;return[Si(_*p+L*b,S*l+k*y),si(k*l-S*y)]},I}function gl(c,f,l,y,p,b){if(l){var I=Ye(f),h=$e(f),N=y*l;p==null?(p=f+y*Mt,b=f-N/2):(p=js(I,p),b=js(I,b),(y>0?p<b:p>b)&&(p+=y*Mt));for(var E,S=p;y>0?S>b:S<b;S-=N)E=kr([I,-h*Ye(S),-h*$e(S)]),c.point(E[0],E[1])}}function js(c,f){f=Ii(f),f[0]-=c,Cr(f);var l=qa(-f[1]);return((-f[2]<0?-l:l)+Mt-Fe)%Mt}function $a(){var c=[],f;return{point:function(l,y){f.push([l,y])},lineStart:function(){c.push(f=[])},lineEnd:Hi,rejoin:function(){c.length>1&&c.push(c.pop().concat(c.shift()))},result:function(){var l=c;return c=[],f=null,l}}}function pl(c,f,l,y,p,b){var I=c[0],h=c[1],N=f[0],E=f[1],S=0,_=1,L=N-I,k=E-h,A;if(A=l-I,!(!L&&A>0)){if(A/=L,L<0){if(A<S)return;A<_&&(_=A)}else if(L>0){if(A>_)return;A>S&&(S=A)}if(A=p-I,!(!L&&A<0)){if(A/=L,L<0){if(A>_)return;A>S&&(S=A)}else if(L>0){if(A<S)return;A<_&&(_=A)}if(A=y-h,!(!k&&A>0)){if(A/=k,k<0){if(A<S)return;A<_&&(_=A)}else if(k>0){if(A>_)return;A>S&&(S=A)}if(A=b-h,!(!k&&A<0)){if(A/=k,k<0){if(A>_)return;A>S&&(S=A)}else if(k>0){if(A<S)return;A<_&&(_=A)}return S>0&&(c[0]=I+S*L,c[1]=h+S*k),_<1&&(f[0]=I+_*L,f[1]=h+_*k),!0}}}}}function mn(c,f){return Ke(c[0]-f[0])<Fe&&Ke(c[1]-f[1])<Fe}function pn(c,f,l,y){this.x=c,this.z=f,this.o=l,this.e=y,this.v=!1,this.n=this.p=null}function Ha(c,f,l,y,p){var b=[],I=[],h,N;if(c.forEach(function(A){if(!((t=A.length-1)<=0)){var t,a=A[0],u=A[t],g;if(mn(a,u)){for(p.lineStart(),h=0;h<t;++h)p.point((a=A[h])[0],a[1]);p.lineEnd();return}b.push(g=new pn(a,A,null,!0)),I.push(g.o=new pn(a,null,g,!1)),b.push(g=new pn(u,A,null,!1)),I.push(g.o=new pn(u,null,g,!0))}}),!!b.length){for(I.sort(f),Xs(b),Xs(I),h=0,N=I.length;h<N;++h)I[h].e=l=!l;for(var E=b[0],S,_;;){for(var L=E,k=!0;L.v;)if((L=L.n)===E)return;S=L.z,p.lineStart();do{if(L.v=L.o.v=!0,L.e){if(k)for(h=0,N=S.length;h<N;++h)p.point((_=S[h])[0],_[1]);else y(L.x,L.n.x,1,p);L=L.n}else{if(k)for(S=L.p.z,h=S.length-1;h>=0;--h)p.point((_=S[h])[0],_[1]);else y(L.x,L.p.x,-1,p);L=L.p}L=L.o,S=L.z,k=!k}while(!L.v);p.lineEnd()}}}function Xs(c){if(f=c.length){for(var f,l=0,y=c[0],p;++l<f;)y.n=p=c[l],p.p=y,y=p;y.n=p=c[0],p.p=y}}function Va(c,f){return c<f?-1:c>f?1:c>=f?0:NaN}function yl(c){return c.length===1&&(c=ml(c)),{left:function(f,l,y,p){for(y==null&&(y=0),p==null&&(p=f.length);y<p;){var b=y+p>>>1;c(f[b],l)<0?y=b+1:p=b}return y},right:function(f,l,y,p){for(y==null&&(y=0),p==null&&(p=f.length);y<p;){var b=y+p>>>1;c(f[b],l)>0?p=b:y=b+1}return y}}}function ml(c){return function(f,l){return Va(c(f),l)}}yl(Va);function ja(c){for(var f=c.length,l,y=-1,p=0,b,I;++y<f;)p+=c[y].length;for(b=new Array(p);--f>=0;)for(I=c[f],l=I.length;--l>=0;)b[--p]=I[l];return b}var Vi=1e9,yn=-Vi;function vl(c,f,l,y){function p(E,S){return c<=E&&E<=l&&f<=S&&S<=y}function b(E,S,_,L){var k=0,A=0;if(E==null||(k=I(E,_))!==(A=I(S,_))||N(E,S)<0^_>0)do L.point(k===0||k===3?c:l,k>1?y:f);while((k=(k+_+4)%4)!==A);else L.point(S[0],S[1])}function I(E,S){return Ke(E[0]-c)<Fe?S>0?0:3:Ke(E[0]-l)<Fe?S>0?2:1:Ke(E[1]-f)<Fe?S>0?1:0:S>0?3:2}function h(E,S){return N(E.x,S.x)}function N(E,S){var _=I(E,1),L=I(S,1);return _!==L?_-L:_===0?S[1]-E[1]:_===1?E[0]-S[0]:_===2?E[1]-S[1]:S[0]-E[0]}return function(E){var S=E,_=$a(),L,k,A,t,a,u,g,v,w,T,O,P={point:D,lineStart:X,lineEnd:oe,polygonStart:j,polygonEnd:$};function D(Y,Z){p(Y,Z)&&S.point(Y,Z)}function z(){for(var Y=0,Z=0,ee=k.length;Z<ee;++Z)for(var V=k[Z],Q=1,J=V.length,ve=V[0],le,fe,re=ve[0],de=ve[1];Q<J;++Q)le=re,fe=de,ve=V[Q],re=ve[0],de=ve[1],fe<=y?de>y&&(re-le)*(y-fe)>(de-fe)*(c-le)&&++Y:de<=y&&(re-le)*(y-fe)<(de-fe)*(c-le)&&--Y;return Y}function j(){S=_,L=[],k=[],O=!0}function $(){var Y=z(),Z=O&&Y,ee=(L=ja(L)).length;(Z||ee)&&(E.polygonStart(),Z&&(E.lineStart(),b(null,null,1,E),E.lineEnd()),ee&&Ha(L,h,Y,b,E),E.polygonEnd()),S=E,L=k=A=null}function X(){P.point=W,k&&k.push(A=[]),T=!0,w=!1,g=v=NaN}function oe(){L&&(W(t,a),u&&w&&_.rejoin(),L.push(_.result())),P.point=D,w&&S.lineEnd()}function W(Y,Z){var ee=p(Y,Z);if(k&&A.push([Y,Z]),T)t=Y,a=Z,u=ee,T=!1,ee&&(S.lineStart(),S.point(Y,Z));else if(ee&&w)S.point(Y,Z);else{var V=[g=Math.max(yn,Math.min(Vi,g)),v=Math.max(yn,Math.min(Vi,v))],Q=[Y=Math.max(yn,Math.min(Vi,Y)),Z=Math.max(yn,Math.min(Vi,Z))];pl(V,Q,c,f,l,y)?(w||(S.lineStart(),S.point(V[0],V[1])),S.point(Q[0],Q[1]),ee||S.lineEnd(),O=!1):ee&&(S.lineStart(),S.point(Y,Z),O=!1)}g=Y,v=Z,w=ee}return P}}var tr=Xt();function _l(c,f){var l=f[0],y=f[1],p=[$e(l),-Ye(l),0],b=0,I=0;tr.reset();for(var h=0,N=c.length;h<N;++h)if(S=(E=c[h]).length)for(var E,S,_=E[S-1],L=_[0],k=_[1]/2+zs,A=$e(k),t=Ye(k),a=0;a<S;++a,L=g,A=w,t=T,_=u){var u=E[a],g=u[0],v=u[1]/2+zs,w=$e(v),T=Ye(v),O=g-L,P=O>=0?1:-1,D=P*O,z=D>Re,j=A*w;if(tr.add(Si(j*P*$e(D),t*T+j*Ye(D))),b+=z?O+P*Mt:O,z^L>=l^g>=l){var $=kn(Ii(_),Ii(u));Cr($);var X=kn(p,$);Cr(X);var oe=(z^O>=0?-1:1)*si(X[2]);(y>oe||y===oe&&($[0]||$[1]))&&(I+=z^O>=0?1:-1)}}return(b<-Fe||b<Fe&&tr<-Fe)^I&1}Xt();function Zs(c){return c}Xt();Xt();var wi=1/0,Cn=wi,Zi=-wi,Nn=Zi,Ws={point:xl,lineStart:Hi,lineEnd:Hi,polygonStart:Hi,polygonEnd:Hi,result:function(){var c=[[wi,Cn],[Zi,Nn]];return Zi=Nn=-(Cn=wi=1/0),c}};function xl(c,f){c<wi&&(wi=c),c>Zi&&(Zi=c),f<Cn&&(Cn=f),f>Nn&&(Nn=f)}Xt();function Xa(c,f,l,y){return function(p,b){var I=f(b),h=p.invert(y[0],y[1]),N=$a(),E=f(N),S=!1,_,L,k,A={point:t,lineStart:u,lineEnd:g,polygonStart:function(){A.point=v,A.lineStart=w,A.lineEnd=T,L=[],_=[]},polygonEnd:function(){A.point=t,A.lineStart=u,A.lineEnd=g,L=ja(L);var O=_l(_,h);L.length?(S||(b.polygonStart(),S=!0),Ha(L,bl,O,l,b)):O&&(S||(b.polygonStart(),S=!0),b.lineStart(),l(null,null,1,b),b.lineEnd()),S&&(b.polygonEnd(),S=!1),L=_=null},sphere:function(){b.polygonStart(),b.lineStart(),l(null,null,1,b),b.lineEnd(),b.polygonEnd()}};function t(O,P){var D=p(O,P);c(O=D[0],P=D[1])&&b.point(O,P)}function a(O,P){var D=p(O,P);I.point(D[0],D[1])}function u(){A.point=a,I.lineStart()}function g(){A.point=t,I.lineEnd()}function v(O,P){k.push([O,P]);var D=p(O,P);E.point(D[0],D[1])}function w(){E.lineStart(),k=[]}function T(){v(k[0][0],k[0][1]),E.lineEnd();var O=E.clean(),P=N.result(),D,z=P.length,j,$,X;if(k.pop(),_.push(k),k=null,!!z){if(O&1){if($=P[0],(j=$.length-1)>0){for(S||(b.polygonStart(),S=!0),b.lineStart(),D=0;D<j;++D)b.point((X=$[D])[0],X[1]);b.lineEnd()}return}z>1&&O&2&&P.push(P.pop().concat(P.shift())),L.push(P.filter(El))}}return A}}function El(c){return c.length>1}function bl(c,f){return((c=c.x)[0]<0?c[1]-Pt-Fe:Pt-c[1])-((f=f.x)[0]<0?f[1]-Pt-Fe:Pt-f[1])}const Ks=Xa(function(){return!0},Sl,wl,[-Re,-Pt]);function Sl(c){var f=NaN,l=NaN,y=NaN,p;return{lineStart:function(){c.lineStart(),p=1},point:function(b,I){var h=b>0?Re:-Re,N=Ke(b-f);Ke(N-Re)<Fe?(c.point(f,l=(l+I)/2>0?Pt:-Pt),c.point(y,l),c.lineEnd(),c.lineStart(),c.point(h,l),c.point(b,l),p=0):y!==h&&N>=Re&&(Ke(f-y)<Fe&&(f-=y*Fe),Ke(b-h)<Fe&&(b-=h*Fe),l=Il(f,l,b,I),c.point(y,l),c.lineEnd(),c.lineStart(),c.point(h,l),p=0),c.point(f=b,l=I),y=h},lineEnd:function(){c.lineEnd(),f=l=NaN},clean:function(){return 2-p}}}function Il(c,f,l,y){var p,b,I=$e(c-l);return Ke(I)>Fe?cl(($e(f)*(b=Ye(y))*$e(l)-$e(y)*(p=Ye(f))*$e(c))/(p*b*I)):(f+y)/2}function wl(c,f,l,y){var p;if(c==null)p=l*Pt,y.point(-Re,p),y.point(0,p),y.point(Re,p),y.point(Re,0),y.point(Re,-p),y.point(0,-p),y.point(-Re,-p),y.point(-Re,0),y.point(-Re,p);else if(Ke(c[0]-f[0])>Fe){var b=c[0]<f[0]?Re:-Re;p=l*b/2,y.point(-b,p),y.point(0,p),y.point(b,p)}else y.point(f[0],f[1])}function kl(c,f){var l=Ye(c),y=l>0,p=Ke(l)>Fe;function b(S,_,L,k){gl(k,c,f,L,S,_)}function I(S,_){return Ye(S)*Ye(_)>l}function h(S){var _,L,k,A,t;return{lineStart:function(){A=k=!1,t=1},point:function(a,u){var g=[a,u],v,w=I(a,u),T=y?w?0:E(a,u):w?E(a+(a<0?Re:-Re),u):0;if(!_&&(A=k=w)&&S.lineStart(),w!==k&&(v=N(_,g),(!v||mn(_,v)||mn(g,v))&&(g[0]+=Fe,g[1]+=Fe,w=I(g[0],g[1]))),w!==k)t=0,w?(S.lineStart(),v=N(g,_),S.point(v[0],v[1])):(v=N(_,g),S.point(v[0],v[1]),S.lineEnd()),_=v;else if(p&&_&&y^w){var O;!(T&L)&&(O=N(g,_,!0))&&(t=0,y?(S.lineStart(),S.point(O[0][0],O[0][1]),S.point(O[1][0],O[1][1]),S.lineEnd()):(S.point(O[1][0],O[1][1]),S.lineEnd(),S.lineStart(),S.point(O[0][0],O[0][1])))}w&&(!_||!mn(_,g))&&S.point(g[0],g[1]),_=g,k=w,L=T},lineEnd:function(){k&&S.lineEnd(),_=null},clean:function(){return t|(A&&k)<<1}}}function N(S,_,L){var k=Ii(S),A=Ii(_),t=[1,0,0],a=kn(k,A),u=dn(a,a),g=a[0],v=u-g*g;if(!v)return!L&&S;var w=l*u/v,T=-l*g/v,O=kn(t,a),P=gn(t,w),D=gn(a,T);er(P,D);var z=O,j=dn(P,z),$=dn(z,z),X=j*j-$*(dn(P,P)-1);if(!(X<0)){var oe=Ni(X),W=gn(z,(-j-oe)/$);if(er(W,P),W=kr(W),!L)return W;var Y=S[0],Z=_[0],ee=S[1],V=_[1],Q;Z<Y&&(Q=Y,Y=Z,Z=Q);var J=Z-Y,ve=Ke(J-Re)<Fe,le=ve||J<Fe;if(!ve&&V<ee&&(Q=ee,ee=V,V=Q),le?ve?ee+V>0^W[1]<(Ke(W[0]-Y)<Fe?ee:V):ee<=W[1]&&W[1]<=V:J>Re^(Y<=W[0]&&W[0]<=Z)){var fe=gn(z,(-j+oe)/$);return er(fe,P),[W,kr(fe)]}}}function E(S,_){var L=y?c:Re-c,k=0;return S<-L?k|=1:S>L&&(k|=2),_<-L?k|=4:_>L&&(k|=8),k}return Xa(I,h,b,y?[0,-c]:[-Re,c-Re])}function Za(c){return function(f){var l=new Lr;for(var y in c)l[y]=c[y];return l.stream=f,l}}function Lr(){}Lr.prototype={constructor:Lr,point:function(c,f){this.stream.point(c,f)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Wa(c,f,l){var y=f[1][0]-f[0][0],p=f[1][1]-f[0][1],b=c.clipExtent&&c.clipExtent();c.scale(150).translate([0,0]),b!=null&&c.clipExtent(null),fl(l,c.stream(Ws));var I=Ws.result(),h=Math.min(y/(I[1][0]-I[0][0]),p/(I[1][1]-I[0][1])),N=+f[0][0]+(y-h*(I[1][0]+I[0][0]))/2,E=+f[0][1]+(p-h*(I[1][1]+I[0][1]))/2;return b!=null&&c.clipExtent(b),c.scale(h*150).translate([N,E])}function Cl(c,f,l){return Wa(c,[[0,0],f],l)}var Js=16,Nl=Ye(30*It);function Qs(c,f){return+f?Tl(c,f):Ll(c)}function Ll(c){return Za({point:function(f,l){f=c(f,l),this.stream.point(f[0],f[1])}})}function Tl(c,f){function l(y,p,b,I,h,N,E,S,_,L,k,A,t,a){var u=E-y,g=S-p,v=u*u+g*g;if(v>4*f&&t--){var w=I+L,T=h+k,O=N+A,P=Ni(w*w+T*T+O*O),D=si(O/=P),z=Ke(Ke(O)-1)<Fe||Ke(b-_)<Fe?(b+_)/2:Si(T,w),j=c(z,D),$=j[0],X=j[1],oe=$-y,W=X-p,Y=g*oe-u*W;(Y*Y/v>f||Ke((u*oe+g*W)/v-.5)>.3||I*L+h*k+N*A<Nl)&&(l(y,p,b,I,h,N,$,X,z,w/=P,T/=P,O,t,a),a.point($,X),l($,X,z,w,T,O,E,S,_,L,k,A,t,a))}}return function(y){var p,b,I,h,N,E,S,_,L,k,A,t,a={point:u,lineStart:g,lineEnd:w,polygonStart:function(){y.polygonStart(),a.lineStart=T},polygonEnd:function(){y.polygonEnd(),a.lineStart=g}};function u(D,z){D=c(D,z),y.point(D[0],D[1])}function g(){_=NaN,a.point=v,y.lineStart()}function v(D,z){var j=Ii([D,z]),$=c(D,z);l(_,L,S,k,A,t,_=$[0],L=$[1],S=D,k=j[0],A=j[1],t=j[2],Js,y),y.point(_,L)}function w(){a.point=u,y.lineEnd()}function T(){g(),a.point=O,a.lineEnd=P}function O(D,z){v(p=D,z),b=_,I=L,h=k,N=A,E=t,a.point=v}function P(){l(_,L,S,k,A,t,b,I,p,h,N,E,Js,y),a.lineEnd=w,w()}return a}}var Al=Za({point:function(c,f){this.stream.point(c*It,f*It)}});function Rl(c){return Ol(function(){return c})()}function Ol(c){var f,l=150,y=480,p=250,b,I,h=0,N=0,E=0,S=0,_=0,L,k,A=null,t=Ks,a=null,u,g,v,w=Zs,T=.5,O=Qs($,T),P,D;function z(W){return W=k(W[0]*It,W[1]*It),[W[0]*l+b,I-W[1]*l]}function j(W){return W=k.invert((W[0]-b)/l,(I-W[1])/l),W&&[W[0]*jt,W[1]*jt]}function $(W,Y){return W=f(W,Y),[W[0]*l+b,I-W[1]*l]}z.stream=function(W){return P&&D===W?P:P=Al(t(L,O(w(D=W))))},z.clipAngle=function(W){return arguments.length?(t=+W?kl(A=W*It,6*It):(A=null,Ks),oe()):A*jt},z.clipExtent=function(W){return arguments.length?(w=W==null?(a=u=g=v=null,Zs):vl(a=+W[0][0],u=+W[0][1],g=+W[1][0],v=+W[1][1]),oe()):a==null?null:[[a,u],[g,v]]},z.scale=function(W){return arguments.length?(l=+W,X()):l},z.translate=function(W){return arguments.length?(y=+W[0],p=+W[1],X()):[y,p]},z.center=function(W){return arguments.length?(h=W[0]%360*It,N=W[1]%360*It,X()):[h*jt,N*jt]},z.rotate=function(W){return arguments.length?(E=W[0]%360*It,S=W[1]%360*It,_=W.length>2?W[2]%360*It:0,X()):[E*jt,S*jt,_*jt]},z.precision=function(W){return arguments.length?(O=Qs($,T=W*W),oe()):Ni(T)},z.fitExtent=function(W,Y){return Wa(z,W,Y)},z.fitSize=function(W,Y){return Cl(z,W,Y)};function X(){k=Ya(L=dl(E,S,_),f);var W=f(h,N);return b=y-W[0]*l,I=p+W[1]*l,oe()}function oe(){return P=D=null,z}return function(){return f=c.apply(this,arguments),z.invert=f.invert&&j,X()}}function Ka(c){return function(f,l){var y=Ye(f),p=Ye(l),b=c(y*p);return[b*p*$e(f),b*$e(l)]}}function Ja(c){return function(f,l){var y=Ni(f*f+l*l),p=c(y),b=$e(p),I=Ye(p);return[Si(f*b,y*I),si(y&&l*b/y)]}}var Ul=Ka(function(c){return Ni(2/(1+c))});Ul.invert=Ja(function(c){return 2*si(c/2)});var Qa=Ka(function(c){return(c=qa(c))&&c/$e(c)});Qa.invert=Ja(function(c){return c});function Pl(){return Rl(Qa).scale(79.4188).clipAngle(180-.001)}function ea(c,f){return[c,f]}ea.invert=ea;var{BufferOp:Ml,GeoJSONReader:Bl,GeoJSONWriter:Dl}=hl;function Fl(c,f,l){l=l||{};var y=l.units||"kilometers",p=l.steps||8;if(!c)throw new Error("geojson is required");if(typeof l!="object")throw new Error("options must be an object");if(typeof p!="number")throw new Error("steps must be an number");if(f===void 0)throw new Error("radius is required");if(p<=0)throw new Error("steps must be greater than 0");var b=[];switch(c.type){case"GeometryCollection":return Fa(c,function(I){var h=vn(I,f,y,p);h&&b.push(h)}),bi(b);case"FeatureCollection":return Us(c,function(I){var h=vn(I,f,y,p);h&&Us(h,function(N){N&&b.push(N)})}),bi(b)}return vn(c,f,y,p)}function vn(c,f,l,y){var p=c.properties||{},b=c.type==="Feature"?c.geometry:c;if(b.type==="GeometryCollection"){var I=[];return Fa(c,function(t){var a=vn(t,f,l,y);a&&I.push(a)}),bi(I)}var h=zl(b),N={type:b.type,coordinates:to(b.coordinates,h)},E=new Bl,S=E.read(N),_=Ru(Ma(f,l),"meters"),L=Ml.bufferOp(S,_,y),k=new Dl;if(L=k.write(L),!eo(L.coordinates)){var A={type:L.type,coordinates:io(L.coordinates,h)};return Ou(A,p)}}function eo(c){return Array.isArray(c[0])?eo(c[0]):isNaN(c[0])}function to(c,f){return typeof c[0]!="object"?f(c):c.map(function(l){return to(l,f)})}function io(c,f){return typeof c[0]!="object"?f.invert(c):c.map(function(l){return io(l,f)})}function zl(c){var f=Mu(c).geometry.coordinates,l=[-f[0],-f[1]];return Pl().rotate(l).scale(Or)}var Gl=Fl;function ql(c,f={}){let l=0,y=0,p=0;return Pr(c,function(b){l+=b[0],y+=b[1],p++},!0),st([l/p,y/p],f.properties)}function Fr(c,f,l={}){const y=l.steps||64,p=l.properties?l.properties:!Array.isArray(c)&&c.type==="Feature"&&c.properties?c.properties:{},b=[];for(let I=0;I<y;I++)b.push(Br(c,f,I*-360/y,l).geometry.coordinates);return b.push(b[0]),Xi([b],p)}var Yl=Fr;function $l(c){if(!c)throw new Error("geojson is required");switch(c.type){case"Feature":return no(c);case"FeatureCollection":return Hl(c);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return zr(c);default:throw new Error("unknown GeoJSON type")}}function no(c){const f={type:"Feature"};return Object.keys(c).forEach(l=>{switch(l){case"type":case"properties":case"geometry":return;default:f[l]=c[l]}}),f.properties=ro(c.properties),c.geometry==null?f.geometry=null:f.geometry=zr(c.geometry),f}function ro(c){const f={};return c&&Object.keys(c).forEach(l=>{const y=c[l];typeof y=="object"?y===null?f[l]=null:Array.isArray(y)?f[l]=y.map(p=>p):f[l]=ro(y):f[l]=y}),f}function Hl(c){const f={type:"FeatureCollection"};return Object.keys(c).forEach(l=>{switch(l){case"type":case"features":return;default:f[l]=c[l]}}),f.features=c.features.map(l=>no(l)),f}function zr(c){const f={type:c.type};return c.bbox&&(f.bbox=c.bbox),c.type==="GeometryCollection"?(f.geometries=c.geometries.map(l=>zr(l)),f):(f.coordinates=so(c.coordinates),f)}function so(c){const f=c;return typeof f[0]!="object"?f.slice():f.map(l=>so(l))}function Tr(c,f,l,y={}){const p=f<0;let b=Ba(Math.abs(f),y.units,"meters");p&&(b=-Math.abs(b));const I=kt(c),h=Vl(I,b,l);return h[0]+=h[0]-I[0]>180?-360:I[0]-h[0]>180?360:0,st(h,y.properties)}function Vl(c,f,l,y){y=y===void 0?Or:Number(y);const p=f/y,b=c[0]*Math.PI/180,I=Yt(c[1]),h=Yt(l),N=p*Math.cos(h);let E=I+N;Math.abs(E)>Math.PI/2&&(E=E>0?Math.PI-E:-Math.PI-E);const S=Math.log(Math.tan(E/2+Math.PI/4)/Math.tan(I/2+Math.PI/4)),_=Math.abs(S)>1e-11?N/S:Math.cos(I),L=p*Math.sin(h)/_;return[((b+L)*180/Math.PI+540)%360-180,E*180/Math.PI]}function jl(c,f,l={}){const y=kt(c),p=kt(f);p[0]+=p[0]-y[0]>180?-360:y[0]-p[0]>180?360:0;const b=Xl(y,p);return Ba(b,"meters",l.units)}function Xl(c,f,l){l=l===void 0?Or:Number(l);const y=l,p=c[1]*Math.PI/180,b=f[1]*Math.PI/180,I=b-p;let h=Math.abs(f[0]-c[0])*Math.PI/180;h>Math.PI&&(h-=2*Math.PI);const N=Math.log(Math.tan(b/2+Math.PI/4)/Math.tan(p/2+Math.PI/4)),E=Math.abs(N)>1e-11?I/N:Math.cos(p);return Math.sqrt(I*I+E*E*h*h)*y}function Zl(c,f,l){if(l=l||{},!Ur(l))throw new Error("options is invalid");const y=l.pivot,p=l.mutate;if(!c)throw new Error("geojson is required");if(f==null||isNaN(f))throw new Error("angle is required");if(f===0)return c;const b=y??ql(c);return(p===!1||p===void 0)&&(c=$l(c)),Pr(c,function(I){const N=Ju(b,I)+f,E=jl(b,I),S=Da(Tr(b,E,N));I[0]=S[0],I[1]=S[1]}),c}function Wl(c,f,l,y){y=y||{};const p=y.steps||64,b=y.units||"kilometers",I=y.angle||0,h=y.pivot||c,N=y.properties||{};if(!c)throw new Error("center is required");if(!f)throw new Error("xSemiAxis is required");if(!l)throw new Error("ySemiAxis is required");if(!Ur(y))throw new Error("options must be an object");if(!Rs(p))throw new Error("steps must be a number");if(!Rs(I))throw new Error("angle must be a number");const E=kt(c);if(b!=="degrees"){const _=Tr(c,f,90,{units:b}),L=Tr(c,l,0,{units:b});f=kt(_)[0]-E[0],l=kt(L)[1]-E[1]}const S=[];for(let _=0;_<p;_+=1){const L=_*-360/p;let k=f*l/Math.sqrt(Math.pow(l,2)+Math.pow(f,2)*Math.pow(ta(L),2)),A=f*l/Math.sqrt(Math.pow(f,2)+Math.pow(l,2)/Math.pow(ta(L),2));if(L<-90&&L>=-270&&(k=-k),L<-180&&L>=-360&&(A=-A),b==="degrees"){const t=Yt(I),a=k*Math.cos(t)+A*Math.sin(t),u=A*Math.cos(t)-k*Math.sin(t);k=a,A=u}S.push([k+E[0],A+E[1]])}return S.push(S[0]),b==="degrees"?Xi([S],N):Zl(Xi([S],N),I,{pivot:h})}function ta(c){const f=c*Math.PI/180;return Math.tan(f)}var Kl=Wl;function Jl(c,f,l,y,p={}){const b=p.steps||64,I=ia(l),h=ia(y),N=!Array.isArray(c)&&c.type==="Feature"?c.properties:{};if(I===h)return Os(Fr(c,f,p).geometry.coordinates[0],N);const E=I,S=I<h?h:h+360;let _=E;const L=[];let k=0;const A=(S-E)/b;for(;_<=S;)L.push(Br(c,f,_,p).geometry.coordinates),k++,_=E+k*A;return Os(L,N)}function ia(c){let f=c%360;return f<0&&(f+=360),f}function Ql(c,f,l,y,p={}){if(p=p||{},!Ur(p))throw new Error("options is invalid");const b=p.properties;if(!c)throw new Error("center is required");if(l==null)throw new Error("bearing1 is required");if(y==null)throw new Error("bearing2 is required");if(!f)throw new Error("radius is required");if(typeof p!="object")throw new Error("options must be an object");if(na(l)===na(y))return Fr(c,f,p);const I=Da(c),h=Jl(c,f,l,y,p),N=[[I]];return Pr(h,function(E){N[0].push(E)}),N[0].push(I),Xi(N,b)}function na(c){let f=c%360;return f<0&&(f+=360),f}var eh=Ql;const Ae=(c,f)=>(c.install=l=>{for(const y of[c,...Object.values({})])l.component(y.name,y)},c),th=`<svg xmlns="http://www.w3.org/2000/svg" width="{{diameter}}" height="{{diameter}}" viewBox="0 0 64 64" fill="{{fillColor}}">
  <circle id="dot_1" data-name="dot 1" cx="32" cy="32" r="32"/>
</svg>`,Li=(c="close")=>[{name:c,type:"link",url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHIAAAAwCAYAAADNTS4aAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAcqADAAQAAAABAAAAMAAAAABSTZk/AAAK30lEQVR4Ae1cDXBU1RU+9+0m2YT8sruAAmJtUCwVRMAftB0DYu0IJBBw1FHrSBVlWjulDm2tQ6E6bYdp7RRrO1JsbW2rTozkR6YVLFBBCgMVAfmpDS2giLJL/kk2m913+52XbLLZ3be7b98meSGcGdjd9+7Puee759xzz7k3gi4gWrJLZgc93rkYUgmRnITPYimpSJDIkyQzB3Oo4MEPHlqEoAbwUUckjuFzm83t2lIxS7Sb5U2YbWCw69/7ZmORTw2UkipLpZC3k6ScwebJUP+C2oQUm0kR1Q7FXv2XeYUMtGEaskA+UitzvKpnhSSxkqTMMzxyK1YQokWQXOtS3M+uny/ajLA45IBcIqVNrfUulSqthqm6xMhgh0pZmOEzQqHVynzXixVCBJPhe0gBuaTWOzaoyiop5YxkBjfUywgh9tkUUVYx33U60ViGDJDlVd4boIEbL1Qt1ANK004SCyvLXHv0yvBzJd5Lq7wrr/beJ4W6fbiByPLnMfPYWQbx8LC8RvIAVKm+HG8Qw+WdIpT7K0tdf4o1XksDqZlT1kRJjljMD7dn2IP6hFRujWVmLQuk5tgE5d7haE7jTVBeM202MTPSAbLkGslbDM07vUC3F/GASvSOJzbLhmUUXtaSQGr7xGGyxQgHI9nvvP1iGYWXt5xp1SI2QW/dRZMaDlP0dzaxLpurOBQBspxGdoXdLsyITTQcqT/hic6yCrVgKSA5AK7FTkPcpeGzIEvQFHdGwpZKi7Np/uezEbtOWFQrcFmejR6dmktOx+CJkGXFMmOG7MmxPTCltCxGGgPgNoDy0y8VURGEvWJ7A33SGjtsmZsh6J5JI+h4Y4BqjyeXUbo010a3X55NY/G56t0mbNy7aHSOQlNHJZcx+7glSEfOdaYuXMhKkxnRS5YCklNRqY8qumYQ0v3dB630/RsK6JvT8ujJHY09Ag8vXXKZgzKB+hv/ST7hsPuMn7ad8hHXLYM2b6zrmgATizKgqcklYzafaDcHJA+iS2bWAZKTwgGPh/OJaaW9n/pp+0c+unW8gxZA4NXdAg91kgHLyCb1VHOA/vWZP/Q4qc8Nh1ppsiuD7rl6BB3wdNJ/mwK0/6yfnoD2x6MRsABrbi6MVyTpd5yDZdkNnoGPYFXL7PdTUvhFCLy+PUhzJzjIHjHieQDRlW2jqrrktHEONPAb0G6eAO0BSc+916LNvamjutbh851SA5RB5fXWr/b+5mf87wQmTdoIMmPZWcm0lqRrcEuvySVHn+0y0adtQfK0qbRsSm6fbm66NEv7PcWdSZOdvU4RA/LS4fN9yvKPq1FmNsDkydEJkA5jjVv6t3PUivKR9MwthVTX2ElP7WyKfJXu3yUWAlLyGZu00JfHZVFeZoTqcctO/ebZ9IZTg0+NCWR4mdD3WCCG3g3Mp5xkISCpOF2DfmxLfdym1s3WPHZ6fKv+WhatX3GbHOyXxaaBvPutc+P9PrUKmbMIY2ZsbBDc5cZq6Jduw9oVjzLgobb4VUpULl4b/C4/U9Dya/U9VF6Px+fZ6XvX5/c0tQ5rarqJTwqaBrLDp/4ah5+uSzdz/dUeOylsdtlLNUu8ZZkxJvaeEX4O4agG+upbJhPTnbdF6SSE6zBdTFB5zdm7VFXOA8uNNrtyZ1Aq0d5Bku2LYIBTVr3eRpL1jBYb2R2JqccaaJa87SotrvHGbIa18PpLsrBP9Ec5OwxuuillIDk01B70r2OG4GavfH2ec5cZ5hZWnW1G/TjuSOLWOaoya2yXF6pX2o2tBtOoHBstnJitV6zn+a7THfQZvF0jNBNaypqKLIWRaimXhQK0pAxkezDwM2ygRsN8vPP6AtcGs3OMT2Bj3KaAHAcDc/8X+m4v9KRz1cgM4n+J6FRzEEAmHyjgGCxHkV452kZLrhqYs9Isu5SAXFTtKZFSfYgEdWTY6WGAmY6ph2P05jzXo9jTrfyHvifKoH0XJq8wS9HWqTPng/T8/vjOh158NtYEYIuw6qYCOogoTyXCfQMFJHipMwzkg9uko7nZ+wIPRJH09Gt3uj+MNSjjz/guhLzDeL3eGuyF1iHwrUfTR2eSE6b17ZPt1IYN/ILiHMq2CzrkNRG47u5sKjIsK2bkE6+9z+3nVWIgSRyLsWuOz0BTi+eHsP0TYUo/cI5zr41f2tDbbYZKp1B48ZU5FEA0puLfbbQRGuMD8A9+MRcB8xQa666CeUB3wYQ+BU3kIMKPdzdRR+wkS+qdJK65zRCQ5dX1U0iKJ+DuqoKUr6+fIcxP5W4m+VYSTHVyAc/EA4sqwflGXhO3ImPhgbfZhLtRLx9ppc8V2OlJZEd4W2KUOKT3i5IiuhspsO2nOmjlOw1a20bbMVUeMmPZJc3+ailhSYMb4IrZhSJ+FetInhmG+GqZdivJTCM6dRcCxK9NzqWPsHd89VjvDumv//NRFTST46yc6jK6LZgOz5QD7uvea6bn328h/8BrIrHMWHZJr5EHa72Pw6TOhGNzSslz/kBHZuYe42oZ8mtl5hrpre1GcudRRF6mIdF72Ounn+xpjorm/PHIecpGWukrSBKvmz2SNhxspXc/6ehtJM631zAp/n7SR6djJKwLcTKBtbzfzSzLDJQUkIs2NUygQOcz3WNaXlEiWuOML+VXfD+wXXYiL2TumhwDWDYxh25D2ioDm9wdH/u0dJNe5O6FA610BA7PMhzd+M7MfJqNnCJraiIniEEKB5GPlayeVailt8aMsGmRnffRViSFAvpYrs0RruGxzLiRpICUgcBvsGccAW189Y1S9yZzvevX5kuei6rPrsX4ntYvpf/mWniODOA1SPaCV+LtSM3xNtqDbH4i2oGN/7H6TnqsW4NZi0/CFFd+2EY78S4ZauqQmsPDieMz0NJNODbCGstUgGjO9DFZMDiSbukOWpg65oE2+S5l6GJsQiAX1XrulUH5VTg49dLh+JbGVT/+x5c8vUHv8lSOQyIOruUU2TTW4CRAvK1IrCGwE/SjfzbRlQhBsyd63egsYlCMENePRR0IsPJhLTssBIPJpn6fwRMJ4e1qxyEV17OhZ3G5fODtZmfred9R9Osmsj20scz5+1DF/vwsr/E8ghiutlc12g8fpEpXfnBCvg3B9WCf0yes7eMQvdlywkd6plqPZ26PTf05TJiGDmNhv8g2FUUsq1zgXh96HhdImLk/AMQHYKa2wqTOCVXq70/tykCNdzecq2FxodWoPIHHPtsC143ht5l1tx+4CXWbBiKOptgoc5nRzsyUZwb5pi6bDzPtXIh1WSbaLeaIK+kxgeRTWbhcqZk2qShrKkoLOA46oMS3jcD0QvgsXd7CgPZuzc5YFiyTyJtYzG1MIAMe7xpo4xWoeGBqnvPngzUsDjoggvTwYPVvtX5ZFnqBmKg1srz67DQpxV4eBIC8sbLUvW+wB6RdPSf1t5hcfU9IDTZjA9R/lyYCRJ3bysxGH41kJwP3CTbA9bdJQb+0AojMJA+Ab+oOxzWTx6zdUo4DYhSQgVrvt+Ep8vmbE7kO1youYBVik8I3ddljswpP/c2H5p1izHrmNLz/HtNa/mbjFWrQfwibphzFbrujcp7zrfCCVvnOVuPiH0yKRqMHSOwZN2MNmotZ8GfsGe+LLmqtJxf/hFlfPDQgF1XX3yxlYCdenXPYHJNemZ8f+2hY37qW+HXxjwp2wdCjkYtrvXNgVnNxkEqLplsCJYNMDOc/8/l/JjlQF3IAmQ0AAAAASUVORK5CYII="}],ze={steps:80,units:"kilometers"},Ti={RESIZER:"resizable",CLOSE_BUTTON:"closable",DISTANCE_COUNTER:"countable",ROTATER:"rotatable"};function Tt(c){return{getVisibility:(f=!0)=>c.visible&&f?"visible":"none"}}const ih=(c="black",f=16)=>{const l=th.replace(/\{\{fillColor\}\}/,c).replace(/\{\{diameter\}\}/g,`${f}`);return`data:image/svg+xml;base64,${btoa(l)}`},mt=(c="dot",f="black",l=8)=>{const y=ih(f,l*2);return{name:c,type:"link:svg",url:y}},Ai=(c,f)=>{const l=c.find(y=>y.name.includes("close"));return f&&l&&(l.url=f),c};let ai=class _n{constructor(f,l,y,p=1){this.r=f,this.g=l,this.b=y,this.a=p}static parse(f){if(f){if(f instanceof _n)return f;if(Array.isArray(f))return new _n(f[0],f[1],f[2],f[3]);if(typeof f=="string"){const l=Du(f);return l?new _n(...l):void 0}}}toArray(){const{r:f,g:l,b:y,a:p}=this;return p===0?[0,0,0,0]:[f,l,y,p]}toString(){const[f,l,y,p]=this.toArray();return`rgba(${Math.round(f)},${Math.round(l)},${Math.round(y)},${p})`}toArrayForDeck(){const{r:f,g:l,b:y,a:p}=this;return p===0?[0,0,0,0]:[f,l,y,p*255]}};function nh(c,f){const l=ai.parse(f.color),y=l.toArray(),p=f.radius?f.radius*2:75,b=f.duration?f.duration:1200;return{width:p,height:p,data:new Uint8ClampedArray(p*p*4),context:null,onAdd(){const I=document.createElement("canvas");I.width=this.width,I.height=this.height,this.context=I.getContext("2d")},render(){const I=performance.now()%(b*1.4)/b,h=I<1?1:1-(I-1)/.4,N=p/2*Math.min(I,1),E=this.context;E.clearRect(0,0,this.width,this.height),E.beginPath(),E.arc(this.width/2,this.height/2,N,0,Math.PI*2);const S=p/2,_=E.createRadialGradient(S,S,0,S,S,S);return _.addColorStop(0,`rgba(${y[0]}, ${y[1]}, ${y[2]}, ${.1*h} )`),_.addColorStop(1,`rgba(${y[0]}, ${y[1]}, ${y[2]}, ${.6*h} )`),E.fillStyle=_,E.fill(),this.data=E.getImageData(0,0,this.width,this.height).data,c.triggerRepaint(),!0}}}function rh(c,f){const l=ai.parse(f.color),y=l.toArray(),p=f.radius?f.radius*2:75,b=f.duration?f.duration:2e3;return{width:p,height:p,data:new Uint8ClampedArray(p*p*4),context:null,onAdd(){const I=document.createElement("canvas");I.width=this.width,I.height=this.height,this.context=I.getContext("2d")},render(){const I=performance.now()%b/b,h=p/2*.5,N=p/2*.5*I+h,E=this.context;return E.clearRect(0,0,this.width,this.height),E.beginPath(),E.arc(this.width/2,this.height/2,N,0,Math.PI*2),E.fillStyle=`rgba(${y[0]}, ${y[1]}, ${y[2]}, ${1-I} )`,E.fill(),E.beginPath(),E.arc(this.width/2,this.height/2,h,0,Math.PI*2),E.fillStyle=l.toString(),E.strokeStyle="white",E.lineWidth=0,E.fill(),E.stroke(),this.data=E.getImageData(0,0,this.width,this.height).data,c.triggerRepaint(),!0}}}function sh(c,f){const l=ai.parse(f.color),y=f.radius?f.radius*2:75;return{width:y,height:y,data:new Uint8ClampedArray(y*y*4),context:null,onAdd(){const p=document.createElement("canvas");p.width=this.width,p.height=this.height,this.context=p.getContext("2d")},render(){const p=y/2*.5,b=this.context;return b.clearRect(0,0,this.width,this.height),b.beginPath(),b.arc(this.width/2,this.height/2,p,0,Math.PI*2),b.fillStyle=l.toString(),b.strokeStyle="white",b.lineWidth=0,b.fill(),b.stroke(),this.data=b.getImageData(0,0,this.width,this.height).data,c.triggerRepaint(),!0}}}function ah(c,f){const l=f.color,y=ai.parse(f.color).toArray(),p=f.radius?f.radius*2:75,b=f.duration?f.duration:2e3;return{width:p,height:p,data:new Uint8ClampedArray(p*p*4),context:null,onAdd(){const I=document.createElement("canvas");I.width=this.width,I.height=this.height,this.context=I.getContext("2d")},render(){const I=performance.now()%b/b,h=.5,N=I/2+h,E=this.context,{width:S,height:_}=this;return E.clearRect(0,0,this.width,this.height),ra(E,S,_,h,l),ra(E,S,_,N,`rgba(${y[0]}, ${y[1]}, ${y[2]}, ${.9-I} )`),this.data=E.getImageData(0,0,this.width,this.height).data,c.triggerRepaint(),!0}}}function ra(c,f,l,y,p){c.fillStyle=p,c.beginPath(),c.moveTo(f/2,l/2-l/4.29*y),c.bezierCurveTo(f/2,l/2-l/3.95*y,f/2-f/30*y,l/2-l/3*y,f/2-f/6*y,l/2-l/3*y),c.bezierCurveTo(f/2-f/2.73*y,l/2-l/3*y,f/2-f/2.73*y,l/2-l/60*y,f/2-f/2.73*y,l/2-l/12*y),c.bezierCurveTo(f/2-f/2.73*y,l/2+l/25*y,f/2-f/4.28*y,l/2+l/5*y,f/2,l/2+l/3.33*y),c.bezierCurveTo(f/2+f/4.28*y,l/2+l/5*y,f/2+f/2.73*y,l/2+l/25*y,f/2+f/2.73*y,l/2-l/12*y),c.bezierCurveTo(f/2+f/2.73*y,l/2-l/60*y,f/2+f/2.73*y,l/2-l/3*y,f/2+f/6*y,l/2-l/3*y),c.bezierCurveTo(f/2+f/15*y,l/2-l/3*y,f/2,l/2-l/3.95*y,f/2,l/2-l/4.29*y),c.fill()}const ao={drawDynamicCircle:rh,drawStaticCircle:sh,drawDynamicGradientCircle:nh,drawDynamicHeart:ah},oh={images:{type:Array,required:!0}},uh={class:"mb-image-loader"},lh={name:"MbImageLoader"},hh=Te({...lh,props:oh,setup(c){const{getMap:f}=ki(oi),l=c,y=()=>{const I=b();p(I)},p=I=>{if(!I){console.error("ImageLoader Error: Mapbox instance is null");return}const h=I.listImages();l.images&&l.images.filter(N=>!h.includes(N.name)).forEach(N=>{if(N.type==="link")I.loadImage(N.url,(E,S)=>{if(E)throw new Error(`${N.url} load error`);N.name&&!I.hasImage(N.name)&&I.addImage(N.name,S)});else if(N.type.includes("link:")){const E=new Image(...N.size||[]);E.onload=()=>!I.hasImage(N.name)&&I.addImage(N.name,E),E.onerror=()=>{throw new Error(`${N.url} load error`)},E.src=N.url,E.setAttribute("crossOrigin","")}else N.type==="function"?I.addImage(N.name,ao[N.functionName](I,N.functionProps)):N.type==="custom"&&typeof N.functionName=="function"&&I.addImage(N.name,N.functionName(I))})},{getMapboxInstance:b}=He(y);return ue(()=>l.images,async()=>{const I=await f;p(I.mapboxInstance)},{deep:!0}),(I,h)=>(Se(),je("i",uh))}}),ui=Ae(hh),Ki={id:{type:String,default:()=>De()},center:{type:Array,required:!0},radius:{type:Number,default:10},borderColor:{type:String,default:"blue"},borderOpacity:{type:Number,default:.5},borderWidth:{type:Number,default:5},backgroundColor:{type:String,default:"blue"},backgroundOpacity:{type:Number,default:.1},resizerColor:{type:String,default:"black"},resizerRadius:{type:Number,default:8},centerColor:{type:String,default:"red"},centerRadius:{type:Number,default:8},closeSize:{type:Number,default:.7},closable:{type:Boolean,default:!1},countable:{type:Boolean,default:!1},resizable:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},rotatable:{type:Boolean,default:!1},rotaterColor:{type:String,default:"yellow"},visible:{type:Boolean,default:!0},textFonts:{type:Array,default:["Open Sans Regular"]},textColor:{type:String,default:"#000000"},textSize:{type:Number,default:16},formatter:{type:Function},closeIconUrl:String,manual:Boolean},Ji={close:c=>!0,mouseenter:()=>!0,mouseleave:()=>!0},oo={...Ki,closeOffset:{type:Array,default:[70,0]}},uo={...Ji,update:({center:c,radius:f})=>Array.isArray(c)&&typeof f=="number"};function lo(c,f,l){const{getVisibility:y}=Tt(l);ue(()=>[l.borderColor,l.borderOpacity,l.borderWidth],()=>{c().getLayer(f.CIRCLE_BORDER)&&Object.entries({"line-color":l.borderColor,"line-opacity":l.borderOpacity,"line-width":l.borderWidth}).forEach(p=>{c().setPaintProperty(f.CIRCLE_BORDER,p[0],p[1])})}),ue(()=>[l.backgroundColor,l.backgroundOpacity],()=>{c().getLayer(f.CIRCLE_BACKGROUND)&&Object.entries({"fill-color":l.backgroundColor,"fill-opacity":l.backgroundOpacity}).forEach(p=>{c().setPaintProperty(f.CIRCLE_BACKGROUND,p[0],p[1])})}),ue(()=>l.resizable,()=>{c().getLayer(f.RESIZER)&&c().setLayoutProperty(f.RESIZER,"visibility",y(l.resizable))}),ue(()=>l.closable,()=>{c().getLayer(f.CLOSE_BUTTON)&&c().setLayoutProperty(f.CLOSE_BUTTON,"visibility",y(l.closable))}),ue(()=>[l.closeSize,l.closeOffset],()=>{c().getLayer(f.CLOSE_BUTTON)&&Object.entries({"icon-size":l.closeSize,"icon-offset":l.closeOffset}).forEach(p=>{c().setLayoutProperty(f.CLOSE_BUTTON,p[0],p[1])})}),ue(()=>l.countable,()=>{c().getLayer(f.DISTANCE_COUNTER)&&c().setLayoutProperty(f.DISTANCE_COUNTER,"visibility",y(l.countable))}),ue(()=>[l.textFonts,l.textSize],()=>{c().getLayer(f.DISTANCE_COUNTER)&&Object.entries({"text-font":l.textFonts,"text-size":l.textSize}).forEach(p=>{c().setLayoutProperty(f.DISTANCE_COUNTER,p[0],p[1])})}),ue(()=>[l.textColor],()=>{c().getLayer(f.DISTANCE_COUNTER)&&Object.entries({"text-color":l.textColor}).forEach(p=>{c().setPaintProperty(f.DISTANCE_COUNTER,p[0],p[1])})})}const ch={CIRCLE_BORDER:"circle-buffer-main-layer",CIRCLE_BACKGROUND:"circle-buffer-main-bg-layer",RESIZER:"circle-buffer-resizer-layer",CENTER_POINT:"circle-buffer-center-layer",CLOSE_BUTTON:"circle-buffer-close-button",DISTANCE_COUNTER:"circle-buffer-distance-counter"},fh="circle-buffer-source",ho=()=>{const c={...ch};Object.keys(c).forEach(l=>{c[l]+=`-${De()}`});const f=`${fh}-${De()}`;return{BUFFER_CIRCLE_LAYER:c,BUFFER_CIRCLE_SOURCE:f}},dh={name:"MbBufferCircleLayer"},gh=Te({...dh,props:oo,emits:uo,setup(c,{emit:f}){const l=c,y=f,{getVisibility:p}=Tt(l),b="circle-close",I=tt(Ai(Li(b),l.closeIconUrl));let h=0,N=l.radius,E=[],S=[],_,L,k=!1,A,t=!1,a=!1;const{BUFFER_CIRCLE_LAYER:u,BUFFER_CIRCLE_SOURCE:g}=ho(),v=()=>{I.value.push(mt("BufferCircleCenterSVG",l.centerColor,l.centerRadius),mt("BufferCircleResizerSVG",l.resizerColor,l.resizerRadius))},w=()=>{Object.keys(u).forEach(G=>{_.getLayer(u[G])&&_.setLayoutProperty(u[G],"visibility",p(l[Ti[G]]))})},T=(G,ie,U)=>{typeof ie=="string"?(_.on(G,ie,U),S.push({event:G,target:ie,handler:U})):(_.on(G,ie),S.push({event:G,handler:ie}))},O=()=>{S.forEach(G=>{G.target?_.off(G.event,G.target,G.handler):_.off(G.event,G.handler)}),S=[]},P=()=>{T("mouseenter",u.CIRCLE_BACKGROUND,D),T("mouseleave",u.CIRCLE_BACKGROUND,z),T("mousedown",u.CIRCLE_BACKGROUND,W),T("touchstart",u.CIRCLE_BACKGROUND,Y),T("mouseenter",u.RESIZER,j),T("mouseleave",u.RESIZER,$),T("mousedown",u.RESIZER,X),T("touchstart",u.RESIZER,oe),T("click",u.CLOSE_BUTTON,G=>{y("close",G)})},D=()=>{L.style.cursor="move",k=!0,_.dragPan.disable(),y("mouseenter")},z=()=>{L.style.cursor="",k=!1,_.dragPan.enable(),y("mouseleave")},j=()=>{L.style.cursor="nwse-resize",k=!0,_.dragPan.disable(),y("mouseenter")},$=G=>{ni([G.lngLat.lng,G.lngLat.lat],E)>h?(L.style.cursor="",k=!1,_.dragPan.enable(),y("mouseleave")):D()},X=G=>{k&&(A=G.lngLat,t=!0,a=!1,L.style.cursor="nwse-resize",T("mousemove",Z),_.once("mouseup",ee))},oe=G=>{G.points.length===1&&(G.preventDefault(),A=G.lngLat,t=!0,a=!1,T("touchmove",Z),_.once("touchend",ie=>{ee(),_.dragPan.enable()}))},W=G=>{!k||!l.draggable||(A=G.lngLat,a=!0,t=!1,L.style.cursor="grab",T("mousemove",V),_.once("mouseup",Q))},Y=G=>{G.points.length!==1||!l.draggable||(G.preventDefault(),A=G.lngLat,a=!0,t=!1,T("touchmove",V),_.once("touchend",ie=>{Q(),_.dragPan.enable()}))},Z=G=>{if(!t)return;L.style.cursor="nwse-resize";const ie=G.lngLat.lat-A.lat,U=ni(st([A.lng,A.lat]),st([G.lngLat.lng,G.lngLat.lat]),ze);A={lng:G.lngLat.lng,lat:G.lngLat.lat},h+=U*(ie>0?1:-1),N=Math.abs(+h.toFixed(1)),le(E)},ee=()=>{t&&(L.style.cursor="",t=!1,y("update",{center:E,radius:N}),_.off("mousemove",Z),_.off("touchmove",Z))},V=G=>{if(!a)return;L.style.cursor="grabbing";const ie=G.lngLat.lng-A.lng,U=G.lngLat.lat-A.lat;A={lng:G.lngLat.lng,lat:G.lngLat.lat},fe([E[0]+ie,E[1]+U])},Q=()=>{a&&(L.style.cursor="",a=!1,_.off("mousemove",u.CIRCLE_BACKGROUND,V),_.off("touchmove",u.CIRCLE_BACKGROUND,V),y("update",{center:E,radius:N}))},J=G=>{const ie=st([...G]),U=Yl(ie,h,{...ze,properties:{bufferType:"main"}}),H=We(ie,h,-45,ze),B=We(ie,h,45,ze).geometry.coordinates,ne=We(ie,h,90,ze).geometry.coordinates,pe={type:"Feature",properties:{bufferType:"close"},geometry:{type:"Point",coordinates:B}},Ie={type:"Feature",properties:{bufferType:"resizer"},geometry:{type:"Point",coordinates:[...H.geometry.coordinates]}},Ce={type:"Feature",properties:{bufferType:"center"},geometry:{type:"Point",coordinates:G}},te={type:"Feature",properties:{bufferType:"counter",text:l.formatter?l.formatter(N):`${N}km`},geometry:{type:"Point",coordinates:ne}};return{circleMain:U,circleCenter:Ce,circleResizer:Ie,closeButton:pe,counter:te}},ve=({circleMain:G,circleCenter:ie,circleResizer:U,closeButton:H,counter:B})=>{_.getSource(g)?_.getSource(g).setData({type:"FeatureCollection",features:[G,ie,U,H,B]}):(_.addSource(g,{type:"geojson",data:{type:"FeatureCollection",features:[G,ie,U,H,B]}}),_.addLayer({id:u.CIRCLE_BORDER,type:"line",source:g,paint:{"line-color":l.borderColor,"line-opacity":l.borderOpacity,"line-width":l.borderWidth,"line-offset":3},layout:{visibility:p()},filter:["==","bufferType","main"],metadata:{mbLayerId:l.id}}),_.addLayer({id:u.CIRCLE_BACKGROUND,type:"fill",source:g,paint:{"fill-color":l.backgroundColor,"fill-opacity":l.backgroundOpacity},layout:{visibility:p()},filter:["==","bufferType","main"],metadata:{mbLayerId:l.id}}),_.addLayer({id:u.RESIZER,type:"symbol",source:g,layout:{visibility:p(l.resizable),"icon-image":"BufferCircleResizerSVG","icon-size":1,"icon-offset":[2,2],"icon-allow-overlap":!0},filter:["==","bufferType","resizer"],metadata:{mbLayerId:l.id}}),_.addLayer({id:u.CENTER_POINT,type:"symbol",source:g,layout:{visibility:p(),"icon-image":"BufferCircleCenterSVG","icon-size":1,"icon-allow-overlap":!0},filter:["==","bufferType","center"],metadata:{mbLayerId:l.id}}),_.addLayer({id:u.CLOSE_BUTTON,type:"symbol",source:g,layout:{visibility:p(l.closable),"icon-image":b,"icon-size":l.closeSize,"icon-offset":l.closeOffset,"icon-allow-overlap":!0},filter:["==","bufferType","close"],metadata:{mbLayerId:l.id}}),_.addLayer({id:u.DISTANCE_COUNTER,type:"symbol",source:g,paint:{"text-color":l.textColor},layout:{visibility:p(l.countable),"text-font":l.textFonts,"text-size":l.textSize,"text-field":["get","text"],"text-allow-overlap":!0,"text-offset":[2,0]},filter:["==","bufferType","counter"],metadata:{mbLayerId:l.id}}))},le=G=>{window.requestAnimationFrame(()=>{ve(J(G))})},fe=G=>{E=G,le(E)},re=()=>{_=de(),h=l.radius,v(),L=_.getCanvasContainer(),P(),fe(l.center)},{getMapboxInstance:de}=He(re);lo(de,u,l),ue(()=>l.center,(G,ie)=>{(G==null?void 0:G.join())!==(ie==null?void 0:ie.join())&&(E=G,le(E))}),ue(()=>l.radius,G=>{N=G,h=G,le(E)}),ue(()=>l.visible,()=>{w()});const be=()=>{me(),F(),Ne(),O(),_=null},me=()=>{Object.keys(u).forEach(G=>{_.getLayer(u[G])&&_.removeLayer(u[G])})},F=()=>{_.removeSource(g)},Ne=()=>{I.value.forEach(G=>{_.hasImage(G.name)&&_.removeImage(G.name)})};return it(()=>{be()}),(G,ie)=>(Se(),Me(ce(ui),{images:I.value,class:"mb-buffer-circle-layer"},null,8,["images"]))}}),ph=Ae(gh),yh={...oo},mh=uo,vh={name:"MbBufferCircleLayerV2"},_h=Te({...vh,props:yh,emits:mh,setup(c,{emit:f}){const l=c,y=f,{getVisibility:p}=Tt(l),b="circle-v2-close",I=tt(Ai(Li(b),l.closeIconUrl));let h,N=0,E=l.radius,S=[],_=[],L,k=!1,A,t=!1,a=!1;const{BUFFER_CIRCLE_LAYER:u,BUFFER_CIRCLE_SOURCE:g}=ho(),v=()=>{I.value.push(mt("BufferCircleCenterSVG",l.centerColor,l.centerRadius),mt("BufferCircleResizerSVG",l.resizerColor,l.resizerRadius))},w=()=>{Object.keys(u).forEach(B=>{h.getLayer(u[B])&&h.setLayoutProperty(u[B],"visibility",p(l[Ti[B]]))})},T=(B,ne,pe)=>{typeof ne=="string"?(h.on(B,ne,pe),_.push({event:B,target:ne,handler:pe})):(h.on(B,ne),_.push({event:B,handler:ne}))},O=()=>{_.forEach(B=>{B.target?h.off(B.event,B.target,B.handler):h.off(B.event,B.handler)}),_=[]},P=()=>{T("mouseenter",u.CIRCLE_BACKGROUND,D),T("mouseleave",u.CIRCLE_BACKGROUND,z),T("mousedown",u.CIRCLE_BACKGROUND,W),T("touchstart",u.CIRCLE_BACKGROUND,Y),T("mouseenter",u.RESIZER,j),T("mouseleave",u.RESIZER,$),T("mousedown",u.RESIZER,X),T("touchstart",u.RESIZER,oe),T("click",u.CLOSE_BUTTON,B=>{y("close",B)})},D=()=>{L.style.cursor="move",k=!0,h.dragPan.disable(),y("mouseenter")},z=()=>{L.style.cursor="",k=!1,h.dragPan.enable(),y("mouseleave")},j=()=>{L.style.cursor="nwse-resize",k=!0,h.dragPan.disable(),y("mouseenter")},$=B=>{ni([B.lngLat.lng,B.lngLat.lat],S)>N?(L.style.cursor="",k=!1,h.dragPan.enable(),y("mouseleave")):D()},X=B=>{k&&(A=B.lngLat,t=!0,a=!1,L.style.cursor="nwse-resize",T("mousemove",Z),h.once("mouseup",ee))},oe=B=>{B.points.length===1&&(B.preventDefault(),A=B.lngLat,t=!0,a=!1,T("touchmove",Z),h.once("touchend",ne=>{ee(),h.dragPan.enable()}))},W=B=>{!k||!l.draggable||(A=B.lngLat,a=!0,t=!1,L.style.cursor="grab",T("mousemove",V),h.once("mouseup",Q))},Y=B=>{B.points.length!==1||!l.draggable||(B.preventDefault(),A=B.lngLat,a=!0,t=!1,T("touchmove",V),h.once("touchend",ne=>{Q(),h.dragPan.enable()}))},Z=B=>{if(!t)return;L.style.cursor="nwse-resize";const ne=B.lngLat.lat-A.lat,pe=ni(st([A.lng,A.lat]),st([B.lngLat.lng,B.lngLat.lat]),ze);A={lng:B.lngLat.lng,lat:B.lngLat.lat},N+=pe*(ne>0?1:-1),E=Math.abs(+N.toFixed(1)),be(S)},ee=()=>{t&&(L.style.cursor="",t=!1,y("update",{center:S,radius:E}),h.off("mousemove",Z),h.off("touchmove",Z))},V=B=>{if(!a)return;L.style.cursor="grabbing";const ne=B.lngLat.lng-A.lng,pe=B.lngLat.lat-A.lat;A={lng:B.lngLat.lng,lat:B.lngLat.lat},me([S[0]+ne,S[1]+pe])},Q=()=>{a&&(L.style.cursor="",a=!1,h.off("mousemove",u.CIRCLE_BACKGROUND,V),h.off("touchmove",u.CIRCLE_BACKGROUND,V),y("update",{center:S,radius:E}))},J=B=>{const ne=We(B,N,0),pe=h.project(B),Ie=h.project(ne.geometry.coordinates),Ce=Math.sqrt((Ie.y-pe.y)**2+(Ie.x-pe.x)**2);return{center:ne,centerPx:pe,targetPx:Ie,radiusPx:Ce}},ve=B=>{const{centerPx:ne,radiusPx:pe}=J(B),Ie=le(ne.x,ne.y,pe,360/ze.steps).map(te=>h.unproject(te)),Ce=[];return Ie.forEach(te=>{Ce.push([te.lng,te.lat])}),Ce.push([...Ce[0]]),Ce},le=(B,ne,pe,Ie)=>{const Ce=[];let te=0;for(;te<360;){const Je=fe(B,ne,pe,te);Ce.push(Je),te+=Ie}return Ce},fe=(B,ne,pe,Ie)=>{const Ce=Ie*(Math.PI/180),te=B+pe*Math.cos(Ce),Je=ne+pe*Math.sin(Ce);return[te,Je]},re=B=>{const{centerPx:ne,radiusPx:pe}=J(B),Ie=h.unproject(fe(ne.x,ne.y,pe,315)),Ce=[Ie.lng,Ie.lat],te=h.unproject(fe(ne.x,ne.y,pe,0)),Je=[te.lng,te.lat],ht=h.unproject(fe(ne.x,ne.y,pe,225)),Qe=[ht.lng,ht.lat],et={type:"Feature",properties:{bufferType:"main"},geometry:{type:"Polygon",coordinates:[ve(B)]}},ge={type:"Feature",properties:{bufferType:"close"},geometry:{type:"Point",coordinates:Ce}},Ve={type:"Feature",properties:{bufferType:"resizer"},geometry:{type:"Point",coordinates:Qe}},Ht={type:"Feature",properties:{bufferType:"center"},geometry:{type:"Point",coordinates:B}},Zt={type:"Feature",properties:{bufferType:"counter",text:l.formatter?l.formatter(E):`${E}km`},geometry:{type:"Point",coordinates:Je}};return{circleMain:et,circleCenter:Ht,circleResizer:Ve,closeButton:ge,counter:Zt}},de=({circleMain:B,circleCenter:ne,circleResizer:pe,closeButton:Ie,counter:Ce})=>{h.getSource(g)?h.getSource(g).setData({type:"FeatureCollection",features:[B,ne,pe,Ie,Ce]}):(h.addSource(g,{type:"geojson",data:{type:"FeatureCollection",features:[B,ne,pe,Ie,Ce]}}),h.addLayer({id:u.CIRCLE_BORDER,type:"line",source:g,paint:{"line-color":l.borderColor,"line-opacity":l.borderOpacity,"line-width":l.borderWidth,"line-offset":3},layout:{visibility:p()},filter:["==","bufferType","main"],metadata:{mbLayerId:l.id}}),h.addLayer({id:u.CIRCLE_BACKGROUND,type:"fill",source:g,paint:{"fill-color":l.backgroundColor,"fill-opacity":l.backgroundOpacity},layout:{visibility:p()},filter:["==","bufferType","main"],metadata:{mbLayerId:l.id}}),h.addLayer({id:u.RESIZER,type:"symbol",source:g,layout:{visibility:p(l.resizable),"icon-image":"BufferCircleResizerSVG","icon-size":1,"icon-offset":[2,2],"icon-allow-overlap":!0},filter:["==","bufferType","resizer"],metadata:{mbLayerId:l.id}}),h.addLayer({id:u.CENTER_POINT,type:"symbol",source:g,layout:{visibility:p(),"icon-image":"BufferCircleCenterSVG","icon-size":1,"icon-allow-overlap":!0},filter:["==","bufferType","center"],metadata:{mbLayerId:l.id}}),h.addLayer({id:u.CLOSE_BUTTON,type:"symbol",source:g,layout:{visibility:p(l.closable),"icon-image":b,"icon-size":l.closeSize,"icon-offset":l.closeOffset,"icon-allow-overlap":!0},filter:["==","bufferType","close"],metadata:{mbLayerId:l.id}}),h.addLayer({id:u.DISTANCE_COUNTER,type:"symbol",source:g,paint:{"text-color":l.textColor},layout:{visibility:p(l.countable),"text-font":l.textFonts,"text-size":l.textSize,"text-field":["get","text"],"text-allow-overlap":!0,"text-offset":[2,0]},filter:["==","bufferType","counter"],metadata:{mbLayerId:l.id}}))},be=B=>{window.requestAnimationFrame(()=>{de(re(B))})},me=B=>{S=B,be(S)},F=()=>{h=Ne(),N=l.radius,v(),L=h.getCanvasContainer(),P(),me(l.center)},{getMapboxInstance:Ne}=He(F);lo(Ne,u,l),ue(()=>l.center,(B,ne)=>{(B==null?void 0:B.join())!==(ne==null?void 0:ne.join())&&(S=B,be(S))}),ue(()=>l.radius,B=>{E=B,N=B,be(S)}),ue(()=>l.visible,()=>{w()});const G=()=>{ie(),U(),H(),O(),h=null},ie=()=>{Object.keys(u).forEach(B=>{h.getLayer(u[B])&&h.removeLayer(u[B])})},U=()=>{h.removeSource(g)},H=()=>{I.value.forEach(B=>{h.hasImage(B.name)&&h.removeImage(B.name)})};return it(()=>{G()}),(B,ne)=>(Se(),Me(ce(ui),{images:I.value,class:"mb-buffer-circle-layer-v2"},null,8,["images"]))}}),xh=Ae(_h),Eh={...Ki,xSemiAxis:{type:Number,default:5},ySemiAxis:{type:Number,default:10},angle:{type:Number,default:0},closeOffset:{type:Array,default:[40,-25]}},bh={...Ji,update:({center:c,xSemiAxis:f,ySemiAxis:l,angle:y})=>Array.isArray(c)&&typeof f=="number"&&typeof l=="number"&&typeof y=="number"};function Sh(c,f,l){const{getVisibility:y}=Tt(l);ue(()=>[l.borderColor,l.borderOpacity,l.borderWidth],()=>{c().getLayer(f.ELLIPSE_BORDER)&&Object.entries({"line-color":l.borderColor,"line-opacity":l.borderOpacity,"line-width":l.borderWidth}).forEach(p=>{c().setPaintProperty(f.ELLIPSE_BORDER,p[0],p[1])})}),ue(()=>[l.backgroundColor,l.backgroundOpacity],()=>{c().getLayer(f.ELLIPSE_BACKGROUND)&&Object.entries({"fill-color":l.backgroundColor,"fill-opacity":l.backgroundOpacity}).forEach(p=>{c().setPaintProperty(f.ELLIPSE_BACKGROUND,p[0],p[1])})}),ue(()=>l.resizable,()=>{c().getLayer(f.RESIZER)&&c().setLayoutProperty(f.RESIZER,"visibility",y(l.resizable))}),ue(()=>l.rotatable,()=>{c().getLayer(f.ROTATER)&&c().setLayoutProperty(f.ROTATER,"visibility",y(l.rotatable))}),ue(()=>l.closable,()=>{c().getLayer(f.CLOSE_BUTTON)&&c().setLayoutProperty(f.CLOSE_BUTTON,"visibility",y(l.closable))}),ue(()=>[l.closeSize,l.closeOffset],()=>{c().getLayer(f.CLOSE_BUTTON)&&Object.entries({"icon-size":l.closeSize,"icon-offset":l.closeOffset}).forEach(p=>{c().setLayoutProperty(f.CLOSE_BUTTON,p[0],p[1])})}),ue(()=>l.countable,()=>{c().getLayer(f.DISTANCE_COUNTER)&&c().setLayoutProperty(f.DISTANCE_COUNTER,"visibility",y(l.countable))}),ue(()=>[l.textFonts,l.textSize],()=>{c().getLayer(f.DISTANCE_COUNTER)&&Object.entries({"text-font":l.textFonts,"text-size":l.textSize}).forEach(p=>{c().setLayoutProperty(f.DISTANCE_COUNTER,p[0],p[1])})}),ue(()=>[l.textColor],()=>{c().getLayer(f.DISTANCE_COUNTER)&&Object.entries({"text-color":l.textColor}).forEach(p=>{c().setPaintProperty(f.DISTANCE_COUNTER,p[0],p[1])})})}const Ih={steps:512,units:"kilometers"},wh={ELLIPSE_BORDER:"ellipse-buffer-main-layer",ELLIPSE_BACKGROUND:"ellipse-buffer-main-bg-layer",RESIZER:"ellipse-buffer-resizer-layer",ROTATER:"ellipse-buffer-rotater-layer",CENTER_POINT:"ellipse-buffer-center-layer",CLOSE_BUTTON:"ellipse-buffer-close-button",DISTANCE_COUNTER:"ellipse-buffer-distance-counter"},kh="ellipse-buffer-source",Ch=()=>{const c={...wh};Object.keys(c).forEach(l=>{c[l]+=`-${De()}`});const f=`${kh}-${De()}`;return{BUFFER_ELLIPSE_LAYER:c,BUFFER_ELLIPSE_SOURCE:f}},sa={0:{name:"xResizer","icon-offset":[2,0],icon:"BufferEllipseResizerSVG"},1:{name:"yResizer","icon-offset":[0,2],icon:"BufferEllipseResizerSVG"},2:{name:"rotater","icon-offset":[-2,0],icon:"BufferEllipseRotaterSVG"}},ir=c=>({xResizer:"ew-resize",yResizer:"ns-resize",rotater:"ns-resize"})[c],aa=c=>c.features[0].properties.name,oa=c=>c*Math.PI/180,Nh=c=>c/Math.PI*180,ji=c=>c*c,Lh=(c,f)=>l=>Math.sqrt(ji(f)*(1-ji(l)/ji(c))),Th={name:"MbBufferEllipseLayer"},Ah=Te({...Th,props:Eh,emits:bh,setup(c,{emit:f}){const l=c,y=f,{getVisibility:p}=Tt(l),b="ellipse-close",I=tt(Ai(Li(b),l.closeIconUrl));let h=l.xSemiAxis,N=l.ySemiAxis,E=l.angle,S=[],_=[],L,k,A=!1,t,a=!1,u=!1,g,v;const{BUFFER_ELLIPSE_LAYER:w,BUFFER_ELLIPSE_SOURCE:T}=Ch(),O=()=>{I.value.push(mt("BufferEllipseCenterSVG",l.centerColor,l.centerRadius),mt("BufferEllipseResizerSVG",l.resizerColor,l.resizerRadius),mt("BufferEllipseRotaterSVG",l.rotaterColor,l.resizerRadius))},P=()=>{Object.keys(w).forEach(H=>{L.getLayer(w[H])&&L.setLayoutProperty(w[H],"visibility",p(l[Ti[H]]))})},D=(H,B,ne)=>{typeof B=="string"?(L.on(H,B,ne),_.push({event:H,target:B,handler:ne})):(L.on(H,B),_.push({event:H,handler:B}))},z=()=>{_.forEach(H=>{H.target?L.off(H.event,H.target,H.handler):L.off(H.event,H.handler)}),_=[]},j=()=>{D("mouseenter",w.ELLIPSE_BACKGROUND,X),D("mouseleave",w.ELLIPSE_BACKGROUND,oe),D("mousedown",w.ELLIPSE_BACKGROUND,Q),D("mouseenter",w.RESIZER,W),D("mouseleave",w.RESIZER,Y),D("mousedown",w.RESIZER,Z),D("mouseenter",w.ROTATER,W),D("mouseleave",w.ROTATER,Y),D("mousedown",w.ROTATER,Z),D("click",w.CLOSE_BUTTON,H=>{y("close",H)})},$=()=>({center:S,xSemiAxis:h,ySemiAxis:N,angle:E}),X=()=>{k.style.cursor="move",A=!0,L.dragPan.disable(),y("mouseenter")},oe=()=>{k.style.cursor="",A=!1,L.dragPan.enable(),y("mouseleave")},W=H=>{g=aa(H),k.style.cursor=ir(aa(H)),A=!0,L.dragPan.disable(),y("mouseenter")},Y=H=>{const B=[H.lngLat.lng,H.lngLat.lat];Dr(B,v)?X():(k.style.cursor="",A=!1,L.dragPan.enable(),y("mouseleave"))},Z=H=>{A&&(t=H.lngLat,a=!0,u=!1,k.style.cursor=ir(g),D("mousemove",ee),L.once("mouseup",V))},ee=H=>{if(!a)return;k.style.cursor=ir(g);const B=ni(st([H.lngLat.lng,H.lngLat.lat]),st(S),ze),ne=Sn(S,[H.lngLat.lng,H.lngLat.lat])-90-E;({xResizer:()=>{h=B*Math.abs(Math.cos(oa(ne)))},yResizer:()=>{N=B*Math.abs(Math.sin(oa(ne)))},rotater:()=>{E=Sn(S,[H.lngLat.lng,H.lngLat.lat])-90}})[g](),de(S)},V=()=>{a&&(k.style.cursor="",a=!1,y("update",$()),L.off("mousemove",ee))},Q=H=>{!A||!l.draggable||(t=H.lngLat,u=!0,a=!1,k.style.cursor="grab",D("mousemove",J),L.once("mouseup",ve))},J=H=>{if(!u)return;k.style.cursor="grabbing";const B=H.lngLat.lng-t.lng,ne=H.lngLat.lat-t.lat;t={lng:H.lngLat.lng,lat:H.lngLat.lat},be([S[0]+B,S[1]+ne])},ve=()=>{u&&(k.style.cursor="",u=!1,L.off("mousemove",w.ELLIPSE_BACKGROUND,J),y("update",$()))},le=H=>{const B=h/2,ne=Lh(h,N)(B),pe=Math.sqrt(ji(B)+ji(ne)),Ie=Nh(Math.atan(B/ne));return We(H,pe,Ie+E,ze).geometry.coordinates},fe=H=>{const B=st([...H]),ne=Kl(B,h,N,{...Ih,angle:E,properties:{bufferType:"main"}});v=ne;const pe=We(B,h,-90+E,ze),Ie=We(B,N,E,ze),Ce=We(B,h,90+E,ze),te=We(B,h,90+E,ze).geometry.coordinates,Je=(Ln(ne)/1e3/1e3).toFixed(2),ht=le(B),Qe={type:"Feature",properties:{bufferType:"close"},geometry:{type:"Point",coordinates:ht}},et=[pe,Ie].map((Zt,xe)=>({type:"Feature",properties:{bufferType:"resizer",...sa[xe]},geometry:{type:"Point",coordinates:[...Zt.geometry.coordinates]}})),ge={type:"Feature",properties:{bufferType:"rotater",...sa[2]},geometry:{type:"Point",coordinates:[...Ce.geometry.coordinates]}},Ve={type:"Feature",properties:{bufferType:"center"},geometry:{type:"Point",coordinates:H}},Ht={type:"Feature",properties:{bufferType:"counter",text:l.formatter?l.formatter(Je,h,N):`${Je} km2`},geometry:{type:"Point",coordinates:te}};return{ellipseMain:ne,ellipseCenter:Ve,ellipseResizer:et,ellipseRotater:ge,closeButton:Qe,counter:Ht}},re=({ellipseMain:H,ellipseCenter:B,ellipseResizer:ne,ellipseRotater:pe,closeButton:Ie,counter:Ce})=>{L.getSource(T)?L.getSource(T).setData({type:"FeatureCollection",features:[H,B,...ne,pe,Ie,Ce]}):(L.addSource(T,{type:"geojson",data:{type:"FeatureCollection",features:[H,B,...ne,pe,Ie,Ce]}}),L.addLayer({id:w.ELLIPSE_BORDER,type:"line",source:T,paint:{"line-color":l.borderColor,"line-opacity":l.borderOpacity,"line-width":l.borderWidth,"line-offset":3},layout:{visibility:p()},filter:["==","bufferType","main"],metadata:{mbLayerId:l.id}}),L.addLayer({id:w.ELLIPSE_BACKGROUND,type:"fill",source:T,paint:{"fill-color":l.backgroundColor,"fill-opacity":l.backgroundOpacity},layout:{visibility:p()},filter:["==","bufferType","main"],metadata:{mbLayerId:l.id}}),L.addLayer({id:w.RESIZER,type:"symbol",source:T,layout:{visibility:p(l.resizable),"icon-image":["get","icon"],"icon-size":1,"icon-offset":["get","icon-offset"],"icon-allow-overlap":!0},filter:["==","bufferType","resizer"],metadata:{mbLayerId:l.id}}),L.addLayer({id:w.ROTATER,type:"symbol",source:T,layout:{visibility:p(l.rotatable),"icon-image":["get","icon"],"icon-size":1,"icon-offset":["get","icon-offset"],"icon-allow-overlap":!0},filter:["==","bufferType","rotater"],metadata:{mbLayerId:l.id}}),L.addLayer({id:w.CENTER_POINT,type:"symbol",source:T,layout:{visibility:p(),"icon-image":"BufferEllipseCenterSVG","icon-size":1,"icon-allow-overlap":!0},filter:["==","bufferType","center"],metadata:{mbLayerId:l.id}}),L.addLayer({id:w.CLOSE_BUTTON,type:"symbol",source:T,layout:{visibility:p(l.closable),"icon-image":b,"icon-size":l.closeSize,"icon-offset":l.closeOffset,"icon-allow-overlap":!0},filter:["==","bufferType","close"],metadata:{mbLayerId:l.id}}),L.addLayer({id:w.DISTANCE_COUNTER,type:"symbol",source:T,paint:{"text-color":l.textColor},layout:{visibility:p(l.countable),"text-font":l.textFonts,"text-size":l.textSize,"text-field":["get","text"],"text-allow-overlap":!0,"text-offset":[3,0]},filter:["==","bufferType","counter"],metadata:{mbLayerId:l.id}}))},de=H=>{window.requestAnimationFrame(()=>{re(fe(H||l.center))})},be=H=>{S=H,de(S)},me=()=>{L=F(),k=L.getCanvasContainer(),O(),j(),be(l.center)},{getMapboxInstance:F}=He(me);Sh(F,w,l),ue(()=>l.center,(H,B)=>{(H==null?void 0:H.join())!==(B==null?void 0:B.join())&&(S=H,de(S))}),ue(()=>l.xSemiAxis,H=>{h=H,de(S)}),ue(()=>l.ySemiAxis,H=>{N=H,de(S)}),ue(()=>l.angle,H=>{E=H,de(S)}),ue(()=>l.visible,()=>{P()});const Ne=()=>{G(),ie(),U(),z(),L=null},G=()=>{Object.keys(w).forEach(H=>{L.getLayer(w[H])&&L.removeLayer(w[H])})},ie=()=>{L.removeSource(T)},U=()=>{I.value.forEach(H=>{L.hasImage(H.name)&&L.removeImage(H.name)})};return it(()=>{Ne()}),(H,B)=>(Se(),Me(ce(ui),{images:I.value,class:"mb-buffer-ellipse-layer"},null,8,["images"]))}}),Rh=Ae(Ah),Oh={...Ki,lineString:{type:Array,default:()=>[]},closeOffset:{type:Array,default:[65,-20]}},Uh={...Ji,complete:({polygon:c,lineString:f})=>Array.isArray(f),update:({polygon:c,lineString:f})=>Array.isArray(f)};function Ph(c,f,l){const{getVisibility:y}=Tt(l);ue(()=>[l.borderColor,l.borderOpacity,l.borderWidth],()=>{c().getLayer(f.LINE_BORDER)&&Object.entries({"line-color":l.borderColor,"line-opacity":l.borderOpacity,"line-width":l.borderWidth}).forEach(p=>{c().setPaintProperty(f.LINE_BORDER,p[0],p[1])})}),ue(()=>[l.backgroundColor,l.backgroundOpacity],()=>{c().getLayer(f.LINE_BACKGROUND)&&Object.entries({"fill-color":l.backgroundColor,"fill-opacity":l.backgroundOpacity}).forEach(p=>{c().setPaintProperty(f.LINE_BACKGROUND,p[0],p[1])})}),ue(()=>l.resizable,()=>{c().getLayer(f.RESIZER)&&c().setLayoutProperty(f.RESIZER,"visibility",y(l.resizable))}),ue(()=>l.closable,()=>{c().getLayer(f.CLOSE_BUTTON)&&c().setLayoutProperty(f.CLOSE_BUTTON,"visibility",y(l.closable))}),ue(()=>[l.closeSize,l.closeOffset],()=>{c().getLayer(f.CLOSE_BUTTON)&&Object.entries({"icon-size":l.closeSize,"icon-offset":l.closeOffset}).forEach(p=>{c().setLayoutProperty(f.CLOSE_BUTTON,p[0],p[1])})}),ue(()=>l.countable,()=>{c().getLayer(f.DISTANCE_COUNTER)&&c().setLayoutProperty(f.DISTANCE_COUNTER,"visibility",y(l.countable))}),ue(()=>[l.textFonts,l.textSize],()=>{c().getLayer(f.DISTANCE_COUNTER)&&Object.entries({"text-font":l.textFonts,"text-size":l.textSize}).forEach(p=>{c().setLayoutProperty(f.DISTANCE_COUNTER,p[0],p[1])})}),ue(()=>[l.textColor],()=>{c().getLayer(f.DISTANCE_COUNTER)&&Object.entries({"text-color":l.textColor}).forEach(p=>{c().setPaintProperty(f.DISTANCE_COUNTER,p[0],p[1])})})}const Mh={LINE_BORDER:"line-buffer-main-layer",LINE_BACKGROUND:"line-buffer-main-bg-layer",RESIZER:"line-buffer-resizer-layer",CENTER_POINT:"line-buffer-center-layer",CLOSE_BUTTON:"line-buffer-close-button",DISTANCE_COUNTER:"line-buffer-distance-counter"},Bh="line-buffer-source",Dh=()=>{const c={...Mh};Object.keys(c).forEach(l=>{c[l]+=`-${De()}`});const f=`${Bh}-${De()}`;return{BUFFER_LINE_LAYER:c,BUFFER_LINE_SOURCE:f}},Fh={name:"MbBufferLineLayer"},zh=Te({...Fh,props:Oh,emits:Uh,setup(c,{emit:f}){const l=c,y=f,{getVisibility:p}=Tt(l),b="line-close",I=tt(Ai(Li(b),l.closeIconUrl)),h=tt(l.manual?[]:JSON.parse(JSON.stringify(l.lineString)));let N,E,S=[],_,L,k=!1,A,t=!1,a=!1,u="";const{BUFFER_LINE_LAYER:g,BUFFER_LINE_SOURCE:v}=Dh(),w=()=>{I.value.push(mt("BufferLineResizerSVG",l.resizerColor,l.resizerRadius))},T=()=>{Object.keys(g).forEach(B=>{_.getLayer(g[B])&&_.setLayoutProperty(g[B],"visibility",p(l[Ti[B]]))})},O=(B,ne,pe)=>{typeof ne=="string"?(_.on(B,ne,pe),S.push({event:B,target:ne,handler:pe})):(_.on(B,ne),S.push({event:B,handler:ne}))},P=()=>{S.forEach(B=>{B.target?_.off(B.event,B.target,B.handler):_.off(B.event,B.handler)}),S=[],j()},D=()=>{O("mouseenter",g.LINE_BACKGROUND,W),O("mouseleave",g.LINE_BACKGROUND,Y),O("mousedown",g.LINE_BACKGROUND,ve),O("mouseenter",g.RESIZER,Z),O("mouseleave",g.RESIZER,ee),O("mousedown",g.RESIZER,V),O("click",g.CLOSE_BUTTON,B=>{y("close",B)}),z()},z=()=>{E={},l.manual&&(_.on("click",$),_.on("dblclick",X),document.addEventListener("keydown",oe))},j=()=>{_.off("click",$),_.off("dblclick",X),document.removeEventListener("keydown",oe)},$=B=>{if(B.preventDefault(),B.originalEvent.cancelBubble=!0,E.x!==B.point.x||E.y!==B.point.y){const{lng:ne,lat:pe}=B.lngLat;h.value.push([ne,pe]),h.value.length===1?h.value.push(h.value[0]):h.value.length>2&&h.value[0]===h.value[1]&&h.value.splice(1,1),me()}E=B.point},X=B=>{B.preventDefault(),B.originalEvent&&(B.originalEvent.cancelBubble=!0),j(),y("complete",{lineString:h.value,polygon:N})},oe=B=>{const ne=B.keyCode;ne===27||ne===8||ne===46?(h.value.length>2?h.value.splice(-1,1):h.value.length===2&&(h.value[0]!==h.value[1]?h.value.splice(1,1,h.value[0]):h.value.splice(0,2)),me()):ne===13&&X(B)},W=()=>{L.style.cursor="move",k=!0,_.dragPan.disable(),y("mouseenter")},Y=()=>{L.style.cursor="",k=!1,_.dragPan.enable(),y("mouseleave")},Z=B=>{u=B.features[0].properties.idx,L.style.cursor="move",k=!0,_.dragPan.disable(),y("mouseenter")},ee=B=>{if(!N)return;const ne=st([B.lngLat.lng,B.lngLat.lat]);Dr(ne,N)?(L.style.cursor="",k=!1,_.dragPan.enable(),y("mouseleave")):W()},V=B=>{k&&(A=B.lngLat,t=!0,a=!1,L.style.cursor="move",O("mousemove",Q),_.once("mouseup",J))},Q=B=>{if(!t)return;L.style.cursor="move";const ne=+u;h.value.splice(ne,1,[B.lngLat.lng,B.lngLat.lat]),A={lng:B.lngLat.lng,lat:B.lngLat.lat},be()},J=B=>{t&&(L.style.cursor="",t=!1,y("update",{lineString:h.value,polygon:N}),_.off("mousemove",Q))},ve=B=>{!k||!l.draggable||(A=B.lngLat,a=!0,t=!1,L.style.cursor="grab",O("mousemove",le),_.once("mouseup",fe))},le=B=>{if(!a)return;L.style.cursor="grabbing";const ne=B.lngLat.lng-A.lng,pe=B.lngLat.lat-A.lat;A={lng:B.lngLat.lng,lat:B.lngLat.lat},h.value.forEach(Ie=>{Ie[0]+=ne,Ie[1]+=pe}),me()},fe=B=>{a&&(L.style.cursor="",a=!1,_.off("mousemove",g.LINE_BACKGROUND,le),y("update",{lineString:h.value,polygon:N}))},re=()=>{const B=h.value.reduce((et,ge)=>ge[0]>et[0]?ge:et,[-Number.MAX_SAFE_INTEGER,0]),ne=h.value.reduce((et,ge)=>ge[1]>et[1]?ge:et,[0,-Number.MAX_SAFE_INTEGER]),pe=We(ne,0,0,ze).geometry.coordinates,Ie=We(B,0,0,ze).geometry.coordinates,Ce={type:"Feature",properties:{bufferType:"main"},geometry:{type:"LineString",coordinates:h.value}};let te="";h.value.length?(N=Gl(JSON.parse(JSON.stringify(Ce)),l.radius,ze),N.properties.bufferType="buffer",te=(Ln(N)/1e3/1e3).toFixed(2)):N=void 0;const Je={type:"Feature",properties:{bufferType:"close"},geometry:{type:"Point",coordinates:pe}},ht=h.value.map((et,ge)=>({type:"Feature",properties:{bufferType:"resizer",idx:`${ge}`},geometry:{type:"Point",coordinates:[...et]}})),Qe={type:"Feature",properties:{bufferType:"counter",text:l.formatter?l.formatter(te):`${te} km2`},geometry:{type:"Point",coordinates:Ie}};return{lineMain:Ce,bufferMain:N,resizers:ht,closeButton:Je,counter:Qe}},de=({lineMain:B,bufferMain:ne,resizers:pe,closeButton:Ie,counter:Ce})=>{_.getSource(v)?_.getSource(v).setData({type:"FeatureCollection",features:[B,ne,...pe,Ie,Ce].filter(te=>!!te)}):(_.addSource(v,{type:"geojson",data:{type:"FeatureCollection",features:[B,ne,...pe,Ie,Ce].filter(te=>!!te)}}),_.addLayer({id:g.LINE_BORDER,type:"line",source:v,paint:{"line-color":l.borderColor,"line-opacity":l.borderOpacity,"line-width":l.borderWidth,"line-offset":3},layout:{visibility:p()},filter:["==","bufferType","main"],metadata:{mbLayerId:l.id}}),_.addLayer({id:g.LINE_BACKGROUND,type:"fill",source:v,paint:{"fill-color":l.backgroundColor,"fill-opacity":l.backgroundOpacity},layout:{visibility:p()},filter:["==","bufferType","buffer"],metadata:{mbLayerId:l.id}}),_.addLayer({id:g.RESIZER,type:"symbol",source:v,layout:{visibility:p(l.resizable),"icon-image":"BufferLineResizerSVG","icon-size":1,"icon-offset":["get","offset"],"icon-allow-overlap":!0},filter:["==","bufferType","resizer"],metadata:{mbLayerId:l.id}}),_.addLayer({id:g.CLOSE_BUTTON,type:"symbol",source:v,layout:{visibility:p(l.closable),"icon-image":b,"icon-size":l.closeSize,"icon-offset":l.closeOffset,"icon-allow-overlap":!0},filter:["==","bufferType","close"],metadata:{mbLayerId:l.id}}),_.addLayer({id:g.DISTANCE_COUNTER,type:"symbol",source:v,paint:{"text-color":l.textColor},layout:{visibility:p(l.countable),"text-font":l.textFonts,"text-size":l.textSize,"text-field":["get","text"],"text-allow-overlap":!0,"text-offset":[3.5,0]},filter:["==","bufferType","counter"],metadata:{mbLayerId:l.id}}))},be=()=>{window.requestAnimationFrame(()=>{de(re())})},me=()=>{be()},F=()=>{_=Ne(),L=_.getCanvasContainer(),w(),D(),me()},{getMapboxInstance:Ne}=He(F);Ph(Ne,g,l),ue(()=>l.lineString,B=>{h.value=JSON.parse(JSON.stringify(B)),be()},{deep:!0}),ue(()=>l.visible,()=>{T()});const G=()=>{ie(),U(),H(),P(),_=null},ie=()=>{Object.keys(g).forEach(B=>{_.getLayer(g[B])&&_.removeLayer(g[B])})},U=()=>{_.removeSource(v)},H=()=>{I.value.forEach(B=>{_.hasImage(B.name)&&_.removeImage(B.name)})};return it(()=>{G()}),(B,ne)=>(Se(),Me(ce(ui),{images:I.value,class:"mb-buffer-line-layer"},null,8,["images"]))}}),Gh=Ae(zh),qh={...Ki,polygon:{type:Array,default:()=>[]},closeOffset:{type:Array,default:[65,-20]}},Yh={...Ji,complete:({polygon:c})=>Array.isArray(c),update:({polygon:c})=>Array.isArray(c)};function $h(c,f,l){const{getVisibility:y}=Tt(l);ue(()=>[l.borderColor,l.borderOpacity,l.borderWidth],()=>{c().getLayer(f.POLYGON_BORDER)&&Object.entries({"line-color":l.borderColor,"line-opacity":l.borderOpacity,"line-width":l.borderWidth}).forEach(p=>{c().setPaintProperty(f.POLYGON_BORDER,p[0],p[1])})}),ue(()=>[l.backgroundColor,l.backgroundOpacity],()=>{c().getLayer(f.POLYGON_BACKGROUND)&&Object.entries({"fill-color":l.backgroundColor,"fill-opacity":l.backgroundOpacity}).forEach(p=>{c().setPaintProperty(f.POLYGON_BACKGROUND,p[0],p[1])})}),ue(()=>l.resizable,()=>{c().getLayer(f.RESIZER)&&c().setLayoutProperty(f.RESIZER,"visibility",y(l.resizable))}),ue(()=>l.closable,()=>{c().getLayer(f.CLOSE_BUTTON)&&c().setLayoutProperty(f.CLOSE_BUTTON,"visibility",y(l.closable))}),ue(()=>[l.closeSize,l.closeOffset],()=>{c().getLayer(f.CLOSE_BUTTON)&&Object.entries({"icon-size":l.closeSize,"icon-offset":l.closeOffset}).forEach(p=>{c().setLayoutProperty(f.CLOSE_BUTTON,p[0],p[1])})}),ue(()=>l.countable,()=>{c().getLayer(f.DISTANCE_COUNTER)&&c().setLayoutProperty(f.DISTANCE_COUNTER,"visibility",y(l.countable))}),ue(()=>[l.textFonts,l.textSize],()=>{c().getLayer(f.DISTANCE_COUNTER)&&Object.entries({"text-font":l.textFonts,"text-size":l.textSize}).forEach(p=>{c().setLayoutProperty(f.DISTANCE_COUNTER,p[0],p[1])})}),ue(()=>[l.textColor],()=>{c().getLayer(f.DISTANCE_COUNTER)&&Object.entries({"text-color":l.textColor}).forEach(p=>{c().setPaintProperty(f.DISTANCE_COUNTER,p[0],p[1])})})}const Hh={POLYGON_BORDER:"polygon-buffer-main-layer",POLYGON_BACKGROUND:"polygon-buffer-main-bg-layer",RESIZER:"polygon-buffer-resizer-layer",CENTER_POINT:"polygon-buffer-center-layer",CLOSE_BUTTON:"polygon-buffer-close-button",DISTANCE_COUNTER:"polygon-buffer-distance-counter"},Vh="polygon-buffer-source",jh=()=>{const c={...Hh};Object.keys(c).forEach(l=>{c[l]+=`-${De()}`});const f=`${Vh}-${De()}`;return{BUFFER_POLYGON_LAYER:c,BUFFER_POLYGON_SOURCE:f}},ua=c=>(c[0]!==c[c.length-1]&&c.push(c[0]),c),Xh={name:"MbBufferPolygonLayer"},Zh=Te({...Xh,props:qh,emits:Yh,setup(c,{emit:f}){const l=c,y=f,{getVisibility:p}=Tt(l),b="polygon-close",I=tt(Ai(Li(b),l.closeIconUrl)),h=tt(l.manual?[]:ua(JSON.parse(JSON.stringify(l.polygon))));let N,E=[],S,_,L=!1,k,A=!1,t=!1,a="";const{BUFFER_POLYGON_LAYER:u,BUFFER_POLYGON_SOURCE:g}=jh(),v=()=>{I.value.push(mt("BufferPolygonCenterSVG",l.centerColor,l.centerRadius),mt("BufferPolygonResizerSVG",l.resizerColor,l.resizerRadius))},w=()=>{Object.keys(u).forEach(H=>{S.getLayer(u[H])&&S.setLayoutProperty(u[H],"visibility",p(l[Ti[H]]))})},T=(H,B,ne)=>{typeof B=="string"?(S.on(H,B,ne),E.push({event:H,target:B,handler:ne})):(S.on(H,B),E.push({event:H,handler:B}))},O=()=>{E.forEach(H=>{H.target?S.off(H.event,H.target,H.handler):S.off(H.event,H.handler)}),E=[],z()},P=()=>{T("mouseenter",u.POLYGON_BACKGROUND,oe),T("mouseleave",u.POLYGON_BACKGROUND,W),T("mousedown",u.POLYGON_BACKGROUND,J),T("mouseenter",u.RESIZER,Y),T("mouseleave",u.RESIZER,Z),T("mousedown",u.RESIZER,ee),T("click",u.CLOSE_BUTTON,H=>{y("close",H)}),D()},D=()=>{N={},l.manual&&(S.on("click",j),S.on("dblclick",$),document.addEventListener("keydown",X))},z=()=>{S.off("click",j),S.off("dblclick",$),document.removeEventListener("keydown",X)},j=H=>{if(H.preventDefault(),H.originalEvent.cancelBubble=!0,N.x!==H.point.x||N.y!==H.point.y){const{lng:B,lat:ne}=H.lngLat;h.value.splice(h.value.length?h.value.length-1:0,0,[B,ne]),h.value.length===1&&h.value.push(h.value[0]),be()}N=H.point},$=H=>{H.preventDefault(),H.originalEvent&&(H.originalEvent.cancelBubble=!0),z(),y("complete",{polygon:h.value})},X=H=>{const B=H.keyCode;B===27||B===8||B===46?(h.value.length>2?h.value.splice(-2,1):h.value.length===2&&h.value.splice(0,2),be()):B===13&&$(H)},oe=()=>{_.style.cursor="move",L=!0,S.dragPan.disable(),y("mouseenter")},W=()=>{_.style.cursor="",L=!1,S.dragPan.enable(),y("mouseleave")},Y=H=>{a=H.features[0].properties.idx,_.style.cursor="move",L=!0,S.dragPan.disable(),y("mouseenter")},Z=H=>{if(h.value.length<4)return;const B=st([H.lngLat.lng,H.lngLat.lat]),ne=Xi([h.value]);Dr(B,ne)?oe():(_.style.cursor="",L=!1,S.dragPan.enable(),y("mouseleave"))},ee=H=>{L&&(k=H.lngLat,A=!0,t=!1,_.style.cursor="move",T("mousemove",V),S.once("mouseup",Q))},V=H=>{if(!A)return;_.style.cursor="move";const B=+a;h.value.splice(B,1,[H.lngLat.lng,H.lngLat.lat]),B===0?h.value.splice(-1,1,[H.lngLat.lng,H.lngLat.lat]):B===h.value.length-1&&h.value.splice(0,1,[H.lngLat.lng,H.lngLat.lat]),k={lng:H.lngLat.lng,lat:H.lngLat.lat},de()},Q=()=>{A&&(_.style.cursor="",A=!1,y("update",{polygon:h.value}),S.off("mousemove",V))},J=H=>{!L||!l.draggable||(k=H.lngLat,t=!0,A=!1,_.style.cursor="grab",T("mousemove",ve),S.once("mouseup",le))},ve=H=>{if(!t)return;_.style.cursor="grabbing";const B=H.lngLat.lng-k.lng,ne=H.lngLat.lat-k.lat;k={lng:H.lngLat.lng,lat:H.lngLat.lat},h.value.forEach((pe,Ie)=>{Ie!==h.value.length-1&&(pe[0]+=B,pe[1]+=ne)}),be()},le=()=>{t&&(_.style.cursor="",t=!1,S.off("mousemove",u.POLYGON_BACKGROUND,ve),y("update",{polygon:h.value}))},fe=()=>{const H=h.value.length?Bu(Uu(h.value)):void 0,B=h.value.reduce((ge,Ve)=>Ve[0]>ge[0]?Ve:ge,[-Number.MAX_SAFE_INTEGER,0]),ne=h.value.reduce((ge,Ve)=>Ve[1]>ge[1]?Ve:ge,[0,-Number.MAX_SAFE_INTEGER]),pe=We(ne,0,0,ze).geometry.coordinates,Ie=We(B,0,0,ze).geometry.coordinates,Ce={type:"Feature",properties:{bufferType:"main"},geometry:{type:"Polygon",coordinates:[h.value]}},te=(Ln(Ce)/1e3/1e3).toFixed(2),Je={type:"Feature",properties:{bufferType:"close"},geometry:{type:"Point",coordinates:pe}},ht=h.value.map((ge,Ve)=>({type:"Feature",properties:{bufferType:"resizer",idx:`${Ve}`},geometry:{type:"Point",coordinates:[...ge]}})),Qe={type:"Feature",properties:{bufferType:"center"},geometry:{type:"Point",coordinates:H?[...H.geometry.coordinates]:[0,0]}},et={type:"Feature",properties:{bufferType:"counter",text:l.formatter?l.formatter(te):`${te} km2`},geometry:{type:"Point",coordinates:Ie}};return{polygonMain:Ce,polygonCenter:Qe,resizers:ht,closeButton:Je,counter:et}},re=({polygonMain:H,polygonCenter:B,resizers:ne,closeButton:pe,counter:Ie})=>{S.getSource(g)?S.getSource(g).setData({type:"FeatureCollection",features:[H,B,...ne,pe,Ie]}):(S.addSource(g,{type:"geojson",data:{type:"FeatureCollection",features:[H,B,...ne,pe,Ie]}}),S.addLayer({id:u.POLYGON_BORDER,type:"line",source:g,paint:{"line-color":l.borderColor,"line-opacity":l.borderOpacity,"line-width":l.borderWidth,"line-offset":3},layout:{visibility:p()},filter:["==","bufferType","main"],metadata:{mbLayerId:l.id}}),S.addLayer({id:u.POLYGON_BACKGROUND,type:"fill",source:g,paint:{"fill-color":l.backgroundColor,"fill-opacity":l.backgroundOpacity},layout:{visibility:p()},filter:["==","bufferType","main"],metadata:{mbLayerId:l.id}}),S.addLayer({id:u.RESIZER,type:"symbol",source:g,layout:{visibility:p(l.resizable),"icon-image":"BufferPolygonResizerSVG","icon-size":1,"icon-offset":["get","offset"],"icon-allow-overlap":!0},filter:["==","bufferType","resizer"],metadata:{mbLayerId:l.id}}),S.addLayer({id:u.CENTER_POINT,type:"symbol",source:g,layout:{visibility:p(),"icon-image":"BufferPolygonCenterSVG","icon-size":1,"icon-allow-overlap":!0},filter:["==","bufferType","center"],metadata:{mbLayerId:l.id}}),S.addLayer({id:u.CLOSE_BUTTON,type:"symbol",source:g,layout:{visibility:p(l.closable),"icon-image":b,"icon-size":l.closeSize,"icon-offset":l.closeOffset,"icon-allow-overlap":!0},filter:["==","bufferType","close"],metadata:{mbLayerId:l.id}}),S.addLayer({id:u.DISTANCE_COUNTER,type:"symbol",source:g,paint:{"text-color":l.textColor},layout:{visibility:p(l.countable),"text-font":l.textFonts,"text-size":l.textSize,"text-field":["get","text"],"text-allow-overlap":!0,"text-offset":[3.5,0]},filter:["==","bufferType","counter"],metadata:{mbLayerId:l.id}}))},de=()=>{window.requestAnimationFrame(()=>{re(fe())})},be=()=>{de()},me=()=>{S=F(),_=S.getCanvasContainer(),v(),P(),be()},{getMapboxInstance:F}=He(me);$h(F,u,l),ue(()=>l.polygon,H=>{h.value=ua(JSON.parse(JSON.stringify(H))),de()},{deep:!0}),ue(()=>l.visible,()=>{w()});const Ne=()=>{G(),ie(),U(),O(),S=null},G=()=>{Object.keys(u).forEach(H=>{S.getLayer(u[H])&&S.removeLayer(u[H])})},ie=()=>{S.removeSource(g)},U=()=>{I.value.forEach(H=>{S.hasImage(H.name)&&S.removeImage(H.name)})};return it(()=>{Ne()}),(H,B)=>(Se(),Me(ce(ui),{images:I.value,class:"mb-buffer-polygon-layer"},null,8,["images"]))}}),Wh=Ae(Zh),Kh={...Ki,startAngle:{type:Number,default:0},endAngle:{type:Number,default:90},closeOffset:{type:Array,default:[40,-25]}},Jh={...Ji,update:({center:c,startAngle:f,endAngle:l,radius:y})=>Array.isArray(c)&&typeof f=="number"&&typeof l=="number"&&typeof y=="number"};function Qh(c,f,l){const{getVisibility:y}=Tt(l);ue(()=>[l.borderColor,l.borderOpacity,l.borderWidth],()=>{c().getLayer(f.SECTOR_BORDER)&&Object.entries({"line-color":l.borderColor,"line-opacity":l.borderOpacity,"line-width":l.borderWidth}).forEach(p=>{c().setPaintProperty(f.SECTOR_BORDER,p[0],p[1])})}),ue(()=>[l.backgroundColor,l.backgroundOpacity],()=>{c().getLayer(f.SECTOR_BACKGROUND)&&Object.entries({"fill-color":l.backgroundColor,"fill-opacity":l.backgroundOpacity}).forEach(p=>{c().setPaintProperty(f.SECTOR_BACKGROUND,p[0],p[1])})}),ue(()=>l.resizable,()=>{c().getLayer(f.RESIZER)&&c().setLayoutProperty(f.RESIZER,"visibility",y(l.resizable))}),ue(()=>l.rotatable,()=>{c().getLayer(f.ROTATER)&&c().setLayoutProperty(f.ROTATER,"visibility",y(l.rotatable))}),ue(()=>l.closable,()=>{c().getLayer(f.CLOSE_BUTTON)&&c().setLayoutProperty(f.CLOSE_BUTTON,"visibility",y(l.closable))}),ue(()=>[l.closeSize,l.closeOffset],()=>{c().getLayer(f.CLOSE_BUTTON)&&Object.entries({"icon-size":l.closeSize,"icon-offset":l.closeOffset}).forEach(p=>{c().setLayoutProperty(f.CLOSE_BUTTON,p[0],p[1])})}),ue(()=>l.countable,()=>{c().getLayer(f.DISTANCE_COUNTER)&&c().setLayoutProperty(f.DISTANCE_COUNTER,"visibility",y(l.countable))}),ue(()=>[l.textFonts,l.textSize],()=>{c().getLayer(f.DISTANCE_COUNTER)&&Object.entries({"text-font":l.textFonts,"text-size":l.textSize}).forEach(p=>{c().setLayoutProperty(f.DISTANCE_COUNTER,p[0],p[1])})}),ue(()=>[l.textColor],()=>{c().getLayer(f.DISTANCE_COUNTER)&&Object.entries({"text-color":l.textColor}).forEach(p=>{c().setPaintProperty(f.DISTANCE_COUNTER,p[0],p[1])})})}const ec={SECTOR_BORDER:"sector-buffer-main-layer",SECTOR_BACKGROUND:"sector-buffer-main-bg-layer",RESIZER:"sector-buffer-resizer-layer",ROTATER:"ellipse-buffer-rotater-layer",CENTER_POINT:"sector-buffer-center-layer",CLOSE_BUTTON:"sector-buffer-close-button",DISTANCE_COUNTER:"sector-buffer-distance-counter"},tc="sector-buffer-source",ic=()=>{const c={...ec};Object.keys(c).forEach(l=>{c[l]+=`-${De()}`});const f=`${tc}-${De()}`;return{BUFFER_SECTOR_LAYER:c,BUFFER_SECTOR_SOURCE:f}},la={0:{name:"Resizer",offset:[2,4],icon:"BufferSectorResizerSVG"},1:{name:"sectorStartAngle",offset:[2,0],icon:"BufferSectorRotaterSVG"},2:{name:"sectorEndAngle",offset:[2,0],icon:"BufferSectorRotaterSVG"}},nc=(c,f)=>{const l=f-c;return c+(l>0?l/2:(360-Math.abs(l))/2)},nr=c=>c==="Resizer"?"col-resize":"move",rc={name:"MbBufferSectorLayer"},sc=Te({...rc,props:Kh,emits:Jh,setup(c,{emit:f}){const l=c,y=f,{getVisibility:p}=Tt(l),b="sector-close",I=tt(Ai(Li(b),l.closeIconUrl));let h=l.startAngle,N=l.endAngle,E=l.radius,S=[],_=[],L,k,A=!1,t,a=!1,u=!1,g="";const{BUFFER_SECTOR_LAYER:v,BUFFER_SECTOR_SOURCE:w}=ic(),T=()=>{I.value.push(mt("BufferSectorCenterSVG",l.centerColor,l.centerRadius),mt("BufferSectorResizerSVG",l.resizerColor,l.resizerRadius),mt("BufferSectorRotaterSVG",l.rotaterColor,l.resizerRadius))},O=()=>{Object.keys(v).forEach(G=>{L.getLayer(v[G])&&L.setLayoutProperty(v[G],"visibility",p(l[Ti[G]]))})},P=(G,ie,U)=>{typeof ie=="string"?(L.on(G,ie,U),_.push({event:G,target:ie,handler:U})):(L.on(G,ie),_.push({event:G,handler:ie}))},D=()=>{_.forEach(G=>{G.target?L.off(G.event,G.target,G.handler):L.off(G.event,G.handler)}),_=[]},z=()=>{P("mouseenter",v.SECTOR_BACKGROUND,j),P("mouseleave",v.SECTOR_BACKGROUND,$),P("mousedown",v.SECTOR_BACKGROUND,ee),P("mouseenter",v.RESIZER,X),P("mouseleave",v.RESIZER,oe),P("mousedown",v.RESIZER,W),P("mouseenter",v.ROTATER,X),P("mouseleave",v.ROTATER,oe),P("mousedown",v.ROTATER,W),P("click",v.CLOSE_BUTTON,G=>{y("close",G)})},j=()=>{k.style.cursor="move",A=!0,L.dragPan.disable(),y("mouseenter")},$=()=>{k.style.cursor="",A=!1,L.dragPan.enable(),y("mouseleave")},X=G=>{g=G.features[0].properties.name,k.style.cursor=nr(g),A=!0,L.dragPan.disable(),y("mouseenter")},oe=G=>{ni([G.lngLat.lng,G.lngLat.lat],S)>E?(k.style.cursor="",A=!1,L.dragPan.enable(),y("mouseleave")):j()},W=G=>{A&&(t=G.lngLat,a=!0,u=!1,k.style.cursor=nr(g),P("mousemove",Y),L.once("mouseup",Z))},Y=G=>{if(a)if(k.style.cursor=nr(g),g==="Resizer"){const ie=ni(st(S),st([G.lngLat.lng,G.lngLat.lat]),ze);E=Math.abs(ie),le(S)}else g==="sectorStartAngle"?N=Sn(S,[G.lngLat.lng,G.lngLat.lat]):g==="sectorEndAngle"&&(h=Sn(S,[G.lngLat.lng,G.lngLat.lat])),t={lng:G.lngLat.lng,lat:G.lngLat.lat},le(S)},Z=()=>{a&&(k.style.cursor="",a=!1,y("update",{center:S,radius:E,startAngle:N,endAngle:h}),L.off("mousemove",Y))},ee=G=>{!A||!l.draggable||(t=G.lngLat,u=!0,a=!1,k.style.cursor="grab",P("mousemove",V),L.once("mouseup",Q))},V=G=>{if(!u)return;k.style.cursor="grabbing";const ie=G.lngLat.lng-t.lng,U=G.lngLat.lat-t.lat;t={lng:G.lngLat.lng,lat:G.lngLat.lat},fe([S[0]+ie,S[1]+U])},Q=()=>{u&&(k.style.cursor="",u=!1,L.off("mousemove",v.SECTOR_BACKGROUND,V),y("update",{center:S,radius:E,startAngle:N,endAngle:h}))},J=G=>{const ie=st([...G]),U=nc(N,h),H=eh(ie,E,N,h,{...ze,properties:{bufferType:"main"}}),B=We(ie,E,U,ze),ne=We(ie,E,N,ze),pe=We(ie,E,h,ze),Ie=We(ie,0,0,ze).geometry.coordinates,Ce=We(ie,E,h,ze).geometry.coordinates,te=(Ln(H)/1e3/1e3).toFixed(2),Je={type:"Feature",properties:{bufferType:"close"},geometry:{type:"Point",coordinates:Ie}},ht=Object.entries({1:ne,2:pe}).map(Ve=>({type:"Feature",properties:{bufferType:"rotater",...la[+Ve[0]]},geometry:{type:"Point",coordinates:[...Ve[1].geometry.coordinates]}})),Qe={type:"Feature",properties:{bufferType:"resizer",...la[0]},geometry:{type:"Point",coordinates:[...B.geometry.coordinates]}},et={type:"Feature",properties:{bufferType:"center"},geometry:{type:"Point",coordinates:G}},ge={type:"Feature",properties:{bufferType:"counter",text:l.formatter?l.formatter(te,E):`${te} km2`},geometry:{type:"Point",coordinates:Ce}};return{sectorMain:H,sectorCenter:et,sectorResizer:Qe,sectorRotater:ht,closeButton:Je,counter:ge}},ve=({sectorMain:G,sectorCenter:ie,sectorResizer:U,sectorRotater:H,closeButton:B,counter:ne})=>{L.getSource(w)?L.getSource(w).setData({type:"FeatureCollection",features:[G,ie,...H,U,B,ne]}):(L.addSource(w,{type:"geojson",data:{type:"FeatureCollection",features:[G,ie,...H,U,B,ne]}}),L.addLayer({id:v.SECTOR_BORDER,type:"line",source:w,paint:{"line-color":l.borderColor,"line-opacity":l.borderOpacity,"line-width":l.borderWidth,"line-offset":3},layout:{visibility:p()},filter:["==","bufferType","main"],metadata:{mbLayerId:l.id}}),L.addLayer({id:v.SECTOR_BACKGROUND,type:"fill",source:w,paint:{"fill-color":l.backgroundColor,"fill-opacity":l.backgroundOpacity},layout:{visibility:p()},filter:["==","bufferType","main"],metadata:{mbLayerId:l.id}}),L.addLayer({id:v.RESIZER,type:"symbol",source:w,layout:{visibility:p(l.resizable),"icon-image":["get","icon"],"icon-size":1,"icon-offset":["get","offset"],"icon-allow-overlap":!0},filter:["==","bufferType","resizer"],metadata:{mbLayerId:l.id}}),L.addLayer({id:v.ROTATER,type:"symbol",source:w,layout:{visibility:p(l.rotatable),"icon-image":["get","icon"],"icon-size":1,"icon-offset":["get","offset"],"icon-allow-overlap":!0},filter:["==","bufferType","rotater"],metadata:{mbLayerId:l.id}}),L.addLayer({id:v.CENTER_POINT,type:"symbol",source:w,layout:{visibility:p(),"icon-image":"BufferSectorCenterSVG","icon-size":1,"icon-allow-overlap":!0},filter:["==","bufferType","center"],metadata:{mbLayerId:l.id}}),L.addLayer({id:v.CLOSE_BUTTON,type:"symbol",source:w,layout:{visibility:p(l.closable),"icon-image":b,"icon-size":l.closeSize,"icon-offset":l.closeOffset,"icon-allow-overlap":!0},filter:["==","bufferType","close"],metadata:{mbLayerId:l.id}}),L.addLayer({id:v.DISTANCE_COUNTER,type:"symbol",source:w,paint:{"text-color":l.textColor},layout:{visibility:p(l.countable),"text-font":l.textFonts,"text-size":l.textSize,"text-field":["get","text"],"text-allow-overlap":!0,"text-offset":[3.5,0]},filter:["==","bufferType","counter"],metadata:{mbLayerId:l.id}}))},le=G=>{window.requestAnimationFrame(()=>{ve(J(G))})},fe=G=>{S=G,le(S)},re=()=>{L=de(),k=L.getCanvasContainer(),T(),z(),fe(l.center)},{getMapboxInstance:de}=He(re);Qh(de,v,l),ue(()=>l.center,(G,ie)=>{(G==null?void 0:G.join())!==(ie==null?void 0:ie.join())&&(S=G,le(S))}),ue(()=>l.radius,G=>{E=G,le(S)}),ue(()=>l.startAngle,G=>{N=G,le(S)}),ue(()=>l.endAngle,G=>{h=G,le(S)}),ue(()=>l.visible,()=>{O()});const be=()=>{me(),F(),Ne(),D(),L=null},me=()=>{Object.keys(v).forEach(G=>{L.getLayer(v[G])&&L.removeLayer(v[G])})},F=()=>{L.removeSource(w)},Ne=()=>{I.value.forEach(G=>{L.hasImage(G.name)&&L.removeImage(G.name)})};return it(()=>{be()}),(G,ie)=>(Se(),Me(ce(ui),{images:I.value,class:"mb-buffer-sector-layer"},null,8,["images"]))}}),ac=Ae(sc),oc={id:{type:String,default:()=>De()},type:{type:String,default:"symbol"},filter:{type:Array},layout:{type:Object,default:()=>({})},paint:{type:Object,default:()=>({})},sourceId:String,sourceLayer:String,minzoom:{type:Number,default:0},maxzoom:{type:Number,default:22},metadata:{type:Object},beforeId:String},uc={class:"mb-layer"},lc={name:"MbLayer"},hc=Te({...lc,props:oc,setup(c){const f=c,l=()=>{const h=I(),N=b(),{id:E,sourceId:S,type:_,filter:L,layout:k,paint:A,minzoom:t,maxzoom:a,sourceLayer:u,beforeId:g,metadata:v}=f,w={id:E,source:S||E,type:_,layout:k,paint:A,minzoom:t,maxzoom:a,metadata:v};L&&(w.filter=L),u&&(w["source-layer"]=u),N.getLayer(E)||h.addLayer(w,g)},y=(h,N)=>{const E=b();E&&E.setLayoutProperty(f.id,h,N)},p=(h,N)=>{const E=b();E&&E.setPaintProperty(f.id,h,N)},{getMapboxInstance:b,getMapInstance:I}=He(l);return ue(()=>f.layout,h=>{for(const[N,E]of Object.entries(h))y(N,E)}),ue(()=>f.paint,h=>{for(const[N,E]of Object.entries(h))p(N,E)}),ue(()=>f.beforeId,h=>{const N=I();N&&N.moveLayer(f.id,h)}),ue(()=>f.filter,h=>{const N=b();N&&N.setFilter(f.id,h)}),it(()=>{const h=b();!h||h._removed||!h.getLayer(f.id)||h.removeLayer(f.id)}),(h,N)=>(Se(),je("i",uc,[ri(h.$slots,"default")]))}}),ut=Ae(hc),cc={id:{type:String,default:()=>De()},geoJsonSource:{type:Object},tileJsonSource:{type:Object}},fc={sourceAdded:c=>!0},dc={class:"mb-source"},gc={name:"MbSource"},pc=Te({...gc,props:cc,emits:fc,setup(c,{expose:f,emit:l}){const y=c,p=l,b=()=>{const E=N(),{id:S,geoJsonSource:_,tileJsonSource:L}=y;_?E.addSource(S,_):L&&E.addSource(S,L),p("sourceAdded",E.getSource(S))},I=()=>{const E=h();if(!E||E._removed)return;let{layers:S=[]}=E.getStyle();return S=S.map((_,L)=>{const{id:k}=S[L+1]||{id:void 0};return{..._,before:k}}).filter(_=>_.source===y.id),S.forEach(_=>E.removeLayer(_.id)),E.removeSource(y.id),S.reverse()},{getMapboxInstance:h,getMapInstance:N}=He(b);return ue(()=>y.geoJsonSource,(E,S)=>{const _=h();if(!_)return;_.getSource(y.id).setData(E.data);const L=["buffer","maxzoom","cluster","clusterRadius","clusterMaxZoom","clusterMinPoints"].filter(k=>![void 0,null].includes(E==null?void 0:E[k])&&(E==null?void 0:E[k])!==(S==null?void 0:S[k]));if(L.length){const k=_.getStyle(),A=k.sources[y.id];L.forEach(t=>{A[t]=E==null?void 0:E[t]}),_.setStyle(k)}},{deep:!0}),ue(()=>y.tileJsonSource,(E,S)=>{const _=h();if(E.url!==S.url||JSON.stringify(E.tiles)!==JSON.stringify(S.tiles)||E.minzoom!==S.minzoom||E.maxzoom!==S.maxzoom){const L=I();_.addSource(y.id,E),L.forEach(k=>_.addLayer(k,k.before))}},{deep:!0}),it(()=>{I()}),f({removeSource:I}),(E,S)=>(Se(),je("i",dc,[ri(E.$slots,"default")]))}}),lt=Ae(pc);function Ri(c,{geoType:f,dataHandler:l}){const y=c.sourceId?c.sourceId:De();let p,b;const I=Be(()=>{if(c.sourceId)return;const g={type:"geojson",data:c.data?N(c.data,f):c.geoJsonDataSource,buffer:c.bufferSize,maxzoom:c.maxzoom};return c.cluster?(g.cluster=!0,g.clusterRadius=c.clusterRadius||50,c.clusterMaxZoom&&(g.clusterMaxZoom=c.clusterMaxZoom),(c.clusterMinPoints||c.clusterMinPoints===0)&&(g.clusterMinPoints=c.clusterMinPoints)):g.cluster=!1,c.generateId&&(g.generateId=c.generateId),g}),h=Fu().emit,N=(g,v)=>{const w=l?l(g):void 0;g=w!==void 0?w:g.slice();const T=g.map(O=>{const P=O.coordinates;return Pu[v](P,O.properties)});return bi(T)},E=g=>{p=g.getMapboxInstance(),S(),h("created")},S=()=>{p.on("click",c.id,_),p.on("mousemove",c.id,L),p.on("mouseleave",c.id,k),p.on("mousemove",c.id,A),p.on("mouseleave",c.id,t)},_=g=>{if(!c.pickable||g.originalEvent.cancelBubble)return;const v=p.queryRenderedFeatures(g.point,{layers:[c.id]});h("click",{pixel:Object.values(g.point),mouseCoordinates:g.lngLat.toArray(),coordinates:v[0].geometry.coordinates,properties:v[0].properties,originalEvent:g.originalEvent})},L=g=>{c.pickable&&h("mousemove",{pixel:Object.values(g.point),mouseCoordinates:g.lngLat.toArray(),coordinates:g.features[0].geometry.coordinates,properties:g.features[0].properties,originalEvent:g.originalEvent})},k=g=>{c.pickable&&h("mouseleave",g)},A=g=>{c.autoHighlight&&g.features.length>0&&(b&&p.setFeatureState({source:y,id:b},{hover:!1}),b=g.features[0].id,p.setFeatureState({source:y,id:b},{hover:!0}))},t=g=>{c.autoHighlight&&(b&&p.setFeatureState({source:y,id:b},{hover:!1}),b=void 0)},a=g=>{let v;if(c.useExpression)v=g;else if(Array.isArray(g)){const w=g.slice();v=["interpolate",["linear"],["get",w[0]],...w.slice(1)]}else v=ai.parse(g).toString();return c.autoHighlight?["case",["boolean",["feature-state","hover"],!1],ai.parse(c.highlightColor).toString(),v]:v},u=()=>c.geoJsonDataSource&&typeof c.geoJsonDataSource=="string"?null:I.value?JSON.stringify(I.value.data):null;return it(()=>{p&&(p.off("click",c.id,_),p.off("mousemove",c.id,L),p.off("mouseleave",c.id,k),p.off("mousemove",c.id,A),p.off("mouseleave",c.id,t))}),{sourceIdInternal:y,geoJsonSource:I,createdHandler:E,parseColorVal:a,exportToGeoJson:u}}const Oi={id:{type:String,default:()=>De()},beforeId:String,maxzoom:{type:Number,default:22},minzoom:{type:Number,default:0},show:{type:Boolean,default:!0},sourceId:String,sourceLayerName:String,geoJsonDataSource:[String,Object],data:Array,pickable:{type:Boolean,default:!0},useExpression:Boolean,bufferSize:{type:Number,default:128},generateId:Boolean,autoHighlight:Boolean,highlightColor:{type:[String,Array],default:()=>[255,255,128,1]},cluster:Boolean,clusterRadius:Number,clusterMinPoints:Number,clusterMaxZoom:Number},Ui={created:()=>!0,click:({pixel:c,mouseCoordinates:f,coordinates:l,properties:y,originalEvent:p})=>Array.isArray(c)&&Array.isArray(f)&&Array.isArray(l),mousemove:({pixel:c,mouseCoordinates:f,coordinates:l,properties:y,originalEvent:p})=>Array.isArray(c)&&Array.isArray(f)&&Array.isArray(l),mouseleave:c=>!0},yc={...Oi,heightInfoField:{type:String,required:!0},magnification:{type:Number,default:1},base:{type:Number,default:0},color:{type:String,default:"#acacac"},opacity:{type:Number,default:.8},sideGradient:{type:Boolean,default:!1}},mc=Ui,vc={name:"MbBuildingLayer"},_c=Te({...vc,props:yc,emits:mc,setup(c,{expose:f}){const l=c,y=Be(()=>({visibility:l.show?"visible":"none"})),p=Be(()=>({"fill-extrusion-height":["*",["get",l.heightInfoField],l.magnification],"fill-extrusion-color":l.color,"fill-extrusion-base":l.base,"fill-extrusion-opacity":l.opacity,"fill-extrusion-vertical-gradient":l.sideGradient})),b=S=>S.map(_=>{let{coordinates:L,properties:k}=_;return L=L.slice(),L.push(L[0]),{coordinates:[L],properties:k}}),{sourceIdInternal:I,geoJsonSource:h,createdHandler:N,exportToGeoJson:E}=Ri(l,{geoType:"polygon",dataHandler:b});return f({exportToGeoJson:E}),(S,_)=>(Se(),Me(ce(ut),{id:S.id,"before-id":S.beforeId,"source-id":ce(I),"source-layer":S.sourceLayerName,type:"fill-extrusion",layout:y.value,paint:p.value,maxzoom:S.maxzoom,minzoom:S.minzoom,class:"mb-building-layer",onCreated:ce(N)},{default:Bt(()=>[S.sourceId?wt("",!0):(Se(),Me(ce(lt),{key:0,id:ce(I),"geo-json-source":ce(h)},null,8,["id","geo-json-source"]))]),_:1},8,["id","before-id","source-id","source-layer","layout","paint","maxzoom","minzoom","onCreated"]))}}),xc=Ae(_c),Ec={...Oi,radius:{type:[Number,Array],default:5},blur:{type:Number,default:0},color:{type:[String,Array],default:"#000000"},opacity:{type:[Number,Array],default:1},translate:{type:Array,default:()=>[0,0]},strokeWidth:{type:Number,default:0},strokeColor:{type:[String,Array],default:"#000000"},strokeOpacity:{type:[String,Array],default:0}},bc=Ui,Sc={name:"MbCircleLayer"},Ic=Te({...Sc,props:Ec,emits:bc,setup(c,{expose:f}){const l=c,y=Be(()=>({visibility:l.show?"visible":"none"})),p=Be(()=>{const{radius:E,color:S,opacity:_,translate:L,strokeWidth:k,strokeColor:A,strokeOpacity:t,blur:a}=l,u=Array.isArray(S)?typeof S[0]=="string"?["interpolate",["linear"],["get",S[0]],...S.slice(1)]:["interpolate",["linear"],["zoom"],...S]:S,g=l.autoHighlight?["case",["boolean",["feature-state","hover"],!1],ai.parse(l.highlightColor).toString(),u]:u;return{"circle-radius":Array.isArray(E)?typeof E[0]=="string"?["interpolate",["linear"],["get",E[0]],...E.slice(1)]:["interpolate",["linear"],["zoom"],...E]:E,"circle-color":g,"circle-opacity":Array.isArray(_)?["interpolate",["linear"],["zoom"],..._]:_,"circle-translate":L,"circle-stroke-width":k,"circle-stroke-color":Array.isArray(A)?typeof A[0]=="string"?["interpolate",["linear"],["get",A[0]],...A.slice(1)]:["interpolate",["linear"],["zoom"],...A]:A,"circle-stroke-opacity":Array.isArray(t)?["interpolate",["linear"],["zoom"],...t]:t,"circle-blur":a}}),{sourceIdInternal:b,geoJsonSource:I,createdHandler:h,exportToGeoJson:N}=Ri(l,{geoType:"point"});return f({exportToGeoJson:N}),(E,S)=>(Se(),Me(ce(ut),{id:E.id,"before-id":E.beforeId,"source-id":ce(b),"source-layer":E.sourceLayerName,type:"circle",layout:y.value,paint:p.value,maxzoom:E.maxzoom,minzoom:E.minzoom,class:"mb-circle-layer",onCreated:ce(h)},{default:Bt(()=>[E.sourceId?wt("",!0):(Se(),Me(ce(lt),{key:0,id:ce(b),"geo-json-source":ce(I)},null,8,["id","geo-json-source"]))]),_:1},8,["id","before-id","source-id","source-layer","layout","paint","maxzoom","minzoom","onCreated"]))}}),wc=Ae(Ic),kc={functions:{type:Array,default:()=>["point","polyline","polygon","trash"]},position:{type:String,default:"top-right"}},Cc={created:()=>!0,"draw.created":c=>!0,"draw.delete":c=>!0,"draw.update":({action:c,features:f})=>!0},Nc={class:"mb-draw-control"},Lc={name:"MbDrawControl"},Tc=Te({...Lc,props:kc,emits:Cc,setup(c,{expose:f,emit:l}){const y=c,p=l;let b,I;const h=()=>({onAdd:()=>b.ctx.ui.addButtons(),onRemove:()=>{b.destroy(),b.ctx.ui.removeButtons()}}),N=w=>{p("draw.created",w.features)},E=w=>{p("draw.delete",w.features)},S=w=>{p("draw.update",{action:w.action,features:w.features})},_=w=>{if(b)return b.add(w)},L=w=>{if(b)return b.get(w)},k=()=>{if(b)return b.getSelectedIds()},A=()=>{if(b)return b.getSelected()},t=()=>{if(b)return b.getAll()},a=w=>{b&&b.delete(w)},u=()=>{b&&b.deleteAll()},g=()=>{const w=v(),{functions:T}=y;b=new Ku(w,{userProperties:!0,controls:{point:T.includes("point"),line_string:T.includes("polyline"),polygon:T.includes("polygon"),trash:T.includes("trash"),combine_features:!1,uncombine_features:!1},displayControlsDefault:!1}),I=h(),w.addControl(I,y.position),p("created"),w.on("draw.create",N),w.on("draw.delete",E),w.on("draw.update",S)},{getMapboxInstance:v}=He(g);return it(()=>{const w=v();w&&(w.off("draw.create",N),w.off("draw.delete",E),w.off("draw.update",S),I&&w.removeControl(I))}),f({add:_,get:L,getSelectedIds:k,getSelected:A,getAll:t,del:a,deleteAll:u}),(w,T)=>(Se(),je("i",Nc))}}),Ac=Ae(Tc),Rc={position:{type:String,default:"top-right"}},Oc={class:"mb-fullscreen-control"},Uc={name:"MbFullscreenControl"},Pc=Te({...Uc,props:Rc,setup(c){const f=c;let l;const y=()=>{const b=p();l=new b.mapboxgl.FullscreenControl,b.addControl(l,f.position)},{getMapboxInstance:p}=He(y);return it(()=>{const b=p();b&&l&&b.removeControl(l),l=null}),(b,I)=>(Se(),je("i",Oc))}}),Mc=Ae(Pc);function yt(c){return typeof c=="number"&&!Number.isNaN(c)}const Bc={zoom:{type:Number,default:2},center:{type:Array,default:()=>[116.38745,39.91266],validator:c=>c.length===2&&c.every(yt)},bearing:{type:Number,default:0},pitch:{type:Number,default:0},bounds:{type:[Object,Array],default:void 0},maxBounds:{type:[Object,Array],default:void 0},antialias:{type:Boolean,default:!0},minzoom:{type:Number,default:0},maxzoom:{type:Number,default:22},hash:{type:[Boolean,String],default:!1},interactive:{type:Boolean,default:!0},bearingSnap:{type:Number,default:7},pitchWithRotate:{type:Boolean,default:!0},clickTolerance:{type:Number,default:3},attributionControl:{type:Boolean,default:!1},mapStyle:{type:[Object,String],default:()=>({version:8,sources:{},layers:[],glyphs:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",sprite:"mapbox://sprites/mapbox/bright-v8"})},glyphs:{type:String,default:""},sprite:{type:String,default:""},crs:[String,Array],extendProps:{type:Object,default:()=>({})}},Dc={"update:pitch":c=>yt(c),"update:bearing":c=>yt(c),"update:center":c=>Array.isArray(c)&&c.every(f=>yt(f)),"update:zoom":c=>yt(c),mousemove:({pixel:c,coordinates:f,originalEvent:l})=>c.every(y=>yt(y))&&f.every(y=>yt(y)),click:({pixel:c,coordinates:f,originalEvent:l})=>c.every(y=>yt(y))&&f.every(y=>yt(y)),dblclick:({pixel:c,coordinates:f,originalEvent:l})=>c.every(y=>yt(y))&&f.every(y=>yt(y)),singleclick:({pixel:c,coordinates:f,originalEvent:l})=>c.every(y=>yt(y))&&f.every(y=>yt(y)),mouseout:c=>!0,created:c=>!0},Fc=["id"],zc={name:"MbMap"},Gc=Te({...zc,props:Bc,emits:Dc,setup(c,{expose:f,emit:l}){cn.mapboxgl.config.REQUIRE_ACCESS_TOKEN=!1;const y=c,p=l,b=tt(),I=tt(0),h=tt(De().replace(/-/gi,""));let N,E;const S=new Promise((V,Q)=>{E={resolve:V,reject:Q}}),_=(V,Q)=>{N.addSource(V,Q)},L=V=>N.getSource(V),k=(V,Q)=>{N.addLayer(V,Q)},A=(V,Q)=>{!N||V===Q||N.moveLayer(V,Q)},t=()=>N.getZoom(),a=V=>{V!==t()&&N.setZoom(V)},u=()=>{const V=N.getCenter();return[V.lng,V.lat]},g=()=>{N.resize()},v=V=>{const Q=N.getStyle().layers.map(de=>({id:de.id,metadata:de.metadata||{},deleted:!1})),J={};V.forEach(de=>{J[de]=[],Q.forEach((be,me)=>{(be.metadata.mbLayerId===de||be.id===de)&&J[de].push(me)})});const ve=[...V];ve.sort((de,be)=>J[de][0]-J[be][0]);const le={},fe={};for(const[de,be]of V.entries()){const me=ve[de];le[me]=[],fe[be]=[],Q.forEach(F=>{(F.metadata.mbLayerId===me||F.id===me)&&le[me].push(F.id),(F.metadata.mbLayerId===be||F.id===be)&&fe[be].push({...F,new:!0})})}for(const[de,be]of V.entries()){const me=ve[de];let F=-1;for(const[Ne,G]of Q.entries())G.new||le[me].includes(G.id)&&(F===-1&&(F=Ne),G.deleted=!0);Q.splice(F,0,...fe[be])}const re=Q.filter(de=>!de.deleted);for(let de=re.length-1;de>=0;de--)N.moveLayer(re[de].id,re[de+1]?re[de+1].id:void 0)},w=V=>{const Q=u();!V||!Q||V[0]===Q[0]&&V[1]===Q[1]||N.setCenter(V)},T=()=>N.getBearing(),O=V=>{V!==T()&&N.setBearing(V)},P=()=>N.getPitch(),D=V=>{V!==P()&&N.setPitch(V)},z=V=>{N.jumpTo(V)},j=V=>(V.duration||(V.duration=1e3),N.easeTo(V),new Promise(Q=>{N.once("moveend",()=>{Q()})})),$=V=>(N.flyTo(V),new Promise(Q=>{N.once("moveend",()=>{Q()})})),X=()=>{N.stop()},oe=(V,Q)=>N.cameraForBounds(V,Q),W=(V,Q)=>(N.fitBounds(V,Q),new Promise(J=>{N.once("moveend",()=>{J()})})),Y=V=>N.project(V),Z=()=>{N.on("idle",()=>{I.value++}),N.on("zoomend",()=>{p("update:zoom",N.getZoom())}),N.on("moveend",()=>{p("update:center",u())}),N.on("rotateend",()=>{p("update:bearing",N.getBearing())}),N.on("pitchend",()=>{p("update:pitch",N.getPitch())});let V;N.on("click",Q=>{Q.originalEvent.cancelBubble||(p("click",{originalEvent:Q.originalEvent,pixel:Object.values(Q.point),coordinates:Object.values(Q.lngLat.wrap())}),V!==void 0?(clearTimeout(V),V=void 0,p("dblclick",{originalEvent:Q.originalEvent,pixel:Object.values(Q.point),coordinates:Object.values(Q.lngLat.wrap())})):V=setTimeout(()=>{V=void 0,p("singleclick",{originalEvent:Q.originalEvent,pixel:Object.values(Q.point),coordinates:Object.values(Q.lngLat.wrap())})},200),Yu(()=>{Q.originalEvent.cancelBubble=!0}))}),N.on("mousemove",Q=>{p("mousemove",{pixel:Object.values(Q.point),coordinates:Object.values(Q.lngLat.wrap()),originalEvent:Q.originalEvent})}),N.on("mouseout",Q=>{p("mouseout",Q)})};ue(()=>y.zoom,V=>{a(V)}),ue(()=>y.center,V=>{w(V)}),ue(()=>y.bearing,V=>{O(V)}),ue(()=>y.pitch,V=>{D(V)}),zu(oi,{getMap:S});const ee={addSource:_,getSource:L,addLayer:k,moveLayer:A,getZoom:t,setZoom:a,getCenter:u,setCenter:w,resize:g,reorderLayers:v,getBearing:T,setBearing:O,getPitch:P,setPitch:D,jumpTo:z,easeTo:j,flyTo:$,stop:X,cameraForBounds:oe,fitBounds:W,project:Y};return Gu(()=>{const{glyphs:V,sprite:Q,crs:J,zoom:ve,center:le,mapStyle:fe,bearing:re,pitch:de,bounds:be,maxBounds:me,minzoom:F,extendProps:Ne,maxzoom:G,antialias:ie,hash:U,interactive:H,bearingSnap:B,pitchWithRotate:ne,clickTolerance:pe,attributionControl:Ie}=y,Ce={};V&&(Ce.glyphs=V),Q&&(Ce.sprite=Q),typeof fe=="object"&&!(Ne!=null&&Ne.accessToken)&&(fe.glyphs&&fe.glyphs.startsWith("mapbox:")&&delete fe.glyphs,fe.sprite&&fe.sprite.startsWith("mapbox:")&&delete fe.sprite);const te=Array.isArray(J)?new cn.mapboxgl.CRS(...J):J;N=new cn.mapboxgl.Map(Object.assign({container:h.value,zoom:ve,center:le,style:typeof fe=="string"?fe:Object.assign({},fe,Ce),bearing:re,pitch:de,bounds:be,maxBounds:me,minZoom:F,maxZoom:G,antialias:ie,hash:U,interactive:H,bearingSnap:B,pitchWithRotate:ne,clickTolerance:pe,attributionControl:Ie,localIdeographFontFamily:"'Noto Sans', 'Noto Sans CJK SC', sans-serif",doubleClickZoom:!1},te?{crs:te}:{},Ne)),Z(),N.on("load",()=>{E.resolve({mapboxInstance:N,mapInstance:ee}),p("created",N)}),N.mapboxgl=cn.mapboxgl}),qu(()=>{N.mapboxgl=null,N.remove(),N=null}),f(ee),(V,Q)=>(Se(),je("div",{ref_key:"container",ref:b,class:"mb-map-container"},[Sr("div",{id:h.value,style:{width:"100%",height:"100%"}},null,8,Fc),ri(V.$slots,"default")],512))}}),qc=Ae(Gc),Yc={anchor:{type:String,default:"bottom"},offset:{type:Array,default:()=>[0,0]},color:{type:String,default:"#3FB1CE"},draggable:{type:Boolean,default:!0},coordinates:{type:Array,required:!0}},$c={"update:coordinates":c=>Array.isArray(c)},Hc={name:"MbMapMarker"},Vc=Te({...Hc,props:Yc,emits:$c,setup(c,{emit:f}){const l=c,y=f,p=$u(),b=tt();let I;const h=()=>{const E=N();I=new E.mapboxgl.Marker(p.default?Object.assign({},l,{element:b.value}):l).setLngLat(l.coordinates.slice()).addTo(E),I.on("drag",()=>{y("update:coordinates",Object.values(I.getLngLat()))})},{getMapboxInstance:N}=He(h);return ue(()=>l.coordinates,E=>{if(!I)return;const S=I.getLngLat().toArray();(S[0]!==E[0]||S[1]!==E[1])&&I.setLngLat(E)}),ue(()=>l.draggable,E=>{I&&I.setDraggable(E)}),ue(()=>l.offset,E=>{I&&I.setOffset(E)}),it(()=>{I&&I.remove()}),(E,S)=>(Se(),je("div",{ref_key:"markerDiv",ref:b,class:"mb-map-marker"},[ri(E.$slots,"default")],512))}}),jc=Ae(Vc);function Pe(c,f){this.x=c,this.y=f}Pe.prototype={clone(){return new Pe(this.x,this.y)},add(c){return this.clone()._add(c)},sub(c){return this.clone()._sub(c)},multByPoint(c){return this.clone()._multByPoint(c)},divByPoint(c){return this.clone()._divByPoint(c)},mult(c){return this.clone()._mult(c)},div(c){return this.clone()._div(c)},rotate(c){return this.clone()._rotate(c)},rotateAround(c,f){return this.clone()._rotateAround(c,f)},matMult(c){return this.clone()._matMult(c)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(c){return this.x===c.x&&this.y===c.y},dist(c){return Math.sqrt(this.distSqr(c))},distSqr(c){const f=c.x-this.x,l=c.y-this.y;return f*f+l*l},angle(){return Math.atan2(this.y,this.x)},angleTo(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith(c){return this.angleWithSep(c.x,c.y)},angleWithSep(c,f){return Math.atan2(this.x*f-this.y*c,this.x*c+this.y*f)},_matMult(c){const f=c[0]*this.x+c[1]*this.y,l=c[2]*this.x+c[3]*this.y;return this.x=f,this.y=l,this},_add(c){return this.x+=c.x,this.y+=c.y,this},_sub(c){return this.x-=c.x,this.y-=c.y,this},_mult(c){return this.x*=c,this.y*=c,this},_div(c){return this.x/=c,this.y/=c,this},_multByPoint(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint(c){return this.x/=c.x,this.y/=c.y,this},_unit(){return this._div(this.mag()),this},_perp(){const c=this.y;return this.y=this.x,this.x=-c,this},_rotate(c){const f=Math.cos(c),l=Math.sin(c),y=f*this.x-l*this.y,p=l*this.x+f*this.y;return this.x=y,this.y=p,this},_rotateAround(c,f){const l=Math.cos(c),y=Math.sin(c),p=f.x+l*(this.x-f.x)-y*(this.y-f.y),b=f.y+y*(this.x-f.x)+l*(this.y-f.y);return this.x=p,this.y=b,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Pe};Pe.convert=function(c){if(c instanceof Pe)return c;if(Array.isArray(c))return new Pe(+c[0],+c[1]);if(c.x!==void 0&&c.y!==void 0)return new Pe(+c.x,+c.y);throw new Error("Expected [x, y] or {x, y} point format")};const Xc={hideOnZoom:{type:Boolean,default:!1},hideOnMove:{type:Boolean,default:!1},hideOnClick:{type:Boolean,default:!1},anchor:{type:String,validator(c){return typeof c=="string"&&["top","bottom","left","right","top-left","top-right","bottom-left","bottom-right"].includes(c)},default:void 0},offset:{type:[Number,Array],default:()=>[0,0]},className:String,coordinates:{type:Array},show:{type:Boolean,default:!0},showTip:{type:Boolean,default:!0},tipColor:{type:String,default:"#fff"}},Zc={"update:show":c=>typeof c=="boolean"},Wc={key:0,class:"mb-map-popup-tip"},Kc={class:"mb-map-popup-content"},Jc={name:"MbMapPopup"},Qc=Te({...Jc,props:Xc,emits:Zc,setup(c,{emit:f}){const l={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},y=c,p=f,b=tt(),I=tt(y.show),h=()=>{const u=a();if(!u||!I.value||!b.value)return;let g=y.anchor;const v=u.project(y.coordinates),w=k(y.offset);if(!g){const O=b.value.offsetWidth,P=b.value.offsetHeight;let D;v.y+w.bottom.y<P?D=["top"]:v.y>u.transform.height-P?D=["bottom"]:D=[],v.x<O/2?D.push("left"):v.x>u.transform.width-O/2&&D.push("right"),D.length===0?g="bottom":g=D.join("-")}const T=v.add(w[g]).round();b.value.style.transform=`${l[g]} translate(${T.x}px,${T.y}px)`,A(b.value,g)},N=()=>{I.value=!1,p("update:show",!1)},E=()=>{y.hideOnClick&&N()},S=()=>{y.hideOnZoom&&N()},_=()=>{y.hideOnMove&&N()},L=()=>{const u=a();u&&(u.off("move",h),u.on("move",_),u.on("zoomstart",S),u.on("click",E),u.off("remove",L))},k=u=>{if(u)if(typeof u=="number"){const g=Math.round(Math.sqrt(.5*u**2));return{center:new Pe(0,0),top:new Pe(0,u),"top-left":new Pe(g,g),"top-right":new Pe(-g,g),bottom:new Pe(0,-u),"bottom-left":new Pe(g,-g),"bottom-right":new Pe(-g,-g),left:new Pe(u,0),right:new Pe(-u,0)}}else if(u instanceof Pe||Array.isArray(u)){const g=Pe.convert(u);return{center:g,top:g,"top-left":g,"top-right":g,bottom:g,"bottom-left":g,"bottom-right":g,left:g,right:g}}else return{center:Pe.convert(u.center||[0,0]),top:Pe.convert(u.top||[0,0]),"top-left":Pe.convert(u["top-left"]||[0,0]),"top-right":Pe.convert(u["top-right"]||[0,0]),bottom:Pe.convert(u.bottom||[0,0]),"bottom-left":Pe.convert(u["bottom-left"]||[0,0]),"bottom-right":Pe.convert(u["bottom-right"]||[0,0]),left:Pe.convert(u.left||[0,0]),right:Pe.convert(u.right||[0,0])};else return k(new Pe(0,0))},A=(u,g)=>{const v=u.classList;for(const w in l)v.remove(`mb-map-popup-anchor-${w}`);v.add(`mb-map-popup-anchor-${g}`)},t=()=>{const u=a();h(),u.on("move",h),u.on("move",_),u.on("zoomstart",S),u.on("click",E),u.on("remove",L)},{getMapboxInstance:a}=He(t);return ue(()=>y.coordinates,()=>{h()}),ue(()=>y.show,u=>{I.value=u,h()}),it(()=>{L()}),(u,g)=>(Se(),je("div",{ref_key:"popupDiv",ref:b,class:Hu(["mb-map-popup",u.className?"":u.className]),style:Vu({"--tip-color":u.tipColor,visibility:I.value?"visible":"hidden"})},[u.showTip?(Se(),je("div",Wc)):wt("",!0),ri(u.$slots,"default",{},()=>[Sr("div",Kc,[Sr("button",{class:"mb-map-popup-close-button",type:"button",onClick:N},"  "),ri(u.$slots,"content")])])],6))}}),ef=Ae(Qc),tf={name:"MbMapTooltip"},nf=Te({...tf,setup(c){const f=tt(!1),l=tt(),y=Ir({lng:0,lat:0}),p=tt({}),b=E=>{if(!E||!E.originalEvent)return;const S=N();f.value=!0,E.point?p.value=E.point:p.value={x:E.originalEvent.offsetX,y:E.originalEvent.offsetY},Object.assign(y,S.unproject(p.value)),l.value.style.transform=`translate(${p.value.x+2}px,${p.value.y}px)`},I=()=>{f.value=!1},h=()=>{const E=N();E.on("mousemove",b),E.on("zoomend",b),E.on("drag",b),E.on("mouseout",I)},{getMapboxInstance:N}=He(h);return it(()=>{const E=N();E.off("mousemove",b),E.off("zoomend",b),E.off("drag",b),E.off("mouseout",I)}),(E,S)=>ju((Se(),je("div",{ref_key:"tooltipDiv",ref:l,class:"mb-map-tooltip"},[ri(E.$slots,"default",{coordinates:y,pixel:p.value})],512)),[[Xu,f.value]])}}),rf=Ae(nf),sf={showCompass:{type:Boolean,default:!0},showZoom:{type:Boolean,default:!0},position:{type:String,default:"top-left"}},af={class:"mb-navigation-control"},of={name:"MbNavigationControl"},uf=Te({...of,props:sf,setup(c){const f=c;let l;const y=()=>{const b=p();l=new b.mapboxgl.NavigationControl(f),b.addControl(l,f.position)},{getMapboxInstance:p}=He(y);return it(()=>{const b=p();b&&l&&b.removeControl(l),l=null}),(b,I)=>(Se(),je("i",af))}}),lf=Ae(uf),hf={...Oi,radius:{type:[Number,Array],default:30},weight:{type:[Number,Array],default:1},intensity:{type:[Number,Array],default:1},color:{type:Array,default:()=>[0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"]},opacity:{type:[Number,Array],default:1}},cf=Ui,ff={name:"MbHeatmapLayer"},df=Te({...ff,props:hf,emits:cf,setup(c,{expose:f}){const l=c,y=Be(()=>({visibility:l.show?"visible":"none"})),p=Be(()=>{const{radius:E,weight:S,intensity:_,color:L,opacity:k}=l;return{"heatmap-radius":Array.isArray(E)?["interpolate",["linear"],["zoom"],...E]:E,"heatmap-weight":Array.isArray(S)?["interpolate",["linear"],["get",S[0]],...S.slice(1)]:S,"heatmap-intensity":Array.isArray(_)?["interpolate",["linear"],["zoom"],..._]:_,"heatmap-opacity":Array.isArray(k)?["interpolate",["linear"],["zoom"],...k]:k,"heatmap-color":["interpolate",["linear"],["heatmap-density"],...L]}}),{sourceIdInternal:b,geoJsonSource:I,createdHandler:h,exportToGeoJson:N}=Ri(l,{geoType:"point"});return f({exportToGeoJson:N}),(E,S)=>(Se(),Me(ce(ut),{id:E.id,"before-id":E.beforeId,"source-id":ce(b),"source-layer":E.sourceLayerName,type:"heatmap",layout:y.value,paint:p.value,maxzoom:E.maxzoom,minzoom:E.minzoom,class:"mb-heatmap-layer",onCreated:ce(h)},{default:Bt(()=>[E.sourceId?wt("",!0):(Se(),Me(ce(lt),{key:0,id:ce(b),"geo-json-source":ce(I)},null,8,["id","geo-json-source"]))]),_:1},8,["id","before-id","source-id","source-layer","layout","paint","maxzoom","minzoom","onCreated"]))}}),gf=Ae(df),pf={url:{type:String,required:!0},coordinates:{type:Array,required:!0},show:{type:Boolean,default:!0},beforeId:String,id:{type:String,default:()=>De()}},yf={created:()=>!0},mf={name:"MbImageLayer"},vf=Te({...mf,props:pf,emits:yf,setup(c,{emit:f}){const l=c,y=f,p=De(),b=Be(()=>({visibility:l.show?"visible":"none"})),I=Be(()=>({type:"image",url:l.url,coordinates:l.coordinates})),h=()=>{y("created")};return(N,E)=>(Se(),Me(ce(ut),{id:N.id,"source-id":ce(p),type:"raster",layout:b.value,"before-id":N.beforeId,class:"mb-image-layer",onCreated:h},{default:Bt(()=>[Ci(ce(lt),{id:ce(p),"tile-json-source":I.value},null,8,["id","tile-json-source"])]),_:1},8,["id","source-id","layout","before-id"]))}}),_f=Ae(vf);var co={exports:{}};(function(c,f){(function(y,p){c.exports=p()})(za,function(){return function(l){var y={};function p(b){if(y[b])return y[b].exports;var I=y[b]={exports:{},id:b,loaded:!1};return l[b].call(I.exports,I,I.exports,p),I.loaded=!0,I.exports}return p.m=l,p.c=y,p.p="",p(0)}([function(l,y,p){Object.defineProperty(y,"__esModule",{value:!0}),y.isNotPNG=_,y.isNotAPNG=L,y.default=A;var b=p(1),I=N(b),h=p(2);function N(T){return T&&T.__esModule?T:{default:T}}var E=new Error("Not a PNG"),S=new Error("Not an animated PNG");function _(T){return T===E}function L(T){return T===S}var k=new Uint8Array([137,80,78,71,13,10,26,10]);function A(T){var O=new Uint8Array(T);if(Array.prototype.some.call(k,function(Z,ee){return Z!==O[ee]}))return E;var P=!1;if(t(O,function(Z){return!(P=Z==="acTL")}),!P)return S;var D=[],z=[],j=null,$=null,X=0,oe=new h.APNG;if(t(O,function(Z,ee,V,Q){var J=new DataView(ee.buffer);switch(Z){case"IHDR":j=ee.subarray(V+8,V+8+Q),oe.width=J.getUint32(V+8),oe.height=J.getUint32(V+12);break;case"acTL":oe.numPlays=J.getUint32(V+8+4);break;case"fcTL":$&&(oe.frames.push($),X++),$=new h.Frame,$.width=J.getUint32(V+8+4),$.height=J.getUint32(V+8+8),$.left=J.getUint32(V+8+12),$.top=J.getUint32(V+8+16);var ve=J.getUint16(V+8+20),le=J.getUint16(V+8+22);le===0&&(le=100),$.delay=1e3*ve/le,$.delay<=10&&($.delay=100),oe.playTime+=$.delay,$.disposeOp=J.getUint8(V+8+24),$.blendOp=J.getUint8(V+8+25),$.dataParts=[],X===0&&$.disposeOp===2&&($.disposeOp=1);break;case"fdAT":$&&$.dataParts.push(ee.subarray(V+8+4,V+8+Q));break;case"IDAT":$&&$.dataParts.push(ee.subarray(V+8,V+8+Q));break;case"IEND":z.push(g(ee,V,12+Q));break;default:D.push(g(ee,V,12+Q))}}),$&&oe.frames.push($),oe.frames.length==0)return S;var W=new Blob(D),Y=new Blob(z);return oe.frames.forEach(function(Z){var ee=[];ee.push(k),j.set(w(Z.width),0),j.set(w(Z.height),4),ee.push(v("IHDR",j)),ee.push(W),Z.dataParts.forEach(function(V){return ee.push(v("IDAT",V))}),ee.push(Y),Z.imageData=new Blob(ee,{type:"image/png"}),delete Z.dataParts,ee=null}),oe}function t(T,O){var P=new DataView(T.buffer),D=8,z=void 0,j=void 0,$=void 0;do j=P.getUint32(D),z=a(T,D+4,4),$=O(z,T,D,j),D+=12+j;while($!==!1&&z!="IEND"&&D<T.length)}function a(T,O,P){var D=Array.prototype.slice.call(T.subarray(O,O+P));return String.fromCharCode.apply(String,D)}function u(T){for(var O=new Uint8Array(T.length),P=0;P<T.length;P++)O[P]=T.charCodeAt(P);return O}function g(T,O,P){var D=new Uint8Array(P);return D.set(T.subarray(O,O+P)),D}var v=function(O,P){var D=O.length+P.length,z=new Uint8Array(D+8),j=new DataView(z.buffer);j.setUint32(0,P.length),z.set(u(O),4),z.set(P,8);var $=(0,I.default)(z,4,D);return j.setUint32(D+4,$),z},w=function(O){return new Uint8Array([O>>>24&255,O>>>16&255,O>>>8&255,O&255])}},function(l,y){Object.defineProperty(y,"__esModule",{value:!0}),y.default=function(N){for(var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:N.length-E,_=-1,L=E,k=E+S;L<k;L++)_=_>>>8^p[(_^N[L])&255];return _^-1};for(var p=new Uint32Array(256),b=0;b<256;b++){for(var I=b,h=0;h<8;h++)I=I&1?3988292384^I>>>1:I>>>1;p[b]=I}},function(l,y,p){Object.defineProperty(y,"__esModule",{value:!0}),y.Frame=y.APNG=void 0;var b=function(){function S(_,L){for(var k=0;k<L.length;k++){var A=L[k];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(_,A.key,A)}}return function(_,L,k){return L&&S(_.prototype,L),k&&S(_,k),_}}(),I=p(3),h=N(I);function N(S){return S&&S.__esModule?S:{default:S}}function E(S,_){if(!(S instanceof _))throw new TypeError("Cannot call a class as a function")}y.APNG=function(){function S(){E(this,S),this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[]}return b(S,[{key:"createImages",value:function(){return Promise.all(this.frames.map(function(L){return L.createImage()}))}},{key:"getPlayer",value:function(L){var k=this,A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return this.createImages().then(function(){return new h.default(k,L,A)})}}]),S}(),y.Frame=function(){function S(){E(this,S),this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.imageData=null,this.imageElement=null}return b(S,[{key:"createImage",value:function(){var L=this;return this.imageElement?Promise.resolve():new Promise(function(k,A){var t=URL.createObjectURL(L.imageData);L.imageElement=document.createElement("img"),L.imageElement.onload=function(){URL.revokeObjectURL(t),k()},L.imageElement.onerror=function(){URL.revokeObjectURL(t),L.imageElement=null,A(new Error("Image creation error"))},L.imageElement.src=t})}}]),S}()},function(l,y,p){Object.defineProperty(y,"__esModule",{value:!0});var b=function(){function k(A,t){for(var a=0;a<t.length;a++){var u=t[a];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(A,u.key,u)}}return function(A,t,a){return t&&k(A.prototype,t),a&&k(A,a),A}}(),I=p(4),h=N(I);function N(k){return k&&k.__esModule?k:{default:k}}function E(k,A){if(!(k instanceof A))throw new TypeError("Cannot call a class as a function")}function S(k,A){if(!k)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A&&(typeof A=="object"||typeof A=="function")?A:k}function _(k,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);k.prototype=Object.create(A&&A.prototype,{constructor:{value:k,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(k,A):k.__proto__=A)}var L=function(k){_(A,k);function A(t,a,u){E(this,A);var g=S(this,(A.__proto__||Object.getPrototypeOf(A)).call(this));return g.playbackRate=1,g._currentFrameNumber=0,g._ended=!1,g._paused=!0,g._numPlays=0,g._apng=t,g.context=a,g.stop(),u&&g.play(),g}return b(A,[{key:"renderNextFrame",value:function(){this._currentFrameNumber=(this._currentFrameNumber+1)%this._apng.frames.length,this._currentFrameNumber===this._apng.frames.length-1&&(this._numPlays++,this._apng.numPlays!==0&&this._numPlays>=this._apng.numPlays&&(this._ended=!0,this._paused=!0)),this._prevFrame&&this._prevFrame.disposeOp==1?this.context.clearRect(this._prevFrame.left,this._prevFrame.top,this._prevFrame.width,this._prevFrame.height):this._prevFrame&&this._prevFrame.disposeOp==2&&this.context.putImageData(this._prevFrameData,this._prevFrame.left,this._prevFrame.top);var a=this.currentFrame;this._prevFrame=a,this._prevFrameData=null,a.disposeOp==2&&(this._prevFrameData=this.context.getImageData(a.left,a.top,a.width,a.height)),a.blendOp==0&&this.context.clearRect(a.left,a.top,a.width,a.height),this.context.drawImage(a.imageElement,a.left,a.top),this.emit("frame",this._currentFrameNumber),this._ended&&this.emit("end")}},{key:"play",value:function(){var a=this;this.emit("play"),this._ended&&this.stop(),this._paused=!1;var u=performance.now()+this.currentFrame.delay/this.playbackRate,g=function v(w){if(!(a._ended||a._paused)){if(w>=u){for(;w-u>=a._apng.playTime/a.playbackRate;)u+=a._apng.playTime/a.playbackRate,a._numPlays++;do a.renderNextFrame(),u+=a.currentFrame.delay/a.playbackRate;while(!a._ended&&!a._paused&&w>u)}requestAnimationFrame(v)}};requestAnimationFrame(g)}},{key:"pause",value:function(){this._paused||(this.emit("pause"),this._paused=!0)}},{key:"stop",value:function(){this.emit("stop"),this._numPlays=0,this._ended=!1,this._paused=!0,this._currentFrameNumber=-1,this.context.clearRect(0,0,this._apng.width,this._apng.height),this.renderNextFrame()}},{key:"currentFrameNumber",get:function(){return this._currentFrameNumber}},{key:"currentFrame",get:function(){return this._apng.frames[this._currentFrameNumber]}},{key:"paused",get:function(){return this._paused}},{key:"ended",get:function(){return this._ended}}]),A}(h.default);y.default=L},function(l,y){function p(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}l.exports=p,p.EventEmitter=p,p.prototype._events=void 0,p.prototype._maxListeners=void 0,p.defaultMaxListeners=10,p.prototype.setMaxListeners=function(E){if(!I(E)||E<0||isNaN(E))throw TypeError("n must be a positive number");return this._maxListeners=E,this},p.prototype.emit=function(E){var S,_,L,k,A,t;if(this._events||(this._events={}),E==="error"&&(!this._events.error||h(this._events.error)&&!this._events.error.length)){if(S=arguments[1],S instanceof Error)throw S;var a=new Error('Uncaught, unspecified "error" event. ('+S+")");throw a.context=S,a}if(_=this._events[E],N(_))return!1;if(b(_))switch(arguments.length){case 1:_.call(this);break;case 2:_.call(this,arguments[1]);break;case 3:_.call(this,arguments[1],arguments[2]);break;default:k=Array.prototype.slice.call(arguments,1),_.apply(this,k)}else if(h(_))for(k=Array.prototype.slice.call(arguments,1),t=_.slice(),L=t.length,A=0;A<L;A++)t[A].apply(this,k);return!0},p.prototype.addListener=function(E,S){var _;if(!b(S))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",E,b(S.listener)?S.listener:S),this._events[E]?h(this._events[E])?this._events[E].push(S):this._events[E]=[this._events[E],S]:this._events[E]=S,h(this._events[E])&&!this._events[E].warned&&(N(this._maxListeners)?_=p.defaultMaxListeners:_=this._maxListeners,_&&_>0&&this._events[E].length>_&&(this._events[E].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[E].length),typeof console.trace=="function"&&console.trace())),this},p.prototype.on=p.prototype.addListener,p.prototype.once=function(E,S){if(!b(S))throw TypeError("listener must be a function");var _=!1;function L(){this.removeListener(E,L),_||(_=!0,S.apply(this,arguments))}return L.listener=S,this.on(E,L),this},p.prototype.removeListener=function(E,S){var _,L,k,A;if(!b(S))throw TypeError("listener must be a function");if(!this._events||!this._events[E])return this;if(_=this._events[E],k=_.length,L=-1,_===S||b(_.listener)&&_.listener===S)delete this._events[E],this._events.removeListener&&this.emit("removeListener",E,S);else if(h(_)){for(A=k;A-- >0;)if(_[A]===S||_[A].listener&&_[A].listener===S){L=A;break}if(L<0)return this;_.length===1?(_.length=0,delete this._events[E]):_.splice(L,1),this._events.removeListener&&this.emit("removeListener",E,S)}return this},p.prototype.removeAllListeners=function(E){var S,_;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[E]&&delete this._events[E],this;if(arguments.length===0){for(S in this._events)S!=="removeListener"&&this.removeAllListeners(S);return this.removeAllListeners("removeListener"),this._events={},this}if(_=this._events[E],b(_))this.removeListener(E,_);else if(_)for(;_.length;)this.removeListener(E,_[_.length-1]);return delete this._events[E],this},p.prototype.listeners=function(E){var S;return!this._events||!this._events[E]?S=[]:b(this._events[E])?S=[this._events[E]]:S=this._events[E].slice(),S},p.prototype.listenerCount=function(E){if(this._events){var S=this._events[E];if(b(S))return 1;if(S)return S.length}return 0},p.listenerCount=function(E,S){return E.listenerCount(S)};function b(E){return typeof E=="function"}function I(E){return typeof E=="number"}function h(E){return typeof E=="object"&&E!==null}function N(E){return E===void 0}}])})})(co);var xf=co.exports;const ha=Mr(xf),Ef={images:{type:Array,required:!0}},bf={class:"mb-image-apng-loader"},Sf={name:"MbImageApngLoader"},If=Te({...Sf,props:Ef,setup(c){const{getMap:f}=ki(oi),l=c,y=()=>{const I=b();p(I)},p=I=>{if(!I){console.error("ImageApngLoader Error: Mapbox instance is null");return}const h=I.listImages();l.images&&l.images.filter(N=>!h.includes(N.name)).forEach(async N=>{const E=await(await(await fetch(N.url,N.requestInit)).blob()).arrayBuffer(),S=(ha.default||ha)(E);if(S instanceof Error){console.error("not apng image");return}await S.createImages(),Array.isArray(N.size)&&S.frames.flatMap(L=>{L.imageElement.width=N.size[0],L.imageElement.height=N.size[1]});const _=L=>{I.hasImage(N.name)?I.updateImage(N.name,S.frames[L].imageElement):I.addImage(N.name,S.frames[L].imageElement),I.triggerRepaint();const k=++L;window.setTimeout(()=>{_(k>=S.frames.length?0:k)},S.frames[L>=S.frames.length?0:L].delay)};_(0)})},{getMapboxInstance:b}=He(y);return ue(()=>l.images,async()=>{const I=await f;p(I.mapboxInstance)},{deep:!0}),(I,h)=>(Se(),je("i",bf))}}),wf=Ae(If),kf={images:{type:Array,required:!0}},Cf={class:"mb-image-frame-loader"},Nf={name:"MbImageFrameLoader"},Lf=Te({...Nf,props:kf,setup(c){const{getMap:f}=ki(oi),l=c,y=()=>{const I=b();p(I)},p=I=>{const h=I.listImages();l.images&&l.images.filter(N=>!h.includes(N.name)).forEach(async N=>{const E=await(await fetch(N.url,N.requestInit)).blob(),S=URL.createObjectURL(E),_=new Image;_.onload=()=>{URL.revokeObjectURL(S);const L=document.createElement("canvas"),k=L.getContext("2d"),A=_.width,t=_.height;let a,u,g=0,v=0;const w=[];N.dir==="h"?(u=t,a=A/N.steps,g=a):(a=A,u=t/N.steps,v=u),L.width=a,L.height=u;for(let O=0;O<N.steps;O++)k.clearRect(0,0,a,u),k.drawImage(_,O*g,O*v,a,u,0,0,a,u),w.push(k.getImageData(0,0,a,u));const T=O=>{I.hasImage(N.name)?I.updateImage(N.name,w[O]):I.addImage(N.name,w[O]),I.triggerRepaint();const P=++O;window.setTimeout(()=>{T(P>=w.length?0:P)},N.duration||300)};T(0)},_.onerror=L=>console.error(L),_.src=S})},{getMapboxInstance:b}=He(y);return ue(()=>l.images,async()=>{const I=await f;p(I.mapboxInstance)},{deep:!0}),(I,h)=>(Se(),je("i",Cf))}}),Tf=Ae(Lf);var ca={},fo,Af;function Rf(c,f,l,b){var p=0,b=b===void 0?{}:b,I=b.loop===void 0?null:b.loop,h=b.palette===void 0?null:b.palette;if(f<=0||l<=0||f>65535||l>65535)throw new Error("Width/Height invalid.");function N(a){var u=a.length;if(u<2||u>256||u&u-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return u}c[p++]=71,c[p++]=73,c[p++]=70,c[p++]=56,c[p++]=57,c[p++]=97;var E=0,S=0;if(h!==null){for(var _=N(h);_>>=1;)++E;if(_=1<<E,--E,b.background!==void 0){if(S=b.background,S>=_)throw new Error("Background index out of range.");if(S===0)throw new Error("Background index explicitly passed as 0.")}}if(c[p++]=f&255,c[p++]=f>>8&255,c[p++]=l&255,c[p++]=l>>8&255,c[p++]=(h!==null?128:0)|E,c[p++]=S,c[p++]=0,h!==null)for(var L=0,k=h.length;L<k;++L){var A=h[L];c[p++]=A>>16&255,c[p++]=A>>8&255,c[p++]=A&255}if(I!==null){if(I<0||I>65535)throw new Error("Loop count invalid.");c[p++]=33,c[p++]=255,c[p++]=11,c[p++]=78,c[p++]=69,c[p++]=84,c[p++]=83,c[p++]=67,c[p++]=65,c[p++]=80,c[p++]=69,c[p++]=50,c[p++]=46,c[p++]=48,c[p++]=3,c[p++]=1,c[p++]=I&255,c[p++]=I>>8&255,c[p++]=0}var t=!1;this.addFrame=function(a,u,g,v,w,T){if(t===!0&&(--p,t=!1),T=T===void 0?{}:T,a<0||u<0||a>65535||u>65535)throw new Error("x/y invalid.");if(g<=0||v<=0||g>65535||v>65535)throw new Error("Width/Height invalid.");if(w.length<g*v)throw new Error("Not enough pixels for the frame size.");var O=!0,P=T.palette;if(P==null&&(O=!1,P=h),P==null)throw new Error("Must supply either a local or global palette.");for(var D=N(P),z=0;D>>=1;)++z;D=1<<z;var j=T.delay===void 0?0:T.delay,$=T.disposal===void 0?0:T.disposal;if($<0||$>3)throw new Error("Disposal out of range.");var X=!1,oe=0;if(T.transparent!==void 0&&T.transparent!==null&&(X=!0,oe=T.transparent,oe<0||oe>=D))throw new Error("Transparent color index.");if(($!==0||X||j!==0)&&(c[p++]=33,c[p++]=249,c[p++]=4,c[p++]=$<<2|(X===!0?1:0),c[p++]=j&255,c[p++]=j>>8&255,c[p++]=oe,c[p++]=0),c[p++]=44,c[p++]=a&255,c[p++]=a>>8&255,c[p++]=u&255,c[p++]=u>>8&255,c[p++]=g&255,c[p++]=g>>8&255,c[p++]=v&255,c[p++]=v>>8&255,c[p++]=O===!0?128|z-1:0,O===!0)for(var W=0,Y=P.length;W<Y;++W){var Z=P[W];c[p++]=Z>>16&255,c[p++]=Z>>8&255,c[p++]=Z&255}return p=Of(c,p,z<2?2:z,w),p},this.end=function(){return t===!1&&(c[p++]=59,t=!0),p},this.getOutputBuffer=function(){return c},this.setOutputBuffer=function(a){c=a},this.getOutputBufferPosition=function(){return p},this.setOutputBufferPosition=function(a){p=a}}function Of(c,f,l,y){c[f++]=l;var p=f++,b=1<<l,I=b-1,h=b+1,N=h+1,E=l+1,S=0,_=0;function L(T){for(;S>=T;)c[f++]=_&255,_>>=8,S-=8,f===p+256&&(c[p]=255,p=f++)}function k(T){_|=T<<S,S+=E,L(8)}var A=y[0]&I,t={};k(b);for(var a=1,u=y.length;a<u;++a){var g=y[a]&I,v=A<<8|g,w=t[v];if(w===void 0){for(_|=A<<S,S+=E;S>=8;)c[f++]=_&255,_>>=8,S-=8,f===p+256&&(c[p]=255,p=f++);N===4096?(k(b),N=h+1,E=l+1,t={}):(N>=1<<E&&++E,t[v]=N++),A=g}else A=w}return k(A),k(h),L(1),p+1===f?c[p]=0:(c[p]=f-p-1,c[f++]=0),f}function Uf(c){var f=0;if(c[f++]!==71||c[f++]!==73||c[f++]!==70||c[f++]!==56||(c[f++]+1&253)!==56||c[f++]!==97)throw new Error("Invalid GIF 87a/89a header.");var l=c[f++]|c[f++]<<8,y=c[f++]|c[f++]<<8,p=c[f++],b=p>>7,I=p&7,h=1<<I+1;c[f++],c[f++];var N=null,E=null;b&&(N=f,E=h,f+=h*3);var S=!0,_=[],L=0,k=null,A=0,t=null;for(this.width=l,this.height=y;S&&f<c.length;)switch(c[f++]){case 33:switch(c[f++]){case 255:if(c[f]!==11||c[f+1]==78&&c[f+2]==69&&c[f+3]==84&&c[f+4]==83&&c[f+5]==67&&c[f+6]==65&&c[f+7]==80&&c[f+8]==69&&c[f+9]==50&&c[f+10]==46&&c[f+11]==48&&c[f+12]==3&&c[f+13]==1&&c[f+16]==0)f+=14,t=c[f++]|c[f++]<<8,f++;else for(f+=12;;){var a=c[f++];if(!(a>=0))throw Error("Invalid block size");if(a===0)break;f+=a}break;case 249:if(c[f++]!==4||c[f+4]!==0)throw new Error("Invalid graphics extension block.");var u=c[f++];L=c[f++]|c[f++]<<8,k=c[f++],u&1||(k=null),A=u>>2&7,f++;break;case 254:for(;;){var a=c[f++];if(!(a>=0))throw Error("Invalid block size");if(a===0)break;f+=a}break;default:throw new Error("Unknown graphic control label: 0x"+c[f-1].toString(16))}break;case 44:var g=c[f++]|c[f++]<<8,v=c[f++]|c[f++]<<8,w=c[f++]|c[f++]<<8,T=c[f++]|c[f++]<<8,O=c[f++],P=O>>7,D=O>>6&1,z=O&7,j=1<<z+1,$=N,X=E,oe=!1;if(P){var oe=!0;$=f,X=j,f+=j*3}var W=f;for(f++;;){var a=c[f++];if(!(a>=0))throw Error("Invalid block size");if(a===0)break;f+=a}_.push({x:g,y:v,width:w,height:T,has_local_palette:oe,palette_offset:$,palette_size:X,data_offset:W,data_length:f-W,transparent_index:k,interlaced:!!D,delay:L,disposal:A});break;case 59:S=!1;break;default:throw new Error("Unknown gif block: 0x"+c[f-1].toString(16))}this.numFrames=function(){return _.length},this.loopCount=function(){return t},this.frameInfo=function(Y){if(Y<0||Y>=_.length)throw new Error("Frame index out of range.");return _[Y]},this.decodeAndBlitFrameBGRA=function(Y,Z){var ee=this.frameInfo(Y),V=ee.width*ee.height,Q=new Uint8Array(V);fa(c,ee.data_offset,Q,V);var J=ee.palette_offset,ve=ee.transparent_index;ve===null&&(ve=256);var le=ee.width,fe=l-le,re=le,de=(ee.y*l+ee.x)*4,be=((ee.y+ee.height)*l+ee.x)*4,me=de,F=fe*4;ee.interlaced===!0&&(F+=l*4*7);for(var Ne=8,G=0,ie=Q.length;G<ie;++G){var U=Q[G];if(re===0&&(me+=F,re=le,me>=be&&(F=fe*4+l*4*(Ne-1),me=de+(le+fe)*(Ne<<1),Ne>>=1)),U===ve)me+=4;else{var H=c[J+U*3],B=c[J+U*3+1],ne=c[J+U*3+2];Z[me++]=ne,Z[me++]=B,Z[me++]=H,Z[me++]=255}--re}},this.decodeAndBlitFrameRGBA=function(Y,Z){var ee=this.frameInfo(Y),V=ee.width*ee.height,Q=new Uint8Array(V);fa(c,ee.data_offset,Q,V);var J=ee.palette_offset,ve=ee.transparent_index;ve===null&&(ve=256);var le=ee.width,fe=l-le,re=le,de=(ee.y*l+ee.x)*4,be=((ee.y+ee.height)*l+ee.x)*4,me=de,F=fe*4;ee.interlaced===!0&&(F+=l*4*7);for(var Ne=8,G=0,ie=Q.length;G<ie;++G){var U=Q[G];if(re===0&&(me+=F,re=le,me>=be&&(F=fe*4+l*4*(Ne-1),me=de+(le+fe)*(Ne<<1),Ne>>=1)),U===ve)me+=4;else{var H=c[J+U*3],B=c[J+U*3+1],ne=c[J+U*3+2];Z[me++]=H,Z[me++]=B,Z[me++]=ne,Z[me++]=255}--re}}}function fa(c,f,l,y){for(var p=c[f++],b=1<<p,I=b+1,h=I+1,N=p+1,E=(1<<N)-1,S=0,_=0,L=0,k=c[f++],A=new Int32Array(4096),t=null;;){for(;S<16&&k!==0;)_|=c[f++]<<S,S+=8,k===1?k=c[f++]:--k;if(S<N)break;var a=_&E;if(_>>=N,S-=N,a===b){h=I+1,N=p+1,E=(1<<N)-1,t=null;continue}else if(a===I)break;for(var u=a<h?a:t,g=0,v=u;v>b;)v=A[v]>>8,++g;var w=v,T=L+g+(u!==a?1:0);if(T>y){console.log("Warning, gif stream longer than expected.");return}l[L++]=w,L+=g;var O=L;for(u!==a&&(l[L++]=w),v=u;g--;)v=A[v],l[--O]=v&255,v>>=8;t!==null&&h<4096&&(A[h++]=t<<8|w,h>=E+1&&N<12&&(++N,E=E<<1|1)),t=a}return L!==y&&console.log("Warning, gif stream shorter than expected."),l}try{Af=ca.GifWriter=Rf,fo=ca.GifReader=Uf}catch{}const Pf={images:{type:Array,required:!0}},Mf={class:"mb-image-gif-loader"},Bf={name:"MbImageGifLoader"},Df=Te({...Bf,props:Pf,setup(c){const{getMap:f}=ki(oi),l=c,y=()=>{const I=b();p(I)},p=I=>{const h=I.listImages();l.images&&l.images.filter(N=>!h.includes(N.name)).forEach(async N=>{const E=await(await(await fetch(N.url,N.requestInit)).blob()).arrayBuffer(),S=new Uint8Array(E),_=new fo(S),L=_.frameInfo(0),k=L.width,A=L.height;I.addImage(N.name,{width:k,height:A,data:new Uint8ClampedArray(k*A*4),init(){this.frameIndex=0,this.lastTime=Date.now(),this.totalTime=L.delay*10},onAdd(){this.init()},renderGif(){const t=new ImageData(k,A);_.decodeAndBlitFrameRGBA(this.frameIndex++,t.data),this.data=t.data},render(){if(this.frameIndex===0)this.renderGif();else if(this.frameIndex>=_.numFrames())this.init(),this.renderGif();else{const t=this.totalTime+_.frameInfo(this.frameIndex).delay*10;Date.now()-this.lastTime>=t&&(this.totalTime+=_.frameInfo(this.frameIndex).delay*10,this.renderGif())}return I.triggerRepaint(),!0},onRemove(){this.frameIndex=null,this.lastTime=null,this.totalTime=null}})})},{getMapboxInstance:b}=He(y);return ue(()=>l.images,async()=>{const I=await f;p(I.mapboxInstance)},{deep:!0}),(I,h)=>(Se(),je("i",Mf))}}),Ff=Ae(Df),zf={images:{type:Array,required:!0}},Gf={class:"mb-image-lottie-loader"},qf={name:"MbImageLottieLoader"},Yf=Te({...qf,props:zf,setup(c){const{getMap:f}=ki(oi),l=c,y=()=>{const I=b();p(I)},p=I=>{const h=I.listImages();l.images&&l.images.filter(N=>!h.includes(N.name)).forEach(N=>{I.addImage(N.name,{width:N.size[0],height:N.size[1],data:new Uint8ClampedArray(N.size[0]*N.size[1]*4),onAdd(){const E=document.createElement("canvas");if(E.width=this.width,E.height=this.height,this.context=E.getContext("2d",{willReadFrequently:!0}),!this.context)throw new Error("failed to create canvas 2d context");N.onAdd(this.context)},render(){return this.data=this.context.getImageData(0,0,this.width,this.height).data,I.triggerRepaint(),!0},onRemove(){this.context=null}})})},{getMapboxInstance:b}=He(y);return ue(()=>l.images,async()=>{const I=await f;p(I.mapboxInstance)},{deep:!0}),(I,h)=>(Se(),je("i",Gf))}}),$f=Ae(Yf),Hf={...Oi,opacity:{type:Number,default:1},color:{type:[String,Array],default:"#000000"},outlineColor:{type:[String,Array],default:"#000000"},translate:{type:Array,default:()=>[0,0]},pattern:String},Vf=Ui,jf={name:"MbPolygonLayer"},Xf=Te({...jf,props:Hf,emits:Vf,setup(c,{expose:f}){const l=c,y=Be(()=>({visibility:l.show?"visible":"none"})),p=Be(()=>{const _={"fill-opacity":l.opacity,"fill-color":E(l.color),"fill-translate":l.translate,"fill-outline-color":E(l.outlineColor)};return l.pattern&&(_["fill-pattern"]=l.pattern),_}),b=_=>_.map(L=>{let{coordinates:k,properties:A}=L;return k=k.slice(),k.push(k[0]),{coordinates:[k],properties:A}}),{sourceIdInternal:I,geoJsonSource:h,createdHandler:N,parseColorVal:E,exportToGeoJson:S}=Ri(l,{geoType:"polygon",dataHandler:b});return f({exportToGeoJson:S}),(_,L)=>(Se(),Me(ce(ut),{id:_.id,"before-id":_.beforeId,"source-id":ce(I),"source-layer":_.sourceLayerName,type:"fill",layout:y.value,paint:p.value,maxzoom:_.maxzoom,minzoom:_.minzoom,class:"mb-polygon-layer",onCreated:ce(N)},{default:Bt(()=>[_.sourceId?wt("",!0):(Se(),Me(ce(lt),{key:0,id:ce(I),"geo-json-source":ce(h)},null,8,["id","geo-json-source"]))]),_:1},8,["id","before-id","source-id","source-layer","layout","paint","maxzoom","minzoom","onCreated"]))}}),Zf=Ae(Xf),Wf={...Oi,lineCap:{type:String,default:"butt"},lineJoin:{type:String,default:"miter"},opacity:{type:Number,default:1},color:{type:[String,Array],default:"#000000"},width:{type:[Number,Array],default:1},translate:{type:Array,default:()=>[0,0]},dashArray:Array,offset:{type:Number,default:0},blur:{type:Number,default:0}},Kf=Ui,Jf={name:"MbPolylineLayer"},Qf=Te({...Jf,props:Wf,emits:Kf,setup(c,{expose:f}){const l=c,y=Be(()=>({"line-cap":l.lineCap,"line-join":l.lineJoin,visibility:l.show?"visible":"none"})),p=Be(()=>{const S={"line-opacity":l.opacity,"line-color":N(l.color),"line-translate":l.translate,"line-width":l.width,"line-offset":l.offset,"line-blur":l.blur};return l.dashArray!==void 0&&(S["line-dasharray"]=l.dashArray),S}),{sourceIdInternal:b,geoJsonSource:I,createdHandler:h,parseColorVal:N,exportToGeoJson:E}=Ri(l,{geoType:"lineString"});return f({exportToGeoJson:E}),(S,_)=>(Se(),Me(ce(ut),{id:S.id,"before-id":S.beforeId,"source-id":ce(b),"source-layer":S.sourceLayerName,type:"line",layout:y.value,paint:p.value,maxzoom:S.maxzoom,minzoom:S.minzoom,class:"mb-polyline-layer",onCreated:ce(h)},{default:Bt(()=>[S.sourceId?wt("",!0):(Se(),Me(ce(lt),{key:0,id:ce(b),"geo-json-source":ce(I)},null,8,["id","geo-json-source"]))]),_:1},8,["id","before-id","source-id","source-layer","layout","paint","maxzoom","minzoom","onCreated"]))}}),ed=Ae(Qf),td={maxWidth:{type:Number,default:100},unit:{type:String,default:"metric"},position:{type:String,default:"bottom-left"}},id={class:"mb-scale-control"},nd={name:"MbScaleControl"},rd=Te({...nd,props:td,setup(c){const f=c;let l;const y=()=>{const b=p();l=new b.mapboxgl.ScaleControl(f),b.addControl(l,f.position)},{getMapboxInstance:p}=He(y);return it(()=>{const b=p();b&&l&&b.removeControl(l),l=null}),(b,I)=>(Se(),je("i",id))}}),sd=Ae(rd),ad={...Oi,symbolPlacement:{type:String,default:"point"},symbolSpacing:{type:Number,default:250},symbolAvoidEdges:{type:Boolean,default:!1},symbolZOrder:{type:String,default:"auto"},iconAllowOverlap:{type:Boolean,default:!1},iconAnchor:{type:String,default:"center"},iconColor:{type:String,default:"#000000"},iconImage:{type:[String,Array]},iconImageField:{type:String},iconSize:{type:Number,default:1},iconOffset:{type:Array,default:()=>[0,0]},iconOpacity:{type:Number,default:1},iconOptional:{type:Boolean,default:!1},iconRotate:{type:[Number,Array],default:0},iconRotationAlignment:{type:String,default:"auto"},iconIgnorePlacement:Boolean,iconTranslate:{type:Array,default:()=>[0,0]},textAllowOverlap:{type:Boolean,default:!1},textAnchor:{type:String,default:"center"},textColor:{type:String,default:"#000000"},textHaloColor:{type:String,default:"rgba(0, 0, 0, 0)"},textHaloWidth:{type:Number,default:0},textHaloBlur:{type:Number,default:0},text:{type:String,default:""},textField:{type:String,default:""},textFont:{type:Array,default:()=>["Open Sans SemiBold"]},textLetterSpacing:{type:Number,default:0},textLineHeight:{type:Number,default:1.2},textMaxWidth:{type:Number,default:10},textOffset:{type:Array,default:()=>[0,0]},textOpacity:{type:Number,default:1},textOptional:{type:Boolean,default:!1},textSize:{type:Number,default:16},textTranslate:{type:Array,default:()=>[0,0]},textTranslateAnchor:{type:String,default:"viewport"},textPadding:{type:Number,default:2},cluster:{type:Boolean,default:!1},clusterRadius:{type:Number,default:50},clusterMaxZoom:{type:Number,default:22},clusterMinPoints:{type:Number,default:2},clusterIcons:{type:Array,default:()=>[{count:50,textColor:"black",textSize:12,functionName:"drawDynamicCircle",functionProps:{color:"#68B8EE",radius:50}},{count:100,textColor:"black",textSize:14,functionName:"drawDynamicCircle",functionProps:{color:"#B1E345",radius:75}},{count:200,textColor:"white",textSize:18,functionName:"drawDynamicCircle",functionProps:{color:"#F7DC00",radius:100}},{count:500,textColor:"white",textSize:20,functionName:"drawDynamicCircle",functionProps:{color:"#FA9800",radius:125}},{textColor:"white",textSize:22,functionName:"drawDynamicCircle",functionProps:{radius:150,color:"#F34A4A"}}]},clusterIconSize:{type:Number,default:1},clusterIconTranslate:{type:Array,default:()=>[0,0]},clusterIconOffset:{type:Array,default:()=>[0,0]},clusterIconAnchor:{type:String,default:"center"},spiderify:{type:Boolean,default:!1},maxLeafesTospiderify:{type:Number,default:50},distanceBetweenSpiderPoints:{type:Number,default:50},spiderLegColor:{type:String,default:"#B6CBED"},spiderLegWidth:{type:Number,default:3},comparePrecision:{type:Number,default:5},clusterSpiralPoints:{type:Number,default:10}},od={...Ui,clusterclick:({pixel:c,mouseCoordinates:f,originalEvent:l,data:y})=>Array.isArray(c)&&Array.isArray(f)&&Array.isArray(y),mouseenter:({pixel:c,mouseCoordinates:f,coordinates:l,properties:y,originalEvent:p})=>Array.isArray(c)&&Array.isArray(f)&&Array.isArray(l)},ud={class:"mb-symbol-layer"},ld={name:"MbSymbolLayer"},hd=Te({...ld,props:ad,emits:od,setup(c,{expose:f,emit:l}){const y=c,p=l;let b=[];const I=Ir({type:"geojson",data:{type:"FeatureCollection",features:[]}}),h=Ir({type:"geojson",data:{type:"FeatureCollection",features:[]}}),N=Be(()=>{const Y={"symbol-placement":y.symbolPlacement,"symbol-spacing":y.symbolSpacing,"symbol-avoid-edges":y.symbolAvoidEdges,"symbol-z-order":y.symbolZOrder,visibility:""};return(y.iconImage||y.iconImageField)&&Object.assign(Y,{"icon-allow-overlap":y.iconAllowOverlap,"icon-anchor":y.iconAnchor,"icon-image":y.iconImageField?["get",y.iconImageField]:y.iconImage,"icon-size":y.iconSize,"icon-offset":y.iconOffset,"icon-optional":y.iconOptional,"icon-ignore-placement":y.iconIgnorePlacement,"icon-rotate":y.iconRotate,"icon-rotation-alignment":y.iconRotationAlignment}),(y.textField||y.text)&&Object.assign(Y,{"text-allow-overlap":y.textAllowOverlap,"text-anchor":y.textAnchor,"text-field":y.useExpression?y.textField:y.textField?["get",y.textField]:y.text,"text-font":y.textFont,"text-letter-spacing":y.textLetterSpacing,"text-line-height":y.textLineHeight,"text-max-width":y.textMaxWidth,"text-offset":y.textOffset,"text-optional":y.textOptional,"text-size":y.textSize,"text-padding":y.textPadding}),Y.visibility=y.show?"visible":"none",Y}),E=Be(()=>{const Y={};return y.iconImage&&Object.assign(Y,{"icon-color":y.iconColor,"icon-opacity":y.iconOpacity,"icon-translate":y.iconTranslate}),(y.textField||y.text)&&Object.assign(Y,{"text-color":y.textColor,"text-opacity":y.textOpacity,"text-translate":y.textTranslate,"text-translate-anchor":y.textTranslateAnchor,"text-halo-color":y.textHaloColor,"text-halo-width":y.textHaloWidth,"text-halo-blur":y.textHaloBlur}),Y}),S=Be(()=>{if(!y.cluster)return;const Y={"text-field":"{point_count_abbreviated}","text-font":y.textFont,"text-size":["step",["get","point_count"]],"text-allow-overlap":!0,"text-optional":!0,"icon-image":["step",["get","point_count"]],"icon-allow-overlap":!0,"icon-size":y.clusterIconSize,"icon-offset":y.clusterIconOffset,"icon-anchor":y.clusterIconAnchor,visibility:""};if(y.clusterIcons.length>1)y.clusterIcons.forEach(({count:Z,iconName:ee,functionName:V,textSize:Q},J)=>{if(ee)Z!==void 0?Y["icon-image"].push(ee,Z):Y["icon-image"].push(ee);else if(V)Z!==void 0?(Y["icon-image"].push(A(y.clusterIcons[J]),Z),Y["text-size"].push(Q,Z)):(Y["icon-image"].push(A(y.clusterIcons[J])),Y["text-size"].push(Q));else throw new Error("Icon configuration information is incorrect, no iconName or functionName")});else{const Z=y.clusterIcons[0];if(Z.iconName)Y["icon-image"]=Z.iconName;else if(Z.functionName)Y["icon-image"]=A(Z);else throw new Error("Icon configuration information is incorrect, no iconName or functionName");Y["text-size"]=Z.textSize?Z.textSize:14}return Y.visibility=y.show?"visible":"none",Y}),_=Be(()=>{if(!y.cluster)return;const Y={"text-color":["step",["get","point_count"]],"icon-translate":y.clusterIconTranslate};return y.clusterIcons.length>1?y.clusterIcons.forEach(({count:Z,textColor:ee})=>{Z!==void 0?Y["text-color"].push(`${ee}`,Z):Y["text-color"].push(`${ee}`)}):Y["text-color"]=y.clusterIcons[0].textColor,Y}),L=Be(()=>Object.assign({},N.value,{"icon-allow-overlap":!0,"text-allow-overlap":!0,"text-optional":!0})),k=Be(()=>{if(!(!y.cluster||!y.spiderify))return{"line-color":y.spiderLegColor,"line-width":y.spiderLegWidth}}),A=Y=>{const{functionName:Z,textColor:ee="",functionProps:V={},count:Q}=Y;return Y.count!==void 0?`cluster-icon-${typeof Z=="string"?Z:Z.name}-${ee+V.color}-${Q}`:`cluster-icon-${typeof Z=="string"?Z:Z.name}-${ee+V.color}-max`},t=()=>{const Y=j();y.clusterIcons.length>0&&y.clusterIcons.forEach(({iconName:Z,functionName:ee,functionProps:V},Q)=>{if(Z)return;const J=A(y.clusterIcons[Q]);Y.hasImage(J)||(Y.addImage(J,typeof ee=="string"?ao[ee](Y,V):ee(Y),{pixelRatio:2}),b.push(J))})},a=()=>{const Y=j();y.cluster&&(b=[],t()),Y.on("click",`cluster-${$}`,u),Y.on("click",`spider-leaf-${$}`,T),Y.on("mousemove",`spider-leaf-${$}`,O),Y.on("mouseenter",`spider-leaf-${$}`,P),Y.on("mouseleave",`spider-leaf-${$}`,D),Y.on("click",`uncluster-${$}`,T),Y.on("mousemove",`uncluster-${$}`,O),Y.on("mouseenter",`uncluster-${$}`,P),Y.on("mouseleave",`uncluster-${$}`,D)},u=Y=>{if(!y.pickable||!y.cluster||Y.originalEvent.cancelBubble)return;const Z=j(),ee=Z.queryRenderedFeatures(Y.point,{layers:[`cluster-${$}`]}),V=ee[0].properties.cluster_id,Q=Z.getSource($),J=ee[0].geometry.coordinates;y.spiderify?Q.getClusterLeaves(V,255,0,(ve,le)=>{if(ve)return;let fe=!0;if(le.length>y.maxLeafesTospiderify)fe=!1;else{const[re,de]=le[0].geometry.coordinates,be=10**y.comparePrecision,me=Math.trunc(re*be),F=Math.trunc(de*be);for(let Ne=1;Ne<le.length;Ne++){const{coordinates:G}=le[Ne].geometry;if(me!==Math.trunc(be*G[0])||F!==Math.trunc(be*G[1])){fe=!1;break}}}if(fe||Z.getZoom()>=y.clusterMaxZoom){const re=Z.project(J),de=le.slice(),be=[];let me;le.length>y.clusterSpiralPoints?me=v(de.length):me=w(de.length),de.forEach((F,Ne)=>{const G=Z.unproject([re.x+me[Ne].x,re.y+me[Ne].y]);F.geometry.coordinates=[G.lng,G.lat],be.push({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[J,[G.lng,G.lat]]}})}),I.data=bi(be),h.data=bi(de),Z.once("pitchstart",()=>{I.data={type:"FeatureCollection",features:[]},h.data={type:"FeatureCollection",features:[]}}),Z.once("zoomstart",()=>{I.data={type:"FeatureCollection",features:[]},h.data={type:"FeatureCollection",features:[]}}),p("clusterclick",{pixel:Object.values(Y.point),mouseCoordinates:Y.lngLat.toArray(),data:le.map(F=>({coordinates:F.geometry.coordinates,properties:F.properties})),originalEvent:Y.originalEvent})}else g(Q,V,J)}):g(Q,V,J),Y.originalEvent.cancelBubble=!0},g=(Y,Z,ee)=>{const V=j();Y.getClusterExpansionZoom(Z,(Q,J)=>{Q||V.easeTo({center:ee,zoom:J})})},v=Y=>{const Z={rotationsModifier:1250,distanceBetweenPoints:y.distanceBetweenSpiderPoints*.8,radiusModifier:5e4,lengthModifier:1e3},ee=[{x:0,y:0}],V=Y*Z.rotationsModifier,Q=Z.distanceBetweenPoints,J=Y*Z.radiusModifier,ve=V*2*Math.PI,le=J/ve;for(let fe=Q/le;ee.length<=Y+Z.lengthModifier;)ee.push({x:Math.cos(fe)*(le*fe),y:Math.sin(fe)*(le*fe)}),fe+=Q/(le*fe);return ee.slice(0,Y)},w=Y=>{const Z=[],ee=Math.PI*2/Y;for(let V=0;V<Y;V++){const Q=ee*V;Z.push({x:y.distanceBetweenSpiderPoints*Math.cos(Q),y:y.distanceBetweenSpiderPoints*Math.sin(Q)})}return Z},T=Y=>{if(!y.pickable)return;const{point:Z,features:ee}=Y;p("click",{pixel:Object.values(Z),mouseCoordinates:Y.lngLat.toArray(),coordinates:ee[0].geometry.coordinates,properties:ee[0].properties,originalEvent:Y.originalEvent})},O=Y=>{y.pickable&&p("mousemove",{pixel:Object.values(Y.point),mouseCoordinates:Y.lngLat.toArray(),coordinates:Y.features[0].geometry.coordinates,properties:Y.features[0].properties,originalEvent:Y.originalEvent})},P=Y=>{y.pickable&&p("mouseenter",{pixel:Object.values(Y.point),mouseCoordinates:Y.lngLat.toArray(),coordinates:Y.features[0].geometry.coordinates,properties:Y.features[0].properties,originalEvent:Y.originalEvent})},D=Y=>{y.pickable&&p("mouseleave",Y)},z=()=>{I.data={type:"FeatureCollection",features:[]},h.data={type:"FeatureCollection",features:[]}},{getMapboxInstance:j}=He(a),{sourceIdInternal:$,geoJsonSource:X,createdHandler:oe,exportToGeoJson:W}=Ri(y,{geoType:"point"});return ue(()=>y.data,()=>{z()}),ue(()=>[y.cluster,y.spiderify],()=>{(!y.cluster||!y.spiderify)&&z()}),ue(()=>[y.cluster,y.clusterIcons],()=>{y.cluster&&t()},{deep:!0}),it(()=>{const Y=j();Y&&(b.length&&b.forEach(Z=>{Y.removeImage(Z)}),Y.off("click",`cluster-${$}`,u),Y.off("click",`spider-leaf-${$}`,T),Y.off("mousemove",`spider-leaf-${$}`,O),Y.off("mouseenter",`spider-leaf-${$}`,P),Y.off("mouseleave",`spider-leaf-${$}`,D),Y.off("click",`uncluster-${$}`,T),Y.off("mousemove",`uncluster-${$}`,O),Y.off("mouseenter",`uncluster-${$}`,P),Y.off("mouseleave",`uncluster-${$}`,D))}),f({exportToGeoJson:W}),(Y,Z)=>(Se(),je("i",ud,[Y.sourceId?wt("",!0):(Se(),Me(ce(lt),{key:0,id:ce($),"geo-json-source":ce(X)},null,8,["id","geo-json-source"])),Y.cluster?(Se(),Me(ce(ut),{key:1,id:"cluster-"+ce($),type:"symbol","source-layer":Y.sourceLayerName,"before-id":Y.beforeId,"source-id":ce($),filter:["has","point_count"],layout:S.value,paint:_.value,maxzoom:Y.clusterMaxZoom+1,minzoom:Y.minzoom,metadata:{mbLayerId:Y.id}},null,8,["id","source-layer","before-id","source-id","layout","paint","maxzoom","minzoom","metadata"])):wt("",!0),Ci(ce(ut),{id:"uncluster-"+ce($),type:"symbol","source-layer":Y.sourceLayerName,"before-id":Y.beforeId,"source-id":ce($),layout:N.value,paint:E.value,filter:["!",["has","point_count"]],maxzoom:Y.maxzoom,minzoom:Y.minzoom,metadata:{mbLayerId:Y.id},onCreated:ce(oe)},null,8,["id","source-layer","before-id","source-id","layout","paint","maxzoom","minzoom","metadata","onCreated"]),Y.spiderify&&Y.cluster?(Se(),Me(ce(lt),{key:2,id:"spider-leg-"+ce($),"geo-json-source":I},null,8,["id","geo-json-source"])):wt("",!0),Y.spiderify&&Y.cluster?(Se(),Me(ce(ut),{key:3,id:"spider-leg-"+ce($),type:"line","source-id":"spider-leg-"+ce($),paint:k.value,metadata:{mbLayerId:Y.id}},null,8,["id","source-id","paint","metadata"])):wt("",!0),Y.spiderify&&Y.cluster?(Se(),Me(ce(lt),{key:4,id:"spider-leaf-"+ce($),"geo-json-source":h},null,8,["id","geo-json-source"])):wt("",!0),Y.spiderify&&Y.cluster?(Se(),Me(ce(ut),{key:5,id:"spider-leaf-"+ce($),type:"symbol","source-id":"spider-leaf-"+ce($),layout:L.value,paint:E.value,metadata:{mbLayerId:Y.id}},null,8,["id","source-id","layout","paint","metadata"])):wt("",!0)]))}}),cd=Ae(hd),fd={url:{type:String,required:!0},format:{type:String,default:"image/png"},layerName:{type:String,required:!0},layerStyle:{type:String,required:!0},tileMatrixSetID:{type:String,required:!0},tileMatrixPrefix:String,tileSize:{type:Number,default:256},subdomains:[String,Array],maxzoom:{type:Number,default:22},minzoom:{type:Number,default:0},show:{type:Boolean,default:!0},id:{type:String,default:()=>De()},beforeId:{type:String},extraParams:{type:String,default:""}},dd={created:()=>!0},gd={name:"MbWmtsLayer"},pd=Te({...gd,props:fd,emits:dd,setup(c,{emit:f}){const l=c,y=f,p=De(),b=Be(()=>({visibility:l.show?"visible":"none"})),I=Be(()=>{const{url:N,format:E,layerName:S,layerStyle:_,tileMatrixSetID:L,subdomains:k,tileMatrixPrefix:A="",tileSize:t,extraParams:a}=l,u=N.includes("?")?`${N}&`:`${N}?`,g={type:"raster",scheme:"xyz",tiles:[],tileSize:t,minzoom:l.minzoom,maxzoom:l.maxzoom};if(k){let v=[];Array.isArray(k)?v=k.slice().map(String):k.length>0&&(v=k.split("")),v.forEach(w=>{const T=u.replace(/{(.*?)}/g,(O,P)=>P==="s"?w:O);g.tiles.push(`${T}layer=${S}&style=${_}&tilematrixset=${L}&Service=WMTS&Request=GetTile&Version=1.0.0&Format=${E}&TileMatrix=${A}{z}&TileCol={x}&TileRow={y}${a?`&${a}`:""}`)})}else g.tiles[0]=`${u}layer=${S}&style=${_}&tilematrixset=${L}&Service=WMTS&Request=GetTile&Version=1.0.0&Format=${E}&TileMatrix=${A}{z}&TileCol={x}&TileRow={y}${a?`&${a}`:""}`;return g}),h=()=>{y("created")};return(N,E)=>(Se(),Me(ce(ut),{id:N.id,"source-id":ce(p),type:"raster",layout:b.value,"before-id":N.beforeId,class:"mb-wmts-layer",onCreated:h},{default:Bt(()=>[Ci(ce(lt),{id:ce(p),"tile-json-source":I.value},null,8,["id","tile-json-source"])]),_:1},8,["id","source-id","layout","before-id"]))}}),go=Ae(pd),yd={types:{type:Array,default:()=>["vec","cva"]},token:{type:String,default:"b8ed92ff9b64aebcb0110acca15e478f"},maxzoom:{type:Number,default:18},minzoom:{type:Number,default:1},show:{type:Boolean,default:!0},beforeId:String,id:{type:String,default:()=>De()}},md={created:()=>!0},vd={class:"mb-tianditu-layer"},_d={name:"MbTiandituLayer"},xd=Te({..._d,props:yd,emits:md,setup(c,{emit:f}){const l=c,y=f,p=Be(()=>{const{types:I,token:h}=l;let{protocol:N}=window.location;return N.includes("about:")&&(N=window.parent.location.protocol),I.map(E=>`${N}//t{s}.tianditu.gov.cn/${E}_w/wmts?tk=${h}`)}),b=I=>{I===l.types.length-1&&y("created")};return(I,h)=>(Se(),je("i",vd,[(Se(!0),je(Zu,null,Wu(I.types,(N,E)=>(Se(),Me(ce(go),{key:E,url:p.value[E],"layer-name":N,maxzoom:I.maxzoom,minzoom:I.minzoom,show:I.show,"layer-style":"default","tile-matrix-set-i-d":"w",subdomains:"01234567",format:"tiles","before-id":I.beforeId,onCreated:S=>b(E)},null,8,["url","layer-name","maxzoom","minzoom","show","before-id","onCreated"]))),128))]))}}),Ed=Ae(xd),bd={url:{type:String,required:!0},subdomains:[String,Array],scheme:{type:String,default:"xyz",validator:c=>["xyz","tms"].includes(c)},maxzoom:{type:Number,default:22},minzoom:{type:Number,default:0},show:{type:Boolean,default:!0},beforeId:{type:String},id:{type:String,default:()=>De()},extendSource:{type:Object,default:()=>({})}},Sd={created:()=>!0},Id={name:"MbUrlTemplateLayer"},wd=Te({...Id,props:bd,emits:Sd,setup(c,{emit:f}){const l=c,y=f,p=De(),b=Be(()=>({visibility:l.show?"visible":"none"})),I=Be(()=>{const{url:N,subdomains:E,scheme:S,maxzoom:_,minzoom:L,extendSource:k}=l,A={type:"raster",scheme:S,tiles:[],tileSize:256,minzoom:L,maxzoom:_,...k};if(E){let t=[];Array.isArray(E)?t=E.slice().map(String):E.length>0&&(t=E.split("")),t.forEach(a=>{const u=N.replace(/{(.*?)}/g,(g,v)=>v==="s"?a:g);A.tiles.push(u)})}else A.tiles.push(N);return A}),h=()=>{y("created")};return(N,E)=>(Se(),Me(ce(ut),{id:N.id,"source-id":ce(p),type:"raster",layout:b.value,"before-id":N.beforeId,class:"mb-url-template-layer",onCreated:h},{default:Bt(()=>[Ci(ce(lt),{id:ce(p),"tile-json-source":I.value},null,8,["id","tile-json-source"])]),_:1},8,["id","source-id","layout","before-id"]))}}),kd=Ae(wd),Cd={urls:{type:Array,required:!0},coordinates:{type:Array,required:!0},show:{type:Boolean,default:!0},beforeId:String,id:{type:String,default:()=>De()}},Nd={created:()=>!0},Ld={name:"MbVideoLayer"},Td=Te({...Ld,props:Cd,emits:Nd,setup(c,{emit:f}){const l=c,y=f,p=De(),b=Be(()=>({visibility:l.show?"visible":"none"})),I=Be(()=>({type:"video",urls:l.urls,coordinates:l.coordinates})),h=()=>{y("created")};return(N,E)=>(Se(),Me(ce(ut),{id:N.id,"source-id":ce(p),type:"raster",layout:b.value,"before-id":N.beforeId,class:"mb-video-layer",onCreated:h},{default:Bt(()=>[Ci(ce(lt),{id:ce(p),"tile-json-source":I.value},null,8,["id","tile-json-source"])]),_:1},8,["id","source-id","layout","before-id"]))}}),Ad=Ae(Td);var xn={};(function(c){var f=function(){var t=new Date,a=4,u=3,g=2,v=1,w=a,T={setLogLevel:function(O){O==this.debug?w=v:O==this.info?w=g:O==this.warn?w=u:(O==this.error,w=a)},debug:function(O,P){console.debug===void 0&&(console.debug=console.log),v>=w&&console.debug("["+f.getDurationString(new Date-t,1e3)+"]","["+O+"]",P)},log:function(O,P){this.debug(O.msg)},info:function(O,P){g>=w&&console.info("["+f.getDurationString(new Date-t,1e3)+"]","["+O+"]",P)},warn:function(O,P){u>=w&&console.warn("["+f.getDurationString(new Date-t,1e3)+"]","["+O+"]",P)},error:function(O,P){a>=w&&console.error("["+f.getDurationString(new Date-t,1e3)+"]","["+O+"]",P)}};return T}();f.getDurationString=function(t,a){var u;function g(D,z){for(var j=""+D,$=j.split(".");$[0].length<z;)$[0]="0"+$[0];return $.join(".")}t<0?(u=!0,t=-t):u=!1;var v=a||1,w=t/v,T=Math.floor(w/3600);w-=T*3600;var O=Math.floor(w/60);w-=O*60;var P=w*1e3;return w=Math.floor(w),P-=w*1e3,P=Math.floor(P),(u?"-":"")+T+":"+g(O,2)+":"+g(w,2)+"."+g(P,3)},f.printRanges=function(t){var a=t.length;if(a>0){for(var u="",g=0;g<a;g++)g>0&&(u+=","),u+="["+f.getDurationString(t.start(g))+","+f.getDurationString(t.end(g))+"]";return u}else return"(empty)"},c.Log=f;var l=function(t){if(t instanceof ArrayBuffer)this.buffer=t,this.dataview=new DataView(t);else throw"Needs an array buffer";this.position=0};l.prototype.getPosition=function(){return this.position},l.prototype.getEndPosition=function(){return this.buffer.byteLength},l.prototype.getLength=function(){return this.buffer.byteLength},l.prototype.seek=function(t){var a=Math.max(0,Math.min(this.buffer.byteLength,t));return this.position=isNaN(a)||!isFinite(a)?0:a,!0},l.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},l.prototype.readAnyInt=function(t,a){var u=0;if(this.position+t<=this.buffer.byteLength){switch(t){case 1:a?u=this.dataview.getInt8(this.position):u=this.dataview.getUint8(this.position);break;case 2:a?u=this.dataview.getInt16(this.position):u=this.dataview.getUint16(this.position);break;case 3:if(a)throw"No method for reading signed 24 bits values";u=this.dataview.getUint8(this.position)<<16,u|=this.dataview.getUint8(this.position+1)<<8,u|=this.dataview.getUint8(this.position+2);break;case 4:a?u=this.dataview.getInt32(this.position):u=this.dataview.getUint32(this.position);break;case 8:if(a)throw"No method for reading signed 64 bits values";u=this.dataview.getUint32(this.position)<<32,u|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+t}return this.position+=t,u}else throw"Not enough bytes in buffer"},l.prototype.readUint8=function(){return this.readAnyInt(1,!1)},l.prototype.readUint16=function(){return this.readAnyInt(2,!1)},l.prototype.readUint24=function(){return this.readAnyInt(3,!1)},l.prototype.readUint32=function(){return this.readAnyInt(4,!1)},l.prototype.readUint64=function(){return this.readAnyInt(8,!1)},l.prototype.readString=function(t){if(this.position+t<=this.buffer.byteLength){for(var a="",u=0;u<t;u++)a+=String.fromCharCode(this.readUint8());return a}else throw"Not enough bytes in buffer"},l.prototype.readCString=function(){for(var t=[];;){var a=this.readUint8();if(a!==0)t.push(a);else break}return String.fromCharCode.apply(null,t)},l.prototype.readInt8=function(){return this.readAnyInt(1,!0)},l.prototype.readInt16=function(){return this.readAnyInt(2,!0)},l.prototype.readInt32=function(){return this.readAnyInt(4,!0)},l.prototype.readInt64=function(){return this.readAnyInt(8,!1)},l.prototype.readUint8Array=function(t){for(var a=new Uint8Array(t),u=0;u<t;u++)a[u]=this.readUint8();return a},l.prototype.readInt16Array=function(t){for(var a=new Int16Array(t),u=0;u<t;u++)a[u]=this.readInt16();return a},l.prototype.readUint16Array=function(t){for(var a=new Int16Array(t),u=0;u<t;u++)a[u]=this.readUint16();return a},l.prototype.readUint32Array=function(t){for(var a=new Uint32Array(t),u=0;u<t;u++)a[u]=this.readUint32();return a},l.prototype.readInt32Array=function(t){for(var a=new Int32Array(t),u=0;u<t;u++)a[u]=this.readInt32();return a},c.MP4BoxStream=l;var y=function(t,a,u){this._byteOffset=a||0,t instanceof ArrayBuffer?this.buffer=t:typeof t=="object"?(this.dataView=t,a&&(this._byteOffset+=a)):this.buffer=new ArrayBuffer(t||0),this.position=0,this.endianness=u??y.LITTLE_ENDIAN};y.prototype={},y.prototype.getPosition=function(){return this.position},y.prototype._realloc=function(t){if(this._dynamicSize){var a=this._byteOffset+this.position+t,u=this._buffer.byteLength;if(a<=u){a>this._byteLength&&(this._byteLength=a);return}for(u<1&&(u=1);a>u;)u*=2;var g=new ArrayBuffer(u),v=new Uint8Array(this._buffer),w=new Uint8Array(g,0,v.length);w.set(v),this.buffer=g,this._byteLength=a}},y.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var t=new ArrayBuffer(this._byteLength),a=new Uint8Array(t),u=new Uint8Array(this._buffer,0,a.length);a.set(u),this.buffer=t}},y.BIG_ENDIAN=!1,y.LITTLE_ENDIAN=!0,y.prototype._byteLength=0,Object.defineProperty(y.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(y.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(t){this._buffer=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(y.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(t){this._byteOffset=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(y.prototype,"dataView",{get:function(){return this._dataView},set:function(t){this._byteOffset=t.byteOffset,this._buffer=t.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+t.byteLength}}),y.prototype.seek=function(t){var a=Math.max(0,Math.min(this.byteLength,t));this.position=isNaN(a)||!isFinite(a)?0:a},y.prototype.isEof=function(){return this.position>=this._byteLength},y.prototype.mapUint8Array=function(t){this._realloc(t*1);var a=new Uint8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=t*1,a},y.prototype.readInt32Array=function(t,a){t=t??this.byteLength-this.position/4;var u=new Int32Array(t);return y.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,t*u.BYTES_PER_ELEMENT),y.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},y.prototype.readInt16Array=function(t,a){t=t??this.byteLength-this.position/2;var u=new Int16Array(t);return y.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,t*u.BYTES_PER_ELEMENT),y.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},y.prototype.readInt8Array=function(t){t=t??this.byteLength-this.position;var a=new Int8Array(t);return y.memcpy(a.buffer,0,this.buffer,this.byteOffset+this.position,t*a.BYTES_PER_ELEMENT),this.position+=a.byteLength,a},y.prototype.readUint32Array=function(t,a){t=t??this.byteLength-this.position/4;var u=new Uint32Array(t);return y.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,t*u.BYTES_PER_ELEMENT),y.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},y.prototype.readUint16Array=function(t,a){t=t??this.byteLength-this.position/2;var u=new Uint16Array(t);return y.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,t*u.BYTES_PER_ELEMENT),y.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},y.prototype.readUint8Array=function(t){t=t??this.byteLength-this.position;var a=new Uint8Array(t);return y.memcpy(a.buffer,0,this.buffer,this.byteOffset+this.position,t*a.BYTES_PER_ELEMENT),this.position+=a.byteLength,a},y.prototype.readFloat64Array=function(t,a){t=t??this.byteLength-this.position/8;var u=new Float64Array(t);return y.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,t*u.BYTES_PER_ELEMENT),y.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},y.prototype.readFloat32Array=function(t,a){t=t??this.byteLength-this.position/4;var u=new Float32Array(t);return y.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,t*u.BYTES_PER_ELEMENT),y.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},y.prototype.readInt32=function(t){var a=this._dataView.getInt32(this.position,t??this.endianness);return this.position+=4,a},y.prototype.readInt16=function(t){var a=this._dataView.getInt16(this.position,t??this.endianness);return this.position+=2,a},y.prototype.readInt8=function(){var t=this._dataView.getInt8(this.position);return this.position+=1,t},y.prototype.readUint32=function(t){var a=this._dataView.getUint32(this.position,t??this.endianness);return this.position+=4,a},y.prototype.readUint16=function(t){var a=this._dataView.getUint16(this.position,t??this.endianness);return this.position+=2,a},y.prototype.readUint8=function(){var t=this._dataView.getUint8(this.position);return this.position+=1,t},y.prototype.readFloat32=function(t){var a=this._dataView.getFloat32(this.position,t??this.endianness);return this.position+=4,a},y.prototype.readFloat64=function(t){var a=this._dataView.getFloat64(this.position,t??this.endianness);return this.position+=8,a},y.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,y.memcpy=function(t,a,u,g,v){var w=new Uint8Array(t,a,v),T=new Uint8Array(u,g,v);w.set(T)},y.arrayToNative=function(t,a){return a==this.endianness?t:this.flipArrayEndianness(t)},y.nativeToEndian=function(t,a){return this.endianness==a?t:this.flipArrayEndianness(t)},y.flipArrayEndianness=function(t){for(var a=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),u=0;u<t.byteLength;u+=t.BYTES_PER_ELEMENT)for(var g=u+t.BYTES_PER_ELEMENT-1,v=u;g>v;g--,v++){var w=a[v];a[v]=a[g],a[g]=w}return t},y.prototype.failurePosition=0,String.fromCharCodeUint8=function(t){for(var a=[],u=0;u<t.length;u++)a[u]=t[u];return String.fromCharCode.apply(null,a)},y.prototype.readString=function(t,a){return a==null||a=="ASCII"?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(t??this.byteLength-this.position)]):new TextDecoder(a).decode(this.mapUint8Array(t))},y.prototype.readCString=function(t){var a=this.byteLength-this.position,u=new Uint8Array(this._buffer,this._byteOffset+this.position),g=a;t!=null&&(g=Math.min(t,a));for(var v=0;v<g&&u[v]!==0;v++);var w=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(v)]);return t!=null?this.position+=g-v:v!=a&&(this.position+=1),w};var p=Math.pow(2,32);y.prototype.readInt64=function(){return this.readInt32()*p+this.readUint32()},y.prototype.readUint64=function(){return this.readUint32()*p+this.readUint32()},y.prototype.readInt64=function(){return this.readUint32()*p+this.readUint32()},y.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},c.DataStream=y,y.prototype.save=function(t){var a=new Blob([this.buffer]);if(window.URL&&URL.createObjectURL){var u=window.URL.createObjectURL(a),g=document.createElement("a");document.body.appendChild(g),g.setAttribute("href",u),g.setAttribute("download",t),g.setAttribute("target","_self"),g.click(),window.URL.revokeObjectURL(u)}else throw"DataStream.save: Can't create object URL."},y.prototype._dynamicSize=!0,Object.defineProperty(y.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(t){t||this._trimAlloc(),this._dynamicSize=t}}),y.prototype.shift=function(t){var a=new ArrayBuffer(this._byteLength-t),u=new Uint8Array(a),g=new Uint8Array(this._buffer,t,u.length);u.set(g),this.buffer=a,this.position-=t},y.prototype.writeInt32Array=function(t,a){if(this._realloc(t.length*4),t instanceof Int32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)y.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt32Array(t.length,a);else for(var u=0;u<t.length;u++)this.writeInt32(t[u],a)},y.prototype.writeInt16Array=function(t,a){if(this._realloc(t.length*2),t instanceof Int16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)y.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt16Array(t.length,a);else for(var u=0;u<t.length;u++)this.writeInt16(t[u],a)},y.prototype.writeInt8Array=function(t){if(this._realloc(t.length*1),t instanceof Int8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)y.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt8Array(t.length);else for(var a=0;a<t.length;a++)this.writeInt8(t[a])},y.prototype.writeUint32Array=function(t,a){if(this._realloc(t.length*4),t instanceof Uint32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)y.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint32Array(t.length,a);else for(var u=0;u<t.length;u++)this.writeUint32(t[u],a)},y.prototype.writeUint16Array=function(t,a){if(this._realloc(t.length*2),t instanceof Uint16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)y.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint16Array(t.length,a);else for(var u=0;u<t.length;u++)this.writeUint16(t[u],a)},y.prototype.writeUint8Array=function(t){if(this._realloc(t.length*1),t instanceof Uint8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)y.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint8Array(t.length);else for(var a=0;a<t.length;a++)this.writeUint8(t[a])},y.prototype.writeFloat64Array=function(t,a){if(this._realloc(t.length*8),t instanceof Float64Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)y.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat64Array(t.length,a);else for(var u=0;u<t.length;u++)this.writeFloat64(t[u],a)},y.prototype.writeFloat32Array=function(t,a){if(this._realloc(t.length*4),t instanceof Float32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)y.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat32Array(t.length,a);else for(var u=0;u<t.length;u++)this.writeFloat32(t[u],a)},y.prototype.writeInt32=function(t,a){this._realloc(4),this._dataView.setInt32(this.position,t,a??this.endianness),this.position+=4},y.prototype.writeInt16=function(t,a){this._realloc(2),this._dataView.setInt16(this.position,t,a??this.endianness),this.position+=2},y.prototype.writeInt8=function(t){this._realloc(1),this._dataView.setInt8(this.position,t),this.position+=1},y.prototype.writeUint32=function(t,a){this._realloc(4),this._dataView.setUint32(this.position,t,a??this.endianness),this.position+=4},y.prototype.writeUint16=function(t,a){this._realloc(2),this._dataView.setUint16(this.position,t,a??this.endianness),this.position+=2},y.prototype.writeUint8=function(t){this._realloc(1),this._dataView.setUint8(this.position,t),this.position+=1},y.prototype.writeFloat32=function(t,a){this._realloc(4),this._dataView.setFloat32(this.position,t,a??this.endianness),this.position+=4},y.prototype.writeFloat64=function(t,a){this._realloc(8),this._dataView.setFloat64(this.position,t,a??this.endianness),this.position+=8},y.prototype.writeUCS2String=function(t,a,u){u==null&&(u=t.length);for(var g=0;g<t.length&&g<u;g++)this.writeUint16(t.charCodeAt(g),a);for(;g<u;g++)this.writeUint16(0)},y.prototype.writeString=function(t,a,u){var g=0;if(a==null||a=="ASCII")if(u!=null){var v=Math.min(t.length,u);for(g=0;g<v;g++)this.writeUint8(t.charCodeAt(g));for(;g<u;g++)this.writeUint8(0)}else for(g=0;g<t.length;g++)this.writeUint8(t.charCodeAt(g));else this.writeUint8Array(new TextEncoder(a).encode(t.substring(0,u)))},y.prototype.writeCString=function(t,a){var u=0;if(a!=null){var g=Math.min(t.length,a);for(u=0;u<g;u++)this.writeUint8(t.charCodeAt(u));for(;u<a;u++)this.writeUint8(0)}else{for(u=0;u<t.length;u++)this.writeUint8(t.charCodeAt(u));this.writeUint8(0)}},y.prototype.writeStruct=function(t,a){for(var u=0;u<t.length;u+=2){var g=t[u+1];this.writeType(g,a[t[u]],a)}},y.prototype.writeType=function(t,a,u){var g;if(typeof t=="function")return t(this,a);if(typeof t=="object"&&!(t instanceof Array))return t.set(this,a,u);var v=null,w="ASCII",T=this.position;switch(typeof t=="string"&&/:/.test(t)&&(g=t.split(":"),t=g[0],v=parseInt(g[1])),typeof t=="string"&&/,/.test(t)&&(g=t.split(","),t=g[0],w=parseInt(g[1])),t){case"uint8":this.writeUint8(a);break;case"int8":this.writeInt8(a);break;case"uint16":this.writeUint16(a,this.endianness);break;case"int16":this.writeInt16(a,this.endianness);break;case"uint32":this.writeUint32(a,this.endianness);break;case"int32":this.writeInt32(a,this.endianness);break;case"float32":this.writeFloat32(a,this.endianness);break;case"float64":this.writeFloat64(a,this.endianness);break;case"uint16be":this.writeUint16(a,y.BIG_ENDIAN);break;case"int16be":this.writeInt16(a,y.BIG_ENDIAN);break;case"uint32be":this.writeUint32(a,y.BIG_ENDIAN);break;case"int32be":this.writeInt32(a,y.BIG_ENDIAN);break;case"float32be":this.writeFloat32(a,y.BIG_ENDIAN);break;case"float64be":this.writeFloat64(a,y.BIG_ENDIAN);break;case"uint16le":this.writeUint16(a,y.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(a,y.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(a,y.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(a,y.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(a,y.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(a,y.LITTLE_ENDIAN);break;case"cstring":this.writeCString(a,v);break;case"string":this.writeString(a,w,v);break;case"u16string":this.writeUCS2String(a,this.endianness,v);break;case"u16stringle":this.writeUCS2String(a,y.LITTLE_ENDIAN,v);break;case"u16stringbe":this.writeUCS2String(a,y.BIG_ENDIAN,v);break;default:if(t.length==3){for(var O=t[1],P=0;P<a.length;P++)this.writeType(O,a[P]);break}else{this.writeStruct(t,a);break}}v!=null&&(this.position=T,this._realloc(v),this.position=T+v)},y.prototype.writeUint64=function(t){var a=Math.floor(t/p);this.writeUint32(a),this.writeUint32(t&4294967295)},y.prototype.writeUint24=function(t){this.writeUint8((t&16711680)>>16),this.writeUint8((t&65280)>>8),this.writeUint8(t&255)},y.prototype.adjustUint32=function(t,a){var u=this.position;this.seek(t),this.writeUint32(a),this.seek(u)},y.prototype.mapInt32Array=function(t,a){this._realloc(t*4);var u=new Int32Array(this._buffer,this.byteOffset+this.position,t);return y.arrayToNative(u,a??this.endianness),this.position+=t*4,u},y.prototype.mapInt16Array=function(t,a){this._realloc(t*2);var u=new Int16Array(this._buffer,this.byteOffset+this.position,t);return y.arrayToNative(u,a??this.endianness),this.position+=t*2,u},y.prototype.mapInt8Array=function(t){this._realloc(t*1);var a=new Int8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=t*1,a},y.prototype.mapUint32Array=function(t,a){this._realloc(t*4);var u=new Uint32Array(this._buffer,this.byteOffset+this.position,t);return y.arrayToNative(u,a??this.endianness),this.position+=t*4,u},y.prototype.mapUint16Array=function(t,a){this._realloc(t*2);var u=new Uint16Array(this._buffer,this.byteOffset+this.position,t);return y.arrayToNative(u,a??this.endianness),this.position+=t*2,u},y.prototype.mapFloat64Array=function(t,a){this._realloc(t*8);var u=new Float64Array(this._buffer,this.byteOffset+this.position,t);return y.arrayToNative(u,a??this.endianness),this.position+=t*8,u},y.prototype.mapFloat32Array=function(t,a){this._realloc(t*4);var u=new Float32Array(this._buffer,this.byteOffset+this.position,t);return y.arrayToNative(u,a??this.endianness),this.position+=t*4,u};var b=function(t){this.buffers=[],this.bufferIndex=-1,t&&(this.insertBuffer(t),this.bufferIndex=0)};b.prototype=new y(new ArrayBuffer,0,y.BIG_ENDIAN),b.prototype.initialized=function(){var t;return this.bufferIndex>-1?!0:this.buffers.length>0?(t=this.buffers[0],t.fileStart===0?(this.buffer=t,this.bufferIndex=0,f.debug("MultiBufferStream","Stream ready for parsing"),!0):(f.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1)):(f.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1)},ArrayBuffer.concat=function(t,a){f.debug("ArrayBuffer","Trying to create a new buffer of size: "+(t.byteLength+a.byteLength));var u=new Uint8Array(t.byteLength+a.byteLength);return u.set(new Uint8Array(t),0),u.set(new Uint8Array(a),t.byteLength),u.buffer},b.prototype.reduceBuffer=function(t,a,u){var g;return g=new Uint8Array(u),g.set(new Uint8Array(t,a,u)),g.buffer.fileStart=t.fileStart+a,g.buffer.usedBytes=0,g.buffer},b.prototype.insertBuffer=function(t){for(var a=!0,u=0;u<this.buffers.length;u++){var g=this.buffers[u];if(t.fileStart<=g.fileStart){if(t.fileStart===g.fileStart)if(t.byteLength>g.byteLength){this.buffers.splice(u,1),u--;continue}else f.warn("MultiBufferStream","Buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+") already appended, ignoring");else t.fileStart+t.byteLength<=g.fileStart||(t=this.reduceBuffer(t,0,g.fileStart-t.fileStart)),f.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.splice(u,0,t),u===0&&(this.buffer=t);a=!1;break}else if(t.fileStart<g.fileStart+g.byteLength){var v=g.fileStart+g.byteLength-t.fileStart,w=t.byteLength-v;if(w>0)t=this.reduceBuffer(t,v,w);else{a=!1;break}}}a&&(f.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.push(t),u===0&&(this.buffer=t))},b.prototype.logBufferLevel=function(t){var a,u,g,v,w=[],T,O="";for(g=0,v=0,a=0;a<this.buffers.length;a++)u=this.buffers[a],a===0?(T={},w.push(T),T.start=u.fileStart,T.end=u.fileStart+u.byteLength,O+="["+T.start+"-"):T.end===u.fileStart?T.end=u.fileStart+u.byteLength:(T={},T.start=u.fileStart,O+=w[w.length-1].end-1+"], ["+T.start+"-",T.end=u.fileStart+u.byteLength,w.push(T)),g+=u.usedBytes,v+=u.byteLength;w.length>0&&(O+=T.end-1+"]");var P=t?f.info:f.debug;this.buffers.length===0?P("MultiBufferStream","No more buffer in memory"):P("MultiBufferStream",""+this.buffers.length+" stored buffer(s) ("+g+"/"+v+" bytes), continuous ranges: "+O)},b.prototype.cleanBuffers=function(){var t,a;for(t=0;t<this.buffers.length;t++)a=this.buffers[t],a.usedBytes===a.byteLength&&(f.debug("MultiBufferStream","Removing buffer #"+t),this.buffers.splice(t,1),t--)},b.prototype.mergeNextBuffer=function(){var t;if(this.bufferIndex+1<this.buffers.length)if(t=this.buffers[this.bufferIndex+1],t.fileStart===this.buffer.fileStart+this.buffer.byteLength){var a=this.buffer.byteLength,u=this.buffer.usedBytes,g=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,t),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=u,this.buffer.fileStart=g,f.debug("ISOFile","Concatenating buffer for box parsing (length: "+a+"->"+this.buffer.byteLength+")"),!0}else return!1;else return!1},b.prototype.findPosition=function(t,a,u){var g,v=null,w=-1;for(t===!0?g=0:g=this.bufferIndex;g<this.buffers.length&&(v=this.buffers[g],v.fileStart<=a);){w=g,u&&(v.fileStart+v.byteLength<=a?v.usedBytes=v.byteLength:v.usedBytes=a-v.fileStart,this.logBufferLevel());g++}return w!==-1?(v=this.buffers[w],v.fileStart+v.byteLength>=a?(f.debug("MultiBufferStream","Found position in existing buffer #"+w),w):-1):-1},b.prototype.findEndContiguousBuf=function(t){var a,u,g,v=t!==void 0?t:this.bufferIndex;if(u=this.buffers[v],this.buffers.length>v+1)for(a=v+1;a<this.buffers.length&&(g=this.buffers[a],g.fileStart===u.fileStart+u.byteLength);a++)u=g;return u.fileStart+u.byteLength},b.prototype.getEndFilePositionAfter=function(t){var a=this.findPosition(!0,t,!1);return a!==-1?this.findEndContiguousBuf(a):t},b.prototype.addUsedBytes=function(t){this.buffer.usedBytes+=t,this.logBufferLevel()},b.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},b.prototype.seek=function(t,a,u){var g;return g=this.findPosition(a,t,u),g!==-1?(this.buffer=this.buffers[g],this.bufferIndex=g,this.position=t-this.buffer.fileStart,f.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(f.debug("MultiBufferStream","Position "+t+" not found in buffered data"),!1)},b.prototype.getPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},b.prototype.getLength=function(){return this.byteLength},b.prototype.getEndPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},c.MultiBufferStream=b;var I=function(){var t=3,a=4,u=5,g=6,v=[];v[t]="ES_Descriptor",v[a]="DecoderConfigDescriptor",v[u]="DecoderSpecificInfo",v[g]="SLConfigDescriptor",this.getDescriptorName=function(O){return v[O]};var w=this,T={};return this.parseOneDescriptor=function(O){var P=0,D,z,j;for(D=O.readUint8(),j=O.readUint8();j&128;)P=(P<<7)+(j&127),j=O.readUint8();return P=(P<<7)+(j&127),f.debug("MPEG4DescriptorParser","Found "+(v[D]||"Descriptor "+D)+", size "+P+" at position "+O.getPosition()),v[D]?z=new T[v[D]](P):z=new T.Descriptor(P),z.parse(O),z},T.Descriptor=function(O,P){this.tag=O,this.size=P,this.descs=[]},T.Descriptor.prototype.parse=function(O){this.data=O.readUint8Array(this.size)},T.Descriptor.prototype.findDescriptor=function(O){for(var P=0;P<this.descs.length;P++)if(this.descs[P].tag==O)return this.descs[P];return null},T.Descriptor.prototype.parseRemainingDescriptors=function(O){for(var P=O.position;O.position<P+this.size;){var D=w.parseOneDescriptor(O);this.descs.push(D)}},T.ES_Descriptor=function(O){T.Descriptor.call(this,t,O)},T.ES_Descriptor.prototype=new T.Descriptor,T.ES_Descriptor.prototype.parse=function(O){if(this.ES_ID=O.readUint16(),this.flags=O.readUint8(),this.size-=3,this.flags&128?(this.dependsOn_ES_ID=O.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,this.flags&64){var P=O.readUint8();this.URL=O.readString(P),this.size-=P+1}else this.URL="";this.flags&32?(this.OCR_ES_ID=O.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(O)},T.ES_Descriptor.prototype.getOTI=function(O){var P=this.findDescriptor(a);return P?P.oti:0},T.ES_Descriptor.prototype.getAudioConfig=function(O){var P=this.findDescriptor(a);if(!P)return null;var D=P.findDescriptor(u);if(D&&D.data){var z=(D.data[0]&248)>>3;return z===31&&D.data.length>=2&&(z=32+((D.data[0]&7)<<3)+((D.data[1]&224)>>5)),z}else return null},T.DecoderConfigDescriptor=function(O){T.Descriptor.call(this,a,O)},T.DecoderConfigDescriptor.prototype=new T.Descriptor,T.DecoderConfigDescriptor.prototype.parse=function(O){this.oti=O.readUint8(),this.streamType=O.readUint8(),this.upStream=(this.streamType>>1&1)!==0,this.streamType=this.streamType>>>2,this.bufferSize=O.readUint24(),this.maxBitrate=O.readUint32(),this.avgBitrate=O.readUint32(),this.size-=13,this.parseRemainingDescriptors(O)},T.DecoderSpecificInfo=function(O){T.Descriptor.call(this,u,O)},T.DecoderSpecificInfo.prototype=new T.Descriptor,T.SLConfigDescriptor=function(O){T.Descriptor.call(this,g,O)},T.SLConfigDescriptor.prototype=new T.Descriptor,this};c.MPEG4DescriptorParser=I;var h={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:["mdat","idat","free","skip","meco","strk"],FULL_BOXES:["hmhd","nmhd","iods","xml ","bxml","ipro","mere"],CONTAINER_BOXES:[["moov",["trak","pssh"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd","sbgp"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun","sgpd","sbgp"]],["vttc"],["tref"],["iref"],["mfra",["tfra"]],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp",["ipma"]],["ipco"],["grpl"],["j2kH"],["etyp",["tyco"]]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){h.FullBox.prototype=new h.Box,h.ContainerBox.prototype=new h.Box,h.SampleEntry.prototype=new h.Box,h.TrackGroupTypeBox.prototype=new h.FullBox,h.BASIC_BOXES.forEach(function(t){h.createBoxCtor(t)}),h.FULL_BOXES.forEach(function(t){h.createFullBoxCtor(t)}),h.CONTAINER_BOXES.forEach(function(t){h.createContainerBoxCtor(t[0],null,t[1])})},Box:function(t,a,u){this.type=t,this.size=a,this.uuid=u},FullBox:function(t,a,u){h.Box.call(this,t,a,u),this.flags=0,this.version=0},ContainerBox:function(t,a,u){h.Box.call(this,t,a,u),this.boxes=[]},SampleEntry:function(t,a,u,g){h.ContainerBox.call(this,t,a),this.hdr_size=u,this.start=g},SampleGroupEntry:function(t){this.grouping_type=t},TrackGroupTypeBox:function(t,a){h.FullBox.call(this,t,a)},createBoxCtor:function(t,a){h.boxCodes.push(t),h[t+"Box"]=function(u){h.Box.call(this,t,u)},h[t+"Box"].prototype=new h.Box,a&&(h[t+"Box"].prototype.parse=a)},createFullBoxCtor:function(t,a){h[t+"Box"]=function(u){h.FullBox.call(this,t,u)},h[t+"Box"].prototype=new h.FullBox,h[t+"Box"].prototype.parse=function(u){this.parseFullHeader(u),a&&a.call(this,u)}},addSubBoxArrays:function(t){if(t){this.subBoxNames=t;for(var a=t.length,u=0;u<a;u++)this[t[u]+"s"]=[]}},createContainerBoxCtor:function(t,a,u){h[t+"Box"]=function(g){h.ContainerBox.call(this,t,g),h.addSubBoxArrays.call(this,u)},h[t+"Box"].prototype=new h.ContainerBox,a&&(h[t+"Box"].prototype.parse=a)},createMediaSampleEntryCtor:function(t,a,u){h.sampleEntryCodes[t]=[],h[t+"SampleEntry"]=function(g,v){h.SampleEntry.call(this,g,v),h.addSubBoxArrays.call(this,u)},h[t+"SampleEntry"].prototype=new h.SampleEntry,a&&(h[t+"SampleEntry"].prototype.parse=a)},createSampleEntryCtor:function(t,a,u,g){h.sampleEntryCodes[t].push(a),h[a+"SampleEntry"]=function(v){h[t+"SampleEntry"].call(this,a,v),h.addSubBoxArrays.call(this,g)},h[a+"SampleEntry"].prototype=new h[t+"SampleEntry"],u&&(h[a+"SampleEntry"].prototype.parse=u)},createEncryptedSampleEntryCtor:function(t,a,u){h.createSampleEntryCtor.call(this,t,a,u,["sinf"])},createSampleGroupCtor:function(t,a){h[t+"SampleGroupEntry"]=function(u){h.SampleGroupEntry.call(this,t,u)},h[t+"SampleGroupEntry"].prototype=new h.SampleGroupEntry,a&&(h[t+"SampleGroupEntry"].prototype.parse=a)},createTrackGroupCtor:function(t,a){h[t+"TrackGroupTypeBox"]=function(u){h.TrackGroupTypeBox.call(this,t,u)},h[t+"TrackGroupTypeBox"].prototype=new h.TrackGroupTypeBox,a&&(h[t+"TrackGroupTypeBox"].prototype.parse=a)},createUUIDBox:function(t,a,u,g){h.UUIDs.push(t),h.UUIDBoxes[t]=function(v){a?h.FullBox.call(this,"uuid",v,t):u?h.ContainerBox.call(this,"uuid",v,t):h.Box.call(this,"uuid",v,t)},h.UUIDBoxes[t].prototype=a?new h.FullBox:u?new h.ContainerBox:new h.Box,g&&(a?h.UUIDBoxes[t].prototype.parse=function(v){this.parseFullHeader(v),g&&g.call(this,v)}:h.UUIDBoxes[t].prototype.parse=g)}};h.initialize(),h.TKHD_FLAG_ENABLED=1,h.TKHD_FLAG_IN_MOVIE=2,h.TKHD_FLAG_IN_PREVIEW=4,h.TFHD_FLAG_BASE_DATA_OFFSET=1,h.TFHD_FLAG_SAMPLE_DESC=2,h.TFHD_FLAG_SAMPLE_DUR=8,h.TFHD_FLAG_SAMPLE_SIZE=16,h.TFHD_FLAG_SAMPLE_FLAGS=32,h.TFHD_FLAG_DUR_EMPTY=65536,h.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,h.TRUN_FLAGS_DATA_OFFSET=1,h.TRUN_FLAGS_FIRST_FLAG=4,h.TRUN_FLAGS_DURATION=256,h.TRUN_FLAGS_SIZE=512,h.TRUN_FLAGS_FLAGS=1024,h.TRUN_FLAGS_CTS_OFFSET=2048,h.Box.prototype.add=function(t){return this.addBox(new h[t+"Box"])},h.Box.prototype.addBox=function(t){return this.boxes.push(t),this[t.type+"s"]?this[t.type+"s"].push(t):this[t.type]=t,t},h.Box.prototype.set=function(t,a){return this[t]=a,this},h.Box.prototype.addEntry=function(t,a){var u=a||"entries";return this[u]||(this[u]=[]),this[u].push(t),this},c.BoxParser=h,h.parseUUID=function(t){return h.parseHex16(t)},h.parseHex16=function(t){for(var a="",u=0;u<16;u++){var g=t.readUint8().toString(16);a+=g.length===1?"0"+g:g}return a},h.parseOneBox=function(t,a,u){var g,v=t.getPosition(),w=0,T,O;if(t.getEndPosition()-v<8)return f.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:h.ERR_NOT_ENOUGH_DATA};if(u&&u<8)return f.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:h.ERR_NOT_ENOUGH_DATA};var P=t.readUint32(),D=t.readString(4),z=D;if(f.debug("BoxParser","Found box of type '"+D+"' and size "+P+" at position "+v),w=8,D=="uuid"){if(t.getEndPosition()-t.getPosition()<16||u-w<16)return t.seek(v),f.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:h.ERR_NOT_ENOUGH_DATA};O=h.parseUUID(t),w+=16,z=O}if(P==1){if(t.getEndPosition()-t.getPosition()<8||u&&u-w<8)return t.seek(v),f.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+D+'" box'),{code:h.ERR_NOT_ENOUGH_DATA};P=t.readUint64(),w+=8}else if(P===0){if(u)P=u;else if(D!=="mdat")return f.error("BoxParser","Unlimited box size not supported for type: '"+D+"'"),g=new h.Box(D,P),{code:h.OK,box:g,size:g.size}}return P!==0&&P<w?(f.error("BoxParser","Box of type "+D+" has an invalid size "+P+" (too small to be a box)"),{code:h.ERR_NOT_ENOUGH_DATA,type:D,size:P,hdr_size:w,start:v}):P!==0&&u&&P>u?(f.error("BoxParser","Box of type '"+D+"' has a size "+P+" greater than its container size "+u),{code:h.ERR_NOT_ENOUGH_DATA,type:D,size:P,hdr_size:w,start:v}):P!==0&&v+P>t.getEndPosition()?(t.seek(v),f.info("BoxParser","Not enough data in stream to parse the entire '"+D+"' box"),{code:h.ERR_NOT_ENOUGH_DATA,type:D,size:P,hdr_size:w,start:v}):a?{code:h.OK,type:D,size:P,hdr_size:w,start:v}:(h[D+"Box"]?g=new h[D+"Box"](P):D!=="uuid"?(f.warn("BoxParser","Unknown box type: '"+D+"'"),g=new h.Box(D,P),g.has_unparsed_data=!0):h.UUIDBoxes[O]?g=new h.UUIDBoxes[O](P):(f.warn("BoxParser","Unknown uuid type: '"+O+"'"),g=new h.Box(D,P),g.uuid=O,g.has_unparsed_data=!0),g.hdr_size=w,g.start=v,g.write===h.Box.prototype.write&&g.type!=="mdat"&&(f.info("BoxParser","'"+z+"' box writing not yet implemented, keeping unparsed data in memory for later write"),g.parseDataAndRewind(t)),g.parse(t),T=t.getPosition()-(g.start+g.size),T<0?(f.warn("BoxParser","Parsing of box '"+z+"' did not read the entire indicated box data size (missing "+-T+" bytes), seeking forward"),t.seek(g.start+g.size)):T>0&&(f.error("BoxParser","Parsing of box '"+z+"' read "+T+" more bytes than the indicated box data size, seeking backwards"),g.size!==0&&t.seek(g.start+g.size)),{code:h.OK,box:g,size:g.size})},h.Box.prototype.parse=function(t){this.type!="mdat"?this.data=t.readUint8Array(this.size-this.hdr_size):this.size===0?t.seek(t.getEndPosition()):t.seek(this.start+this.size)},h.Box.prototype.parseDataAndRewind=function(t){this.data=t.readUint8Array(this.size-this.hdr_size),t.position-=this.size-this.hdr_size},h.FullBox.prototype.parseDataAndRewind=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,t.position-=this.size-this.hdr_size},h.FullBox.prototype.parseFullHeader=function(t){this.version=t.readUint8(),this.flags=t.readUint24(),this.hdr_size+=4},h.FullBox.prototype.parse=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},h.ContainerBox.prototype.parse=function(t){for(var a,u;t.getPosition()<this.start+this.size;)if(a=h.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),a.code===h.OK)if(u=a.box,this.boxes.push(u),this.subBoxNames&&this.subBoxNames.indexOf(u.type)!=-1)this[this.subBoxNames[this.subBoxNames.indexOf(u.type)]+"s"].push(u);else{var g=u.type!=="uuid"?u.type:u.uuid;this[g]?f.warn("Box of type "+g+" already stored in field of this type"):this[g]=u}else return},h.Box.prototype.parseLanguage=function(t){this.language=t.readUint16();var a=[];a[0]=this.language>>10&31,a[1]=this.language>>5&31,a[2]=this.language&31,this.languageString=String.fromCharCode(a[0]+96,a[1]+96,a[2]+96)},h.SAMPLE_ENTRY_TYPE_VISUAL="Visual",h.SAMPLE_ENTRY_TYPE_AUDIO="Audio",h.SAMPLE_ENTRY_TYPE_HINT="Hint",h.SAMPLE_ENTRY_TYPE_METADATA="Metadata",h.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",h.SAMPLE_ENTRY_TYPE_SYSTEM="System",h.SAMPLE_ENTRY_TYPE_TEXT="Text",h.SampleEntry.prototype.parseHeader=function(t){t.readUint8Array(6),this.data_reference_index=t.readUint16(),this.hdr_size+=8},h.SampleEntry.prototype.parse=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},h.SampleEntry.prototype.parseDataAndRewind=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,t.position-=this.size-this.hdr_size},h.SampleEntry.prototype.parseFooter=function(t){h.ContainerBox.prototype.parse.call(this,t)},h.createMediaSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_HINT),h.createMediaSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_METADATA),h.createMediaSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SUBTITLE),h.createMediaSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SYSTEM),h.createMediaSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_TEXT),h.createMediaSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,function(t){var a;this.parseHeader(t),t.readUint16(),t.readUint16(),t.readUint32Array(3),this.width=t.readUint16(),this.height=t.readUint16(),this.horizresolution=t.readUint32(),this.vertresolution=t.readUint32(),t.readUint32(),this.frame_count=t.readUint16(),a=Math.min(31,t.readUint8()),this.compressorname=t.readString(a),a<31&&t.readString(31-a),this.depth=t.readUint16(),t.readUint16(),this.parseFooter(t)}),h.createMediaSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,function(t){this.parseHeader(t),t.readUint32Array(2),this.channel_count=t.readUint16(),this.samplesize=t.readUint16(),t.readUint16(),t.readUint16(),this.samplerate=t.readUint32()/65536,this.parseFooter(t)}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"dav1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"hvt1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"lhe1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"dvh1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"dvhe"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"vvc1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"vvi1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"vvs1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"vvcN"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"vp08"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"vp09"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"avs3"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"j2ki"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"mjp2"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"mjpg"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"uncv"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"ac-4"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"Opus"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"mha1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"mha2"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"mhm1"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"mhm2"),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"fLaC"),h.createEncryptedSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),h.createEncryptedSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),h.createEncryptedSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),h.createEncryptedSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),h.createEncryptedSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_TEXT,"enct"),h.createEncryptedSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_METADATA,"encm"),h.createBoxCtor("a1lx",function(t){var a=t.readUint8()&1,u=((a&1)+1)*16;this.layer_size=[];for(var g=0;g<3;g++)u==16?this.layer_size[g]=t.readUint16():this.layer_size[g]=t.readUint32()}),h.createBoxCtor("a1op",function(t){this.op_index=t.readUint8()}),h.createFullBoxCtor("auxC",function(t){this.aux_type=t.readCString();var a=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=t.readUint8Array(a)}),h.createBoxCtor("av1C",function(t){var a=t.readUint8();if(a>>7&!1){f.error("av1C marker problem");return}if(this.version=a&127,this.version!==1){f.error("av1C version "+this.version+" not supported");return}if(a=t.readUint8(),this.seq_profile=a>>5&7,this.seq_level_idx_0=a&31,a=t.readUint8(),this.seq_tier_0=a>>7&1,this.high_bitdepth=a>>6&1,this.twelve_bit=a>>5&1,this.monochrome=a>>4&1,this.chroma_subsampling_x=a>>3&1,this.chroma_subsampling_y=a>>2&1,this.chroma_sample_position=a&3,a=t.readUint8(),this.reserved_1=a>>5&7,this.reserved_1!==0){f.error("av1C reserved_1 parsing problem");return}if(this.initial_presentation_delay_present=a>>4&1,this.initial_presentation_delay_present===1)this.initial_presentation_delay_minus_one=a&15;else if(this.reserved_2=a&15,this.reserved_2!==0){f.error("av1C reserved_2 parsing problem");return}var u=this.size-this.hdr_size-4;this.configOBUs=t.readUint8Array(u)}),h.createBoxCtor("avcC",function(t){var a,u;for(this.configurationVersion=t.readUint8(),this.AVCProfileIndication=t.readUint8(),this.profile_compatibility=t.readUint8(),this.AVCLevelIndication=t.readUint8(),this.lengthSizeMinusOne=t.readUint8()&3,this.nb_SPS_nalus=t.readUint8()&31,u=this.size-this.hdr_size-6,this.SPS=[],a=0;a<this.nb_SPS_nalus;a++)this.SPS[a]={},this.SPS[a].length=t.readUint16(),this.SPS[a].nalu=t.readUint8Array(this.SPS[a].length),u-=2+this.SPS[a].length;for(this.nb_PPS_nalus=t.readUint8(),u--,this.PPS=[],a=0;a<this.nb_PPS_nalus;a++)this.PPS[a]={},this.PPS[a].length=t.readUint16(),this.PPS[a].nalu=t.readUint8Array(this.PPS[a].length),u-=2+this.PPS[a].length;u>0&&(this.ext=t.readUint8Array(u))}),h.createBoxCtor("btrt",function(t){this.bufferSizeDB=t.readUint32(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32()}),h.createFullBoxCtor("ccst",function(t){var a=t.readUint8();this.all_ref_pics_intra=(a&128)==128,this.intra_pred_used=(a&64)==64,this.max_ref_per_pic=(a&63)>>2,t.readUint24()}),h.createBoxCtor("cdef",function(t){var a;for(this.channel_count=t.readUint16(),this.channel_indexes=[],this.channel_types=[],this.channel_associations=[],a=0;a<this.channel_count;a++)this.channel_indexes.push(t.readUint16()),this.channel_types.push(t.readUint16()),this.channel_associations.push(t.readUint16())}),h.createBoxCtor("clap",function(t){this.cleanApertureWidthN=t.readUint32(),this.cleanApertureWidthD=t.readUint32(),this.cleanApertureHeightN=t.readUint32(),this.cleanApertureHeightD=t.readUint32(),this.horizOffN=t.readUint32(),this.horizOffD=t.readUint32(),this.vertOffN=t.readUint32(),this.vertOffD=t.readUint32()}),h.createBoxCtor("clli",function(t){this.max_content_light_level=t.readUint16(),this.max_pic_average_light_level=t.readUint16()}),h.createFullBoxCtor("cmex",function(t){this.flags&1&&(this.pos_x=t.readInt32()),this.flags&2&&(this.pos_y=t.readInt32()),this.flags&4&&(this.pos_z=t.readInt32()),this.flags&8&&(this.version==0?this.flags&16?(this.quat_x=t.readInt32(),this.quat_y=t.readInt32(),this.quat_z=t.readInt32()):(this.quat_x=t.readInt16(),this.quat_y=t.readInt16(),this.quat_z=t.readInt16()):this.version==1),this.flags&32&&(this.id=t.readUint32())}),h.createFullBoxCtor("cmin",function(t){this.focal_length_x=t.readInt32(),this.principal_point_x=t.readInt32(),this.principal_point_y=t.readInt32(),this.flags&1&&(this.focal_length_y=t.readInt32(),this.skew_factor=t.readInt32())}),h.createBoxCtor("cmpd",function(t){for(this.component_count=t.readUint32(),this.component_types=[],this.component_type_urls=[],i=0;i<this.component_count;i++){var a=t.readUint16();this.component_types.push(a),a>=32768&&this.component_type_urls.push(t.readCString())}}),h.createFullBoxCtor("co64",function(t){var a,u;if(a=t.readUint32(),this.chunk_offsets=[],this.version===0)for(u=0;u<a;u++)this.chunk_offsets.push(t.readUint64())}),h.createFullBoxCtor("CoLL",function(t){this.maxCLL=t.readUint16(),this.maxFALL=t.readUint16()}),h.createBoxCtor("colr",function(t){if(this.colour_type=t.readString(4),this.colour_type==="nclx"){this.colour_primaries=t.readUint16(),this.transfer_characteristics=t.readUint16(),this.matrix_coefficients=t.readUint16();var a=t.readUint8();this.full_range_flag=a>>7}else this.colour_type==="rICC"?this.ICC_profile=t.readUint8Array(this.size-4):this.colour_type==="prof"&&(this.ICC_profile=t.readUint8Array(this.size-4))}),h.createFullBoxCtor("cprt",function(t){this.parseLanguage(t),this.notice=t.readCString()}),h.createFullBoxCtor("cslg",function(t){this.version===0&&(this.compositionToDTSShift=t.readInt32(),this.leastDecodeToDisplayDelta=t.readInt32(),this.greatestDecodeToDisplayDelta=t.readInt32(),this.compositionStartTime=t.readInt32(),this.compositionEndTime=t.readInt32())}),h.createFullBoxCtor("ctts",function(t){var a,u;if(a=t.readUint32(),this.sample_counts=[],this.sample_offsets=[],this.version===0)for(u=0;u<a;u++){this.sample_counts.push(t.readUint32());var g=t.readInt32();g<0&&f.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(g)}else if(this.version==1)for(u=0;u<a;u++)this.sample_counts.push(t.readUint32()),this.sample_offsets.push(t.readInt32())}),h.createBoxCtor("dac3",function(t){var a=t.readUint8(),u=t.readUint8(),g=t.readUint8();this.fscod=a>>6,this.bsid=a>>1&31,this.bsmod=(a&1)<<2|u>>6&3,this.acmod=u>>3&7,this.lfeon=u>>2&1,this.bit_rate_code=u&3|g>>5&7}),h.createBoxCtor("dec3",function(t){var a=t.readUint16();this.data_rate=a>>3,this.num_ind_sub=a&7,this.ind_subs=[];for(var u=0;u<this.num_ind_sub+1;u++){var g={};this.ind_subs.push(g);var v=t.readUint8(),w=t.readUint8(),T=t.readUint8();g.fscod=v>>6,g.bsid=v>>1&31,g.bsmod=(v&1)<<4|w>>4&15,g.acmod=w>>1&7,g.lfeon=w&1,g.num_dep_sub=T>>1&15,g.num_dep_sub>0&&(g.chan_loc=(T&1)<<8|t.readUint8())}}),h.createFullBoxCtor("dfLa",function(t){var a=127,u=128,g=[],v=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];do{var w=t.readUint8(),T=Math.min(w&a,v.length-1);if(T?t.readUint8Array(t.readUint24()):(t.readUint8Array(13),this.samplerate=t.readUint32()>>12,t.readUint8Array(20)),g.push(v[T]),w&u)break}while(!0);this.numMetadataBlocks=g.length+" ("+g.join(", ")+")"}),h.createBoxCtor("dimm",function(t){this.bytessent=t.readUint64()}),h.createBoxCtor("dmax",function(t){this.time=t.readUint32()}),h.createBoxCtor("dmed",function(t){this.bytessent=t.readUint64()}),h.createBoxCtor("dOps",function(t){if(this.Version=t.readUint8(),this.OutputChannelCount=t.readUint8(),this.PreSkip=t.readUint16(),this.InputSampleRate=t.readUint32(),this.OutputGain=t.readInt16(),this.ChannelMappingFamily=t.readUint8(),this.ChannelMappingFamily!==0){this.StreamCount=t.readUint8(),this.CoupledCount=t.readUint8(),this.ChannelMapping=[];for(var a=0;a<this.OutputChannelCount;a++)this.ChannelMapping[a]=t.readUint8()}}),h.createFullBoxCtor("dref",function(t){var a,u;this.entries=[];for(var g=t.readUint32(),v=0;v<g;v++)if(a=h.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),a.code===h.OK)u=a.box,this.entries.push(u);else return}),h.createBoxCtor("drep",function(t){this.bytessent=t.readUint64()}),h.createFullBoxCtor("elng",function(t){this.extended_language=t.readString(this.size-this.hdr_size)}),h.createFullBoxCtor("elst",function(t){this.entries=[];for(var a=t.readUint32(),u=0;u<a;u++){var g={};this.entries.push(g),this.version===1?(g.segment_duration=t.readUint64(),g.media_time=t.readInt64()):(g.segment_duration=t.readUint32(),g.media_time=t.readInt32()),g.media_rate_integer=t.readInt16(),g.media_rate_fraction=t.readInt16()}}),h.createFullBoxCtor("emsg",function(t){this.version==1?(this.timescale=t.readUint32(),this.presentation_time=t.readUint64(),this.event_duration=t.readUint32(),this.id=t.readUint32(),this.scheme_id_uri=t.readCString(),this.value=t.readCString()):(this.scheme_id_uri=t.readCString(),this.value=t.readCString(),this.timescale=t.readUint32(),this.presentation_time_delta=t.readUint32(),this.event_duration=t.readUint32(),this.id=t.readUint32());var a=this.size-this.hdr_size-(4*4+(this.scheme_id_uri.length+1)+(this.value.length+1));this.version==1&&(a-=4),this.message_data=t.readUint8Array(a)}),h.createEntityToGroupCtor=function(t,a){h[t+"Box"]=function(u){h.FullBox.call(this,t,u)},h[t+"Box"].prototype=new h.FullBox,h[t+"Box"].prototype.parse=function(u){if(this.parseFullHeader(u),a)a.call(this,u);else for(this.group_id=u.readUint32(),this.num_entities_in_group=u.readUint32(),this.entity_ids=[],i=0;i<this.num_entities_in_group;i++){var g=u.readUint32();this.entity_ids.push(g)}}},h.createEntityToGroupCtor("aebr"),h.createEntityToGroupCtor("afbr"),h.createEntityToGroupCtor("albc"),h.createEntityToGroupCtor("altr"),h.createEntityToGroupCtor("brst"),h.createEntityToGroupCtor("dobr"),h.createEntityToGroupCtor("eqiv"),h.createEntityToGroupCtor("favc"),h.createEntityToGroupCtor("fobr"),h.createEntityToGroupCtor("iaug"),h.createEntityToGroupCtor("pano"),h.createEntityToGroupCtor("slid"),h.createEntityToGroupCtor("ster"),h.createEntityToGroupCtor("tsyn"),h.createEntityToGroupCtor("wbbr"),h.createEntityToGroupCtor("prgr"),h.createEntityToGroupCtor("pymd",function(t){this.group_id=t.readUint32(),this.num_entities_in_group=t.readUint32(),this.entity_ids=[];for(var a=0;a<this.num_entities_in_group;a++){var u=t.readUint32();this.entity_ids.push(u)}for(this.tile_size_x=t.readUint16(),this.tile_size_y=t.readUint16(),this.layer_binning=[],this.tiles_in_layer_column_minus1=[],this.tiles_in_layer_row_minus1=[],a=0;a<this.num_entities_in_group;a++)this.layer_binning[a]=t.readUint16(),this.tiles_in_layer_row_minus1[a]=t.readUint16(),this.tiles_in_layer_column_minus1[a]=t.readUint16()}),h.createFullBoxCtor("esds",function(t){var a=t.readUint8Array(this.size-this.hdr_size);if(typeof I<"u"){var u=new I;this.esd=u.parseOneDescriptor(new y(a.buffer,0,y.BIG_ENDIAN))}}),h.createBoxCtor("fiel",function(t){this.fieldCount=t.readUint8(),this.fieldOrdering=t.readUint8()}),h.createBoxCtor("frma",function(t){this.data_format=t.readString(4)}),h.createBoxCtor("ftyp",function(t){var a=this.size-this.hdr_size;this.major_brand=t.readString(4),this.minor_version=t.readUint32(),a-=8,this.compatible_brands=[];for(var u=0;a>=4;)this.compatible_brands[u]=t.readString(4),a-=4,u++}),h.createFullBoxCtor("hdlr",function(t){this.version===0&&(t.readUint32(),this.handler=t.readString(4),t.readUint32Array(3),this.name=t.readString(this.size-this.hdr_size-20),this.name[this.name.length-1]==="\0"&&(this.name=this.name.slice(0,-1)))}),h.createBoxCtor("hvcC",function(t){var a,u,g,v;this.configurationVersion=t.readUint8(),v=t.readUint8(),this.general_profile_space=v>>6,this.general_tier_flag=(v&32)>>5,this.general_profile_idc=v&31,this.general_profile_compatibility=t.readUint32(),this.general_constraint_indicator=t.readUint8Array(6),this.general_level_idc=t.readUint8(),this.min_spatial_segmentation_idc=t.readUint16()&4095,this.parallelismType=t.readUint8()&3,this.chroma_format_idc=t.readUint8()&3,this.bit_depth_luma_minus8=t.readUint8()&7,this.bit_depth_chroma_minus8=t.readUint8()&7,this.avgFrameRate=t.readUint16(),v=t.readUint8(),this.constantFrameRate=v>>6,this.numTemporalLayers=(v&13)>>3,this.temporalIdNested=(v&4)>>2,this.lengthSizeMinusOne=v&3,this.nalu_arrays=[];var w=t.readUint8();for(a=0;a<w;a++){var T=[];this.nalu_arrays.push(T),v=t.readUint8(),T.completeness=(v&128)>>7,T.nalu_type=v&63;var O=t.readUint16();for(u=0;u<O;u++){var P={};T.push(P),g=t.readUint16(),P.data=t.readUint8Array(g)}}}),h.createFullBoxCtor("iinf",function(t){var a;this.version===0?this.entry_count=t.readUint16():this.entry_count=t.readUint32(),this.item_infos=[];for(var u=0;u<this.entry_count;u++)if(a=h.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),a.code===h.OK)a.box.type!=="infe"&&f.error("BoxParser","Expected 'infe' box, got "+a.box.type),this.item_infos[u]=a.box;else return}),h.createFullBoxCtor("iloc",function(t){var a;a=t.readUint8(),this.offset_size=a>>4&15,this.length_size=a&15,a=t.readUint8(),this.base_offset_size=a>>4&15,this.version===1||this.version===2?this.index_size=a&15:this.index_size=0,this.items=[];var u=0;if(this.version<2)u=t.readUint16();else if(this.version===2)u=t.readUint32();else throw"version of iloc box not supported";for(var g=0;g<u;g++){var v={};if(this.items.push(v),this.version<2)v.item_ID=t.readUint16();else if(this.version===2)v.item_ID=t.readUint32();else throw"version of iloc box not supported";switch(this.version===1||this.version===2?v.construction_method=t.readUint16()&15:v.construction_method=0,v.data_reference_index=t.readUint16(),this.base_offset_size){case 0:v.base_offset=0;break;case 4:v.base_offset=t.readUint32();break;case 8:v.base_offset=t.readUint64();break;default:throw"Error reading base offset size"}var w=t.readUint16();v.extents=[];for(var T=0;T<w;T++){var O={};if(v.extents.push(O),this.version===1||this.version===2)switch(this.index_size){case 0:O.extent_index=0;break;case 4:O.extent_index=t.readUint32();break;case 8:O.extent_index=t.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:O.extent_offset=0;break;case 4:O.extent_offset=t.readUint32();break;case 8:O.extent_offset=t.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:O.extent_length=0;break;case 4:O.extent_length=t.readUint32();break;case 8:O.extent_length=t.readUint64();break;default:throw"Error reading extent index"}}}}),h.createBoxCtor("imir",function(t){var a=t.readUint8();this.reserved=a>>7,this.axis=a&1}),h.createFullBoxCtor("infe",function(t){if((this.version===0||this.version===1)&&(this.item_ID=t.readUint16(),this.item_protection_index=t.readUint16(),this.item_name=t.readCString(),this.content_type=t.readCString(),this.content_encoding=t.readCString()),this.version===1){this.extension_type=t.readString(4),f.warn("BoxParser","Cannot parse extension type"),t.seek(this.start+this.size);return}this.version>=2&&(this.version===2?this.item_ID=t.readUint16():this.version===3&&(this.item_ID=t.readUint32()),this.item_protection_index=t.readUint16(),this.item_type=t.readString(4),this.item_name=t.readCString(),this.item_type==="mime"?(this.content_type=t.readCString(),this.content_encoding=t.readCString()):this.item_type==="uri "&&(this.item_uri_type=t.readCString()))}),h.createFullBoxCtor("ipma",function(t){var a,u;for(entry_count=t.readUint32(),this.associations=[],a=0;a<entry_count;a++){var g={};this.associations.push(g),this.version<1?g.id=t.readUint16():g.id=t.readUint32();var v=t.readUint8();for(g.props=[],u=0;u<v;u++){var w=t.readUint8(),T={};g.props.push(T),T.essential=(w&128)>>7===1,this.flags&1?T.property_index=(w&127)<<8|t.readUint8():T.property_index=w&127}}}),h.createFullBoxCtor("iref",function(t){var a,u;for(this.references=[];t.getPosition()<this.start+this.size;)if(a=h.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),a.code===h.OK)this.version===0?u=new h.SingleItemTypeReferenceBox(a.type,a.size,a.hdr_size,a.start):u=new h.SingleItemTypeReferenceBoxLarge(a.type,a.size,a.hdr_size,a.start),u.write===h.Box.prototype.write&&u.type!=="mdat"&&(f.warn("BoxParser",u.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),u.parseDataAndRewind(t)),u.parse(t),this.references.push(u);else return}),h.createBoxCtor("irot",function(t){this.angle=t.readUint8()&3}),h.createFullBoxCtor("ispe",function(t){this.image_width=t.readUint32(),this.image_height=t.readUint32()}),h.createFullBoxCtor("kind",function(t){this.schemeURI=t.readCString(),this.value=t.readCString()}),h.createFullBoxCtor("leva",function(t){var a=t.readUint8();this.levels=[];for(var u=0;u<a;u++){var g={};this.levels[u]=g,g.track_ID=t.readUint32();var v=t.readUint8();switch(g.padding_flag=v>>7,g.assignment_type=v&127,g.assignment_type){case 0:g.grouping_type=t.readString(4);break;case 1:g.grouping_type=t.readString(4),g.grouping_type_parameter=t.readUint32();break;case 2:break;case 3:break;case 4:g.sub_track_id=t.readUint32();break;default:f.warn("BoxParser","Unknown leva assignement type")}}}),h.createBoxCtor("lhvC",function(t){var a,u,g;this.configurationVersion=t.readUint8(),this.min_spatial_segmentation_idc=t.readUint16()&4095,this.parallelismType=t.readUint8()&3,g=t.readUint8(),this.numTemporalLayers=(g&13)>>3,this.temporalIdNested=(g&4)>>2,this.lengthSizeMinusOne=g&3,this.nalu_arrays=[];var v=t.readUint8();for(a=0;a<v;a++){var w=[];this.nalu_arrays.push(w),g=t.readUint8(),w.completeness=(g&128)>>7,w.nalu_type=g&63;var T=t.readUint16();for(u=0;u<T;u++){var O={};w.push(O);var P=t.readUint16();O.data=t.readUint8Array(P)}}}),h.createBoxCtor("lsel",function(t){this.layer_id=t.readUint16()}),h.createBoxCtor("maxr",function(t){this.period=t.readUint32(),this.bytes=t.readUint32()});function N(t,a){this.x=t,this.y=a}N.prototype.toString=function(){return"("+this.x+","+this.y+")"},h.createBoxCtor("mdcv",function(t){this.display_primaries=[],this.display_primaries[0]=new N(t.readUint16(),t.readUint16()),this.display_primaries[1]=new N(t.readUint16(),t.readUint16()),this.display_primaries[2]=new N(t.readUint16(),t.readUint16()),this.white_point=new N(t.readUint16(),t.readUint16()),this.max_display_mastering_luminance=t.readUint32(),this.min_display_mastering_luminance=t.readUint32()}),h.createFullBoxCtor("mdhd",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.parseLanguage(t),t.readUint16()}),h.createFullBoxCtor("mehd",function(t){this.flags&1&&(f.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),this.version==1?this.fragment_duration=t.readUint64():this.fragment_duration=t.readUint32()}),h.createFullBoxCtor("meta",function(t){this.boxes=[],h.ContainerBox.prototype.parse.call(this,t)}),h.createFullBoxCtor("mfhd",function(t){this.sequence_number=t.readUint32()}),h.createFullBoxCtor("mfro",function(t){this._size=t.readUint32()}),h.createFullBoxCtor("mskC",function(t){this.bits_per_pixel=t.readUint8()}),h.createFullBoxCtor("mvhd",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.rate=t.readUint32(),this.volume=t.readUint16()>>8,t.readUint16(),t.readUint32Array(2),this.matrix=t.readUint32Array(9),t.readUint32Array(6),this.next_track_id=t.readUint32()}),h.createBoxCtor("npck",function(t){this.packetssent=t.readUint32()}),h.createBoxCtor("nump",function(t){this.packetssent=t.readUint64()}),h.createFullBoxCtor("padb",function(t){var a=t.readUint32();this.padbits=[];for(var u=0;u<Math.floor((a+1)/2);u++)this.padbits=t.readUint8()}),h.createBoxCtor("pasp",function(t){this.hSpacing=t.readUint32(),this.vSpacing=t.readUint32()}),h.createBoxCtor("payl",function(t){this.text=t.readString(this.size-this.hdr_size)}),h.createBoxCtor("payt",function(t){this.payloadID=t.readUint32();var a=t.readUint8();this.rtpmap_string=t.readString(a)}),h.createFullBoxCtor("pdin",function(t){var a=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var u=0;u<a;u++)this.rate[u]=t.readUint32(),this.initial_delay[u]=t.readUint32()}),h.createFullBoxCtor("pitm",function(t){this.version===0?this.item_id=t.readUint16():this.item_id=t.readUint32()}),h.createFullBoxCtor("pixi",function(t){var a;for(this.num_channels=t.readUint8(),this.bits_per_channels=[],a=0;a<this.num_channels;a++)this.bits_per_channels[a]=t.readUint8()}),h.createBoxCtor("pmax",function(t){this.bytes=t.readUint32()}),h.createFullBoxCtor("prdi",function(t){if(this.step_count=t.readUint16(),this.item_count=[],this.flags&2)for(var a=0;a<this.step_count;a++)this.item_count[a]=t.readUint16()}),h.createFullBoxCtor("prft",function(t){this.ref_track_id=t.readUint32(),this.ntp_timestamp=t.readUint64(),this.version===0?this.media_time=t.readUint32():this.media_time=t.readUint64()}),h.createFullBoxCtor("pssh",function(t){if(this.system_id=h.parseHex16(t),this.version>0){var a=t.readUint32();this.kid=[];for(var u=0;u<a;u++)this.kid[u]=h.parseHex16(t)}var g=t.readUint32();g>0&&(this.data=t.readUint8Array(g))}),h.createFullBoxCtor("clef",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),h.createFullBoxCtor("enof",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),h.createFullBoxCtor("prof",function(t){this.width=t.readUint32(),this.height=t.readUint32()}),h.createContainerBoxCtor("tapt",null,["clef","prof","enof"]),h.createBoxCtor("rtp ",function(t){this.descriptionformat=t.readString(4),this.sdptext=t.readString(this.size-this.hdr_size-4)}),h.createFullBoxCtor("saio",function(t){this.flags&1&&(this.aux_info_type=t.readString(4),this.aux_info_type_parameter=t.readUint32());var a=t.readUint32();this.offset=[];for(var u=0;u<a;u++)this.version===0?this.offset[u]=t.readUint32():this.offset[u]=t.readUint64()}),h.createFullBoxCtor("saiz",function(t){if(this.flags&1&&(this.aux_info_type=t.readString(4),this.aux_info_type_parameter=t.readUint32()),this.default_sample_info_size=t.readUint8(),this.sample_count=t.readUint32(),this.sample_info_size=[],this.default_sample_info_size===0)for(var a=0;a<this.sample_count;a++)this.sample_info_size[a]=t.readUint8()}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_METADATA,"mett",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_METADATA,"metx",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.parseFooter(t)}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",function(t){this.parseHeader(t),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.auxiliary_mime_types=t.readCString(),this.parseFooter(t)}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",function(t){this.parseHeader(t),this.displayFlags=t.readUint32(),this.horizontal_justification=t.readInt8(),this.vertical_justification=t.readInt8(),this.bg_color_rgba=t.readUint8Array(4),this.box_record=t.readInt16Array(4),this.style_record=t.readUint8Array(12),this.parseFooter(t)}),h.createSampleEntryCtor(h.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",function(t){this.parseHeader(t),this.parseFooter(t)}),h.createSampleGroupCtor("alst",function(t){var a,u=t.readUint16();for(this.first_output_sample=t.readUint16(),this.sample_offset=[],a=0;a<u;a++)this.sample_offset[a]=t.readUint32();var g=this.description_length-4-4*u;for(this.num_output_samples=[],this.num_total_samples=[],a=0;a<g/4;a++)this.num_output_samples[a]=t.readUint16(),this.num_total_samples[a]=t.readUint16()}),h.createSampleGroupCtor("avll",function(t){this.layerNumber=t.readUint8(),this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()}),h.createSampleGroupCtor("avss",function(t){this.subSequenceIdentifier=t.readUint16(),this.layerNumber=t.readUint8();var a=t.readUint8();this.durationFlag=a>>7,this.avgRateFlag=a>>6&1,this.durationFlag&&(this.duration=t.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()),this.dependency=[];for(var u=t.readUint8(),g=0;g<u;g++){var v={};this.dependency.push(v),v.subSeqDirectionFlag=t.readUint8(),v.layerNumber=t.readUint8(),v.subSequenceIdentifier=t.readUint16()}}),h.createSampleGroupCtor("dtrt",function(t){f.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createSampleGroupCtor("mvif",function(t){f.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createSampleGroupCtor("prol",function(t){this.roll_distance=t.readInt16()}),h.createSampleGroupCtor("rap ",function(t){var a=t.readUint8();this.num_leading_samples_known=a>>7,this.num_leading_samples=a&127}),h.createSampleGroupCtor("rash",function(t){if(this.operation_point_count=t.readUint16(),this.description_length!==2+(this.operation_point_count===1?2:this.operation_point_count*6)+9)f.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=t.readUint8Array(this.description_length-2);else{if(this.operation_point_count===1)this.target_rate_share=t.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var a=0;a<this.operation_point_count;a++)this.available_bitrate[a]=t.readUint32(),this.target_rate_share[a]=t.readUint16()}this.maximum_bitrate=t.readUint32(),this.minimum_bitrate=t.readUint32(),this.discard_priority=t.readUint8()}}),h.createSampleGroupCtor("roll",function(t){this.roll_distance=t.readInt16()}),h.SampleGroupEntry.prototype.parse=function(t){f.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=t.readUint8Array(this.description_length)},h.createSampleGroupCtor("scif",function(t){f.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createSampleGroupCtor("scnm",function(t){f.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createSampleGroupCtor("seig",function(t){this.reserved=t.readUint8();var a=t.readUint8();this.crypt_byte_block=a>>4,this.skip_byte_block=a&15,this.isProtected=t.readUint8(),this.Per_Sample_IV_Size=t.readUint8(),this.KID=h.parseHex16(t),this.constant_IV_size=0,this.constant_IV=0,this.isProtected===1&&this.Per_Sample_IV_Size===0&&(this.constant_IV_size=t.readUint8(),this.constant_IV=t.readUint8Array(this.constant_IV_size))}),h.createSampleGroupCtor("stsa",function(t){f.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createSampleGroupCtor("sync",function(t){var a=t.readUint8();this.NAL_unit_type=a&63}),h.createSampleGroupCtor("tele",function(t){var a=t.readUint8();this.level_independently_decodable=a>>7}),h.createSampleGroupCtor("tsas",function(t){f.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createSampleGroupCtor("tscl",function(t){f.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createSampleGroupCtor("vipr",function(t){f.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),h.createFullBoxCtor("sbgp",function(t){this.grouping_type=t.readString(4),this.version===1?this.grouping_type_parameter=t.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var a=t.readUint32(),u=0;u<a;u++){var g={};this.entries.push(g),g.sample_count=t.readInt32(),g.group_description_index=t.readInt32()}});function E(t,a){this.bad_pixel_row=t,this.bad_pixel_column=a}E.prototype.toString=function(){return"[row: "+this.bad_pixel_row+", column: "+this.bad_pixel_column+"]"},h.createFullBoxCtor("sbpm",function(t){var a;for(this.component_count=t.readUint16(),this.component_index=[],a=0;a<this.component_count;a++)this.component_index.push(t.readUint16());var u=t.readUint8();for(this.correction_applied=(u&128)==128,this.num_bad_rows=t.readUint32(),this.num_bad_cols=t.readUint32(),this.num_bad_pixels=t.readUint32(),this.bad_rows=[],this.bad_columns=[],this.bad_pixels=[],a=0;a<this.num_bad_rows;a++)this.bad_rows.push(t.readUint32());for(a=0;a<this.num_bad_cols;a++)this.bad_columns.push(t.readUint32());for(a=0;a<this.num_bad_pixels;a++){var g=t.readUint32(),v=t.readUint32();this.bad_pixels.push(new E(g,v))}}),h.createFullBoxCtor("schm",function(t){this.scheme_type=t.readString(4),this.scheme_version=t.readUint32(),this.flags&1&&(this.scheme_uri=t.readString(this.size-this.hdr_size-8))}),h.createBoxCtor("sdp ",function(t){this.sdptext=t.readString(this.size-this.hdr_size)}),h.createFullBoxCtor("sdtp",function(t){var a,u=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var g=0;g<u;g++)a=t.readUint8(),this.is_leading[g]=a>>6,this.sample_depends_on[g]=a>>4&3,this.sample_is_depended_on[g]=a>>2&3,this.sample_has_redundancy[g]=a&3}),h.createFullBoxCtor("senc"),h.createFullBoxCtor("sgpd",function(t){this.grouping_type=t.readString(4),f.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),this.version===1?this.default_length=t.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=t.readUint32()),this.entries=[];for(var a=t.readUint32(),u=0;u<a;u++){var g;h[this.grouping_type+"SampleGroupEntry"]?g=new h[this.grouping_type+"SampleGroupEntry"](this.grouping_type):g=new h.SampleGroupEntry(this.grouping_type),this.entries.push(g),this.version===1?this.default_length===0?g.description_length=t.readUint32():g.description_length=this.default_length:g.description_length=this.default_length,g.write===h.SampleGroupEntry.prototype.write&&(f.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),g.data=t.readUint8Array(g.description_length),t.position-=g.description_length),g.parse(t)}}),h.createFullBoxCtor("sidx",function(t){this.reference_ID=t.readUint32(),this.timescale=t.readUint32(),this.version===0?(this.earliest_presentation_time=t.readUint32(),this.first_offset=t.readUint32()):(this.earliest_presentation_time=t.readUint64(),this.first_offset=t.readUint64()),t.readUint16(),this.references=[];for(var a=t.readUint16(),u=0;u<a;u++){var g={};this.references.push(g);var v=t.readUint32();g.reference_type=v>>31&1,g.referenced_size=v&2147483647,g.subsegment_duration=t.readUint32(),v=t.readUint32(),g.starts_with_SAP=v>>31&1,g.SAP_type=v>>28&7,g.SAP_delta_time=v&268435455}}),h.SingleItemTypeReferenceBox=function(t,a,u,g){h.Box.call(this,t,a),this.hdr_size=u,this.start=g},h.SingleItemTypeReferenceBox.prototype=new h.Box,h.SingleItemTypeReferenceBox.prototype.parse=function(t){this.from_item_ID=t.readUint16();var a=t.readUint16();this.references=[];for(var u=0;u<a;u++)this.references[u]={},this.references[u].to_item_ID=t.readUint16()},h.SingleItemTypeReferenceBoxLarge=function(t,a,u,g){h.Box.call(this,t,a),this.hdr_size=u,this.start=g},h.SingleItemTypeReferenceBoxLarge.prototype=new h.Box,h.SingleItemTypeReferenceBoxLarge.prototype.parse=function(t){this.from_item_ID=t.readUint32();var a=t.readUint16();this.references=[];for(var u=0;u<a;u++)this.references[u]={},this.references[u].to_item_ID=t.readUint32()},h.createFullBoxCtor("SmDm",function(t){this.primaryRChromaticity_x=t.readUint16(),this.primaryRChromaticity_y=t.readUint16(),this.primaryGChromaticity_x=t.readUint16(),this.primaryGChromaticity_y=t.readUint16(),this.primaryBChromaticity_x=t.readUint16(),this.primaryBChromaticity_y=t.readUint16(),this.whitePointChromaticity_x=t.readUint16(),this.whitePointChromaticity_y=t.readUint16(),this.luminanceMax=t.readUint32(),this.luminanceMin=t.readUint32()}),h.createFullBoxCtor("smhd",function(t){this.balance=t.readUint16(),t.readUint16()}),h.createFullBoxCtor("ssix",function(t){this.subsegments=[];for(var a=t.readUint32(),u=0;u<a;u++){var g={};this.subsegments.push(g),g.ranges=[];for(var v=t.readUint32(),w=0;w<v;w++){var T={};g.ranges.push(T),T.level=t.readUint8(),T.range_size=t.readUint24()}}}),h.createFullBoxCtor("stco",function(t){var a;if(a=t.readUint32(),this.chunk_offsets=[],this.version===0)for(var u=0;u<a;u++)this.chunk_offsets.push(t.readUint32())}),h.createFullBoxCtor("stdp",function(t){var a=(this.size-this.hdr_size)/2;this.priority=[];for(var u=0;u<a;u++)this.priority[u]=t.readUint16()}),h.createFullBoxCtor("sthd"),h.createFullBoxCtor("stri",function(t){this.switch_group=t.readUint16(),this.alternate_group=t.readUint16(),this.sub_track_id=t.readUint32();var a=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var u=0;u<a;u++)this.attribute_list[u]=t.readUint32()}),h.createFullBoxCtor("stsc",function(t){var a,u;if(a=t.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],this.version===0)for(u=0;u<a;u++)this.first_chunk.push(t.readUint32()),this.samples_per_chunk.push(t.readUint32()),this.sample_description_index.push(t.readUint32())}),h.createFullBoxCtor("stsd",function(t){var a,u,g,v;for(this.entries=[],g=t.readUint32(),a=1;a<=g;a++)if(u=h.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),u.code===h.OK)h[u.type+"SampleEntry"]?(v=new h[u.type+"SampleEntry"](u.size),v.hdr_size=u.hdr_size,v.start=u.start):(f.warn("BoxParser","Unknown sample entry type: "+u.type),v=new h.SampleEntry(u.type,u.size,u.hdr_size,u.start)),v.write===h.SampleEntry.prototype.write&&(f.info("BoxParser","SampleEntry "+v.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),v.parseDataAndRewind(t)),v.parse(t),this.entries.push(v);else return}),h.createFullBoxCtor("stsg",function(t){this.grouping_type=t.readUint32();var a=t.readUint16();this.group_description_index=[];for(var u=0;u<a;u++)this.group_description_index[u]=t.readUint32()}),h.createFullBoxCtor("stsh",function(t){var a,u;if(a=t.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],this.version===0)for(u=0;u<a;u++)this.shadowed_sample_numbers.push(t.readUint32()),this.sync_sample_numbers.push(t.readUint32())}),h.createFullBoxCtor("stss",function(t){var a,u;if(u=t.readUint32(),this.version===0)for(this.sample_numbers=[],a=0;a<u;a++)this.sample_numbers.push(t.readUint32())}),h.createFullBoxCtor("stsz",function(t){var a;if(this.sample_sizes=[],this.version===0)for(this.sample_size=t.readUint32(),this.sample_count=t.readUint32(),a=0;a<this.sample_count;a++)this.sample_size===0?this.sample_sizes.push(t.readUint32()):this.sample_sizes[a]=this.sample_size}),h.createFullBoxCtor("stts",function(t){var a,u,g;if(a=t.readUint32(),this.sample_counts=[],this.sample_deltas=[],this.version===0)for(u=0;u<a;u++)this.sample_counts.push(t.readUint32()),g=t.readInt32(),g<0&&(f.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),g=1),this.sample_deltas.push(g)}),h.createFullBoxCtor("stvi",function(t){var a=t.readUint32();this.single_view_allowed=a&3,this.stereo_scheme=t.readUint32();var u=t.readUint32();this.stereo_indication_type=t.readString(u);var g,v;for(this.boxes=[];t.getPosition()<this.start+this.size;)if(g=h.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),g.code===h.OK)v=g.box,this.boxes.push(v),this[v.type]=v;else return}),h.createBoxCtor("styp",function(t){h.ftypBox.prototype.parse.call(this,t)}),h.createFullBoxCtor("stz2",function(t){var a,u;if(this.sample_sizes=[],this.version===0)if(this.reserved=t.readUint24(),this.field_size=t.readUint8(),u=t.readUint32(),this.field_size===4)for(a=0;a<u;a+=2){var g=t.readUint8();this.sample_sizes[a]=g>>4&15,this.sample_sizes[a+1]=g&15}else if(this.field_size===8)for(a=0;a<u;a++)this.sample_sizes[a]=t.readUint8();else if(this.field_size===16)for(a=0;a<u;a++)this.sample_sizes[a]=t.readUint16();else f.error("BoxParser","Error in length field in stz2 box")}),h.createFullBoxCtor("subs",function(t){var a,u,g,v;for(g=t.readUint32(),this.entries=[],a=0;a<g;a++){var w={};if(this.entries[a]=w,w.sample_delta=t.readUint32(),w.subsamples=[],v=t.readUint16(),v>0)for(u=0;u<v;u++){var T={};w.subsamples.push(T),this.version==1?T.size=t.readUint32():T.size=t.readUint16(),T.priority=t.readUint8(),T.discardable=t.readUint8(),T.codec_specific_parameters=t.readUint32()}}}),h.createFullBoxCtor("tenc",function(t){if(t.readUint8(),this.version===0)t.readUint8();else{var a=t.readUint8();this.default_crypt_byte_block=a>>4&15,this.default_skip_byte_block=a&15}this.default_isProtected=t.readUint8(),this.default_Per_Sample_IV_Size=t.readUint8(),this.default_KID=h.parseHex16(t),this.default_isProtected===1&&this.default_Per_Sample_IV_Size===0&&(this.default_constant_IV_size=t.readUint8(),this.default_constant_IV=t.readUint8Array(this.default_constant_IV_size))}),h.createFullBoxCtor("tfdt",function(t){this.version==1?this.baseMediaDecodeTime=t.readUint64():this.baseMediaDecodeTime=t.readUint32()}),h.createFullBoxCtor("tfhd",function(t){var a=0;this.track_id=t.readUint32(),this.size-this.hdr_size>a&&this.flags&h.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=t.readUint64(),a+=8):this.base_data_offset=0,this.size-this.hdr_size>a&&this.flags&h.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=t.readUint32(),a+=4):this.default_sample_description_index=0,this.size-this.hdr_size>a&&this.flags&h.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=t.readUint32(),a+=4):this.default_sample_duration=0,this.size-this.hdr_size>a&&this.flags&h.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=t.readUint32(),a+=4):this.default_sample_size=0,this.size-this.hdr_size>a&&this.flags&h.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=t.readUint32(),a+=4):this.default_sample_flags=0}),h.createFullBoxCtor("tfra",function(t){this.track_ID=t.readUint32(),t.readUint24();var a=t.readUint8();this.length_size_of_traf_num=a>>4&3,this.length_size_of_trun_num=a>>2&3,this.length_size_of_sample_num=a&3,this.entries=[];for(var u=t.readUint32(),g=0;g<u;g++)this.version===1?(this.time=t.readUint64(),this.moof_offset=t.readUint64()):(this.time=t.readUint32(),this.moof_offset=t.readUint32()),this.traf_number=t["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=t["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=t["readUint"+8*(this.length_size_of_sample_num+1)]()}),h.createFullBoxCtor("tkhd",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint32()),t.readUint32Array(2),this.layer=t.readInt16(),this.alternate_group=t.readInt16(),this.volume=t.readInt16()>>8,t.readUint16(),this.matrix=t.readInt32Array(9),this.width=t.readUint32(),this.height=t.readUint32()}),h.createBoxCtor("tmax",function(t){this.time=t.readUint32()}),h.createBoxCtor("tmin",function(t){this.time=t.readUint32()}),h.createBoxCtor("totl",function(t){this.bytessent=t.readUint32()}),h.createBoxCtor("tpay",function(t){this.bytessent=t.readUint32()}),h.createBoxCtor("tpyl",function(t){this.bytessent=t.readUint64()}),h.TrackGroupTypeBox.prototype.parse=function(t){this.parseFullHeader(t),this.track_group_id=t.readUint32()},h.createTrackGroupCtor("msrc"),h.TrackReferenceTypeBox=function(t,a,u,g){h.Box.call(this,t,a),this.hdr_size=u,this.start=g},h.TrackReferenceTypeBox.prototype=new h.Box,h.TrackReferenceTypeBox.prototype.parse=function(t){this.track_ids=t.readUint32Array((this.size-this.hdr_size)/4)},h.trefBox.prototype.parse=function(t){for(var a,u;t.getPosition()<this.start+this.size;)if(a=h.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),a.code===h.OK)u=new h.TrackReferenceTypeBox(a.type,a.size,a.hdr_size,a.start),u.write===h.Box.prototype.write&&u.type!=="mdat"&&(f.info("BoxParser","TrackReference "+u.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),u.parseDataAndRewind(t)),u.parse(t),this.boxes.push(u);else return},h.createFullBoxCtor("trep",function(t){for(this.track_ID=t.readUint32(),this.boxes=[];t.getPosition()<this.start+this.size;)if(ret=h.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),ret.code===h.OK)box=ret.box,this.boxes.push(box);else return}),h.createFullBoxCtor("trex",function(t){this.track_id=t.readUint32(),this.default_sample_description_index=t.readUint32(),this.default_sample_duration=t.readUint32(),this.default_sample_size=t.readUint32(),this.default_sample_flags=t.readUint32()}),h.createBoxCtor("trpy",function(t){this.bytessent=t.readUint64()}),h.createFullBoxCtor("trun",function(t){var a=0;if(this.sample_count=t.readUint32(),a+=4,this.size-this.hdr_size>a&&this.flags&h.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=t.readInt32(),a+=4):this.data_offset=0,this.size-this.hdr_size>a&&this.flags&h.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=t.readUint32(),a+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>a)for(var u=0;u<this.sample_count;u++)this.flags&h.TRUN_FLAGS_DURATION&&(this.sample_duration[u]=t.readUint32()),this.flags&h.TRUN_FLAGS_SIZE&&(this.sample_size[u]=t.readUint32()),this.flags&h.TRUN_FLAGS_FLAGS&&(this.sample_flags[u]=t.readUint32()),this.flags&h.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?this.sample_composition_time_offset[u]=t.readUint32():this.sample_composition_time_offset[u]=t.readInt32())}),h.createFullBoxCtor("tsel",function(t){this.switch_group=t.readUint32();var a=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var u=0;u<a;u++)this.attribute_list[u]=t.readUint32()}),h.createFullBoxCtor("txtC",function(t){this.config=t.readCString()}),h.createBoxCtor("tyco",function(t){var a=(this.size-this.hdr_size)/4;this.compatible_brands=[];for(var u=0;u<a;u++)this.compatible_brands[u]=t.readString(4)}),h.createFullBoxCtor("udes",function(t){this.lang=t.readCString(),this.name=t.readCString(),this.description=t.readCString(),this.tags=t.readCString()}),h.createFullBoxCtor("uncC",function(t){var a;if(this.profile=t.readUint32(),this.version!=1){if(this.version==0){for(this.component_count=t.readUint32(),this.component_index=[],this.component_bit_depth_minus_one=[],this.component_format=[],this.component_align_size=[],a=0;a<this.component_count;a++)this.component_index.push(t.readUint16()),this.component_bit_depth_minus_one.push(t.readUint8()),this.component_format.push(t.readUint8()),this.component_align_size.push(t.readUint8());this.sampling_type=t.readUint8(),this.interleave_type=t.readUint8(),this.block_size=t.readUint8();var u=t.readUint8();this.component_little_endian=u>>7&1,this.block_pad_lsb=u>>6&1,this.block_little_endian=u>>5&1,this.block_reversed=u>>4&1,this.pad_unknown=u>>3&1,this.pixel_size=t.readUint32(),this.row_align_size=t.readUint32(),this.tile_align_size=t.readUint32(),this.num_tile_cols_minus_one=t.readUint32(),this.num_tile_rows_minus_one=t.readUint32()}}}),h.createFullBoxCtor("url ",function(t){this.flags!==1&&(this.location=t.readCString())}),h.createFullBoxCtor("urn ",function(t){this.name=t.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=t.readCString())}),h.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66",!0,!1,function(t){this.LiveServerManifest=t.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}),h.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3",!0,!1,function(t){this.system_id=h.parseHex16(t);var a=t.readUint32();a>0&&(this.data=t.readUint8Array(a))}),h.createUUIDBox("a2394f525a9b4f14a2446c427c648df4",!0,!1),h.createUUIDBox("8974dbce7be74c5184f97148f9882554",!0,!1,function(t){this.default_AlgorithmID=t.readUint24(),this.default_IV_size=t.readUint8(),this.default_KID=h.parseHex16(t)}),h.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f",!0,!1,function(t){this.fragment_count=t.readUint8(),this.entries=[];for(var a=0;a<this.fragment_count;a++){var u={},g=0,v=0;this.version===1?(g=t.readUint64(),v=t.readUint64()):(g=t.readUint32(),v=t.readUint32()),u.absolute_time=g,u.absolute_duration=v,this.entries.push(u)}}),h.createUUIDBox("6d1d9b0542d544e680e2141daff757b2",!0,!1,function(t){this.version===1?(this.absolute_time=t.readUint64(),this.duration=t.readUint64()):(this.absolute_time=t.readUint32(),this.duration=t.readUint32())}),h.createFullBoxCtor("vmhd",function(t){this.graphicsmode=t.readUint16(),this.opcolor=t.readUint16Array(3)}),h.createFullBoxCtor("vpcC",function(t){var a;this.version===1?(this.profile=t.readUint8(),this.level=t.readUint8(),a=t.readUint8(),this.bitDepth=a>>4,this.chromaSubsampling=a>>1&7,this.videoFullRangeFlag=a&1,this.colourPrimaries=t.readUint8(),this.transferCharacteristics=t.readUint8(),this.matrixCoefficients=t.readUint8(),this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize)):(this.profile=t.readUint8(),this.level=t.readUint8(),a=t.readUint8(),this.bitDepth=a>>4&15,this.colorSpace=a&15,a=t.readUint8(),this.chromaSubsampling=a>>4&15,this.transferFunction=a>>1&7,this.videoFullRangeFlag=a&1,this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize))}),h.createBoxCtor("vttC",function(t){this.text=t.readString(this.size-this.hdr_size)}),h.createFullBoxCtor("vvcC",function(t){var a,u,g={held_bits:void 0,num_held_bits:0,stream_read_1_bytes:function(X){this.held_bits=X.readUint8(),this.num_held_bits=8},stream_read_2_bytes:function(X){this.held_bits=X.readUint16(),this.num_held_bits=16},extract_bits:function(X){var oe=this.held_bits>>this.num_held_bits-X&(1<<X)-1;return this.num_held_bits-=X,oe}};if(g.stream_read_1_bytes(t),g.extract_bits(5),this.lengthSizeMinusOne=g.extract_bits(2),this.ptl_present_flag=g.extract_bits(1),this.ptl_present_flag){g.stream_read_2_bytes(t),this.ols_idx=g.extract_bits(9),this.num_sublayers=g.extract_bits(3),this.constant_frame_rate=g.extract_bits(2),this.chroma_format_idc=g.extract_bits(2),g.stream_read_1_bytes(t),this.bit_depth_minus8=g.extract_bits(3),g.extract_bits(5);{if(g.stream_read_2_bytes(t),g.extract_bits(2),this.num_bytes_constraint_info=g.extract_bits(6),this.general_profile_idc=g.extract_bits(7),this.general_tier_flag=g.extract_bits(1),this.general_level_idc=t.readUint8(),g.stream_read_1_bytes(t),this.ptl_frame_only_constraint_flag=g.extract_bits(1),this.ptl_multilayer_enabled_flag=g.extract_bits(1),this.general_constraint_info=new Uint8Array(this.num_bytes_constraint_info),this.num_bytes_constraint_info){for(a=0;a<this.num_bytes_constraint_info-1;a++){var v=g.extract_bits(6);g.stream_read_1_bytes(t);var w=g.extract_bits(2);this.general_constraint_info[a]=v<<2|w}this.general_constraint_info[this.num_bytes_constraint_info-1]=g.extract_bits(6)}else g.extract_bits(6);if(this.num_sublayers>1){for(g.stream_read_1_bytes(t),this.ptl_sublayer_present_mask=0,u=this.num_sublayers-2;u>=0;--u){var T=g.extract_bits(1);this.ptl_sublayer_present_mask|=T<<u}for(u=this.num_sublayers;u<=8&&this.num_sublayers>1;++u)g.extract_bits(1);for(this.sublayer_level_idc=[],u=this.num_sublayers-2;u>=0;--u)this.ptl_sublayer_present_mask&1<<u&&(this.sublayer_level_idc[u]=t.readUint8())}if(this.ptl_num_sub_profiles=t.readUint8(),this.general_sub_profile_idc=[],this.ptl_num_sub_profiles)for(a=0;a<this.ptl_num_sub_profiles;a++)this.general_sub_profile_idc.push(t.readUint32())}this.max_picture_width=t.readUint16(),this.max_picture_height=t.readUint16(),this.avg_frame_rate=t.readUint16()}var O=12,P=13;this.nalu_arrays=[];var D=t.readUint8();for(a=0;a<D;a++){var z=[];this.nalu_arrays.push(z),g.stream_read_1_bytes(t),z.completeness=g.extract_bits(1),g.extract_bits(2),z.nalu_type=g.extract_bits(5);var j=1;for(z.nalu_type!=P&&z.nalu_type!=O&&(j=t.readUint16()),u=0;u<j;u++){var $=t.readUint16();z.push({data:t.readUint8Array($),length:$})}}}),h.createFullBoxCtor("vvnC",function(t){var a=strm.readUint8();this.lengthSizeMinusOne=a&3}),h.SampleEntry.prototype.isVideo=function(){return!1},h.SampleEntry.prototype.isAudio=function(){return!1},h.SampleEntry.prototype.isSubtitle=function(){return!1},h.SampleEntry.prototype.isMetadata=function(){return!1},h.SampleEntry.prototype.isHint=function(){return!1},h.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},h.SampleEntry.prototype.getWidth=function(){return""},h.SampleEntry.prototype.getHeight=function(){return""},h.SampleEntry.prototype.getChannelCount=function(){return""},h.SampleEntry.prototype.getSampleRate=function(){return""},h.SampleEntry.prototype.getSampleSize=function(){return""},h.VisualSampleEntry.prototype.isVideo=function(){return!0},h.VisualSampleEntry.prototype.getWidth=function(){return this.width},h.VisualSampleEntry.prototype.getHeight=function(){return this.height},h.AudioSampleEntry.prototype.isAudio=function(){return!0},h.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},h.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},h.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},h.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},h.MetadataSampleEntry.prototype.isMetadata=function(){return!0},h.decimalToHex=function(t,a){var u=Number(t).toString(16);for(a=typeof a>"u"||a===null?a=2:a;u.length<a;)u="0"+u;return u},h.avc1SampleEntry.prototype.getCodec=h.avc2SampleEntry.prototype.getCodec=h.avc3SampleEntry.prototype.getCodec=h.avc4SampleEntry.prototype.getCodec=function(){var t=h.SampleEntry.prototype.getCodec.call(this);return this.avcC?t+"."+h.decimalToHex(this.avcC.AVCProfileIndication)+h.decimalToHex(this.avcC.profile_compatibility)+h.decimalToHex(this.avcC.AVCLevelIndication):t},h.hev1SampleEntry.prototype.getCodec=h.hvc1SampleEntry.prototype.getCodec=function(){var t,a=h.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(a+=".",this.hvcC.general_profile_space){case 0:a+="";break;case 1:a+="A";break;case 2:a+="B";break;case 3:a+="C";break}a+=this.hvcC.general_profile_idc,a+=".";var u=this.hvcC.general_profile_compatibility,g=0;for(t=0;t<32&&(g|=u&1,t!=31);t++)g<<=1,u>>=1;a+=h.decimalToHex(g,0),a+=".",this.hvcC.general_tier_flag===0?a+="L":a+="H",a+=this.hvcC.general_level_idc;var v=!1,w="";for(t=5;t>=0;t--)(this.hvcC.general_constraint_indicator[t]||v)&&(w="."+h.decimalToHex(this.hvcC.general_constraint_indicator[t],0)+w,v=!0);a+=w}return a},h.vvc1SampleEntry.prototype.getCodec=h.vvi1SampleEntry.prototype.getCodec=function(){var t,a=h.SampleEntry.prototype.getCodec.call(this);if(this.vvcC){a+="."+this.vvcC.general_profile_idc,this.vvcC.general_tier_flag?a+=".H":a+=".L",a+=this.vvcC.general_level_idc;var u="";if(this.vvcC.general_constraint_info){var g=[],v=0;v|=this.vvcC.ptl_frame_only_constraint<<7,v|=this.vvcC.ptl_multilayer_enabled<<6;var w;for(t=0;t<this.vvcC.general_constraint_info.length;++t)v|=this.vvcC.general_constraint_info[t]>>2&63,g.push(v),v&&(w=t),v=this.vvcC.general_constraint_info[t]>>2&3;if(w===void 0)u=".CA";else{u=".C";var T="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",O=0,P=0;for(t=0;t<=w;++t)for(O=O<<8|g[t],P+=8;P>=5;){var D=O>>P-5&31;u+=T[D],P-=5,O&=(1<<P)-1}P&&(O<<=5-P,u+=T[O&31])}}a+=u}return a},h.mp4aSampleEntry.prototype.getCodec=function(){var t=h.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var a=this.esds.esd.getOTI(),u=this.esds.esd.getAudioConfig();return t+"."+h.decimalToHex(a)+(u?"."+u:"")}else return t},h.stxtSampleEntry.prototype.getCodec=function(){var t=h.SampleEntry.prototype.getCodec.call(this);return this.mime_format?t+"."+this.mime_format:t},h.vp08SampleEntry.prototype.getCodec=h.vp09SampleEntry.prototype.getCodec=function(){var t=h.SampleEntry.prototype.getCodec.call(this),a=this.vpcC.level;a==0&&(a="00");var u=this.vpcC.bitDepth;return u==8&&(u="08"),t+".0"+this.vpcC.profile+"."+a+"."+u},h.av01SampleEntry.prototype.getCodec=function(){var t=h.SampleEntry.prototype.getCodec.call(this),a=this.av1C.seq_level_idx_0;a<10&&(a="0"+a);var u;return this.av1C.seq_profile===2&&this.av1C.high_bitdepth===1?u=this.av1C.twelve_bit===1?"12":"10":this.av1C.seq_profile<=2&&(u=this.av1C.high_bitdepth===1?"10":"08"),t+"."+this.av1C.seq_profile+"."+a+(this.av1C.seq_tier_0?"H":"M")+"."+u},h.Box.prototype.writeHeader=function(t,a){this.size+=8,this.size>p&&(this.size+=8),this.type==="uuid"&&(this.size+=16),f.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+t.getPosition()+(a||"")),this.size>p?t.writeUint32(1):(this.sizePosition=t.getPosition(),t.writeUint32(this.size)),t.writeString(this.type,null,4),this.type==="uuid"&&t.writeUint8Array(this.uuid),this.size>p&&t.writeUint64(this.size)},h.FullBox.prototype.writeHeader=function(t){this.size+=4,h.Box.prototype.writeHeader.call(this,t," v="+this.version+" f="+this.flags),t.writeUint8(this.version),t.writeUint24(this.flags)},h.Box.prototype.write=function(t){this.type==="mdat"?this.data&&(this.size=this.data.length,this.writeHeader(t),t.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(t),this.data&&t.writeUint8Array(this.data))},h.ContainerBox.prototype.write=function(t){this.size=0,this.writeHeader(t);for(var a=0;a<this.boxes.length;a++)this.boxes[a]&&(this.boxes[a].write(t),this.size+=this.boxes[a].size);f.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},h.TrackReferenceTypeBox.prototype.write=function(t){this.size=this.track_ids.length*4,this.writeHeader(t),t.writeUint32Array(this.track_ids)},h.avcCBox.prototype.write=function(t){var a;for(this.size=7,a=0;a<this.SPS.length;a++)this.size+=2+this.SPS[a].length;for(a=0;a<this.PPS.length;a++)this.size+=2+this.PPS[a].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8(this.AVCProfileIndication),t.writeUint8(this.profile_compatibility),t.writeUint8(this.AVCLevelIndication),t.writeUint8(this.lengthSizeMinusOne+252),t.writeUint8(this.SPS.length+224),a=0;a<this.SPS.length;a++)t.writeUint16(this.SPS[a].length),t.writeUint8Array(this.SPS[a].nalu);for(t.writeUint8(this.PPS.length),a=0;a<this.PPS.length;a++)t.writeUint16(this.PPS[a].length),t.writeUint8Array(this.PPS[a].nalu);this.ext&&t.writeUint8Array(this.ext)},h.co64Box.prototype.write=function(t){var a;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),a=0;a<this.chunk_offsets.length;a++)t.writeUint64(this.chunk_offsets[a])},h.cslgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(t),t.writeInt32(this.compositionToDTSShift),t.writeInt32(this.leastDecodeToDisplayDelta),t.writeInt32(this.greatestDecodeToDisplayDelta),t.writeInt32(this.compositionStartTime),t.writeInt32(this.compositionEndTime)},h.cttsBox.prototype.write=function(t){var a;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),a=0;a<this.sample_counts.length;a++)t.writeUint32(this.sample_counts[a]),this.version===1?t.writeInt32(this.sample_offsets[a]):t.writeUint32(this.sample_offsets[a])},h.drefBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++)this.entries[a].write(t),this.size+=this.entries[a].size;f.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},h.elngBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(t),t.writeString(this.extended_language)},h.elstBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(t),t.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++){var u=this.entries[a];t.writeUint32(u.segment_duration),t.writeInt32(u.media_time),t.writeInt16(u.media_rate_integer),t.writeInt16(u.media_rate_fraction)}},h.emsgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*4+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(t),t.writeCString(this.scheme_id_uri),t.writeCString(this.value),t.writeUint32(this.timescale),t.writeUint32(this.presentation_time_delta),t.writeUint32(this.event_duration),t.writeUint32(this.id),t.writeUint8Array(this.message_data)},h.ftypBox.prototype.write=function(t){this.size=8+4*this.compatible_brands.length,this.writeHeader(t),t.writeString(this.major_brand,null,4),t.writeUint32(this.minor_version);for(var a=0;a<this.compatible_brands.length;a++)t.writeString(this.compatible_brands[a],null,4)},h.hdlrBox.prototype.write=function(t){this.size=5*4+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(t),t.writeUint32(0),t.writeString(this.handler,null,4),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeCString(this.name)},h.hvcCBox.prototype.write=function(t){var a,u;for(this.size=23,a=0;a<this.nalu_arrays.length;a++)for(this.size+=3,u=0;u<this.nalu_arrays[a].length;u++)this.size+=2+this.nalu_arrays[a][u].data.length;for(this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8((this.general_profile_space<<6)+(this.general_tier_flag<<5)+this.general_profile_idc),t.writeUint32(this.general_profile_compatibility),t.writeUint8Array(this.general_constraint_indicator),t.writeUint8(this.general_level_idc),t.writeUint16(this.min_spatial_segmentation_idc+(15<<24)),t.writeUint8(this.parallelismType+252),t.writeUint8(this.chroma_format_idc+252),t.writeUint8(this.bit_depth_luma_minus8+248),t.writeUint8(this.bit_depth_chroma_minus8+248),t.writeUint16(this.avgFrameRate),t.writeUint8((this.constantFrameRate<<6)+(this.numTemporalLayers<<3)+(this.temporalIdNested<<2)+this.lengthSizeMinusOne),t.writeUint8(this.nalu_arrays.length),a=0;a<this.nalu_arrays.length;a++)for(t.writeUint8((this.nalu_arrays[a].completeness<<7)+this.nalu_arrays[a].nalu_type),t.writeUint16(this.nalu_arrays[a].length),u=0;u<this.nalu_arrays[a].length;u++)t.writeUint16(this.nalu_arrays[a][u].data.length),t.writeUint8Array(this.nalu_arrays[a][u].data)},h.kindBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(t),t.writeCString(this.schemeURI),t.writeCString(this.value)},h.mdhdBox.prototype.write=function(t){this.size=4*4+2*2,this.flags=0,this.version=0,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint16(this.language),t.writeUint16(0)},h.mehdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.fragment_duration)},h.mfhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.sequence_number)},h.mvhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=23*4+2*2,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint32(this.rate),t.writeUint16(this.volume<<8),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32Array(this.matrix),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(this.next_track_id)},h.SampleEntry.prototype.writeHeader=function(t){this.size=8,h.Box.prototype.writeHeader.call(this,t),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint16(this.data_reference_index)},h.SampleEntry.prototype.writeFooter=function(t){for(var a=0;a<this.boxes.length;a++)this.boxes[a].write(t),this.size+=this.boxes[a].size;f.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},h.SampleEntry.prototype.write=function(t){this.writeHeader(t),t.writeUint8Array(this.data),this.size+=this.data.length,f.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},h.VisualSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=2*7+6*4+32,t.writeUint16(0),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.width),t.writeUint16(this.height),t.writeUint32(this.horizresolution),t.writeUint32(this.vertresolution),t.writeUint32(0),t.writeUint16(this.frame_count),t.writeUint8(Math.min(31,this.compressorname.length)),t.writeString(this.compressorname,null,31),t.writeUint16(this.depth),t.writeInt16(-1),this.writeFooter(t)},h.AudioSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=2*4+3*4,t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.channel_count),t.writeUint16(this.samplesize),t.writeUint16(0),t.writeUint16(0),t.writeUint32(this.samplerate<<16),this.writeFooter(t)},h.stppSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,t.writeCString(this.namespace),t.writeCString(this.schema_location),t.writeCString(this.auxiliary_mime_types),this.writeFooter(t)},h.SampleGroupEntry.prototype.write=function(t){t.writeUint8Array(this.data)},h.sbgpBox.prototype.write=function(t){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(t),t.writeString(this.grouping_type,null,4),t.writeUint32(this.grouping_type_parameter),t.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++){var u=this.entries[a];t.writeInt32(u.sample_count),t.writeInt32(u.group_description_index)}},h.sgpdBox.prototype.write=function(t){var a,u;for(this.flags=0,this.size=12,a=0;a<this.entries.length;a++)u=this.entries[a],this.version===1&&(this.default_length===0&&(this.size+=4),this.size+=u.data.length);for(this.writeHeader(t),t.writeString(this.grouping_type,null,4),this.version===1&&t.writeUint32(this.default_length),this.version>=2&&t.writeUint32(this.default_sample_description_index),t.writeUint32(this.entries.length),a=0;a<this.entries.length;a++)u=this.entries[a],this.version===1&&this.default_length===0&&t.writeUint32(u.description_length),u.write(t)},h.sidxBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*4+2+2+12*this.references.length,this.writeHeader(t),t.writeUint32(this.reference_ID),t.writeUint32(this.timescale),t.writeUint32(this.earliest_presentation_time),t.writeUint32(this.first_offset),t.writeUint16(0),t.writeUint16(this.references.length);for(var a=0;a<this.references.length;a++){var u=this.references[a];t.writeUint32(u.reference_type<<31|u.referenced_size),t.writeUint32(u.subsegment_duration),t.writeUint32(u.starts_with_SAP<<31|u.SAP_type<<28|u.SAP_delta_time)}},h.smhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=4,this.writeHeader(t),t.writeUint16(this.balance),t.writeUint16(0)},h.stcoBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),t.writeUint32Array(this.chunk_offsets)},h.stscBox.prototype.write=function(t){var a;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(t),t.writeUint32(this.first_chunk.length),a=0;a<this.first_chunk.length;a++)t.writeUint32(this.first_chunk[a]),t.writeUint32(this.samples_per_chunk[a]),t.writeUint32(this.sample_description_index[a])},h.stsdBox.prototype.write=function(t){var a;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(t),t.writeUint32(this.entries.length),this.size+=4,a=0;a<this.entries.length;a++)this.entries[a].write(t),this.size+=this.entries[a].size;f.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},h.stshBox.prototype.write=function(t){var a;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(t),t.writeUint32(this.shadowed_sample_numbers.length),a=0;a<this.shadowed_sample_numbers.length;a++)t.writeUint32(this.shadowed_sample_numbers[a]),t.writeUint32(this.sync_sample_numbers[a])},h.stssBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(t),t.writeUint32(this.sample_numbers.length),t.writeUint32Array(this.sample_numbers)},h.stszBox.prototype.write=function(t){var a,u=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(a=0;a+1<this.sample_sizes.length;)if(this.sample_sizes[a+1]!==this.sample_sizes[0]){u=!1;break}else a++;else u=!1;this.size=8,u||(this.size+=4*this.sample_sizes.length),this.writeHeader(t),u?t.writeUint32(this.sample_sizes[0]):t.writeUint32(0),t.writeUint32(this.sample_sizes.length),u||t.writeUint32Array(this.sample_sizes)},h.sttsBox.prototype.write=function(t){var a;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),a=0;a<this.sample_counts.length;a++)t.writeUint32(this.sample_counts[a]),t.writeUint32(this.sample_deltas[a])},h.tfdtBox.prototype.write=function(t){var a=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>a?1:0,this.flags=0,this.size=4,this.version===1&&(this.size+=4),this.writeHeader(t),this.version===1?t.writeUint64(this.baseMediaDecodeTime):t.writeUint32(this.baseMediaDecodeTime)},h.tfhdBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&h.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&h.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&h.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&h.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&h.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(t),t.writeUint32(this.track_id),this.flags&h.TFHD_FLAG_BASE_DATA_OFFSET&&t.writeUint64(this.base_data_offset),this.flags&h.TFHD_FLAG_SAMPLE_DESC&&t.writeUint32(this.default_sample_description_index),this.flags&h.TFHD_FLAG_SAMPLE_DUR&&t.writeUint32(this.default_sample_duration),this.flags&h.TFHD_FLAG_SAMPLE_SIZE&&t.writeUint32(this.default_sample_size),this.flags&h.TFHD_FLAG_SAMPLE_FLAGS&&t.writeUint32(this.default_sample_flags)},h.tkhdBox.prototype.write=function(t){this.version=0,this.size=4*18+2*4,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.track_id),t.writeUint32(0),t.writeUint32(this.duration),t.writeUint32(0),t.writeUint32(0),t.writeInt16(this.layer),t.writeInt16(this.alternate_group),t.writeInt16(this.volume<<8),t.writeUint16(0),t.writeInt32Array(this.matrix),t.writeUint32(this.width),t.writeUint32(this.height)},h.trexBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(t),t.writeUint32(this.track_id),t.writeUint32(this.default_sample_description_index),t.writeUint32(this.default_sample_duration),t.writeUint32(this.default_sample_size),t.writeUint32(this.default_sample_flags)},h.trunBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&h.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&h.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&h.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&h.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&h.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&h.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(t),t.writeUint32(this.sample_count),this.flags&h.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=t.getPosition(),t.writeInt32(this.data_offset)),this.flags&h.TRUN_FLAGS_FIRST_FLAG&&t.writeUint32(this.first_sample_flags);for(var a=0;a<this.sample_count;a++)this.flags&h.TRUN_FLAGS_DURATION&&t.writeUint32(this.sample_duration[a]),this.flags&h.TRUN_FLAGS_SIZE&&t.writeUint32(this.sample_size[a]),this.flags&h.TRUN_FLAGS_FLAGS&&t.writeUint32(this.sample_flags[a]),this.flags&h.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?t.writeUint32(this.sample_composition_time_offset[a]):t.writeInt32(this.sample_composition_time_offset[a]))},h["url Box"].prototype.write=function(t){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(t),this.location&&t.writeCString(this.location)},h["urn Box"].prototype.write=function(t){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(t),t.writeCString(this.name),this.location&&t.writeCString(this.location)},h.vmhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=8,this.writeHeader(t),t.writeUint16(this.graphicsmode),t.writeUint16Array(this.opcolor)},h.cttsBox.prototype.unpack=function(t){var a,u,g;for(g=0,a=0;a<this.sample_counts.length;a++)for(u=0;u<this.sample_counts[a];u++)t[g].pts=t[g].dts+this.sample_offsets[a],g++},h.sttsBox.prototype.unpack=function(t){var a,u,g;for(g=0,a=0;a<this.sample_counts.length;a++)for(u=0;u<this.sample_counts[a];u++)g===0?t[g].dts=0:t[g].dts=t[g-1].dts+this.sample_deltas[a],g++},h.stcoBox.prototype.unpack=function(t){var a;for(a=0;a<this.chunk_offsets.length;a++)t[a].offset=this.chunk_offsets[a]},h.stscBox.prototype.unpack=function(t){var a,u,g,v,w;for(v=0,w=0,a=0;a<this.first_chunk.length;a++)for(u=0;u<(a+1<this.first_chunk.length?this.first_chunk[a+1]:1/0);u++)for(w++,g=0;g<this.samples_per_chunk[a];g++){if(t[v])t[v].description_index=this.sample_description_index[a],t[v].chunk_index=w;else return;v++}},h.stszBox.prototype.unpack=function(t){var a;for(a=0;a<this.sample_sizes.length;a++)t[a].size=this.sample_sizes[a]},h.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],h.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],h.boxEqualFields=function(t,a){if(t&&!a)return!1;var u;for(u in t)if(!(h.DIFF_BOXES_PROP_NAMES.indexOf(u)>-1)){if(t[u]instanceof h.Box||a[u]instanceof h.Box)continue;if(typeof t[u]>"u"||typeof a[u]>"u")continue;if(typeof t[u]=="function"||typeof a[u]=="function")continue;if(t.subBoxNames&&t.subBoxNames.indexOf(u.slice(0,4))>-1||a.subBoxNames&&a.subBoxNames.indexOf(u.slice(0,4))>-1)continue;if(u==="data"||u==="start"||u==="size"||u==="creation_time"||u==="modification_time")continue;if(h.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(u)>-1)continue;if(t[u]!==a[u])return!1}return!0},h.boxEqual=function(t,a){if(!h.boxEqualFields(t,a))return!1;for(var u=0;u<h.DIFF_BOXES_PROP_NAMES.length;u++){var g=h.DIFF_BOXES_PROP_NAMES[u];if(t[g]&&a[g]&&!h.boxEqual(t[g],a[g]))return!1}return!0};var S=function(){};S.prototype.parseSample=function(t){var a,u,g=new l(t.buffer);for(a=[];!g.isEos();)u=h.parseOneBox(g,!1),u.code===h.OK&&u.box.type==="vttc"&&a.push(u.box);return a},S.prototype.getText=function(t,a,u){function g(D,z,j){return j=j||"0",D=D+"",D.length>=z?D:new Array(z-D.length+1).join(j)+D}function v(D){var z=Math.floor(D/3600),j=Math.floor((D-z*3600)/60),$=Math.floor(D-z*3600-j*60),X=Math.floor((D-z*3600-j*60-$)*1e3);return""+g(z,2)+":"+g(j,2)+":"+g($,2)+"."+g(X,3)}for(var w=this.parseSample(u),T="",O=0;O<w.length;O++){var P=w[O];T+=v(t)+" --> "+v(a)+`\r
`,T+=P.payl.text}return T};var _=function(){};_.prototype.parseSample=function(t){var a={},u;a.resources=[];var g=new l(t.data.buffer);if(!t.subsamples||t.subsamples.length===0)a.documentString=g.readString(t.data.length);else if(a.documentString=g.readString(t.subsamples[0].size),t.subsamples.length>1)for(u=1;u<t.subsamples.length;u++)a.resources[u]=g.readUint8Array(t.subsamples[u].size);return typeof DOMParser<"u"&&(a.document=new DOMParser().parseFromString(a.documentString,"application/xml")),a};var L=function(){};L.prototype.parseSample=function(t){var a,u=new l(t.data.buffer);return a=u.readString(t.data.length),a},L.prototype.parseConfig=function(t){var a,u=new l(t.buffer);return u.readUint32(),a=u.readCString(),a},c.VTTin4Parser=S,c.XMLSubtitlein4Parser=_,c.Textin4Parser=L;var k=function(t){this.stream=t||new b,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.items=[],this.entity_groups=[],this.onSidx=null,this.sidxSent=!1};k.prototype.setSegmentOptions=function(t,a,u){var g=this.getTrackById(t);if(g){var v={};this.fragmentedTracks.push(v),v.id=t,v.user=a,v.trak=g,g.nextSample=0,v.segmentStream=null,v.nb_samples=1e3,v.rapAlignement=!0,u&&(u.nbSamples&&(v.nb_samples=u.nbSamples),u.rapAlignement&&(v.rapAlignement=u.rapAlignement))}},k.prototype.unsetSegmentOptions=function(t){for(var a=-1,u=0;u<this.fragmentedTracks.length;u++){var g=this.fragmentedTracks[u];g.id==t&&(a=u)}a>-1&&this.fragmentedTracks.splice(a,1)},k.prototype.setExtractionOptions=function(t,a,u){var g=this.getTrackById(t);if(g){var v={};this.extractedTracks.push(v),v.id=t,v.user=a,v.trak=g,g.nextSample=0,v.nb_samples=1e3,v.samples=[],u&&u.nbSamples&&(v.nb_samples=u.nbSamples)}},k.prototype.unsetExtractionOptions=function(t){for(var a=-1,u=0;u<this.extractedTracks.length;u++){var g=this.extractedTracks[u];g.id==t&&(a=u)}a>-1&&this.extractedTracks.splice(a,1)},k.prototype.parse=function(){var t,a,u=!1;if(!(this.restoreParsePosition&&!this.restoreParsePosition()))for(;;)if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}else if(this.saveParsePosition&&this.saveParsePosition(),t=h.parseOneBox(this.stream,u),t.code===h.ERR_NOT_ENOUGH_DATA)if(this.processIncompleteBox){if(this.processIncompleteBox(t))continue;return}else return;else{var g;switch(a=t.box,g=a.type!=="uuid"?a.type:a.uuid,this.boxes.push(a),g){case"mdat":this.mdats.push(a);break;case"moof":this.moofs.push(a);break;case"moov":this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0);default:this[g]!==void 0&&f.warn("ISOFile","Duplicate Box of type: "+g+", overriding previous occurrence"),this[g]=a;break}this.updateUsedBytes&&this.updateUsedBytes(a,t)}},k.prototype.checkBuffer=function(t){if(t==null)throw"Buffer must be defined and non empty";if(t.fileStart===void 0)throw"Buffer must have a fileStart property";return t.byteLength===0?(f.warn("ISOFile","Ignoring empty buffer (fileStart: "+t.fileStart+")"),this.stream.logBufferLevel(),!1):(f.info("ISOFile","Processing buffer (fileStart: "+t.fileStart+")"),t.usedBytes=0,this.stream.insertBuffer(t),this.stream.logBufferLevel(),this.stream.initialized()?!0:(f.warn("ISOFile","Not ready to start parsing"),!1))},k.prototype.appendBuffer=function(t,a){var u;if(this.checkBuffer(t))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(a),this.nextSeekPosition?(u=this.nextSeekPosition,this.nextSeekPosition=void 0):u=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(u=this.stream.getEndFilePositionAfter(u))):this.nextParsePosition?u=this.nextParsePosition:u=0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(f.info("ISOFile","Done processing buffer (fileStart: "+t.fileStart+") - next buffer to fetch should have a fileStart position of "+u),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),f.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),u},k.prototype.getInfo=function(){var t,a,u={},g,v,w,T,O=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(u.hasMoov=!0,u.duration=this.moov.mvhd.duration,u.timescale=this.moov.mvhd.timescale,u.isFragmented=this.moov.mvex!=null,u.isFragmented&&this.moov.mvex.mehd&&(u.fragment_duration=this.moov.mvex.mehd.fragment_duration),u.isProgressive=this.isProgressive,u.hasIOD=this.moov.iods!=null,u.brands=[],u.brands.push(this.ftyp.major_brand),u.brands=u.brands.concat(this.ftyp.compatible_brands),u.created=new Date(O+this.moov.mvhd.creation_time*1e3),u.modified=new Date(O+this.moov.mvhd.modification_time*1e3),u.tracks=[],u.audioTracks=[],u.videoTracks=[],u.subtitleTracks=[],u.metadataTracks=[],u.hintTracks=[],u.otherTracks=[],t=0;t<this.moov.traks.length;t++){if(g=this.moov.traks[t],T=g.mdia.minf.stbl.stsd.entries[0],v={},u.tracks.push(v),v.id=g.tkhd.track_id,v.name=g.mdia.hdlr.name,v.references=[],g.tref)for(a=0;a<g.tref.boxes.length;a++)w={},v.references.push(w),w.type=g.tref.boxes[a].type,w.track_ids=g.tref.boxes[a].track_ids;g.edts&&(v.edits=g.edts.elst.entries),v.created=new Date(O+g.tkhd.creation_time*1e3),v.modified=new Date(O+g.tkhd.modification_time*1e3),v.movie_duration=g.tkhd.duration,v.movie_timescale=u.timescale,v.layer=g.tkhd.layer,v.alternate_group=g.tkhd.alternate_group,v.volume=g.tkhd.volume,v.matrix=g.tkhd.matrix,v.track_width=g.tkhd.width/65536,v.track_height=g.tkhd.height/65536,v.timescale=g.mdia.mdhd.timescale,v.cts_shift=g.mdia.minf.stbl.cslg,v.duration=g.mdia.mdhd.duration,v.samples_duration=g.samples_duration,v.codec=T.getCodec(),v.kind=g.udta&&g.udta.kinds.length?g.udta.kinds[0]:{schemeURI:"",value:""},v.language=g.mdia.elng?g.mdia.elng.extended_language:g.mdia.mdhd.languageString,v.nb_samples=g.samples.length,v.size=g.samples_size,v.bitrate=v.size*8*v.timescale/v.samples_duration,T.isAudio()?(v.type="audio",u.audioTracks.push(v),v.audio={},v.audio.sample_rate=T.getSampleRate(),v.audio.channel_count=T.getChannelCount(),v.audio.sample_size=T.getSampleSize()):T.isVideo()?(v.type="video",u.videoTracks.push(v),v.video={},v.video.width=T.getWidth(),v.video.height=T.getHeight()):T.isSubtitle()?(v.type="subtitles",u.subtitleTracks.push(v)):T.isHint()?(v.type="metadata",u.hintTracks.push(v)):T.isMetadata()?(v.type="metadata",u.metadataTracks.push(v)):(v.type="metadata",u.otherTracks.push(v))}else u.hasMoov=!1;if(u.mime="",u.hasMoov&&u.tracks){for(u.videoTracks&&u.videoTracks.length>0?u.mime+='video/mp4; codecs="':u.audioTracks&&u.audioTracks.length>0?u.mime+='audio/mp4; codecs="':u.mime+='application/mp4; codecs="',t=0;t<u.tracks.length;t++)t!==0&&(u.mime+=","),u.mime+=u.tracks[t].codec;u.mime+='"; profiles="',u.mime+=this.ftyp.compatible_brands.join(),u.mime+='"'}return u},k.prototype.setNextSeekPositionFromSample=function(t){t&&(this.nextSeekPosition?this.nextSeekPosition=Math.min(t.offset+t.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=t.offset+t.alreadyRead)},k.prototype.processSamples=function(t){var a,u;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&this.onSegment!==null)for(a=0;a<this.fragmentedTracks.length;a++){var g=this.fragmentedTracks[a];for(u=g.trak;u.nextSample<u.samples.length&&this.sampleProcessingStarted;){f.debug("ISOFile","Creating media fragment on track #"+g.id+" for sample "+u.nextSample);var v=this.createFragment(g.id,u.nextSample,g.segmentStream);if(v)g.segmentStream=v,u.nextSample++;else break;if((u.nextSample%g.nb_samples===0||t||u.nextSample>=u.samples.length)&&(f.info("ISOFile","Sending fragmented data on track #"+g.id+" for samples ["+Math.max(0,u.nextSample-g.nb_samples)+","+(u.nextSample-1)+"]"),f.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(g.id,g.user,g.segmentStream.buffer,u.nextSample,t||u.nextSample>=u.samples.length),g.segmentStream=null,g!==this.fragmentedTracks[a]))break}}if(this.onSamples!==null)for(a=0;a<this.extractedTracks.length;a++){var w=this.extractedTracks[a];for(u=w.trak;u.nextSample<u.samples.length&&this.sampleProcessingStarted;){f.debug("ISOFile","Exporting on track #"+w.id+" sample #"+u.nextSample);var T=this.getSample(u,u.nextSample);if(T)u.nextSample++,w.samples.push(T);else{this.setNextSeekPositionFromSample(u.samples[u.nextSample]);break}if((u.nextSample%w.nb_samples===0||u.nextSample>=u.samples.length)&&(f.debug("ISOFile","Sending samples on track #"+w.id+" for sample "+u.nextSample),this.onSamples&&this.onSamples(w.id,w.user,w.samples),w.samples=[],w!==this.extractedTracks[a]))break}}}},k.prototype.getBox=function(t){var a=this.getBoxes(t,!0);return a.length?a[0]:null},k.prototype.getBoxes=function(t,a){var u=[];return k._sweep.call(this,t,u,a),u},k._sweep=function(t,a,u){this.type&&this.type==t&&a.push(this);for(var g in this.boxes){if(a.length&&u)return;k._sweep.call(this.boxes[g],t,a,u)}},k.prototype.getTrackSamplesInfo=function(t){var a=this.getTrackById(t);if(a)return a.samples},k.prototype.getTrackSample=function(t,a){var u=this.getTrackById(t),g=this.getSample(u,a);return g},k.prototype.releaseUsedSamples=function(t,a){var u=0,g=this.getTrackById(t);g.lastValidSample||(g.lastValidSample=0);for(var v=g.lastValidSample;v<a;v++)u+=this.releaseSample(g,v);f.info("ISOFile","Track #"+t+" released samples up to "+a+" (released size: "+u+", remaining: "+this.samplesDataSize+")"),g.lastValidSample=a},k.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},k.prototype.stop=function(){this.sampleProcessingStarted=!1},k.prototype.flush=function(){f.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},k.prototype.seekTrack=function(t,a,u){var g,v,w=1/0,T=0,O=0,P;if(u.samples.length===0)return f.info("ISOFile","No sample in track, cannot seek! Using time "+f.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(g=0;g<u.samples.length;g++){if(v=u.samples[g],g===0)O=0,P=v.timescale;else if(v.cts>t*v.timescale){O=g-1;break}a&&v.is_sync&&(T=g)}for(a&&(O=T),t=u.samples[O].cts,u.nextSample=O;u.samples[O].alreadyRead===u.samples[O].size&&u.samples[O+1];)O++;return w=u.samples[O].offset+u.samples[O].alreadyRead,f.info("ISOFile","Seeking to "+(a?"RAP":"")+" sample #"+u.nextSample+" on track "+u.tkhd.track_id+", time "+f.getDurationString(t,P)+" and offset: "+w),{offset:w,time:t/P}},k.prototype.getTrackDuration=function(t){var a;return t.samples?(a=t.samples[t.samples.length-1],(a.cts+a.duration)/a.timescale):1/0},k.prototype.seek=function(t,a){var u=this.moov,g,v,w,T={offset:1/0,time:1/0};if(this.moov){for(w=0;w<u.traks.length;w++)g=u.traks[w],!(t>this.getTrackDuration(g))&&(v=this.seekTrack(t,a,g),v.offset<T.offset&&(T.offset=v.offset),v.time<T.time&&(T.time=v.time));return f.info("ISOFile","Seeking at time "+f.getDurationString(T.time,1)+" needs a buffer with a fileStart position of "+T.offset),T.offset===1/0?T={offset:this.nextParsePosition,time:0}:T.offset=this.stream.getEndFilePositionAfter(T.offset),f.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+T.offset),T}else throw"Cannot seek: moov not received!"},k.prototype.equal=function(t){for(var a=0;a<this.boxes.length&&a<t.boxes.length;){var u=this.boxes[a],g=t.boxes[a];if(!h.boxEqual(u,g))return!1;a++}return!0},c.ISOFile=k,k.prototype.lastBoxStartPosition=0,k.prototype.parsingMdat=null,k.prototype.nextParsePosition=0,k.prototype.discardMdatData=!1,k.prototype.processIncompleteBox=function(t){var a,u,g;return t.type==="mdat"?(a=new h[t.type+"Box"](t.size),this.parsingMdat=a,this.boxes.push(a),this.mdats.push(a),a.start=t.start,a.hdr_size=t.hdr_size,this.stream.addUsedBytes(a.hdr_size),this.lastBoxStartPosition=a.start+a.size,g=this.stream.seek(a.start+a.size,!1,this.discardMdatData),g?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=a.start+a.size,!1)):(t.type==="moov"&&(this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0)),u=this.stream.mergeNextBuffer?this.stream.mergeNextBuffer():!1,u?(this.nextParsePosition=this.stream.getEndPosition(),!0):(t.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+t.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},k.prototype.hasIncompleteMdat=function(){return this.parsingMdat!==null},k.prototype.processIncompleteMdat=function(){var t,a;return t=this.parsingMdat,a=this.stream.seek(t.start+t.size,!1,this.discardMdatData),a?(f.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},k.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},k.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},k.prototype.updateUsedBytes=function(t,a){this.stream.addUsedBytes&&(t.type==="mdat"?(this.stream.addUsedBytes(t.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(t.size-t.hdr_size)):this.stream.addUsedBytes(t.size))},k.prototype.add=h.Box.prototype.add,k.prototype.addBox=h.Box.prototype.addBox,k.prototype.init=function(t){var a=t||{};this.add("ftyp").set("major_brand",a.brands&&a.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",a.brands||["iso4"]);var u=this.add("moov");return u.add("mvhd").set("timescale",a.timescale||600).set("rate",a.rate||65536).set("creation_time",0).set("modification_time",0).set("duration",a.duration||0).set("volume",a.width?0:256).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("next_track_id",1),u.add("mvex"),this},k.prototype.addTrack=function(t){this.moov||this.init(t);var a=t||{};a.width=a.width||320,a.height=a.height||320,a.id=a.id||this.moov.mvhd.next_track_id,a.type=a.type||"avc1";var u=this.moov.add("trak");this.moov.mvhd.next_track_id=a.id+1,u.add("tkhd").set("flags",h.TKHD_FLAG_ENABLED|h.TKHD_FLAG_IN_MOVIE|h.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",a.id).set("duration",a.duration||0).set("layer",a.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[0,0,0,0,0,0,0,0,0]).set("width",a.width<<16).set("height",a.height<<16);var g=u.add("mdia");g.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",a.timescale||1).set("duration",a.media_duration||0).set("language",a.language||"und"),g.add("hdlr").set("handler",a.hdlr||"vide").set("name",a.name||"Track created with MP4Box.js"),g.add("elng").set("extended_language",a.language||"fr-FR");var v=g.add("minf");if(h[a.type+"SampleEntry"]!==void 0){var w=new h[a.type+"SampleEntry"];w.data_reference_index=1;var T="";for(var O in h.sampleEntryCodes)for(var P=h.sampleEntryCodes[O],D=0;D<P.length;D++)if(P.indexOf(a.type)>-1){T=O;break}switch(T){case"Visual":if(v.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),w.set("width",a.width).set("height",a.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",a.type+" Compressor").set("depth",24),a.avcDecoderConfigRecord){var z=new h.avcCBox;z.parse(new l(a.avcDecoderConfigRecord)),w.addBox(z)}else if(a.hevcDecoderConfigRecord){var j=new h.hvcCBox;j.parse(new l(a.hevcDecoderConfigRecord)),w.addBox(j)}break;case"Audio":v.add("smhd").set("balance",a.balance||0),w.set("channel_count",a.channel_count||2).set("samplesize",a.samplesize||16).set("samplerate",a.samplerate||65536);break;case"Hint":v.add("hmhd");break;case"Subtitle":switch(v.add("sthd"),a.type){case"stpp":w.set("namespace",a.namespace||"nonamespace").set("schema_location",a.schema_location||"").set("auxiliary_mime_types",a.auxiliary_mime_types||"");break}break;case"Metadata":v.add("nmhd");break;case"System":v.add("nmhd");break;default:v.add("nmhd");break}a.description&&w.addBox(a.description),a.description_boxes&&a.description_boxes.forEach(function(X){w.addBox(X)}),v.add("dinf").add("dref").addEntry(new h["url Box"]().set("flags",1));var $=v.add("stbl");return $.add("stsd").addEntry(w),$.add("stts").set("sample_counts",[]).set("sample_deltas",[]),$.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),$.add("stco").set("chunk_offsets",[]),$.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",a.id).set("default_sample_description_index",a.default_sample_description_index||1).set("default_sample_duration",a.default_sample_duration||0).set("default_sample_size",a.default_sample_size||0).set("default_sample_flags",a.default_sample_flags||0),this.buildTrakSampleLists(u),a.id}},h.Box.prototype.computeSize=function(t){var a=t||new y;a.endianness=y.BIG_ENDIAN,this.write(a)},k.prototype.addSample=function(t,a,u){var g=u||{},v={},w=this.getTrackById(t);if(w!==null){v.number=w.samples.length,v.track_id=w.tkhd.track_id,v.timescale=w.mdia.mdhd.timescale,v.description_index=g.sample_description_index?g.sample_description_index-1:0,v.description=w.mdia.minf.stbl.stsd.entries[v.description_index],v.data=a,v.size=a.byteLength,v.alreadyRead=v.size,v.duration=g.duration||1,v.cts=g.cts||0,v.dts=g.dts||0,v.is_sync=g.is_sync||!1,v.is_leading=g.is_leading||0,v.depends_on=g.depends_on||0,v.is_depended_on=g.is_depended_on||0,v.has_redundancy=g.has_redundancy||0,v.degradation_priority=g.degradation_priority||0,v.offset=0,v.subsamples=g.subsamples,w.samples.push(v),w.samples_size+=v.size,w.samples_duration+=v.duration,w.first_dts===void 0&&(w.first_dts=g.dts),this.processSamples();var T=this.createSingleSampleMoof(v);return this.addBox(T),T.computeSize(),T.trafs[0].truns[0].data_offset=T.size+8,this.add("mdat").data=new Uint8Array(a),v}},k.prototype.createSingleSampleMoof=function(t){var a=0;t.is_sync?a=1<<25:a=65536;var u=new h.moofBox;u.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var g=u.add("traf"),v=this.getTrackById(t.track_id);return g.add("tfhd").set("track_id",t.track_id).set("flags",h.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),g.add("tfdt").set("baseMediaDecodeTime",t.dts-(v.first_dts||0)),g.add("trun").set("flags",h.TRUN_FLAGS_DATA_OFFSET|h.TRUN_FLAGS_DURATION|h.TRUN_FLAGS_SIZE|h.TRUN_FLAGS_FLAGS|h.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[t.duration]).set("sample_size",[t.size]).set("sample_flags",[a]).set("sample_composition_time_offset",[t.cts-t.dts]),u},k.prototype.lastMoofIndex=0,k.prototype.samplesDataSize=0,k.prototype.resetTables=function(){var t,a,u,g,v,w,T,O;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,t=0;t<this.moov.traks.length;t++){a=this.moov.traks[t],a.tkhd.duration=0,a.mdia.mdhd.duration=0,u=a.mdia.minf.stbl.stco||a.mdia.minf.stbl.co64,u.chunk_offsets=[],g=a.mdia.minf.stbl.stsc,g.first_chunk=[],g.samples_per_chunk=[],g.sample_description_index=[],v=a.mdia.minf.stbl.stsz||a.mdia.minf.stbl.stz2,v.sample_sizes=[],w=a.mdia.minf.stbl.stts,w.sample_counts=[],w.sample_deltas=[],T=a.mdia.minf.stbl.ctts,T&&(T.sample_counts=[],T.sample_offsets=[]),O=a.mdia.minf.stbl.stss;var P=a.mdia.minf.stbl.boxes.indexOf(O);P!=-1&&(a.mdia.minf.stbl.boxes[P]=null)}},k.initSampleGroups=function(t,a,u,g,v){var w,T,O,P;function D(z,j,$){this.grouping_type=z,this.grouping_type_parameter=j,this.sbgp=$,this.last_sample_in_run=-1,this.entry_index=-1}for(a&&(a.sample_groups_info=[]),t.sample_groups_info||(t.sample_groups_info=[]),T=0;T<u.length;T++){for(P=u[T].grouping_type+"/"+u[T].grouping_type_parameter,O=new D(u[T].grouping_type,u[T].grouping_type_parameter,u[T]),a&&(a.sample_groups_info[P]=O),t.sample_groups_info[P]||(t.sample_groups_info[P]=O),w=0;w<g.length;w++)g[w].grouping_type===u[T].grouping_type&&(O.description=g[w],O.description.used=!0);if(v)for(w=0;w<v.length;w++)v[w].grouping_type===u[T].grouping_type&&(O.fragment_description=v[w],O.fragment_description.used=!0,O.is_fragment=!0)}if(a){if(v)for(T=0;T<v.length;T++)!v[T].used&&v[T].version>=2&&(P=v[T].grouping_type+"/0",O=new D(v[T].grouping_type,0),O.is_fragment=!0,a.sample_groups_info[P]||(a.sample_groups_info[P]=O))}else for(T=0;T<g.length;T++)!g[T].used&&g[T].version>=2&&(P=g[T].grouping_type+"/0",O=new D(g[T].grouping_type,0),t.sample_groups_info[P]||(t.sample_groups_info[P]=O))},k.setSampleGroupProperties=function(t,a,u,g){var v,w;a.sample_groups=[];for(v in g)if(a.sample_groups[v]={},a.sample_groups[v].grouping_type=g[v].grouping_type,a.sample_groups[v].grouping_type_parameter=g[v].grouping_type_parameter,u>=g[v].last_sample_in_run&&(g[v].last_sample_in_run<0&&(g[v].last_sample_in_run=0),g[v].entry_index++,g[v].entry_index<=g[v].sbgp.entries.length-1&&(g[v].last_sample_in_run+=g[v].sbgp.entries[g[v].entry_index].sample_count)),g[v].entry_index<=g[v].sbgp.entries.length-1?a.sample_groups[v].group_description_index=g[v].sbgp.entries[g[v].entry_index].group_description_index:a.sample_groups[v].group_description_index=-1,a.sample_groups[v].group_description_index!==0){var T;g[v].fragment_description?T=g[v].fragment_description:T=g[v].description,a.sample_groups[v].group_description_index>0?(a.sample_groups[v].group_description_index>65535?w=(a.sample_groups[v].group_description_index>>16)-1:w=a.sample_groups[v].group_description_index-1,T&&w>=0&&(a.sample_groups[v].description=T.entries[w])):T&&T.version>=2&&T.default_group_description_index>0&&(a.sample_groups[v].description=T.entries[T.default_group_description_index-1])}},k.process_sdtp=function(t,a,u){a&&(t?(a.is_leading=t.is_leading[u],a.depends_on=t.sample_depends_on[u],a.is_depended_on=t.sample_is_depended_on[u],a.has_redundancy=t.sample_has_redundancy[u]):(a.is_leading=0,a.depends_on=0,a.is_depended_on=0,a.has_redundancy=0))},k.prototype.buildSampleLists=function(){var t,a;for(t=0;t<this.moov.traks.length;t++)a=this.moov.traks[t],this.buildTrakSampleLists(a)},k.prototype.buildTrakSampleLists=function(t){var a,u,g,v,w,T,O,P,D,z,j,$,X,oe,W,Y,Z,ee,V,Q,J,ve,le,fe;if(t.samples=[],t.samples_duration=0,t.samples_size=0,u=t.mdia.minf.stbl.stco||t.mdia.minf.stbl.co64,g=t.mdia.minf.stbl.stsc,v=t.mdia.minf.stbl.stsz||t.mdia.minf.stbl.stz2,w=t.mdia.minf.stbl.stts,T=t.mdia.minf.stbl.ctts,O=t.mdia.minf.stbl.stss,P=t.mdia.minf.stbl.stsd,D=t.mdia.minf.stbl.subs,$=t.mdia.minf.stbl.stdp,z=t.mdia.minf.stbl.sbgps,j=t.mdia.minf.stbl.sgpds,ee=-1,V=-1,Q=-1,J=-1,ve=0,le=0,fe=0,k.initSampleGroups(t,null,z,j),!(typeof v>"u")){for(a=0;a<v.sample_sizes.length;a++){var re={};re.number=a,re.track_id=t.tkhd.track_id,re.timescale=t.mdia.mdhd.timescale,re.alreadyRead=0,t.samples[a]=re,re.size=v.sample_sizes[a],t.samples_size+=re.size,a===0?(oe=1,X=0,re.chunk_index=oe,re.chunk_run_index=X,Z=g.samples_per_chunk[X],Y=0,X+1<g.first_chunk.length?W=g.first_chunk[X+1]-1:W=1/0):a<Z?(re.chunk_index=oe,re.chunk_run_index=X):(oe++,re.chunk_index=oe,Y=0,oe<=W||(X++,X+1<g.first_chunk.length?W=g.first_chunk[X+1]-1:W=1/0),re.chunk_run_index=X,Z+=g.samples_per_chunk[X]),re.description_index=g.sample_description_index[re.chunk_run_index]-1,re.description=P.entries[re.description_index],re.offset=u.chunk_offsets[re.chunk_index-1]+Y,Y+=re.size,a>ee&&(V++,ee<0&&(ee=0),ee+=w.sample_counts[V]),a>0?(t.samples[a-1].duration=w.sample_deltas[V],t.samples_duration+=t.samples[a-1].duration,re.dts=t.samples[a-1].dts+t.samples[a-1].duration):re.dts=0,T?(a>=Q&&(J++,Q<0&&(Q=0),Q+=T.sample_counts[J]),re.cts=t.samples[a].dts+T.sample_offsets[J]):re.cts=re.dts,O?(a==O.sample_numbers[ve]-1?(re.is_sync=!0,ve++):(re.is_sync=!1,re.degradation_priority=0),D&&D.entries[le].sample_delta+fe==a+1&&(re.subsamples=D.entries[le].subsamples,fe+=D.entries[le].sample_delta,le++)):re.is_sync=!0,k.process_sdtp(t.mdia.minf.stbl.sdtp,re,re.number),$?re.degradation_priority=$.priority[a]:re.degradation_priority=0,D&&D.entries[le].sample_delta+fe==a&&(re.subsamples=D.entries[le].subsamples,fe+=D.entries[le].sample_delta),(z.length>0||j.length>0)&&k.setSampleGroupProperties(t,re,a,t.sample_groups_info)}a>0&&(t.samples[a-1].duration=Math.max(t.mdia.mdhd.duration-t.samples[a-1].dts,0),t.samples_duration+=t.samples[a-1].duration)}},k.prototype.updateSampleLists=function(){var t,a,u,g,v,w,T,O,P,D,z,j,$,X,oe;if(this.moov!==void 0){for(;this.lastMoofIndex<this.moofs.length;)if(P=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,P.type=="moof")for(D=P,t=0;t<D.trafs.length;t++){for(z=D.trafs[t],j=this.getTrackById(z.tfhd.track_id),$=this.getTrexById(z.tfhd.track_id),z.tfhd.flags&h.TFHD_FLAG_SAMPLE_DESC?g=z.tfhd.default_sample_description_index:g=$?$.default_sample_description_index:1,z.tfhd.flags&h.TFHD_FLAG_SAMPLE_DUR?v=z.tfhd.default_sample_duration:v=$?$.default_sample_duration:0,z.tfhd.flags&h.TFHD_FLAG_SAMPLE_SIZE?w=z.tfhd.default_sample_size:w=$?$.default_sample_size:0,z.tfhd.flags&h.TFHD_FLAG_SAMPLE_FLAGS?T=z.tfhd.default_sample_flags:T=$?$.default_sample_flags:0,z.sample_number=0,z.sbgps.length>0&&k.initSampleGroups(j,z,z.sbgps,j.mdia.minf.stbl.sgpds,z.sgpds),a=0;a<z.truns.length;a++){var W=z.truns[a];for(u=0;u<W.sample_count;u++){X={},X.moof_number=this.lastMoofIndex,X.number_in_traf=z.sample_number,z.sample_number++,X.number=j.samples.length,z.first_sample_index=j.samples.length,j.samples.push(X),X.track_id=j.tkhd.track_id,X.timescale=j.mdia.mdhd.timescale,X.description_index=g-1,X.description=j.mdia.minf.stbl.stsd.entries[X.description_index],X.size=w,W.flags&h.TRUN_FLAGS_SIZE&&(X.size=W.sample_size[u]),j.samples_size+=X.size,X.duration=v,W.flags&h.TRUN_FLAGS_DURATION&&(X.duration=W.sample_duration[u]),j.samples_duration+=X.duration,j.first_traf_merged||u>0?X.dts=j.samples[j.samples.length-2].dts+j.samples[j.samples.length-2].duration:(z.tfdt?X.dts=z.tfdt.baseMediaDecodeTime:X.dts=0,j.first_traf_merged=!0),X.cts=X.dts,W.flags&h.TRUN_FLAGS_CTS_OFFSET&&(X.cts=X.dts+W.sample_composition_time_offset[u]),oe=T,W.flags&h.TRUN_FLAGS_FLAGS?oe=W.sample_flags[u]:u===0&&W.flags&h.TRUN_FLAGS_FIRST_FLAG&&(oe=W.first_sample_flags),X.is_sync=!(oe>>16&1),X.is_leading=oe>>26&3,X.depends_on=oe>>24&3,X.is_depended_on=oe>>22&3,X.has_redundancy=oe>>20&3,X.degradation_priority=oe&65535;var Y=!!(z.tfhd.flags&h.TFHD_FLAG_BASE_DATA_OFFSET),Z=!!(z.tfhd.flags&h.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),ee=!!(W.flags&h.TRUN_FLAGS_DATA_OFFSET),V=0;Y?V=z.tfhd.base_data_offset:Z||a===0?V=D.start:V=O,a===0&&u===0?ee?X.offset=V+W.data_offset:X.offset=V:X.offset=O,O=X.offset+X.size,(z.sbgps.length>0||z.sgpds.length>0||j.mdia.minf.stbl.sbgps.length>0||j.mdia.minf.stbl.sgpds.length>0)&&k.setSampleGroupProperties(j,X,X.number_in_traf,z.sample_groups_info)}}if(z.subs){j.has_fragment_subsamples=!0;var Q=z.first_sample_index;for(a=0;a<z.subs.entries.length;a++)Q+=z.subs.entries[a].sample_delta,X=j.samples[Q-1],X.subsamples=z.subs.entries[a].subsamples}}}},k.prototype.getSample=function(t,a){var u,g=t.samples[a];if(!this.moov)return null;if(!g.data)g.data=new Uint8Array(g.size),g.alreadyRead=0,this.samplesDataSize+=g.size,f.debug("ISOFile","Allocating sample #"+a+" on track #"+t.tkhd.track_id+" of size "+g.size+" (total: "+this.samplesDataSize+")");else if(g.alreadyRead==g.size)return g;for(;;){var v=this.stream.findPosition(!0,g.offset+g.alreadyRead,!1);if(v>-1){u=this.stream.buffers[v];var w=u.byteLength-(g.offset+g.alreadyRead-u.fileStart);if(g.size-g.alreadyRead<=w)return f.debug("ISOFile","Getting sample #"+a+" data (alreadyRead: "+g.alreadyRead+" offset: "+(g.offset+g.alreadyRead-u.fileStart)+" read size: "+(g.size-g.alreadyRead)+" full size: "+g.size+")"),y.memcpy(g.data.buffer,g.alreadyRead,u,g.offset+g.alreadyRead-u.fileStart,g.size-g.alreadyRead),u.usedBytes+=g.size-g.alreadyRead,this.stream.logBufferLevel(),g.alreadyRead=g.size,g;if(w===0)return null;f.debug("ISOFile","Getting sample #"+a+" partial data (alreadyRead: "+g.alreadyRead+" offset: "+(g.offset+g.alreadyRead-u.fileStart)+" read size: "+w+" full size: "+g.size+")"),y.memcpy(g.data.buffer,g.alreadyRead,u,g.offset+g.alreadyRead-u.fileStart,w),g.alreadyRead+=w,u.usedBytes+=w,this.stream.logBufferLevel()}else return null}},k.prototype.releaseSample=function(t,a){var u=t.samples[a];return u.data?(this.samplesDataSize-=u.size,u.data=null,u.alreadyRead=0,u.size):0},k.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},k.prototype.getCodecs=function(){var t,a="";for(t=0;t<this.moov.traks.length;t++){var u=this.moov.traks[t];t>0&&(a+=","),a+=u.mdia.minf.stbl.stsd.entries[0].getCodec()}return a},k.prototype.getTrexById=function(t){var a;if(!this.moov||!this.moov.mvex)return null;for(a=0;a<this.moov.mvex.trexs.length;a++){var u=this.moov.mvex.trexs[a];if(u.track_id==t)return u}return null},k.prototype.getTrackById=function(t){if(this.moov===void 0)return null;for(var a=0;a<this.moov.traks.length;a++){var u=this.moov.traks[a];if(u.tkhd.track_id==t)return u}return null},k.prototype.itemsDataSize=0,k.prototype.flattenItemInfo=function(){var t=this.items,a=this.entity_groups,u,g,v,w=this.meta;if(w!=null&&w.hdlr!==void 0&&w.iinf!==void 0){for(u=0;u<w.iinf.item_infos.length;u++)v={},v.id=w.iinf.item_infos[u].item_ID,t[v.id]=v,v.ref_to=[],v.name=w.iinf.item_infos[u].item_name,w.iinf.item_infos[u].protection_index>0&&(v.protection=w.ipro.protections[w.iinf.item_infos[u].protection_index-1]),w.iinf.item_infos[u].item_type?v.type=w.iinf.item_infos[u].item_type:v.type="mime",v.content_type=w.iinf.item_infos[u].content_type,v.content_encoding=w.iinf.item_infos[u].content_encoding;if(w.grpl)for(u=0;u<w.grpl.boxes.length;u++)entity_group={},entity_group.id=w.grpl.boxes[u].group_id,entity_group.entity_ids=w.grpl.boxes[u].entity_ids,entity_group.type=w.grpl.boxes[u].type,a[entity_group.id]=entity_group;if(w.iloc)for(u=0;u<w.iloc.items.length;u++){var T=w.iloc.items[u];switch(v=t[T.item_ID],T.data_reference_index!==0&&(f.warn("Item storage with reference to other files: not supported"),v.source=w.dinf.boxes[T.data_reference_index-1]),T.construction_method){case 0:break;case 1:break;case 2:f.warn("Item storage with construction_method : not supported");break}for(v.extents=[],v.size=0,g=0;g<T.extents.length;g++)v.extents[g]={},v.extents[g].offset=T.extents[g].extent_offset+T.base_offset,T.construction_method==1&&(v.extents[g].offset+=w.idat.start+w.idat.hdr_size),v.extents[g].length=T.extents[g].extent_length,v.extents[g].alreadyRead=0,v.size+=v.extents[g].length}if(w.pitm&&(t[w.pitm.item_id].primary=!0),w.iref)for(u=0;u<w.iref.references.length;u++){var O=w.iref.references[u];for(g=0;g<O.references.length;g++)t[O.from_item_ID].ref_to.push({type:O.type,id:O.references[g]})}if(w.iprp)for(var P=0;P<w.iprp.ipmas.length;P++){var D=w.iprp.ipmas[P];for(u=0;u<D.associations.length;u++){var z=D.associations[u];if(v=t[z.id],v||(v=a[z.id]),v)for(v.properties===void 0&&(v.properties={},v.properties.boxes=[]),g=0;g<z.props.length;g++){var j=z.props[g];if(j.property_index>0&&j.property_index-1<w.iprp.ipco.boxes.length){var $=w.iprp.ipco.boxes[j.property_index-1];v.properties[$.type]=$,v.properties.boxes.push($)}}}}}},k.prototype.getItem=function(t){var a,u;if(!this.meta)return null;if(u=this.items[t],!u.data&&u.size)u.data=new Uint8Array(u.size),u.alreadyRead=0,this.itemsDataSize+=u.size,f.debug("ISOFile","Allocating item #"+t+" of size "+u.size+" (total: "+this.itemsDataSize+")");else if(u.alreadyRead===u.size)return u;for(var g=0;g<u.extents.length;g++){var v=u.extents[g];if(v.alreadyRead!==v.length){var w=this.stream.findPosition(!0,v.offset+v.alreadyRead,!1);if(w>-1){a=this.stream.buffers[w];var T=a.byteLength-(v.offset+v.alreadyRead-a.fileStart);if(v.length-v.alreadyRead<=T)f.debug("ISOFile","Getting item #"+t+" extent #"+g+" data (alreadyRead: "+v.alreadyRead+" offset: "+(v.offset+v.alreadyRead-a.fileStart)+" read size: "+(v.length-v.alreadyRead)+" full extent size: "+v.length+" full item size: "+u.size+")"),y.memcpy(u.data.buffer,u.alreadyRead,a,v.offset+v.alreadyRead-a.fileStart,v.length-v.alreadyRead),a.usedBytes+=v.length-v.alreadyRead,this.stream.logBufferLevel(),u.alreadyRead+=v.length-v.alreadyRead,v.alreadyRead=v.length;else return f.debug("ISOFile","Getting item #"+t+" extent #"+g+" partial data (alreadyRead: "+v.alreadyRead+" offset: "+(v.offset+v.alreadyRead-a.fileStart)+" read size: "+T+" full extent size: "+v.length+" full item size: "+u.size+")"),y.memcpy(u.data.buffer,u.alreadyRead,a,v.offset+v.alreadyRead-a.fileStart,T),v.alreadyRead+=T,u.alreadyRead+=T,a.usedBytes+=T,this.stream.logBufferLevel(),null}else return null}}return u.alreadyRead===u.size?u:null},k.prototype.releaseItem=function(t){var a=this.items[t];if(a.data){this.itemsDataSize-=a.size,a.data=null,a.alreadyRead=0;for(var u=0;u<a.extents.length;u++){var g=a.extents[u];g.alreadyRead=0}return a.size}else return 0},k.prototype.processItems=function(t){for(var a in this.items){var u=this.items[a];this.getItem(u.id),t&&!u.sent&&(t(u),u.sent=!0,u.data=null)}},k.prototype.hasItem=function(t){for(var a in this.items){var u=this.items[a];if(u.name===t)return u.id}return-1},k.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},k.prototype.getPrimaryItem=function(){return!this.meta||!this.meta.pitm?null:this.getItem(this.meta.pitm.item_id)},k.prototype.itemToFragmentedTrackFile=function(t){var a=t||{},u=null;if(a.itemId?u=this.getItem(a.itemId):u=this.getPrimaryItem(),u==null)return null;var g=new k;g.discardMdatData=!1;var v={type:u.type,description_boxes:u.properties.boxes};u.properties.ispe&&(v.width=u.properties.ispe.image_width,v.height=u.properties.ispe.image_height);var w=g.addTrack(v);return w?(g.addSample(w,u.data),g):null},k.prototype.write=function(t){for(var a=0;a<this.boxes.length;a++)this.boxes[a].write(t)},k.prototype.createFragment=function(t,a,u){var g=this.getTrackById(t),v=this.getSample(g,a);if(v==null)return this.setNextSeekPositionFromSample(g.samples[a]),null;var w=u||new y;w.endianness=y.BIG_ENDIAN;var T=this.createSingleSampleMoof(v);T.write(w),T.trafs[0].truns[0].data_offset=T.size+8,f.debug("MP4Box","Adjusting data_offset with new value "+T.trafs[0].truns[0].data_offset),w.adjustUint32(T.trafs[0].truns[0].data_offset_position,T.trafs[0].truns[0].data_offset);var O=new h.mdatBox;return O.data=v.data,O.write(w),w},k.writeInitializationSegment=function(t,a,u,g){var v;f.debug("ISOFile","Generating initialization segment");var w=new y;w.endianness=y.BIG_ENDIAN,t.write(w);var T=a.add("mvex");for(u&&T.add("mehd").set("fragment_duration",u),v=0;v<a.traks.length;v++)T.add("trex").set("track_id",a.traks[v].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",g).set("default_sample_size",0).set("default_sample_flags",65536);return a.write(w),w.buffer},k.prototype.save=function(t){var a=new y;a.endianness=y.BIG_ENDIAN,this.write(a),a.save(t)},k.prototype.getBuffer=function(){var t=new y;return t.endianness=y.BIG_ENDIAN,this.write(t),t.buffer},k.prototype.initializeSegmentation=function(){var t,a,u,g;for(this.onSegment===null&&f.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),a=[],t=0;t<this.fragmentedTracks.length;t++){var v=new h.moovBox;v.mvhd=this.moov.mvhd,v.boxes.push(v.mvhd),u=this.getTrackById(this.fragmentedTracks[t].id),v.boxes.push(u),v.traks.push(u),g={},g.id=u.tkhd.track_id,g.user=this.fragmentedTracks[t].user,g.buffer=k.writeInitializationSegment(this.ftyp,v,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,this.moov.traks[t].samples.length>0?this.moov.traks[t].samples[0].duration:0),a.push(g)}return a},h.Box.prototype.printHeader=function(t){this.size+=8,this.size>p&&(this.size+=8),this.type==="uuid"&&(this.size+=16),t.log(t.indent+"size:"+this.size),t.log(t.indent+"type:"+this.type)},h.FullBox.prototype.printHeader=function(t){this.size+=4,h.Box.prototype.printHeader.call(this,t),t.log(t.indent+"version:"+this.version),t.log(t.indent+"flags:"+this.flags)},h.Box.prototype.print=function(t){this.printHeader(t)},h.ContainerBox.prototype.print=function(t){this.printHeader(t);for(var a=0;a<this.boxes.length;a++)if(this.boxes[a]){var u=t.indent;t.indent+=" ",this.boxes[a].print(t),t.indent=u}},k.prototype.print=function(t){t.indent="";for(var a=0;a<this.boxes.length;a++)this.boxes[a]&&this.boxes[a].print(t)},h.mvhdBox.prototype.print=function(t){h.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"timescale: "+this.timescale),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"rate: "+this.rate),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"next_track_id: "+this.next_track_id)},h.tkhdBox.prototype.print=function(t){h.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"track_id: "+this.track_id),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"layer: "+this.layer),t.log(t.indent+"alternate_group: "+this.alternate_group),t.log(t.indent+"width: "+this.width),t.log(t.indent+"height: "+this.height)};var A={};A.createFile=function(t,a){var u=t!==void 0?t:!0,g=new k(a);return g.discardMdatData=!u,g},c.createFile=A.createFile})(xn);const Rd={videos:{type:Array,required:!0}},Od={class:"mb-video-mp4-loader"},Ud={name:"MbVideoMp4Loader"},Pd=Te({...Ud,props:Rd,setup(c){const{getMap:f}=ki(oi),l=c;let y;const p=()=>{const E=N();b(E)},b=E=>{l.videos&&l.videos.forEach(async S=>{const _=await(await fetch(S.url,S.requestInit)).arrayBuffer();_.fileStart=0,y=xn.createFile();let L=null,k=null;const A=[];let t=0,a=0;y.onReady=u=>{L=u.videoTracks[0],t=L.nb_samples,L!=null&&y.setExtractionOptions(L.id,"video",{nbSamples:t});const g=L.track_width,v=L.track_height;k=new VideoDecoder({output:w=>{var T,O;createImageBitmap(w,0,0,g,v,{resizeWidth:((T=S.size)==null?void 0:T[0])||g,resizeHeight:((O=S.size)==null?void 0:O[1])||v,resizeQuality:"high"}).then(P=>{A.push({img:P,duration:w.duration,timestamp:w.timestamp}),A.length===t&&h(E,S.name,A,0),w.close()})},error:w=>{console.error("videoDecoder Error",w)}}),k.configure({codec:L.codec,codedWidth:g,codedHeight:v,description:I()}),y.start()},y.onSamples=(u,g,v)=>{if((L==null?void 0:L.id)===u){y.stop(),a+=v.length;for(const w of v){const T=w.is_sync?"key":"delta",O=new EncodedVideoChunk({type:T,timestamp:w.cts,duration:w.duration,data:w.data});k.decode(O)}a===t&&k.flush()}},y.appendBuffer(_),y.flush()})},I=()=>{const E=y.moov.traks[0].mdia.minf.stbl.stsd.entries[0],S=E.avcC||E.hvcC||E.vpcC;if(S!=null){const _=new xn.DataStream(void 0,0,xn.DataStream.BIG_ENDIAN);return S.write(_),new Uint8Array(_.buffer.slice(8))}},h=(E,S,_,L)=>{E.hasImage(S)?E.updateImage(S,_[L].img):E.addImage(S,_[L].img),E.triggerRepaint();const k=++L;window.setTimeout(()=>{h(E,S,_,k>=_.length?0:k)},_[L>=_.length?0:L].duration/100)},{getMapboxInstance:N}=He(p);return ue(()=>l.videos,async()=>{const E=await f;b(E.mapboxInstance)},{deep:!0}),(E,S)=>(Se(),je("i",Od))}}),Md=Ae(Pd),Bd={url:{type:String,required:!0},layers:{type:String,required:!0},tileSize:{type:Number,default:256},width:{type:Number,default:256},height:{type:Number,default:256},format:{type:String,default:"image/png"},subdomains:[String,Array],maxzoom:{type:Number,default:22},minzoom:{type:Number,default:0},show:{type:Boolean,default:!0},beforeId:{type:String},version:{type:String,default:"1.1.1"},transparent:{type:Boolean,default:!0},id:{type:String,default:()=>De()},srs:{type:String,default:"EPSG:3857"},layerStyle:{type:String,default:""},extraParams:{type:String,default:""}},Dd={created:()=>!0},Fd={name:"MbWmsLayer"},zd=Te({...Fd,props:Bd,emits:Dd,setup(c,{emit:f}){const l=c,y=f,p=De(),b=Be(()=>({visibility:l.show?"visible":"none"})),I=Be(()=>{const{url:N,format:E,subdomains:S,version:_,layers:L,transparent:k,srs:A,layerStyle:t,tileSize:a,width:u,height:g,extraParams:v}=l,w=N.includes("?")?`${N}&`:`${N}?`,T={type:"raster",scheme:"xyz",tiles:[],tileSize:a,minzoom:l.minzoom,maxzoom:l.maxzoom};if(S){let O=[];Array.isArray(S)?O=S.slice().map(String):S.length>0&&(O=S.split("")),O.forEach(P=>{const D=w.replace(/{(.*?)}/g,(z,j)=>j==="s"?P:z);T.tiles.push(`${D}bbox={bbox-epsg-3857}&&service=WMS&version=${_}&format=${E}&request=GetMap&srs=${A}&transparent=${k}&width=${u}&height=${g}&layers=${L}&style=${t}${v?`&${v}`:""}`)})}else T.tiles[0]=`${w}bbox={bbox-epsg-3857}&&service=WMS&version=${_}&format=${E}&request=GetMap&srs=${A}&transparent=${k}&width=${u}&height=${g}&layers=${L}&style=${t}${v?`&${v}`:""}`;return T}),h=()=>{y("created")};return(N,E)=>(Se(),Me(ce(ut),{id:N.id,"source-id":ce(p),type:"raster",layout:b.value,"before-id":N.beforeId,class:"mb-wms-layer",onCreated:h},{default:Bt(()=>[Ci(ce(lt),{id:ce(p),"tile-json-source":I.value},null,8,["id","tile-json-source"])]),_:1},8,["id","source-id","layout","before-id"]))}}),Gd=Ae(zd),qd="1.0.0";var Gr={exports:{}},po=function(f,l){return function(){for(var p=new Array(arguments.length),b=0;b<p.length;b++)p[b]=arguments[b];return f.apply(l,p)}},Yd=po,li=Object.prototype.toString;function qr(c){return li.call(c)==="[object Array]"}function Ar(c){return typeof c>"u"}function $d(c){return c!==null&&!Ar(c)&&c.constructor!==null&&!Ar(c.constructor)&&typeof c.constructor.isBuffer=="function"&&c.constructor.isBuffer(c)}function Hd(c){return li.call(c)==="[object ArrayBuffer]"}function Vd(c){return typeof FormData<"u"&&c instanceof FormData}function jd(c){var f;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?f=ArrayBuffer.isView(c):f=c&&c.buffer&&c.buffer instanceof ArrayBuffer,f}function Xd(c){return typeof c=="string"}function Zd(c){return typeof c=="number"}function yo(c){return c!==null&&typeof c=="object"}function En(c){if(li.call(c)!=="[object Object]")return!1;var f=Object.getPrototypeOf(c);return f===null||f===Object.prototype}function Wd(c){return li.call(c)==="[object Date]"}function Kd(c){return li.call(c)==="[object File]"}function Jd(c){return li.call(c)==="[object Blob]"}function mo(c){return li.call(c)==="[object Function]"}function Qd(c){return yo(c)&&mo(c.pipe)}function eg(c){return typeof URLSearchParams<"u"&&c instanceof URLSearchParams}function tg(c){return c.trim?c.trim():c.replace(/^\s+|\s+$/g,"")}function ig(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function Yr(c,f){if(!(c===null||typeof c>"u"))if(typeof c!="object"&&(c=[c]),qr(c))for(var l=0,y=c.length;l<y;l++)f.call(null,c[l],l,c);else for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&f.call(null,c[p],p,c)}function Rr(){var c={};function f(p,b){En(c[b])&&En(p)?c[b]=Rr(c[b],p):En(p)?c[b]=Rr({},p):qr(p)?c[b]=p.slice():c[b]=p}for(var l=0,y=arguments.length;l<y;l++)Yr(arguments[l],f);return c}function ng(c,f,l){return Yr(f,function(p,b){l&&typeof p=="function"?c[b]=Yd(p,l):c[b]=p}),c}function rg(c){return c.charCodeAt(0)===65279&&(c=c.slice(1)),c}var vt={isArray:qr,isArrayBuffer:Hd,isBuffer:$d,isFormData:Vd,isArrayBufferView:jd,isString:Xd,isNumber:Zd,isObject:yo,isPlainObject:En,isUndefined:Ar,isDate:Wd,isFile:Kd,isBlob:Jd,isFunction:mo,isStream:Qd,isURLSearchParams:eg,isStandardBrowserEnv:ig,forEach:Yr,merge:Rr,extend:ng,trim:tg,stripBOM:rg},_i=vt;function da(c){return encodeURIComponent(c).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var vo=function(f,l,y){if(!l)return f;var p;if(y)p=y(l);else if(_i.isURLSearchParams(l))p=l.toString();else{var b=[];_i.forEach(l,function(N,E){N===null||typeof N>"u"||(_i.isArray(N)?E=E+"[]":N=[N],_i.forEach(N,function(_){_i.isDate(_)?_=_.toISOString():_i.isObject(_)&&(_=JSON.stringify(_)),b.push(da(E)+"="+da(_))}))}),p=b.join("&")}if(p){var I=f.indexOf("#");I!==-1&&(f=f.slice(0,I)),f+=(f.indexOf("?")===-1?"?":"&")+p}return f},sg=vt;function Tn(){this.handlers=[]}Tn.prototype.use=function(f,l,y){return this.handlers.push({fulfilled:f,rejected:l,synchronous:y?y.synchronous:!1,runWhen:y?y.runWhen:null}),this.handlers.length-1};Tn.prototype.eject=function(f){this.handlers[f]&&(this.handlers[f]=null)};Tn.prototype.forEach=function(f){sg.forEach(this.handlers,function(y){y!==null&&f(y)})};var ag=Tn,og=vt,ug=function(f,l){og.forEach(f,function(p,b){b!==l&&b.toUpperCase()===l.toUpperCase()&&(f[l]=p,delete f[b])})},_o=function(f,l,y,p,b){return f.config=l,y&&(f.code=y),f.request=p,f.response=b,f.isAxiosError=!0,f.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},f},rr,ga;function xo(){if(ga)return rr;ga=1;var c=_o;return rr=function(l,y,p,b,I){var h=new Error(l);return c(h,y,p,b,I)},rr}var sr,pa;function lg(){if(pa)return sr;pa=1;var c=xo();return sr=function(l,y,p){var b=p.config.validateStatus;!p.status||!b||b(p.status)?l(p):y(c("Request failed with status code "+p.status,p.config,null,p.request,p))},sr}var ar,ya;function hg(){if(ya)return ar;ya=1;var c=vt;return ar=c.isStandardBrowserEnv()?function(){return{write:function(y,p,b,I,h,N){var E=[];E.push(y+"="+encodeURIComponent(p)),c.isNumber(b)&&E.push("expires="+new Date(b).toGMTString()),c.isString(I)&&E.push("path="+I),c.isString(h)&&E.push("domain="+h),N===!0&&E.push("secure"),document.cookie=E.join("; ")},read:function(y){var p=document.cookie.match(new RegExp("(^|;\\s*)("+y+")=([^;]*)"));return p?decodeURIComponent(p[3]):null},remove:function(y){this.write(y,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),ar}var or,ma;function cg(){return ma||(ma=1,or=function(f){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(f)}),or}var ur,va;function fg(){return va||(va=1,ur=function(f,l){return l?f.replace(/\/+$/,"")+"/"+l.replace(/^\/+/,""):f}),ur}var lr,_a;function dg(){if(_a)return lr;_a=1;var c=cg(),f=fg();return lr=function(y,p){return y&&!c(p)?f(y,p):p},lr}var hr,xa;function gg(){if(xa)return hr;xa=1;var c=vt,f=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return hr=function(y){var p={},b,I,h;return y&&c.forEach(y.split(`
`),function(E){if(h=E.indexOf(":"),b=c.trim(E.substr(0,h)).toLowerCase(),I=c.trim(E.substr(h+1)),b){if(p[b]&&f.indexOf(b)>=0)return;b==="set-cookie"?p[b]=(p[b]?p[b]:[]).concat([I]):p[b]=p[b]?p[b]+", "+I:I}}),p},hr}var cr,Ea;function pg(){if(Ea)return cr;Ea=1;var c=vt;return cr=c.isStandardBrowserEnv()?function(){var l=/(msie|trident)/i.test(navigator.userAgent),y=document.createElement("a"),p;function b(I){var h=I;return l&&(y.setAttribute("href",h),h=y.href),y.setAttribute("href",h),{href:y.href,protocol:y.protocol?y.protocol.replace(/:$/,""):"",host:y.host,search:y.search?y.search.replace(/^\?/,""):"",hash:y.hash?y.hash.replace(/^#/,""):"",hostname:y.hostname,port:y.port,pathname:y.pathname.charAt(0)==="/"?y.pathname:"/"+y.pathname}}return p=b(window.location.href),function(h){var N=c.isString(h)?b(h):h;return N.protocol===p.protocol&&N.host===p.host}}():function(){return function(){return!0}}(),cr}var fr,ba;function An(){if(ba)return fr;ba=1;function c(f){this.message=f}return c.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},c.prototype.__CANCEL__=!0,fr=c,fr}var dr,Sa;function Ia(){if(Sa)return dr;Sa=1;var c=vt,f=lg(),l=hg(),y=vo,p=dg(),b=gg(),I=pg(),h=xo(),N=Rn(),E=An();return dr=function(_){return new Promise(function(k,A){var t=_.data,a=_.headers,u=_.responseType,g;function v(){_.cancelToken&&_.cancelToken.unsubscribe(g),_.signal&&_.signal.removeEventListener("abort",g)}c.isFormData(t)&&delete a["Content-Type"];var w=new XMLHttpRequest;if(_.auth){var T=_.auth.username||"",O=_.auth.password?unescape(encodeURIComponent(_.auth.password)):"";a.Authorization="Basic "+btoa(T+":"+O)}var P=p(_.baseURL,_.url);w.open(_.method.toUpperCase(),y(P,_.params,_.paramsSerializer),!0),w.timeout=_.timeout;function D(){if(w){var j="getAllResponseHeaders"in w?b(w.getAllResponseHeaders()):null,$=!u||u==="text"||u==="json"?w.responseText:w.response,X={data:$,status:w.status,statusText:w.statusText,headers:j,config:_,request:w};f(function(W){k(W),v()},function(W){A(W),v()},X),w=null}}if("onloadend"in w?w.onloadend=D:w.onreadystatechange=function(){!w||w.readyState!==4||w.status===0&&!(w.responseURL&&w.responseURL.indexOf("file:")===0)||setTimeout(D)},w.onabort=function(){w&&(A(h("Request aborted",_,"ECONNABORTED",w)),w=null)},w.onerror=function(){A(h("Network Error",_,null,w)),w=null},w.ontimeout=function(){var $=_.timeout?"timeout of "+_.timeout+"ms exceeded":"timeout exceeded",X=_.transitional||N.transitional;_.timeoutErrorMessage&&($=_.timeoutErrorMessage),A(h($,_,X.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",w)),w=null},c.isStandardBrowserEnv()){var z=(_.withCredentials||I(P))&&_.xsrfCookieName?l.read(_.xsrfCookieName):void 0;z&&(a[_.xsrfHeaderName]=z)}"setRequestHeader"in w&&c.forEach(a,function($,X){typeof t>"u"&&X.toLowerCase()==="content-type"?delete a[X]:w.setRequestHeader(X,$)}),c.isUndefined(_.withCredentials)||(w.withCredentials=!!_.withCredentials),u&&u!=="json"&&(w.responseType=_.responseType),typeof _.onDownloadProgress=="function"&&w.addEventListener("progress",_.onDownloadProgress),typeof _.onUploadProgress=="function"&&w.upload&&w.upload.addEventListener("progress",_.onUploadProgress),(_.cancelToken||_.signal)&&(g=function(j){w&&(A(!j||j&&j.type?new E("canceled"):j),w.abort(),w=null)},_.cancelToken&&_.cancelToken.subscribe(g),_.signal&&(_.signal.aborted?g():_.signal.addEventListener("abort",g))),t||(t=null),w.send(t)})},dr}var gr,wa;function Rn(){if(wa)return gr;wa=1;var c=vt,f=ug,l=_o,y={"Content-Type":"application/x-www-form-urlencoded"};function p(N,E){!c.isUndefined(N)&&c.isUndefined(N["Content-Type"])&&(N["Content-Type"]=E)}function b(){var N;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(N=Ia()),N}function I(N,E,S){if(c.isString(N))try{return(E||JSON.parse)(N),c.trim(N)}catch(_){if(_.name!=="SyntaxError")throw _}return(0,JSON.stringify)(N)}var h={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:b(),transformRequest:[function(E,S){return f(S,"Accept"),f(S,"Content-Type"),c.isFormData(E)||c.isArrayBuffer(E)||c.isBuffer(E)||c.isStream(E)||c.isFile(E)||c.isBlob(E)?E:c.isArrayBufferView(E)?E.buffer:c.isURLSearchParams(E)?(p(S,"application/x-www-form-urlencoded;charset=utf-8"),E.toString()):c.isObject(E)||S&&S["Content-Type"]==="application/json"?(p(S,"application/json"),I(E)):E}],transformResponse:[function(E){var S=this.transitional||h.transitional,_=S&&S.silentJSONParsing,L=S&&S.forcedJSONParsing,k=!_&&this.responseType==="json";if(k||L&&c.isString(E)&&E.length)try{return JSON.parse(E)}catch(A){if(k)throw A.name==="SyntaxError"?l(A,this,"E_JSON_PARSE"):A}return E}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(E){return E>=200&&E<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};return c.forEach(["delete","get","head"],function(E){h.headers[E]={}}),c.forEach(["post","put","patch"],function(E){h.headers[E]=c.merge(y)}),gr=h,gr}var yg=vt,mg=Rn(),vg=function(f,l,y){var p=this||mg;return yg.forEach(y,function(I){f=I.call(p,f,l)}),f},pr,ka;function Eo(){return ka||(ka=1,pr=function(f){return!!(f&&f.__CANCEL__)}),pr}var Ca=vt,yr=vg,_g=Eo(),xg=Rn(),Eg=An();function mr(c){if(c.cancelToken&&c.cancelToken.throwIfRequested(),c.signal&&c.signal.aborted)throw new Eg("canceled")}var bg=function(f){mr(f),f.headers=f.headers||{},f.data=yr.call(f,f.data,f.headers,f.transformRequest),f.headers=Ca.merge(f.headers.common||{},f.headers[f.method]||{},f.headers),Ca.forEach(["delete","get","head","post","put","patch","common"],function(p){delete f.headers[p]});var l=f.adapter||xg.adapter;return l(f).then(function(p){return mr(f),p.data=yr.call(f,p.data,p.headers,f.transformResponse),p},function(p){return _g(p)||(mr(f),p&&p.response&&(p.response.data=yr.call(f,p.response.data,p.response.headers,f.transformResponse))),Promise.reject(p)})},pt=vt,bo=function(f,l){l=l||{};var y={};function p(S,_){return pt.isPlainObject(S)&&pt.isPlainObject(_)?pt.merge(S,_):pt.isPlainObject(_)?pt.merge({},_):pt.isArray(_)?_.slice():_}function b(S){if(pt.isUndefined(l[S])){if(!pt.isUndefined(f[S]))return p(void 0,f[S])}else return p(f[S],l[S])}function I(S){if(!pt.isUndefined(l[S]))return p(void 0,l[S])}function h(S){if(pt.isUndefined(l[S])){if(!pt.isUndefined(f[S]))return p(void 0,f[S])}else return p(void 0,l[S])}function N(S){if(S in l)return p(f[S],l[S]);if(S in f)return p(void 0,f[S])}var E={url:I,method:I,data:I,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:N};return pt.forEach(Object.keys(f).concat(Object.keys(l)),function(_){var L=E[_]||b,k=L(_);pt.isUndefined(k)&&L!==N||(y[_]=k)}),y},vr,Na;function So(){return Na||(Na=1,vr={version:"0.24.0"}),vr}var Sg=So().version,$r={};["object","boolean","number","function","string","symbol"].forEach(function(c,f){$r[c]=function(y){return typeof y===c||"a"+(f<1?"n ":" ")+c}});var La={};$r.transitional=function(f,l,y){function p(b,I){return"[Axios v"+Sg+"] Transitional option '"+b+"'"+I+(y?". "+y:"")}return function(b,I,h){if(f===!1)throw new Error(p(I," has been removed"+(l?" in "+l:"")));return l&&!La[I]&&(La[I]=!0,console.warn(p(I," has been deprecated since v"+l+" and will be removed in the near future"))),f?f(b,I,h):!0}};function Ig(c,f,l){if(typeof c!="object")throw new TypeError("options must be an object");for(var y=Object.keys(c),p=y.length;p-- >0;){var b=y[p],I=f[b];if(I){var h=c[b],N=h===void 0||I(h,b,c);if(N!==!0)throw new TypeError("option "+b+" must be "+N);continue}if(l!==!0)throw Error("Unknown option "+b)}}var wg={assertOptions:Ig,validators:$r},Io=vt,kg=vo,Ta=ag,Aa=bg,On=bo,wo=wg,xi=wo.validators;function Qi(c){this.defaults=c,this.interceptors={request:new Ta,response:new Ta}}Qi.prototype.request=function(f){typeof f=="string"?(f=arguments[1]||{},f.url=arguments[0]):f=f||{},f=On(this.defaults,f),f.method?f.method=f.method.toLowerCase():this.defaults.method?f.method=this.defaults.method.toLowerCase():f.method="get";var l=f.transitional;l!==void 0&&wo.assertOptions(l,{silentJSONParsing:xi.transitional(xi.boolean),forcedJSONParsing:xi.transitional(xi.boolean),clarifyTimeoutError:xi.transitional(xi.boolean)},!1);var y=[],p=!0;this.interceptors.request.forEach(function(L){typeof L.runWhen=="function"&&L.runWhen(f)===!1||(p=p&&L.synchronous,y.unshift(L.fulfilled,L.rejected))});var b=[];this.interceptors.response.forEach(function(L){b.push(L.fulfilled,L.rejected)});var I;if(!p){var h=[Aa,void 0];for(Array.prototype.unshift.apply(h,y),h=h.concat(b),I=Promise.resolve(f);h.length;)I=I.then(h.shift(),h.shift());return I}for(var N=f;y.length;){var E=y.shift(),S=y.shift();try{N=E(N)}catch(_){S(_);break}}try{I=Aa(N)}catch(_){return Promise.reject(_)}for(;b.length;)I=I.then(b.shift(),b.shift());return I};Qi.prototype.getUri=function(f){return f=On(this.defaults,f),kg(f.url,f.params,f.paramsSerializer).replace(/^\?/,"")};Io.forEach(["delete","get","head","options"],function(f){Qi.prototype[f]=function(l,y){return this.request(On(y||{},{method:f,url:l,data:(y||{}).data}))}});Io.forEach(["post","put","patch"],function(f){Qi.prototype[f]=function(l,y,p){return this.request(On(p||{},{method:f,url:l,data:y}))}});var Cg=Qi,_r,Ra;function Ng(){if(Ra)return _r;Ra=1;var c=An();function f(l){if(typeof l!="function")throw new TypeError("executor must be a function.");var y;this.promise=new Promise(function(I){y=I});var p=this;this.promise.then(function(b){if(p._listeners){var I,h=p._listeners.length;for(I=0;I<h;I++)p._listeners[I](b);p._listeners=null}}),this.promise.then=function(b){var I,h=new Promise(function(N){p.subscribe(N),I=N}).then(b);return h.cancel=function(){p.unsubscribe(I)},h},l(function(I){p.reason||(p.reason=new c(I),y(p.reason))})}return f.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},f.prototype.subscribe=function(y){if(this.reason){y(this.reason);return}this._listeners?this._listeners.push(y):this._listeners=[y]},f.prototype.unsubscribe=function(y){if(this._listeners){var p=this._listeners.indexOf(y);p!==-1&&this._listeners.splice(p,1)}},f.source=function(){var y,p=new f(function(I){y=I});return{token:p,cancel:y}},_r=f,_r}var xr,Oa;function Lg(){return Oa||(Oa=1,xr=function(f){return function(y){return f.apply(null,y)}}),xr}var Er,Ua;function Tg(){return Ua||(Ua=1,Er=function(f){return typeof f=="object"&&f.isAxiosError===!0}),Er}var Pa=vt,Ag=po,bn=Cg,Rg=bo,Og=Rn();function ko(c){var f=new bn(c),l=Ag(bn.prototype.request,f);return Pa.extend(l,bn.prototype,f),Pa.extend(l,f),l.create=function(p){return ko(Rg(c,p))},l}var Dt=ko(Og);Dt.Axios=bn;Dt.Cancel=An();Dt.CancelToken=Ng();Dt.isCancel=Eo();Dt.VERSION=So().version;Dt.all=function(f){return Promise.all(f)};Dt.spread=Lg();Dt.isAxiosError=Tg();Gr.exports=Dt;Gr.exports.default=Dt;var Ug=Gr.exports,Pg=Ug;const Ei=Mr(Pg),Ze={token:"b8ed92ff9b64aebcb0110acca15e478f",baseUrl:"//api.tianditu.gov.cn",urls:{geocoder:"/geocoder",search:"/v2/search",pathByDrive:"/drive",pathByMass:"/transit"},locationToAddress(c,f,l){return Ei.get(`${Ze.baseUrl}${Ze.urls.geocoder}?postStr={'lon':${c},'lat':${f},'ver':1}&type=geocode&tk=${l||Ze.token}`)},addressToLocation(c,f){return Ei.get(`${Ze.baseUrl}${Ze.urls.geocoder}?ds={'keyWord':'${c}'}&tk=${f||Ze.token}`)},searchAddressByKeyword(c,f=10,l="116.203477,40.013767,116.52208,39.828928",y){return typeof c=="object"?Ei.get(`${Ze.baseUrl}${Ze.urls.search}?postStr=${JSON.stringify(c)}&type=query&tk=${c.token||Ze.token}`):Ei.get(`${Ze.baseUrl}${Ze.urls.search}?postStr={"keyWord":"${c}","queryType":"7","count":"${f}","start":"0","level":18,"mapBound":"${l}"}&type=query&tk=${y||Ze.token}`)},pathGeneratorByCar({orig:c,dest:f,mid:l,style:y=0},p){const b=`${Ze.baseUrl}${Ze.urls.pathByDrive}?postStr={"orig":"${c}","dest":"${f}","mid":"${l}","style":"${y}"}&type=search&tk=${p||Ze.token}`;return Ei.get(b)},pathGeneratorByMass({startPosition:c="",endPosition:f="",lineType:l="1"},y){const p=`${Ze.baseUrl}${Ze.urls.pathByDrive}?type=busline&postStr={'startposition':'${c}','endposition':'${f}',linetype:'${l}'}&tk=${y||Ze.token}`;return Ei.get(p)}},Mg=[ph,xh,Rh,Gh,Wh,ac,xc,wc,Ac,Mc,qc,ut,jc,ef,rf,lf,gf,_f,ui,wf,Tf,Ff,$f,sd,lt,cd,ed,Zf,Ed,kd,Ad,Md,Gd,go],Bg=function(c,f={}){Mg.forEach(l=>{c.component(l.name,l)})},jg={version:qd,install:Bg};export{ph as MbBufferCircleLayer,xh as MbBufferCircleLayerV2,Rh as MbBufferEllipseLayer,Gh as MbBufferLineLayer,Wh as MbBufferPolygonLayer,ac as MbBufferSectorLayer,xc as MbBuildingLayer,wc as MbCircleLayer,Ac as MbDrawControl,Mc as MbFullscreenControl,gf as MbHeatmapLayer,wf as MbImageApngLoader,Tf as MbImageFrameLoader,Ff as MbImageGifLoader,_f as MbImageLayer,ui as MbImageLoader,$f as MbImageLottieLoader,ut as MbLayer,qc as MbMap,jc as MbMapMarker,ef as MbMapPopup,rf as MbMapTooltip,lf as MbNavigationControl,Zf as MbPolygonLayer,ed as MbPolylineLayer,sd as MbScaleControl,lt as MbSource,cd as MbSymbolLayer,Ed as MbTiandituLayer,kd as MbUrlTemplateLayer,Ad as MbVideoLayer,Md as MbVideoMp4Loader,Gd as MbWmsLayer,go as MbWmtsLayer,Ze as TiandituApi,jg as default,Bg as install,oi as mapContextKey,He as useMapCreated};
