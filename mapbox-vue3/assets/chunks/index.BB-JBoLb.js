import{a as yo,i as Eo,F as Be,o as Se,r as Me,u as ki,p as To,C as bo}from"./use-path-layer.CvRjDMoi.js";import{n as gt,o as So,q as Vn,s as Mo,t as L,_ as f,S as Qi,u as vo,v as qi,x as Yi,y as ke,z as H,D as Io,E as Ro,H as Zi,I as Po,J as xo,K as Fo,N as $i,O as Do,Q as Oo,R as Vt,X as Lo,Y as wo,Z as er,$ as Go,a0 as Uo,a1 as No,a2 as Ho,a3 as Vo,a4 as Jo,a5 as zo,a6 as _s,a7 as tr,a8 as sn,a9 as Ko,aa as jo,ab as Xo,ac as Wo,ad as ko,ae as Qo,af as qo,G as be,ag as Jn,L as Ze,ah as Yo,ai as Zo,aj as $o,p as mt,a as pt,U as ut,b as xe,g as nr,ak as le,m as ea,W as ta,al as Xt,am as zn,an as sr,F as Kn,M as _e,A as na,ao as jn,C as Ke,j as ir,ap as p,aq as F,ar as at,as as Fe,B as sa,at as ia,au as ra,av as Xn,aw as oa,ax as aa,ay as ca,az as la,aA as ua,aB as da,aC as pe,aD as je,P as ha,aE as fa,aF as ga,aG as ma,aH as Te,aI as At,aJ as rr,aK as pa}from"./path-layer.s0Kv9vne.js";import{d as de,q as y,o as he,c as fe}from"./framework.BRu0xxKU.js";import"./v4.BCLFZokq.js";import"./csscolorparser.A-VAnCRm.js";import"./commonjsHelpers.Cpj98o6Y.js";const Aa=null,Ca=null,In=null,or=null,Ba=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:Aa,readFileAsText:Ca,requireFromFile:In,requireFromString:or},Symbol.toStringTag,{value:"Module"})),_a="3.4.15",rn={};async function Pe(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e&&(n=ya(n,e,t)),rn[n]=rn[n]||Ea(n),await rn[n]}function ya(n,e,t){if(n.startsWith("http"))return n;const s=t.modules||{};return s[n]?s[n]:gt?t.CDN?(So(t.CDN.startsWith("http")),"".concat(t.CDN,"/").concat(e,"@").concat(_a,"/dist/libs/").concat(n)):Vn?"../src/libs/".concat(n):"modules/".concat(e,"/src/libs/").concat(n):"modules/".concat(e,"/dist/libs/").concat(n)}async function Ea(n){if(n.endsWith("wasm"))return await(await fetch(n)).arrayBuffer();if(!gt)try{return Ba&&In&&await In(n)}catch{return null}if(Vn)return importScripts(n);const t=await(await fetch(n)).text();return Ta(t,n)}function Ta(n,e){if(!gt)return or;if(Vn)return eval.call(Mo,n),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(n))}catch{t.text=n}return document.body.appendChild(t),null}function ba(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?ys(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?ys(n,0,e):""}function ys(n,e,t){if(n.byteLength<=e+t)return"";const s=new DataView(n);let i="";for(let r=0;r<t;r++)i+=String.fromCharCode(s.getUint8(e+r));return i}function Sa(n){try{return JSON.parse(n)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(ba(n),'"'))}}function Ct(n,e){return L(n>=0),L(e>0),n+(e-1)&~(e-1)}function Ma(n,e,t){let s;if(n instanceof ArrayBuffer)s=new Uint8Array(n);else{const i=n.byteOffset,r=n.byteLength;s=new Uint8Array(n.buffer||n.arrayBuffer,i,r)}return e.set(s,t),t+Ct(s.byteLength,4)}const va="Queued Requests",Ia="Active Requests",Ra="Cancelled Requests",Pa="Queued Requests Ever",xa="Active Requests Ever",Fa={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Da{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f(this,"props",void 0),f(this,"stats",void 0),f(this,"activeRequestCount",0),f(this,"requestQueue",[]),f(this,"requestMap",new Map),f(this,"deferredUpdate",null),this.props={...Fa,...e},this.stats=new Qi({id:this.props.id}),this.stats.get(va),this.stats.get(Ia),this.stats.get(Ra),this.stats.get(Pa),this.stats.get(xa)}scheduleRequest(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const s={handle:e,priority:0,getPriority:t},i=new Promise(r=>(s.resolve=r,s));return this.requestQueue.push(s),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:t,resolve:s}=e;let i=!1;const r=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,s?s({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const s=this.requestQueue.shift();s&&this._issueRequest(s)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const s=e[t];this._updateRequest(s)||(e.splice(t,1),this.requestMap.delete(s.handle),t--)}e.sort((t,s)=>t.priority-s.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}const on={};function Oa(n){if(on[n]===void 0){const e=vo?wa(n):La(n);on[n]=e}return on[n]}function La(n){const e=["image/png","image/jpeg","image/gif"],{_parseImageNode:t,_imageFormatsNode:s=e}=globalThis;return!!t&&s.includes(n)}function wa(n){switch(n){case"image/avif":case"image/webp":return Ga(n);default:return!0}}function Ga(n){try{return document.createElement("canvas").toDataURL(n).indexOf("data:".concat(n))===0}catch{return!1}}class Wn extends qi{constructor(e=0,t=0){super(2),Yi(e)&&arguments.length===1?this.copy(e):(ke.debug&&(H(e),H(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return ke.debug&&(H(e.x),H(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Io(this,this,e),this.check()}transformAsVector(e){return Ro(this,this,e),this.check()}transformByMatrix3(e){return Zi(this,this,e),this.check()}transformByMatrix2x3(e){return Po(this,this,e),this.check()}transformByMatrix2(e){return xo(this,this,e),this.check()}}let Tt;class kn extends qi{static get ZERO(){return Tt||(Tt=new kn(0,0,0,0),Object.freeze(Tt)),Tt}constructor(e=0,t=0,s=0,i=0){super(-0,-0,-0,-0),Yi(e)&&arguments.length===1?this.copy(e):(ke.debug&&(H(e),H(t),H(s),H(i)),this[0]=e,this[1]=t,this[2]=s,this[3]=i)}set(e,t,s,i){return this[0]=e,this[1]=t,this[2]=s,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return ke.debug&&(H(e.x),H(e.y),H(e.z),H(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=H(e)}get w(){return this[3]}set w(e){this[3]=H(e)}transform(e){return Fo(this,this,e),this.check()}transformByMatrix3(e){return $i(this,this,e),this.check()}transformByMatrix2(e){return Do(this,this,e),this.check()}transformByQuaternion(e){return Oo(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}function Ua(){var n=new Vt(9);return Vt!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Na(n,e){if(n===e){var t=e[1],s=e[2],i=e[5];n[1]=e[3],n[2]=e[6],n[3]=t,n[5]=e[7],n[6]=s,n[7]=i}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n}function Ha(n,e){var t=e[0],s=e[1],i=e[2],r=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=u*o-a*l,h=-u*r+a*c,g=l*r-o*c,m=t*d+s*h+i*g;return m?(m=1/m,n[0]=d*m,n[1]=(-u*s+i*l)*m,n[2]=(a*s-i*o)*m,n[3]=h*m,n[4]=(u*t-i*c)*m,n[5]=(-a*t+i*r)*m,n[6]=g*m,n[7]=(-l*t+s*c)*m,n[8]=(o*t-s*r)*m,n):null}function Va(n){var e=n[0],t=n[1],s=n[2],i=n[3],r=n[4],o=n[5],a=n[6],c=n[7],l=n[8];return e*(l*r-o*c)+t*(-l*i+o*a)+s*(c*i-r*a)}function Es(n,e,t){var s=e[0],i=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],d=e[8],h=t[0],g=t[1],m=t[2],A=t[3],C=t[4],B=t[5],E=t[6],T=t[7],b=t[8];return n[0]=h*s+g*o+m*l,n[1]=h*i+g*a+m*u,n[2]=h*r+g*c+m*d,n[3]=A*s+C*o+B*l,n[4]=A*i+C*a+B*u,n[5]=A*r+C*c+B*d,n[6]=E*s+T*o+b*l,n[7]=E*i+T*a+b*u,n[8]=E*r+T*c+b*d,n}function Ja(n,e,t){var s=e[0],i=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],d=e[8],h=t[0],g=t[1];return n[0]=s,n[1]=i,n[2]=r,n[3]=o,n[4]=a,n[5]=c,n[6]=h*s+g*o+l,n[7]=h*i+g*a+u,n[8]=h*r+g*c+d,n}function za(n,e,t){var s=e[0],i=e[1],r=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],d=e[8],h=Math.sin(t),g=Math.cos(t);return n[0]=g*s+h*o,n[1]=g*i+h*a,n[2]=g*r+h*c,n[3]=g*o-h*s,n[4]=g*a-h*i,n[5]=g*c-h*r,n[6]=l,n[7]=u,n[8]=d,n}function Ts(n,e,t){var s=t[0],i=t[1];return n[0]=s*e[0],n[1]=s*e[1],n[2]=s*e[2],n[3]=i*e[3],n[4]=i*e[4],n[5]=i*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function Ka(n,e){var t=e[0],s=e[1],i=e[2],r=e[3],o=t+t,a=s+s,c=i+i,l=t*o,u=s*o,d=s*a,h=i*o,g=i*a,m=i*c,A=r*o,C=r*a,B=r*c;return n[0]=1-d-m,n[3]=u-B,n[6]=h+C,n[1]=u+B,n[4]=1-l-m,n[7]=g-A,n[2]=h-C,n[5]=g+A,n[8]=1-l-d,n}var Rn;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(Rn||(Rn={}));const ja=Object.freeze([1,0,0,0,1,0,0,0,1]);class U extends Lo{static get IDENTITY(){return Wa()}static get ZERO(){return Xa()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Rn}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(ja)}fromObject(e){return this.check()}fromQuaternion(e){return Ka(this,e),this.check()}set(e,t,s,i,r,o,a,c,l){return this[0]=e,this[1]=t,this[2]=s,this[3]=i,this[4]=r,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(e,t,s,i,r,o,a,c,l){return this[0]=e,this[1]=i,this[2]=a,this[3]=t,this[4]=r,this[5]=c,this[6]=s,this[7]=o,this[8]=l,this.check()}determinant(){return Va(this)}transpose(){return Na(this,this),this.check()}invert(){return Ha(this,this),this.check()}multiplyLeft(e){return Es(this,e,this),this.check()}multiplyRight(e){return Es(this,this,e),this.check()}rotate(e){return za(this,this,e),this.check()}scale(e){return Array.isArray(e)?Ts(this,this,e):Ts(this,this,[e,e]),this.check()}translate(e){return Ja(this,this,e),this.check()}transform(e,t){let s;switch(e.length){case 2:s=Zi(t||[-0,-0],e,this);break;case 3:s=wo(t||[-0,-0,-0],e,this);break;case 4:s=$i(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return er(s,e.length),s}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let bt,St;function Xa(){return bt||(bt=new U([0,0,0,0,0,0,0,0,0]),Object.freeze(bt)),bt}function Wa(){return St||(St=new U,Object.freeze(St)),St}function bs(){var n=new Vt(4);return Vt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function ka(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function ar(n,e,t){t=t*.5;var s=Math.sin(t);return n[0]=s*e[0],n[1]=s*e[1],n[2]=s*e[2],n[3]=Math.cos(t),n}function Ss(n,e,t){var s=e[0],i=e[1],r=e[2],o=e[3],a=t[0],c=t[1],l=t[2],u=t[3];return n[0]=s*u+o*a+i*l-r*c,n[1]=i*u+o*c+r*a-s*l,n[2]=r*u+o*l+s*c-i*a,n[3]=o*u-s*a-i*c-r*l,n}function Qa(n,e,t){t*=.5;var s=e[0],i=e[1],r=e[2],o=e[3],a=Math.sin(t),c=Math.cos(t);return n[0]=s*c+o*a,n[1]=i*c+r*a,n[2]=r*c-i*a,n[3]=o*c-s*a,n}function qa(n,e,t){t*=.5;var s=e[0],i=e[1],r=e[2],o=e[3],a=Math.sin(t),c=Math.cos(t);return n[0]=s*c-r*a,n[1]=i*c+o*a,n[2]=r*c+s*a,n[3]=o*c-i*a,n}function Ya(n,e,t){t*=.5;var s=e[0],i=e[1],r=e[2],o=e[3],a=Math.sin(t),c=Math.cos(t);return n[0]=s*c+i*a,n[1]=i*c-s*a,n[2]=r*c+o*a,n[3]=o*c-r*a,n}function Za(n,e){var t=e[0],s=e[1],i=e[2];return n[0]=t,n[1]=s,n[2]=i,n[3]=Math.sqrt(Math.abs(1-t*t-s*s-i*i)),n}function Gt(n,e,t,s){var i=e[0],r=e[1],o=e[2],a=e[3],c=t[0],l=t[1],u=t[2],d=t[3],h,g,m,A,C;return g=i*c+r*l+o*u+a*d,g<0&&(g=-g,c=-c,l=-l,u=-u,d=-d),1-g>Xo?(h=Math.acos(g),m=Math.sin(h),A=Math.sin((1-s)*h)/m,C=Math.sin(s*h)/m):(A=1-s,C=s),n[0]=A*i+C*c,n[1]=A*r+C*l,n[2]=A*o+C*u,n[3]=A*a+C*d,n}function $a(n,e){var t=e[0],s=e[1],i=e[2],r=e[3],o=t*t+s*s+i*i+r*r,a=o?1/o:0;return n[0]=-t*a,n[1]=-s*a,n[2]=-i*a,n[3]=r*a,n}function ec(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function cr(n,e){var t=e[0]+e[4]+e[8],s;if(t>0)s=Math.sqrt(t+1),n[3]=.5*s,s=.5/s,n[0]=(e[5]-e[7])*s,n[1]=(e[6]-e[2])*s,n[2]=(e[1]-e[3])*s;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var r=(i+1)%3,o=(i+2)%3;s=Math.sqrt(e[i*3+i]-e[r*3+r]-e[o*3+o]+1),n[i]=.5*s,s=.5/s,n[3]=(e[r*3+o]-e[o*3+r])*s,n[r]=(e[r*3+i]+e[i*3+r])*s,n[o]=(e[o*3+i]+e[i*3+o])*s}return n}var tc=Go,nc=Uo,sc=No,ic=Ho,rc=Vo,oc=Jo,lr=Wo,ac=function(){var n=zo(),e=_s(1,0,0),t=_s(0,1,0);return function(s,i,r){var o=tr(i,r);return o<-.999999?(sn(n,e,i),Ko(n)<1e-6&&sn(n,t,i),jo(n,n),ar(s,n,Math.PI),s):o>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(sn(n,i,r),s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=1+o,lr(s,s))}}();(function(){var n=bs(),e=bs();return function(t,s,i,r,o,a){return Gt(n,s,o,a),Gt(e,i,r,a),Gt(t,n,e,2*a*(1-a)),t}})();(function(){var n=Ua();return function(e,t,s,i){return n[0]=s[0],n[3]=s[1],n[6]=s[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],lr(e,cr(e,n))}})();const cc=[0,0,0,1];class dt extends ko{constructor(e=0,t=0,s=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,s,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,s,i){return this[0]=e,this[1]=t,this[2]=s,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return cr(this,e),this.check()}fromAxisRotation(e,t){return ar(this,e,t),this.check()}identity(){return ka(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=H(e)}get y(){return this[1]}set y(e){this[1]=H(e)}get z(){return this[2]}set z(e){this[2]=H(e)}get w(){return this[3]}set w(e){this[3]=H(e)}len(){return rc(this)}lengthSquared(){return oc(this)}dot(e){return sc(this,e)}rotationTo(e,t){return ac(this,e,t),this.check()}add(e){return tc(this,this,e),this.check()}calculateW(){return Za(this,this),this.check()}conjugate(){return ec(this,this),this.check()}invert(){return $a(this,this),this.check()}lerp(e,t,s){return s===void 0?this.lerp(this,e,t):(ic(this,e,t,s),this.check())}multiplyRight(e){return Ss(this,this,e),this.check()}multiplyLeft(e){return Ss(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return Qa(this,this,e),this.check()}rotateY(e){return qa(this,this,e),this.check()}rotateZ(e){return Ya(this,this,e),this.check()}scale(e){return nc(this,this,e),this.check()}slerp(e,t,s){let i,r,o;switch(arguments.length){case 1:({start:i=cc,target:r,ratio:o}=e);break;case 2:i=this,r=e,o=t;break;default:i=e,r=t,o=s}return Gt(this,i,r,o),this.check()}transformVector4(e,t=new kn){return Qo(t,e,this),er(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const ht={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},lc=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,uc=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,Qn={name:"pbr",vs:lc,fs:uc,defines:{LIGHTING_FRAGMENT:1},dependencies:[qo]},dc=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),hc=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),fc=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),gc=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),mc={POSITION:{size:3,value:new Float32Array(hc)},NORMAL:{size:3,value:new Float32Array(fc)},TEXCOORD_0:{size:2,value:new Float32Array(gc)}};class pc extends be{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t=Jn("cube-geometry")}=e;super({...e,id:t,indices:{size:1,value:new Uint16Array(dc)},attributes:{...mc,...e.attributes}})}}const Ac="compositeLayer.renderLayers";class qn extends Ze{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:s}=this.props;return s&&s[e]&&s[e].type||t}getSubLayerRow(e,t,s){return e.__source={parent:this,object:t,index:s},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(s,i)=>s&&s.__source?(t.index=s.__source.index,e(s.__source.object,t)):e(s,i)}return e}getSubLayerProps(e={}){var t;const{opacity:s,pickable:i,visible:r,parameters:o,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:l,highlightColor:u,coordinateSystem:d,coordinateOrigin:h,wrapLongitude:g,positionFormat:m,modelMatrix:A,extensions:C,fetch:B,operation:E,_subLayerProps:T}=this.props,b={id:"",updateTriggers:{},opacity:s,pickable:i,visible:r,parameters:o,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:l,highlightColor:u,coordinateSystem:d,coordinateOrigin:h,wrapLongitude:g,positionFormat:m,modelMatrix:A,extensions:C,fetch:B,operation:E},M=T&&e.id&&T[e.id],D=M&&M.updateTriggers,O=e.id||"sublayer";if(M){const P=this.props[Yo],R=e.type?e.type._propTypes:{};for(const S in M){const q=R[S]||P[S];q&&q.type==="accessor"&&(M[S]=this.getSubLayerAccessor(M[S]))}}Object.assign(b,e,M),b.id="".concat(this.props.id,"-").concat(O),b.updateTriggers={all:(t=this.props.updateTriggers)===null||t===void 0?void 0:t.all,...e.updateTriggers,...D};for(const P of C){const R=P.getSubLayerProps.call(this,P);R&&Object.assign(b,R,{updateTriggers:Object.assign(b.updateTriggers,R.updateTriggers)})}return b}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let s=this.internalState.subLayers;const i=!s||this.needsUpdate();if(i){const r=this.renderLayers();s=Zo(r,Boolean),this.internalState.subLayers=s}$o(Ac,this,i,s);for(const r of s)r.parent=this}}f(qn,"layerName","CompositeLayer");const ge=(n,e)=>(n.install=t=>{for(const s of[n,...Object.values({})])t.component(s.name,s)},n),Cc=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      gl_Position = vec4(0.);
      return;
    }
  }
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(p, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Bc=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,_c=[0,0,0,255],yc={getSourcePosition:{type:"accessor",value:n=>n.sourcePosition},getTargetPosition:{type:"accessor",value:n=>n.targetPosition},getColor:{type:"accessor",value:_c},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class Yn extends Ze{getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Cc,fs:Bc,modules:[mt,pt]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var t;const{gl:s}=this.context;(t=this.state.model)===null||t===void 0||t.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:t,widthScale:s,widthMinPixels:i,widthMaxPixels:r,wrapLongitude:o}=this.props;this.state.model.setUniforms(e).setUniforms({widthUnits:ut[t],widthScale:s,widthMinPixels:i,widthMaxPixels:r,useShortestPath:o?1:0}).draw(),o&&this.state.model.setUniforms({useShortestPath:-1}).draw()}_getModel(e){const t=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new xe(e,{...this.getShaders(),id:this.props.id,geometry:new be({drawMode:5,attributes:{positions:new Float32Array(t)}}),isInstanced:!0})}}f(Yn,"layerName","LineLayer");f(Yn,"defaultProps",yc);const Ec=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Tc=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,ur=[0,0,0,255],dr=[0,0,1],bc={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:n=>n.position},getNormal:{type:"accessor",value:dr},getColor:{type:"accessor",value:ur},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Sc(n){const{header:e,attributes:t}=n;!e||!t||(n.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0&&(t.instanceColors=t.COLOR_0))}class Zn extends Ze{getShaders(){return super.getShaders({vs:Ec,fs:Tc,modules:[mt,nr,pt]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:dr},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:ur}})}updateState(e){const{changeFlags:t,props:s}=e;if(super.updateState(e),t.extensionsChanged){var i;const{gl:r}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}t.dataChanged&&Sc(s.data)}draw({uniforms:e}){const{pointSize:t,sizeUnits:s}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:ut[s],radiusPixels:t}).draw()}_getModel(e){const t=[];for(let s=0;s<3;s++){const i=s/3*Math.PI*2;t.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new xe(e,{...this.getShaders(),id:this.props.id,geometry:new be({drawMode:4,attributes:{positions:new Float32Array(t)}}),isInstanced:!0})}}f(Zn,"layerName","PointCloudLayer");f(Zn,"defaultProps",bc);class Mc extends be{constructor(e){const{id:t=Jn("column-geometry")}=e,{indices:s,attributes:i}=vc(e);super({...e,id:t,indices:s,attributes:i})}}function vc(n){const{radius:e,height:t=1,nradial:s=10}=n;let{vertices:i}=n;i&&(le.assert(i.length>=s),i=i.flatMap(g=>[g[0],g[1]]),ea(i,ta.COUNTER_CLOCKWISE));const r=t>0,o=s+1,a=r?o*3+1:s,c=Math.PI*2/s,l=new Uint16Array(r?s*3*2:0),u=new Float32Array(a*3),d=new Float32Array(a*3);let h=0;if(r){for(let g=0;g<o;g++){const m=g*c,A=g%s,C=Math.sin(m),B=Math.cos(m);for(let E=0;E<2;E++)u[h+0]=i?i[A*2]:B*e,u[h+1]=i?i[A*2+1]:C*e,u[h+2]=(1/2-E)*t,d[h+0]=i?i[A*2]:B,d[h+1]=i?i[A*2+1]:C,h+=3}u[h+0]=u[h-3],u[h+1]=u[h-2],u[h+2]=u[h-1],h+=3}for(let g=r?0:1;g<o;g++){const m=Math.floor(g/2)*Math.sign(.5-g%2),A=m*c,C=(m+s)%s,B=Math.sin(A),E=Math.cos(A);u[h+0]=i?i[C*2]:E*e,u[h+1]=i?i[C*2+1]:B*e,u[h+2]=t/2,d[h+2]=1,h+=3}if(r){let g=0;for(let m=0;m<s;m++)l[g++]=m*2+0,l[g++]=m*2+2,l[g++]=m*2+0,l[g++]=m*2+1,l[g++]=m*2+1,l[g++]=m*2+3}return{indices:l,attributes:{POSITION:{size:3,value:u},NORMAL:{size:3,value:d}}}}const Ic=`#version 300 es

#define SHADER_NAME column-layer-vertex-shader

in vec3 positions;
in vec3 normals;

in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;

in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif

void main(void) {
  geometry.worldPosition = instancePositions;

  vec4 color = isStroke ? instanceLineColors : instanceFillColors;
  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
  float elevation = 0.0;
  float strokeOffsetRatio = 1.0;

  if (extruded) {
    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
  } else if (stroked) {
    float widthPixels = clamp(
      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
      widthMinPixels, widthMaxPixels) / 2.0;
    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
    if (isStroke) {
      strokeOffsetRatio -= sign(positions.z) * halfOffset;
    } else {
      strokeOffsetRatio -= halfOffset;
    }
  }
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = radius * coverage * shouldRender;

  geometry.pickingColor = instancePickingColors;
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
  if (radiusUnits == UNIT_METERS) {
    offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  if (extruded && !isStroke) {
#ifdef FLAT_SHADING
    position_commonspace = geometry.position;
    vColor = vec4(color.rgb, color.a * opacity);
#else
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
    vColor = vec4(lightColor, color.a * opacity);
#endif
  } else {
    vColor = vec4(color.rgb, color.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Rc=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader

precision highp float;

uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;

out vec4 fragColor;

in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif

void main(void) {
  fragColor = vColor;
#ifdef FLAT_SHADING
  if (extruded && !isStroke && !picking_uActive) {
    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
  }
#endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Jt=[0,0,0,255],Pc={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:n=>n.position},getFillColor:{type:"accessor",value:Jt},getLineColor:{type:"accessor",value:Jt},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Bt extends Ze{getShaders(){const{gl:e}=this.context,t=!Xt(e),s={},i=this.props.flatShading&&zn(e,Kn.GLSL_DERIVATIVES);return i&&(s.FLAT_SHADING=1),super.getShaders({vs:Ic,fs:Rc,defines:s,transpileToGLSL100:t,modules:[mt,i?sr:nr,pt]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:Jt},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:Jt},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:t,oldProps:s,changeFlags:i}=e,r=i.extensionsChanged||t.flatShading!==s.flatShading;if(r){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}(r||t.diskResolution!==s.diskResolution||t.vertices!==s.vertices||(t.extruded||t.stroked)!==(s.extruded||s.stroked))&&this._updateGeometry(t)}getGeometry(e,t,s){const i=new Mc({radius:1,height:s?2:0,vertices:t,nradial:e});let r=0;if(t)for(let o=0;o<e;o++){const a=t[o],c=Math.sqrt(a[0]*a[0]+a[1]*a[1]);r+=c/e}else r=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*r}),i}_getModel(e){return new xe(e,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:e,vertices:t,extruded:s,stroked:i}){const r=this.getGeometry(e,t,s||i);this.setState({fillVertexCount:r.attributes.POSITION.value.length/3,wireframeVertexCount:r.indices.value.length}),this.state.model.setProps({geometry:r})}draw({uniforms:e}){const{lineWidthUnits:t,lineWidthScale:s,lineWidthMinPixels:i,lineWidthMaxPixels:r,radiusUnits:o,elevationScale:a,extruded:c,filled:l,stroked:u,wireframe:d,offset:h,coverage:g,radius:m,angle:A}=this.props,{model:C,fillVertexCount:B,wireframeVertexCount:E,edgeDistance:T}=this.state;C.setUniforms(e).setUniforms({radius:m,angle:A/180*Math.PI,offset:h,extruded:c,stroked:u,coverage:g,elevationScale:a,edgeDistance:T,radiusUnits:ut[o],widthUnits:ut[t],widthScale:s,widthMinPixels:i,widthMaxPixels:r}),c&&d&&(C.setProps({isIndexed:!0}),C.setVertexCount(E).setDrawMode(1).setUniforms({isStroke:!0}).draw()),l&&(C.setProps({isIndexed:!1}),C.setVertexCount(B).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!c&&u&&(C.setProps({isIndexed:!1}),C.setVertexCount(B*2/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}f(Bt,"layerName","ColumnLayer");f(Bt,"defaultProps",Pc);const xc={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};class Wt extends Bt{getGeometry(e){return new pc}draw({uniforms:e}){const{elevationScale:t,extruded:s,offset:i,coverage:r,cellSize:o,angle:a,radiusUnits:c}=this.props;this.state.model.setUniforms(e).setUniforms({radius:o/2,radiusUnits:ut[c],angle:a,offset:i,extruded:s,coverage:r,elevationScale:t,edgeDistance:1,isWireframe:!1}).draw()}}f(Wt,"layerName","GridCellLayer");f(Wt,"defaultProps",xc);const Fc={class:"mb-arc-layer"},Dc={name:"MbArcLayer"},Oc=de({...Dc,props:yo,emits:Eo,setup(n){const e=n,t=o=>{const{width:a,height:c,sourcePosition:l,targetPosition:u,sourceColor:d,targetColor:h}=e;return new _e(Object.assign({},o,{type:na,getWidth:a,getHeight:c,getSourcePosition:l,getTargetPosition:u,getSourceColor:i(d),getTargetColor:i(h)}))},{getLayer:s,parseColorVal:i,setColorProps:r}=Be(e,t);return y(()=>e.width,o=>{const a=s();a==null||a.setProps({getWidth:o})}),y(()=>e.height,o=>{const a=s();a==null||a.setProps({getHeight:o})}),y(()=>e.sourcePosition,o=>{const a=s();a==null||a.setProps({getSourcePosition:o})}),y(()=>e.targetPosition,o=>{const a=s();a==null||a.setProps({getTargetPosition:o})}),y(()=>e.sourceColor,o=>{r("getSourceColor",o)}),y(()=>e.targetColor,o=>{r("getTargetColor",o)}),(o,a)=>(he(),fe("i",Fc))}}),Lc=ge(Oc),wc={...Se,radius:{type:Number,default:1e3},filled:{type:Boolean,default:!0},stroked:{type:Boolean,default:!1},extruded:{type:Boolean,default:!0},lineWidthUnits:{type:String,default:"meters"},lineWidthScale:{type:Number,default:1},lineWidthMinPixels:{type:Number,default:0},lineWidthMaxPixels:{type:Number,default:Number.MAX_SAFE_INTEGER},position:{type:Function,required:!0},elevation:{type:[Number,Function],default:1e3},fillColor:{type:[String,Function],default:"black"},lineColor:{type:[String,Function],default:"black"},lineWidth:{type:[Number,Function],default:1}},Gc=Me,Uc={class:"mb-column-layer"},Nc={name:"MbColumnLayer"},Hc=de({...Nc,props:wc,emits:Gc,setup(n){const e=n,t=o=>{const{radius:a,filled:c,stroked:l,extruded:u,lineWidthUnits:d,lineWidthScale:h,lineWidthMinPixels:g,lineWidthMaxPixels:m,position:A,fillColor:C,lineColor:B,elevation:E,lineWidth:T}=e;return new _e(Object.assign({},o,{type:Bt,radius:a,filled:c,stroked:l,extruded:u,lineWidthUnits:d,lineWidthScale:h,lineWidthMinPixels:g,lineWidthMaxPixels:m,getPosition:A,getFillColor:i(C),getLineColor:i(B),getElevation:E,getLineWidth:T}))},{getLayer:s,parseColorVal:i,setColorProps:r}=Be(e,t);return y(()=>e.radius,o=>{const a=s();a==null||a.setProps({radius:o})}),y(()=>e.filled,o=>{const a=s();a==null||a.setProps({filled:o})}),y(()=>e.stroked,o=>{const a=s();a==null||a.setProps({stroked:o})}),y(()=>e.extruded,o=>{const a=s();a==null||a.setProps({extruded:o})}),y(()=>e.lineWidth,o=>{const a=s();a==null||a.setProps({getLineWidth:o})}),y(()=>e.lineWidthUnits,o=>{const a=s();a==null||a.setProps({lineWidthUnits:o})}),y(()=>e.lineWidthScale,o=>{const a=s();a==null||a.setProps({lineWidthScale:o})}),y(()=>e.lineWidthMinPixels,o=>{const a=s();a==null||a.setProps({lineWidthMinPixels:o})}),y(()=>e.lineWidthMaxPixels,o=>{const a=s();a==null||a.setProps({lineWidthMaxPixels:o})}),y(()=>e.fillColor,o=>{r("getFillColor",o)}),y(()=>e.lineColor,o=>{r("getLineColor",o)}),y(()=>e.position,o=>{const a=s();a==null||a.setProps({getPosition:o})}),y(()=>e.elevation,o=>{const a=s();a==null||a.setProps({getElevation:o})}),(o,a)=>(he(),fe("i",Uc))}}),Vc=ge(Hc),an=Math.PI/180,Mt=new Float32Array(16),Ms=new Float32Array(12);function vs(n,e,t){const s=e[0]*an,i=e[1]*an,r=e[2]*an,o=Math.sin(r),a=Math.sin(s),c=Math.sin(i),l=Math.cos(r),u=Math.cos(s),d=Math.cos(i),h=t[0],g=t[1],m=t[2];n[0]=h*d*u,n[1]=h*c*u,n[2]=h*-a,n[3]=g*(-c*l+d*a*o),n[4]=g*(d*l+c*a*o),n[5]=g*u*o,n[6]=m*(c*o+d*a*l),n[7]=m*(-d*o+c*a*l),n[8]=m*u*l}function Is(n){return n[0]=n[0],n[1]=n[1],n[2]=n[2],n[3]=n[4],n[4]=n[5],n[5]=n[6],n[6]=n[8],n[7]=n[9],n[8]=n[10],n[9]=n[12],n[10]=n[13],n[11]=n[14],n.subarray(0,12)}const hr={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(n,{startRow:e,endRow:t}){const{data:s,getOrientation:i,getScale:r,getTranslation:o,getTransformMatrix:a}=this.props,c=Array.isArray(a),l=c&&a.length===16,u=Array.isArray(r),d=Array.isArray(i),h=Array.isArray(o),g=l||!c&&!!a(s[0]);g?n.constant=l:n.constant=d&&u&&h;const m=n.value;if(n.constant){let A;g?(Mt.set(a),A=Is(Mt)):(A=Ms,vs(A,i,r),A.set(o,9)),n.value=new Float32Array(A)}else{let A=e*n.size;const{iterable:C,objectInfo:B}=jn(s,e,t);for(const E of C){B.index++;let T;if(g)Mt.set(l?a:a(E,B)),T=Is(Mt);else{T=Ms;const b=d?i:i(E,B),M=u?r:r(E,B);vs(T,b,M),T.set(h?o:o(E,B),9)}m[A++]=T[0],m[A++]=T[1],m[A++]=T[2],m[A++]=T[3],m[A++]=T[4],m[A++]=T[5],m[A++]=T[6],m[A++]=T[7],m[A++]=T[8],m[A++]=T[9],m[A++]=T[10],m[A++]=T[11]}}}};function fr(n,e){return e===Ke.CARTESIAN||e===Ke.METER_OFFSETS||e===Ke.DEFAULT&&!n.isGeospatial}const Jc=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,zc=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function gr(n){let e=1/0,t=1/0,s=1/0,i=-1/0,r=-1/0,o=-1/0;const a=n.POSITION?n.POSITION.value:[],c=a&&a.length;for(let l=0;l<c;l+=3){const u=a[l],d=a[l+1],h=a[l+2];e=u<e?u:e,t=d<t?d:t,s=h<s?h:s,i=u>i?u:i,r=d>r?d:r,o=h>o?h:o}return[[e,t,s],[i,r,o]]}function Kc(n,e){if(!n)throw new Error("loader assertion failed.")}class Je{constructor(e,t){f(this,"fields",void 0),f(this,"metadata",void 0),Kc(Array.isArray(e)),jc(e),this.fields=e,this.metadata=t||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let t=0;t<this.fields.length;++t)if(!this.fields[t].compareTo(e.fields[t]))return!1;return!0}select(){const e=Object.create(null);for(var t=arguments.length,s=new Array(t),i=0;i<t;i++)s[i]=arguments[i];for(const o of s)e[o]=!0;const r=this.fields.filter(o=>e[o.name]);return new Je(r,this.metadata)}selectAt(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const i=t.map(r=>this.fields[r]).filter(Boolean);return new Je(i,this.metadata)}assign(e){let t,s=this.metadata;if(e instanceof Je){const o=e;t=o.fields,s=Rs(Rs(new Map,this.metadata),o.metadata)}else t=e;const i=Object.create(null);for(const o of this.fields)i[o.name]=o;for(const o of t)i[o.name]=o;const r=Object.values(i);return new Je(r,s)}}function jc(n){const e={};for(const t of n)e[t.name]&&console.warn("Schema: duplicated field name",t.name,t),e[t.name]=!0}function Rs(n,e){return new Map([...n||new Map,...e||new Map])}class zt{constructor(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;f(this,"name",void 0),f(this,"type",void 0),f(this,"nullable",void 0),f(this,"metadata",void 0),this.name=e,this.type=t,this.nullable=s,this.metadata=i}get typeId(){return this.type&&this.type.typeId}clone(){return new zt(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let G=function(n){return n[n.NONE=0]="NONE",n[n.Null=1]="Null",n[n.Int=2]="Int",n[n.Float=3]="Float",n[n.Binary=4]="Binary",n[n.Utf8=5]="Utf8",n[n.Bool=6]="Bool",n[n.Decimal=7]="Decimal",n[n.Date=8]="Date",n[n.Time=9]="Time",n[n.Timestamp=10]="Timestamp",n[n.Interval=11]="Interval",n[n.List=12]="List",n[n.Struct=13]="Struct",n[n.Union=14]="Union",n[n.FixedSizeBinary=15]="FixedSizeBinary",n[n.FixedSizeList=16]="FixedSizeList",n[n.Map=17]="Map",n[n.Dictionary=-1]="Dictionary",n[n.Int8=-2]="Int8",n[n.Int16=-3]="Int16",n[n.Int32=-4]="Int32",n[n.Int64=-5]="Int64",n[n.Uint8=-6]="Uint8",n[n.Uint16=-7]="Uint16",n[n.Uint32=-8]="Uint32",n[n.Uint64=-9]="Uint64",n[n.Float16=-10]="Float16",n[n.Float32=-11]="Float32",n[n.Float64=-12]="Float64",n[n.DateDay=-13]="DateDay",n[n.DateMillisecond=-14]="DateMillisecond",n[n.TimestampSecond=-15]="TimestampSecond",n[n.TimestampMillisecond=-16]="TimestampMillisecond",n[n.TimestampMicrosecond=-17]="TimestampMicrosecond",n[n.TimestampNanosecond=-18]="TimestampNanosecond",n[n.TimeSecond=-19]="TimeSecond",n[n.TimeMillisecond=-20]="TimeMillisecond",n[n.TimeMicrosecond=-21]="TimeMicrosecond",n[n.TimeNanosecond=-22]="TimeNanosecond",n[n.DenseUnion=-23]="DenseUnion",n[n.SparseUnion=-24]="SparseUnion",n[n.IntervalDayTime=-25]="IntervalDayTime",n[n.IntervalYearMonth=-26]="IntervalYearMonth",n}({}),mr,pr,Ar;class $n{static isNull(e){return e&&e.typeId===G.Null}static isInt(e){return e&&e.typeId===G.Int}static isFloat(e){return e&&e.typeId===G.Float}static isBinary(e){return e&&e.typeId===G.Binary}static isUtf8(e){return e&&e.typeId===G.Utf8}static isBool(e){return e&&e.typeId===G.Bool}static isDecimal(e){return e&&e.typeId===G.Decimal}static isDate(e){return e&&e.typeId===G.Date}static isTime(e){return e&&e.typeId===G.Time}static isTimestamp(e){return e&&e.typeId===G.Timestamp}static isInterval(e){return e&&e.typeId===G.Interval}static isList(e){return e&&e.typeId===G.List}static isStruct(e){return e&&e.typeId===G.Struct}static isUnion(e){return e&&e.typeId===G.Union}static isFixedSizeBinary(e){return e&&e.typeId===G.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===G.FixedSizeList}static isMap(e){return e&&e.typeId===G.Map}static isDictionary(e){return e&&e.typeId===G.Dictionary}get typeId(){return G.NONE}compareTo(e){return this===e}}mr=Symbol.toStringTag;class $e extends $n{constructor(e,t){super(),f(this,"isSigned",void 0),f(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=t}get typeId(){return G.Int}get[mr](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class Xc extends $e{constructor(){super(!0,8)}}class Wc extends $e{constructor(){super(!0,16)}}class kc extends $e{constructor(){super(!0,32)}}class Qc extends $e{constructor(){super(!1,8)}}class qc extends $e{constructor(){super(!1,16)}}class Yc extends $e{constructor(){super(!1,32)}}const Cr={HALF:16,SINGLE:32,DOUBLE:64};pr=Symbol.toStringTag;class Br extends $n{constructor(e){super(),f(this,"precision",void 0),this.precision=e}get typeId(){return G.Float}get[pr](){return"Float"}toString(){return"Float".concat(this.precision)}}class Zc extends Br{constructor(){super(Cr.SINGLE)}}class $c extends Br{constructor(){super(Cr.DOUBLE)}}Ar=Symbol.toStringTag;class el extends $n{constructor(e,t){super(),f(this,"listSize",void 0),f(this,"children",void 0),this.listSize=e,this.children=[t]}get typeId(){return G.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[Ar](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function tl(n){switch(n.constructor){case Int8Array:return new Xc;case Uint8Array:return new Qc;case Int16Array:return new Wc;case Uint16Array:return new qc;case Int32Array:return new kc;case Uint32Array:return new Yc;case Float32Array:return new Zc;case Float64Array:return new $c;default:throw new Error("array type not supported")}}function nl(n,e,t){const s=tl(e.value),i=t||sl(e);return new zt(n,new el(e.size,new zt("value",s)),!1,i)}function sl(n){const e=new Map;return"byteOffset"in n&&e.set("byteOffset",n.byteOffset.toString(10)),"byteStride"in n&&e.set("byteStride",n.byteStride.toString(10)),"normalized"in n&&e.set("normalized",n.normalized.toString()),e}function Ps(n,e){(n.COLOR_0||n.colors)&&e||(n.colors={constant:!0,value:new Float32Array([1,1,1])}),le.assert(n.positions||n.POSITION,'no "postions" or "POSITION" attribute in mesh')}function xs(n,e){if(n.attributes)return Ps(n.attributes,e),n instanceof be?n:new be(n);if(n.positions||n.POSITION)return Ps(n,e),new be({attributes:n});throw Error("Invalid mesh")}const il=[0,0,0,255],rl={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:il},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class es extends Ze{constructor(...e){super(...e),f(this,"state",void 0)}getShaders(){const e=!Xt(this.context.gl),t={};return zn(this.context.gl,Kn.GLSL_DERIVATIVES)&&(t.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:Jc,fs:zc,modules:[mt,sr,pt],transpileToGLSL100:e,defines:t})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let t=this.state.positionBounds;if(t)return t;const{mesh:s}=this.props;if(!s)return null;if(t=(e=s.header)===null||e===void 0?void 0:e.boundingBox,!t){const{attributes:i}=xs(s,this.props._useMeshColors);i.POSITION=i.POSITION||i.positions,t=gr(i)}return this.state.positionBounds=t,t}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:hr}),this.setState({emptyTexture:new ir(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:t,oldProps:s,changeFlags:i}=e;if(t.mesh!==s.mesh||i.extensionsChanged){var r;if(this.state.positionBounds=null,(r=this.state.model)===null||r===void 0||r.delete(),t.mesh){this.state.model=this.getModel(t.mesh);const o=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==s.texture&&this.setTexture(t.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){if(!this.state.model)return;const{viewport:t}=this.context,{sizeScale:s,coordinateSystem:i,_instanced:r}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:s,composeModelMatrix:!r||fr(t,i),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var e;return((e=this.state)===null||e===void 0?void 0:e.model)&&super.isLoaded}getModel(e){const t=new xe(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:xs(e,this.props._useMeshColors),isInstanced:!0}),{texture:s}=this.props,{emptyTexture:i}=this.state;return t.setUniforms({sampler:s||i,hasTexture:!!s}),t}setTexture(e){const{emptyTexture:t,model:s}=this.state;s&&s.setUniforms({sampler:e||t,hasTexture:!!e})}}f(es,"defaultProps",rl);f(es,"layerName","SimpleMeshLayer");class Xe{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t}=e;this.id=t||Jn(this.constructor.name),this.display=!0,this.position=new p,this.rotation=new p,this.scale=new p(1,1,1),this.matrix=new F,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(e){return at(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return at(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return at(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:t,rotation:s,scale:i,update:r=!0}=e;return t&&this.setPosition(t),s&&this.setRotation(s),i&&this.setScale(i),r&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,s=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(s),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:t,rotation:s,scale:i}=e;return t&&this.setPosition(t),s&&this.setRotation(s),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,t){at(e),t=t||this.matrix;const s=new F(e).multiplyRight(t),i=s.invert(),r=i.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:s,worldInverseMatrix:i,worldInverseTransposeMatrix:r}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class lt extends Xe{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=Array.isArray(e)?{children:e}:e;const{children:t=[]}=e;Fe.assert(t.every(s=>s instanceof Xe),"every child must an instance of ScenegraphNode"),super(e),this.children=t}add(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];for(const i of t)Array.isArray(i)?this.add(...i):this.children.push(i);return this}remove(e){const t=this.children,s=t.indexOf(e);return s>-1&&t.splice(s,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((t,s)=>{let{worldMatrix:i}=s;const r=t.getBounds();if(!r)return;const[o,a]=r,c=new p(o).add(a).divide([2,2,2]);i.transformAsPoint(c,c);const l=new p(a).subtract(o).divide([2,2,2]);i.transformAsVector(l,l);for(let u=0;u<8;u++){const d=new p(u&1?-1:1,u&2?-1:1,u&4?-1:1).multiply(l).add(c);for(let h=0;h<3;h++)e[0][h]=Math.min(e[0][h],d[h]),e[1][h]=Math.max(e[1][h],d[h])}}),Number.isFinite(e[0][0])?e:null}traverse(e){let{worldMatrix:t=new F}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new F(t).multiplyRight(this.matrix);for(const i of this.children)i instanceof lt?i.traverse(e,{worldMatrix:s}):e(i,{worldMatrix:s})}}const ol={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},al={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Fs(n){if(!n._animation){const e=al[n.componentType],t=ol[n.type],s=t*n.count,{buffer:i,byteOffset:r}=n.bufferView.data,o=new e(i,r+(n.byteOffset||0),s);if(t===1)n._animation=Array.from(o);else{const a=[];for(let c=0;c<o.length;c+=t)a.push(Array.from(o.slice(c,c+t)));n._animation=a}}return n._animation}const cl=new F;function ll(n,e){if(e.matrix.identity(),n.translation&&e.matrix.translate(n.translation),n.rotation){const t=cl.fromQuaternion(n.rotation);e.matrix.multiplyRight(t)}n.scale&&e.matrix.scale(n.scale)}const cn=new dt;function ul(n,e,t,s,i){if(e==="rotation"){cn.slerp({start:t,target:s,ratio:i});for(let r=0;r<cn.length;r++)n[e][r]=cn[r]}else for(let r=0;r<t.length;r++)n[e][r]=i*s[r]+(1-i)*t[r]}function dl(n,e,t){let{p0:s,outTangent0:i,inTangent1:r,p1:o,tDiff:a,ratio:c}=t;for(let l=0;l<n[e].length;l++){const u=i[l]*a,d=r[l]*a;n[e][l]=(2*Math.pow(c,3)-3*Math.pow(c,2)+1)*s[l]+(Math.pow(c,3)-2*Math.pow(c,2)+c)*u+(-2*Math.pow(c,3)+3*Math.pow(c,2))*o[l]+(Math.pow(c,3)-Math.pow(c,2))*d}}function hl(n,e,t){for(let s=0;s<t.length;s++)n[e][s]=t[s]}function fl(n,e,t,s){let{input:i,interpolation:r,output:o}=e;const a=i[i.length-1],c=n%a,l=i.findIndex(g=>g>=c),u=Math.max(0,l-1);if(!Array.isArray(t[s]))switch(s){case"translation":t[s]=[0,0,0];break;case"rotation":t[s]=[0,0,0,1];break;case"scale":t[s]=[1,1,1];break;default:Fe.warn("Bad animation path ".concat(s))()}at(t[s].length===o[u].length);const d=i[u],h=i[l];switch(r){case"STEP":hl(t,s,o[u]);break;case"LINEAR":if(h>d){const g=(c-d)/(h-d);ul(t,s,o[u],o[l],g)}break;case"CUBICSPLINE":if(h>d){const g=(c-d)/(h-d),m=h-d,A=o[3*u+1],C=o[3*u+2],B=o[3*l+0],E=o[3*l+1];dl(t,s,{p0:A,outTangent0:C,inTangent1:B,p1:E,tDiff:m,ratio:g})}break;default:Fe.warn("Interpolation ".concat(r," not supported"))();break}}class gl{constructor(e){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}animate(e){if(!this.playing)return;const s=(e/1e3-this.startTime)*this.speed;this.channels.forEach(i=>{let{sampler:r,target:o,path:a}=i;fl(s,r,o,a),ll(o,o._node)})}}class ml{constructor(e){this.animations=e.animations.map((t,s)=>{const i=t.name||"Animation-".concat(s),r=t.samplers.map(a=>{let{input:c,interpolation:l="LINEAR",output:u}=a;return{input:Fs(e.accessors[c]),interpolation:l,output:Fs(e.accessors[u])}}),o=t.channels.map(a=>{let{sampler:c,target:l}=a;return{sampler:r[c],target:e.nodes[l.node],path:l.path}});return new gl({name:i,channels:o})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}class pl extends Xe{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t),this.onBeforeRender=null,this.AfterRender=null,e instanceof xe?(this.model=e,this._setModelNodeProps(t)):this.model=new xe(e,t),this.bounds=null,this.managedResources=t.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(e){this.model.setProps(e)}}class _r{constructor(e,t){let{attributes:s,material:i,pbrDebug:r,imageBasedLightingEnvironment:o,lights:a,useTangents:c}=t;this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},zn(e,Kn.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],o&&(this.uniforms.u_DiffuseEnvSampler=o.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=o.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=o.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),r&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(s.NORMAL,"HAS_NORMALS"),this.defineIfPresent(s.TANGENT&&c,"HAS_TANGENTS"),this.defineIfPresent(s.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(o,"USE_IBL"),this.defineIfPresent(a,"USE_LIGHTS"),this.defineIfPresent(r,"PBR_DEBUG"),i&&this.parseMaterial(i)}defineIfPresent(e,t){e&&(this.defines[t]=1)}parseTexture(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const i=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},r=e.texture.source.image;let o,a={};r.compressed?(o=r,a={[this.gl.TEXTURE_MIN_FILTER]:r.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):o={data:r};const c=new ir(this.gl,{id:e.name||e.id,parameters:{...i,...a},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...o});this.uniforms[t]=c,this.defineIfPresent(s,s),this.generatedTextures.push(c)}parsePbrMetallicRoughness(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:t=1,roughnessFactor:s=1}=e;this.uniforms.u_MetallicRoughnessValues=[t,s]}parseMaterial(e){if(this.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:t=1}=e.normalTexture;this.uniforms.u_NormalScale=t}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:t=1}=e.occlusionTexture;this.uniforms.u_OcclusionStrength=t}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){const{alphaCutoff:t=.5}=e;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=t}else e.alphaMode==="BLEND"&&(Fe.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(e=>e.delete())}}const Al=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,Cl=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function Ds(n,e){return Xt(n)?`#version 300 es
`.concat(e):e}function Bl(n,e){const{id:t,drawMode:s,vertexCount:i,attributes:r,modelOptions:o}=e,a=new _r(n,e);Fe.info(4,"createGLTFModel defines: ",a.defines)();const c=[];c.push(...a.generatedTextures),c.push(...Object.values(r).map(u=>u.buffer));const l=new pl(n,{id:t,drawMode:s,vertexCount:i,modules:[Qn],parameters:a.parameters,vs:Ds(n,Al),fs:Ds(n,Cl),managedResources:c,...o,defines:{...a.defines,...o.defines}});return l.setProps({attributes:r}),l.setUniforms(a.uniforms),l}const _l={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},yl={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class El{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.options=Object.assign({},yl,t)}instantiate(e){return this.gltf=e,(e.scenes||[]).map(s=>this.createScene(s))}createAnimator(){return Array.isArray(this.gltf.animations)?new ml(this.gltf):null}createScene(e){const s=(e.nodes||[]).map(r=>this.createNode(r));return new lt({id:e.name||e.id,children:s})}createNode(e){if(!e._node){const s=(e.children||[]).map(r=>this.createNode(r));e.mesh&&s.push(this.createMesh(e.mesh));const i=new lt({id:e.name||e.id,children:s});if(e.matrix)i.setMatrix(e.matrix);else{if(i.matrix.identity(),e.translation&&i.matrix.translate(e.translation),e.rotation){const r=new F().fromQuaternion(e.rotation);i.matrix.multiplyRight(r)}e.scale&&i.matrix.scale(e.scale)}e._node=i}return e._node}createMesh(e){if(!e._mesh){const s=(e.primitives||[]).map((r,o)=>this.createPrimitive(r,o,e)),i=new lt({id:e.name||e.id,children:s});e._mesh=i}return e._mesh}getVertexCount(e){Fe.warn("getVertexCount() not found")()}createPrimitive(e,t,s){const i=Bl(this.gl,Object.assign({id:e.name||"".concat(s.name||s.id,"-primitive-").concat(t),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options));return i.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],i}createAttributes(e,t){const s={};return Object.keys(e).forEach(i=>{s[i]=this.createAccessor(e[i],this.createBuffer(e[i],this.gl.ARRAY_BUFFER))}),t&&(s.indices=this.createAccessor(t,this.createBuffer(t,this.gl.ELEMENT_ARRAY_BUFFER))),Fe.info(4,"glTF Attributes",{attributes:e,indices:t,generated:s})(),s}createBuffer(e,t){e.bufferView||(e.bufferView={});const{bufferView:s}=e;return s.lumaBuffers||(s.lumaBuffers={}),s.lumaBuffers[t]||(s.lumaBuffers[t]=new sa(this.gl,{id:"from-".concat(s.id),data:s.data||e.value,target:t})),s.lumaBuffers[t]}createAccessor(e,t){return new ia({buffer:t,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:_l[e.type]})}createSampler(e){return e}needsPOT(){return!1}}function Tl(n,e,t){const s=new El(n,t),i=s.instantiate(e),r=s.createAnimator();return{scenes:i,animator:r}}const bl="3.4.15",Sl="3.4.15",yr="3.4.15",Ml="https://unpkg.com/@loaders.gl/textures@".concat(yr,"/dist/libs/basis_encoder.wasm"),vl="https://unpkg.com/@loaders.gl/textures@".concat(yr,"/dist/libs/basis_encoder.js");let ln;async function Os(n){const e=n.modules||{};return e.basis?e.basis:(ln=ln||Il(n),await ln)}async function Il(n){let e=null,t=null;return[e,t]=await Promise.all([await Pe("basis_transcoder.js","textures",n),await Pe("basis_transcoder.wasm","textures",n)]),e=e||globalThis.BASIS,await Rl(e,t)}function Rl(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(s=>{n(t).then(i=>{const{BasisFile:r,initializeBasis:o}=i;o(),s({BasisFile:r})})})}let un;async function Ls(n){const e=n.modules||{};return e.basisEncoder?e.basisEncoder:(un=un||Pl(n),await un)}async function Pl(n){let e=null,t=null;return[e,t]=await Promise.all([await Pe(vl,"textures",n),await Pe(Ml,"textures",n)]),e=e||globalThis.BASIS,await xl(e,t)}function xl(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(s=>{n(t).then(i=>{const{BasisFile:r,KTX2File:o,initializeBasis:a,BasisEncoder:c}=i;a(),s({BasisFile:r,KTX2File:o,BasisEncoder:c})})})}const we={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},Fl=["","WEBKIT_","MOZ_"],ws={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let vt=null;function Dl(n){if(!vt){n=n||Ol()||void 0,vt=new Set;for(const e of Fl)for(const t in ws)if(n&&n.getExtension("".concat(e).concat(t))){const s=ws[t];vt.add(s)}}return vt}function Ol(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var Gs,Us,Ns,Hs,Vs,Js,zs,Ks;(function(n){n[n.NONE=0]="NONE",n[n.BASISLZ=1]="BASISLZ",n[n.ZSTD=2]="ZSTD",n[n.ZLIB=3]="ZLIB"})(Gs||(Gs={})),function(n){n[n.BASICFORMAT=0]="BASICFORMAT"}(Us||(Us={})),function(n){n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.ETC1S=163]="ETC1S",n[n.UASTC=166]="UASTC"}(Ns||(Ns={})),function(n){n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.SRGB=1]="SRGB"}(Hs||(Hs={})),function(n){n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.LINEAR=1]="LINEAR",n[n.SRGB=2]="SRGB",n[n.ITU=3]="ITU",n[n.NTSC=4]="NTSC",n[n.SLOG=5]="SLOG",n[n.SLOG2=6]="SLOG2"}(Vs||(Vs={})),function(n){n[n.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",n[n.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(Js||(Js={})),function(n){n[n.RGB=0]="RGB",n[n.RRR=3]="RRR",n[n.GGG=4]="GGG",n[n.AAA=15]="AAA"}(zs||(zs={})),function(n){n[n.RGB=0]="RGB",n[n.RGBA=3]="RGBA",n[n.RRR=4]="RRR",n[n.RRRG=5]="RRRG"}(Ks||(Ks={}));const X=[171,75,84,88,32,50,48,187,13,10,26,10];function Ll(n){const e=new Uint8Array(n);return!(e.byteLength<X.length||e[0]!==X[0]||e[1]!==X[1]||e[2]!==X[2]||e[3]!==X[3]||e[4]!==X[4]||e[5]!==X[5]||e[6]!==X[6]||e[7]!==X[7]||e[8]!==X[8]||e[9]!==X[9]||e[10]!==X[10]||e[11]!==X[11])}const wl={etc1:{basisFormat:0,compressed:!0,format:we.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:we.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:we.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:we.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:we.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:we.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function Gl(n,e){if(e.basis.containerFormat==="auto"){if(Ll(n)){const s=await Ls(e);return js(s.KTX2File,n,e)}const{BasisFile:t}=await Os(e);return dn(t,n,e)}switch(e.basis.module){case"encoder":const t=await Ls(e);switch(e.basis.containerFormat){case"ktx2":return js(t.KTX2File,n,e);case"basis":default:return dn(t.BasisFile,n,e)}case"transcoder":default:const{BasisFile:s}=await Os(e);return dn(s,n,e)}}function dn(n,e,t){const s=new n(new Uint8Array(e));try{if(!s.startTranscoding())throw new Error("Failed to start basis transcoding");const i=s.getNumImages(),r=[];for(let o=0;o<i;o++){const a=s.getNumLevels(o),c=[];for(let l=0;l<a;l++)c.push(Ul(s,o,l,t));r.push(c)}return r}finally{s.close(),s.delete()}}function Ul(n,e,t,s){const i=n.getImageWidth(e,t),r=n.getImageHeight(e,t),o=n.getHasAlpha(),{compressed:a,format:c,basisFormat:l}=Er(s,o),u=n.getImageTranscodedSizeInBytes(e,t,l),d=new Uint8Array(u);if(!n.transcodeImage(d,e,t,l,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:r,data:d,compressed:a,format:c,hasAlpha:o}}function js(n,e,t){const s=new n(new Uint8Array(e));try{if(!s.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=s.getLevels(),r=[];for(let o=0;o<i;o++){r.push(Nl(s,o,t));break}return[r]}finally{s.close(),s.delete()}}function Nl(n,e,t){const{alphaFlag:s,height:i,width:r}=n.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:c}=Er(t,s),l=n.getImageTranscodedSizeInBytes(e,0,0,c),u=new Uint8Array(l);if(!n.transcodeImage(u,e,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:r,height:i,data:u,compressed:o,levelSize:l,hasAlpha:s,format:a}}function Er(n,e){let t=n&&n.basis&&n.basis.format;return t==="auto"&&(t=Tr()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),wl[t]}function Tr(){const n=Dl();return n.has("astc")?"astc-4x4":n.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:n.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:n.has("etc1")?"etc1":n.has("etc2")?"etc2":"rgb565"}const Hl={name:"Basis",id:gt?"basis":"basis-nodejs",module:"textures",version:Sl,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},Vl={...Hl,parse:Gl};function Q(n,e){if(!n)throw new Error(e||"assert failed: gltf")}function br(n,e){if(n.startsWith("data:")||n.startsWith("http:")||n.startsWith("https:"))return n;const s=e.baseUri||e.uri;if(!s)throw new Error("'baseUri' must be provided to resolve relative url ".concat(n));return s.substr(0,s.lastIndexOf("/")+1)+n}function Jl(n,e,t){const s=n.bufferViews[t];Q(s);const i=s.buffer,r=e[i];Q(r);const o=(s.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,o,s.byteLength)}const Xs=["SCALAR","VEC2","VEC3","VEC4"],zl=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Kl=new Map(zl),jl={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Xl={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Wl={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Sr(n){return Xs[n-1]||Xs[0]}function Mr(n){const e=Kl.get(n.constructor);if(!e)throw new Error("Illegal typed array");return e}function ts(n,e){const t=Wl[n.componentType],s=jl[n.type],i=Xl[n.componentType],r=n.count*s,o=n.count*s*i;return Q(o>=0&&o<=e.byteLength),{ArrayType:t,length:r,byteLength:o}}function vr(n){let{images:e,bufferViews:t}=n;e=e||[],t=t||[];const s=e.map(o=>o.bufferView);t=t.filter(o=>!s.includes(o));const i=t.reduce((o,a)=>o+a.byteLength,0),r=e.reduce((o,a)=>{const{width:c,height:l}=a.image;return o+c*l},0);return i+Math.ceil(4*r*1.33)}const kl={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class j{constructor(e){f(this,"gltf",void 0),f(this,"sourceBuffers",void 0),f(this,"byteLength",void 0),this.gltf=e||{json:{...kl},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const t=this.getUsedExtensions().find(i=>i===e),s=this.json.extensions||{};return t?s[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(s=>s===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const s=this.json[e]&&this.json[e][t];if(!s)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return s}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,s=this.gltf.buffers[t];Q(s);const i=(e.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,{ArrayType:r,length:o}=ts(e,t),a=t.byteOffset+e.byteOffset;return new r(i,a,o)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,r=t.byteOffset||0;return new Uint8Array(i,r,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,s){return e.extensions=e.extensions||{},e.extensions[t]=s,this.registerUsedExtension(t),this}setObjectExtension(e,t,s){const i=e.extensions||{};i[t]=s}removeObjectExtension(e,t){const s=e.extensions||{},i=s[t];return delete s[t],i}addExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Q(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Q(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(!this.getExtension(e))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:s}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return s&&(i.matrix=s),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:s,material:i,mode:r=4}=e,a={primitives:[{attributes:this._addAttributes(t),mode:r}]};if(s){const c=this._addIndices(s);a.primitives[0].indices=c}return Number.isFinite(i)&&(a.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(e){const s={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addImage(e,t){const s=ra(e),i=t||(s==null?void 0:s.mimeType),o={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(e){const t=e.byteLength;Q(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const s={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=Ct(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(e,t){const s={bufferView:e,type:Sr(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(s),this.json.accessors.length-1}addBinaryBuffer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const s=this.addBufferView(e);let i={min:t.min,max:t.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,t.size));const r={size:t.size,componentType:Mr(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(s,Object.assign(r,t))}addTexture(e){const{imageIndex:t}=e,s={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(s),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];const s=this.byteLength,i=new ArrayBuffer(s),r=new Uint8Array(i);let o=0;for(const a of this.sourceBuffers||[])o=Ma(a,r,o);(e=this.json)!==null&&e!==void 0&&(t=e.buffers)!==null&&t!==void 0&&t[0]?this.json.buffers[0].byteLength=s:this.json.buffers=[{byteLength:s}],this.gltf.binary=i,this.sourceBuffers=[i]}_removeStringFromArray(e,t){let s=!0;for(;s;){const i=e.indexOf(t);i>-1?e.splice(i,1):s=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={};for(const s in e){const i=e[s],r=this._getGltfAttributeName(s),o=this.addBinaryBuffer(i.value,i);t[r]=o}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const s={min:null,max:null};if(e.length<t)return s;s.min=[],s.max=[];const i=e.subarray(0,t);for(const r of i)s.min.push(r),s.max.push(r);for(let r=t;r<e.length;r+=t)for(let o=0;o<t;o++)s.min[0+o]=Math.min(s.min[0+o],e[r+o]),s.max[0+o]=Math.max(s.max[0+o],e[r+o]);return s}}const Ql="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",ql="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",Yl=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Zl=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),$l={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},eu={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function tu(n,e,t,s,i){let r=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const o=await nu();ru(o,o.exports[eu[i]],n,e,t,s,o.exports[$l[r||"NONE"]])}let hn;async function nu(){return hn||(hn=su()),hn}async function su(){let n=Ql;WebAssembly.validate(Yl)&&(n=ql,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(iu(n),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function iu(n){const e=new Uint8Array(n.length);for(let s=0;s<n.length;++s){const i=n.charCodeAt(s);e[s]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let t=0;for(let s=0;s<n.length;++s)e[t++]=e[s]<60?Zl[e[s]]:(e[s]-60)*64+e[++s];return e.buffer.slice(0,t)}function ru(n,e,t,s,i,r,o){const a=n.exports.sbrk,c=s+3&-4,l=a(c*i),u=a(r.length),d=new Uint8Array(n.exports.memory.buffer);d.set(r,u);const h=e(l,s,i,u,r.length);if(h===0&&o&&o(l,c,i),t.set(d.subarray(l,l+s*i)),a(l-a(0)),h!==0)throw new Error("Malformed buffer data: ".concat(h))}const ns="EXT_meshopt_compression",ou=ns;async function au(n,e){var t;const s=new j(n);if(!(e!=null&&(t=e.gltf)!==null&&t!==void 0&&t.decompressMeshes))return;const i=[];for(const r of n.json.bufferViews||[])i.push(cu(s,r));await Promise.all(i),s.removeExtension(ns)}async function cu(n,e){const t=n.getObjectExtension(e,ns);if(t){const{byteOffset:s=0,byteLength:i=0,byteStride:r,count:o,mode:a,filter:c="NONE",buffer:l}=t,u=n.gltf.buffers[l],d=new Uint8Array(u.arrayBuffer,u.byteOffset+s,i),h=new Uint8Array(n.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await tu(h,o,r,d,a,c),h}return null}const lu=Object.freeze(Object.defineProperty({__proto__:null,decode:au,name:ou},Symbol.toStringTag,{value:"Module"})),He="EXT_texture_webp",uu=He;function du(n,e){const t=new j(n);if(!Oa("image/webp")){if(t.getRequiredExtensions().includes(He))throw new Error("gltf: Required extension ".concat(He," not supported by browser"));return}const{json:s}=t;for(const i of s.textures||[]){const r=t.getObjectExtension(i,He);r&&(i.source=r.source),t.removeObjectExtension(i,He)}t.removeExtension(He)}const hu=Object.freeze(Object.defineProperty({__proto__:null,name:uu,preprocess:du},Symbol.toStringTag,{value:"Module"})),Ut="KHR_texture_basisu",fu=Ut;function gu(n,e){const t=new j(n),{json:s}=t;for(const i of s.textures||[]){const r=t.getObjectExtension(i,Ut);r&&(i.source=r.source),t.removeObjectExtension(i,Ut)}t.removeExtension(Ut)}const mu=Object.freeze(Object.defineProperty({__proto__:null,name:fu,preprocess:gu},Symbol.toStringTag,{value:"Module"})),pu="3.4.15",Au={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},Cu={name:"Draco",id:gt?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:pu,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:Au};function Bu(n,e,t){const s=Ir(e.metadata),i=[],r=_u(e.attributes);for(const o in n){const a=n[o],c=Ws(o,a,r[o]);i.push(c)}if(t){const o=Ws("indices",t);i.push(o)}return new Je(i,s)}function _u(n){const e={};for(const t in n){const s=n[t];e[s.name||"undefined"]=s}return e}function Ws(n,e,t){const s=t?Ir(t.metadata):void 0;return nl(n,e,s)}function Ir(n){const e=new Map;for(const t in n)e.set("".concat(t,".string"),JSON.stringify(n[t]));return e}const ks={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},yu={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Eu=4;class Tu{constructor(e){f(this,"draco",void 0),f(this,"decoder",void 0),f(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new this.draco.DecoderBuffer;s.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(s),r=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(i){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(s,r);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(s,r);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!r.ptr){const h="DRACO decompression failed: ".concat(o.error_msg());throw new Error(h)}const a=this._getDracoLoaderData(r,i,t),c=this._getMeshData(r,a,t),l=gr(c.attributes),u=Bu(c.attributes,a,c.indices);return{loader:"draco",loaderData:a,header:{vertexCount:r.num_points(),boundingBox:l},...c,schema:u}}finally{this.draco.destroy(s),r&&this.draco.destroy(r)}}_getDracoLoaderData(e,t,s){const i=this._getTopLevelMetadata(e),r=this._getDracoAttributes(e,s);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:r}}_getDracoAttributes(e,t){const s={};for(let i=0;i<e.num_attributes();i++){const r=this.decoder.GetAttribute(e,i),o=this._getAttributeMetadata(e,i);s[r.unique_id()]={unique_id:r.unique_id(),attribute_type:r.attribute_type(),data_type:r.data_type(),num_components:r.num_components(),byte_offset:r.byte_offset(),byte_stride:r.byte_stride(),normalized:r.normalized(),attribute_index:i,metadata:o};const a=this._getQuantizationTransform(r,t);a&&(s[r.unique_id()].quantization_transform=a);const c=this._getOctahedronTransform(r,t);c&&(s[r.unique_id()].octahedron_transform=c)}return s}_getMeshData(e,t,s){const i=this._getMeshAttributes(t,e,s);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(s.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,s){const i={};for(const r of Object.values(e.attributes)){const o=this._deduceAttributeName(r,s);r.name=o;const{value:a,size:c}=this._getAttributeValues(t,r);i[o]={value:a,size:c,byteOffset:r.byte_offset,byteStride:r.byte_stride,normalized:r.normalized}}return i}_getTriangleListIndices(e){const s=e.num_faces()*3,i=s*Eu,r=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,r),new Uint32Array(this.draco.HEAPF32.buffer,r,s).slice()}finally{this.draco._free(r)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),Mu(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const s=yu[t.data_type],i=t.num_components,o=e.num_points()*i,a=o*s.BYTES_PER_ELEMENT,c=bu(this.draco,s);let l;const u=this.draco._malloc(a);try{const d=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,d,c,a,u),l=new s(this.draco.HEAPF32.buffer,u,o).slice()}finally{this.draco._free(u)}return{value:l,size:i}}_deduceAttributeName(e,t){const s=e.unique_id;for(const[o,a]of Object.entries(t.extraAttributes||{}))if(a===s)return o;const i=e.attribute_type;for(const o in ks)if(this.draco[o]===i)return ks[o];const r=t.attributeNameEntry||"name";return e.metadata[r]?e.metadata[r].string:"CUSTOM_ATTRIBUTE_".concat(s)}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const s=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(s)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},s=this.metadataQuerier.NumEntries(e);for(let i=0;i<s;i++){const r=this.metadataQuerier.GetEntryName(e,i);t[r]=this._getDracoMetadataField(e,r)}return t}_getDracoMetadataField(e,t){const s=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,s);const i=Su(s);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(s)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:s=[]}=e,i=[...t,...s];for(const r of i)this.decoder.SkipAttributeTransform(this.draco[r])}_getQuantizationTransform(e,t){const{quantizedAttributes:s=[]}=t,i=e.attribute_type();if(s.map(o=>this.decoder[o]).includes(i)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:s=[]}=t,i=e.attribute_type();if(s.map(o=>this.decoder[o]).includes(i)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function bu(n,e){switch(e){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32;default:return n.DT_INVALID}}function Su(n){const e=n.size(),t=new Int32Array(e);for(let s=0;s<e;s++)t[s]=n.GetValue(s);return t}function Mu(n){const e=n.size(),t=new Int32Array(e);for(let s=0;s<e;s++)t[s]=n.GetValue(s);return t}const vu="1.5.5",ss="https://www.gstatic.com/draco/versioned/decoders/".concat(vu),Iu="".concat(ss,"/draco_decoder.js"),Ru="".concat(ss,"/draco_wasm_wrapper.js"),Pu="".concat(ss,"/draco_decoder.wasm");let tt;async function xu(n){const e=n.modules||{};return e.draco3d?tt=tt||e.draco3d.createDecoderModule({}).then(t=>({draco:t})):tt=tt||Fu(n),await tt}async function Fu(n){let e,t;switch(n.draco&&n.draco.decoderType){case"js":e=await Pe(Iu,"draco",n);break;case"wasm":default:[e,t]=await Promise.all([await Pe(Ru,"draco",n),await Pe(Pu,"draco",n)])}return e=e||globalThis.DracoDecoderModule,await Du(e,t)}function Du(n,e){const t={};return e&&(t.wasmBinary=e),new Promise(s=>{n({...t,onModuleLoaded:i=>s({draco:i})})})}const Rr={...Cu,parse:Ou};async function Ou(n,e){const{draco:t}=await xu(e),s=new Tu(t);try{return s.parseSync(n,e==null?void 0:e.draco)}finally{s.destroy()}}function Lu(n){const e={};for(const t in n){const s=n[t];if(t!=="indices"){const i=Pr(s);e[t]=i}}return e}function Pr(n){const{buffer:e,size:t,count:s}=wu(n);return{value:e,size:t,byteOffset:0,count:s,type:Sr(t),componentType:Mr(e)}}function wu(n){let e=n,t=1,s=0;return n&&n.value&&(e=n.value,t=n.size||1),e&&(ArrayBuffer.isView(e)||(e=Gu(e,Float32Array)),s=e.length/t),{buffer:e,size:t,count:s}}function Gu(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return n?Array.isArray(n)?new e(n):t&&!(n instanceof e)?new e(n):n:null}const De="KHR_draco_mesh_compression",Uu=De;function Nu(n,e,t){const s=new j(n);for(const i of xr(s))s.getObjectExtension(i,De)}async function Hu(n,e,t){var s;if(!(e!=null&&(s=e.gltf)!==null&&s!==void 0&&s.decompressMeshes))return;const i=new j(n),r=[];for(const o of xr(i))i.getObjectExtension(o,De)&&r.push(Ju(i,o,e,t));await Promise.all(r),i.removeExtension(De)}function Vu(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new j(n);for(const s of t.json.meshes||[])zu(s,e),t.addRequiredExtension(De)}async function Ju(n,e,t,s){const i=n.getObjectExtension(e,De);if(!i)return;const r=n.getTypedArrayForBufferView(i.bufferView),o=Xn(r.buffer,r.byteOffset),{parse:a}=s,c={...t};delete c["3d-tiles"];const l=await a(o,Rr,c,s),u=Lu(l.attributes);for(const[d,h]of Object.entries(u))if(d in e.attributes){const g=e.attributes[d],m=n.getAccessor(g);m!=null&&m.min&&m!==null&&m!==void 0&&m.max&&(h.min=m.min,h.max=m.max)}e.attributes=u,l.indices&&(e.indices=Pr(l.indices)),Ku(e)}function zu(n,e){var t;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=i.DracoWriter.encodeSync({attributes:n}),a=r==null||(t=r.parseSync)===null||t===void 0?void 0:t.call(r,{attributes:n}),c=i._addFauxAttributes(a.attributes),l=i.addBufferView(o);return{primitives:[{attributes:c,mode:s,extensions:{[De]:{bufferView:l,attributes:c}}}]}}function Ku(n){if(!n.attributes&&Object.keys(n.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*xr(n){for(const e of n.json.meshes||[])for(const t of e.primitives)yield t}const ju=Object.freeze(Object.defineProperty({__proto__:null,decode:Hu,encode:Vu,name:Uu,preprocess:Nu},Symbol.toStringTag,{value:"Module"})),Xu={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Wu={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},is="KHR_texture_transform",ku=is,It=new p,Qu=new U,qu=new U;async function Yu(n,e){if(!new j(n).getExtension(is))return;const i=n.json.materials||[];for(let r=0;r<i.length;r++)Zu(r,n)}function Zu(n,e){var t,s,i;const r=[],o=(t=e.json.materials)===null||t===void 0?void 0:t[n],a=o==null||(s=o.pbrMetallicRoughness)===null||s===void 0?void 0:s.baseColorTexture;a&&nt(e,n,a,r);const c=o==null?void 0:o.emissiveTexture;c&&nt(e,n,c,r);const l=o==null?void 0:o.normalTexture;l&&nt(e,n,l,r);const u=o==null?void 0:o.occlusionTexture;u&&nt(e,n,u,r);const d=o==null||(i=o.pbrMetallicRoughness)===null||i===void 0?void 0:i.metallicRoughnessTexture;d&&nt(e,n,d,r)}function nt(n,e,t,s){const i=$u(t,s);if(!i)return;const r=n.json.meshes||[];for(const o of r)for(const a of o.primitives){const c=a.material;Number.isFinite(c)&&e===c&&ed(n,a,i)}}function $u(n,e){var t;const s=(t=n.extensions)===null||t===void 0?void 0:t[is],{texCoord:i=0}=n,{texCoord:r=i}=s;if(!(e.findIndex(a=>{let[c,l]=a;return c===i&&l===r})!==-1)){const a=sd(s);return i!==r&&(n.texCoord=r),e.push([i,r]),{originalTexCoord:i,texCoord:r,matrix:a}}return null}function ed(n,e,t){const{originalTexCoord:s,texCoord:i,matrix:r}=t,o=e.attributes["TEXCOORD_".concat(s)];if(Number.isFinite(o)){var a;const l=(a=n.json.accessors)===null||a===void 0?void 0:a[o];if(l&&l.bufferView){var c;const u=(c=n.json.bufferViews)===null||c===void 0?void 0:c[l.bufferView];if(u){const{arrayBuffer:d,byteOffset:h}=n.buffers[u.buffer],g=(h||0)+(l.byteOffset||0)+(u.byteOffset||0),{ArrayType:m,length:A}=ts(l,u),C=Wu[l.componentType],B=Xu[l.type],E=u.byteStride||C*B,T=new Float32Array(A);for(let b=0;b<l.count;b++){const M=new m(d,g+b*E,2);It.set(M[0],M[1],1),It.transformByMatrix3(r),T.set([It[0],It[1]],b*B)}s===i?td(l,u,n.buffers,T):nd(i,l,e,n,T)}}}}function td(n,e,t,s){n.componentType=5126,t.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=s.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function nd(n,e,t,s,i){s.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const r=s.json.bufferViews;if(!r)return;r.push({buffer:s.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const o=s.json.accessors;o&&(o.push({bufferView:(r==null?void 0:r.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes["TEXCOORD_".concat(n)]=o.length-1)}function sd(n){const{offset:e=[0,0],rotation:t=0,scale:s=[1,1]}=n,i=new U().set(1,0,0,0,1,0,e[0],e[1],1),r=Qu.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),o=qu.set(s[0],0,0,0,s[1],0,0,0,1);return i.multiplyRight(r).multiplyRight(o)}const id=Object.freeze(Object.defineProperty({__proto__:null,decode:Yu,name:ku},Symbol.toStringTag,{value:"Module"})),Re="KHR_lights_punctual",rd=Re;async function od(n){const e=new j(n),{json:t}=e,s=e.getExtension(Re);s&&(e.json.lights=s.lights,e.removeExtension(Re));for(const i of t.nodes||[]){const r=e.getObjectExtension(i,Re);r&&(i.light=r.light),e.removeObjectExtension(i,Re)}}async function ad(n){const e=new j(n),{json:t}=e;if(t.lights){const s=e.addExtension(Re);Q(!s.lights),s.lights=t.lights,delete t.lights}if(e.json.lights){for(const s of e.json.lights){const i=s.node;e.addObjectExtension(i,Re,s)}delete e.json.lights}}const cd=Object.freeze(Object.defineProperty({__proto__:null,decode:od,encode:ad,name:rd},Symbol.toStringTag,{value:"Module"})),ft="KHR_materials_unlit",ld=ft;async function ud(n){const e=new j(n),{json:t}=e;for(const s of t.materials||[])s.extensions&&s.extensions.KHR_materials_unlit&&(s.unlit=!0),e.removeObjectExtension(s,ft);e.removeExtension(ft)}function dd(n){const e=new j(n),{json:t}=e;if(e.materials)for(const s of t.materials||[])s.unlit&&(delete s.unlit,e.addObjectExtension(s,ft,{}),e.addExtension(ft))}const hd=Object.freeze(Object.defineProperty({__proto__:null,decode:ud,encode:dd,name:ld},Symbol.toStringTag,{value:"Module"})),ct="KHR_techniques_webgl",fd=ct;async function gd(n){const e=new j(n),{json:t}=e,s=e.getExtension(ct);if(s){const i=pd(s,e);for(const r of t.materials||[]){const o=e.getObjectExtension(r,ct);o&&(r.technique=Object.assign({},o,i[o.technique]),r.technique.values=Ad(r.technique,e)),e.removeObjectExtension(r,ct)}e.removeExtension(ct)}}async function md(n,e){}function pd(n,e){const{programs:t=[],shaders:s=[],techniques:i=[]}=n,r=new TextDecoder;return s.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=r.decode(e.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(o=>{o.fragmentShader=s[o.fragmentShader],o.vertexShader=s[o.vertexShader]}),i.forEach(o=>{o.program=t[o.program]}),i}function Ad(n,e){const t=Object.assign({},n.values);return Object.keys(n.uniforms||{}).forEach(s=>{n.uniforms[s].value&&!(s in t)&&(t[s]=n.uniforms[s].value)}),Object.keys(t).forEach(s=>{typeof t[s]=="object"&&t[s].index!==void 0&&(t[s].texture=e.getTexture(t[s].index))}),t}const Cd=Object.freeze(Object.defineProperty({__proto__:null,decode:gd,encode:md,name:fd},Symbol.toStringTag,{value:"Module"})),Fr="EXT_feature_metadata",Bd=Fr;async function _d(n){const e=new j(n);yd(e)}function yd(n){var e;const t=n.getExtension(Fr),s=t==null||(e=t.schema)===null||e===void 0?void 0:e.classes,i=t==null?void 0:t.featureTables;if((t==null?void 0:t.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),s&&i)for(const o in s){const a=s[o],c=bd(i,o);c&&Ed(n,c,a)}}function Ed(n,e,t){for(const i in t.properties){var s;const r=t.properties[i],o=e==null||(s=e.properties)===null||s===void 0?void 0:s[i],a=e.count;if(o){const c=Td(n,r,a,o);o.data=c}}}function Td(n,e,t,s){const i=s.bufferView;let r=n.getTypedArrayForBufferView(i);switch(e.type){case"STRING":{const o=s.stringOffsetBufferView,a=n.getTypedArrayForBufferView(o);r=Sd(r,a,t);break}}return r}function bd(n,e){for(const t in n){const s=n[t];if(s.class===e)return s}return null}function Sd(n,e,t){const s=[],i=new TextDecoder("utf8");let r=0;const o=4;for(let a=0;a<t;a++){const c=e[(a+1)*o]-e[a*o],l=n.subarray(r,c+r),u=i.decode(l);s.push(u),r+=c}return s}const Md=Object.freeze(Object.defineProperty({__proto__:null,decode:_d,name:Bd},Symbol.toStringTag,{value:"Module"})),Dr=[lu,hu,mu,ju,cd,hd,Cd,id,Md];function vd(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const s=Dr.filter(r=>Or(r.name,e));for(const r of s){var i;(i=r.preprocess)===null||i===void 0||i.call(r,n,e,t)}}async function Id(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const s=Dr.filter(r=>Or(r.name,e));for(const r of s){var i;await((i=r.decode)===null||i===void 0?void 0:i.call(r,n,e,t))}}function Or(n,e){var t;const s=(e==null||(t=e.gltf)===null||t===void 0?void 0:t.excludeExtensions)||{};return!(n in s&&!s[n])}const fn="KHR_binary_glTF";function Rd(n){const e=new j(n),{json:t}=e;for(const s of t.images||[]){const i=e.getObjectExtension(s,fn);i&&Object.assign(s,i),e.removeObjectExtension(s,fn)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(fn)}const Qs={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Pd={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class xd{constructor(){f(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),f(this,"json",void 0)}normalize(e,t){this.json=e.json;const s=e.json;switch(s.asset&&s.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(s.asset.version));return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(s),this._convertTopLevelObjectsToArrays(s),Rd(e),this._convertObjectIdsToArrayIndices(s),this._updateObjects(s),this._updateMaterial(s)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in Qs)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const s=e[t];if(!(!s||Array.isArray(s))){e[t]=[];for(const i in s){const r=s[i];r.id=r.id||i;const o=e[t].length;e[t].push(r),this.idToIndexMap[t][i]=o}}}_convertObjectIdsToArrayIndices(e){for(const t in Qs)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:s,indices:i,material:r}=t;for(const o in s)s[o]=this._convertIdToIndex(s[o],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),r&&(t.material=this._convertIdToIndex(r,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn("gltf v1: json doesn't contain attribute ".concat(t)),e[t]=[]);for(const s of e[t])for(const i in s){const r=s[i],o=this._convertIdToIndex(r,i);s[i]=o}}_convertIdToIndex(e,t){const s=Pd[t];if(s in this.idToIndexMap){const i=this.idToIndexMap[s][e];if(!Number.isFinite(i))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const r of e.materials){var t,s,i;r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((t=r.values)===null||t===void 0?void 0:t.tex)||((s=r.values)===null||s===void 0?void 0:s.texture2d_0)||((i=r.values)===null||i===void 0?void 0:i.diffuseTex),a=e.textures.findIndex(c=>c.id===o);a!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:a})}}}function Fd(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new xd().normalize(n,e)}const Dd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Od={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Z={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Ld={magFilter:Z.TEXTURE_MAG_FILTER,minFilter:Z.TEXTURE_MIN_FILTER,wrapS:Z.TEXTURE_WRAP_S,wrapT:Z.TEXTURE_WRAP_T},wd={[Z.TEXTURE_MAG_FILTER]:Z.LINEAR,[Z.TEXTURE_MIN_FILTER]:Z.NEAREST_MIPMAP_LINEAR,[Z.TEXTURE_WRAP_S]:Z.REPEAT,[Z.TEXTURE_WRAP_T]:Z.REPEAT};function Gd(n){return Od[n]}function Ud(n){return Dd[n]}class Nd{constructor(){f(this,"baseUri",""),f(this,"json",{}),f(this,"buffers",[]),f(this,"images",[])}postProcess(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:s,buffers:i=[],images:r=[],baseUri:o=""}=e;return Q(s),this.baseUri=o,this.json=s,this.buffers=i,this.images=r,this._resolveTree(this.json,t),this.json}_resolveTree(e){e.bufferViews&&(e.bufferViews=e.bufferViews.map((t,s)=>this._resolveBufferView(t,s))),e.images&&(e.images=e.images.map((t,s)=>this._resolveImage(t,s))),e.samplers&&(e.samplers=e.samplers.map((t,s)=>this._resolveSampler(t,s))),e.textures&&(e.textures=e.textures.map((t,s)=>this._resolveTexture(t,s))),e.accessors&&(e.accessors=e.accessors.map((t,s)=>this._resolveAccessor(t,s))),e.materials&&(e.materials=e.materials.map((t,s)=>this._resolveMaterial(t,s))),e.meshes&&(e.meshes=e.meshes.map((t,s)=>this._resolveMesh(t,s))),e.nodes&&(e.nodes=e.nodes.map((t,s)=>this._resolveNode(t,s))),e.skins&&(e.skins=e.skins.map((t,s)=>this._resolveSkin(t,s))),e.scenes&&(e.scenes=e.scenes.map((t,s)=>this._resolveScene(t,s))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){if(typeof t=="object")return t;const s=this.json[e]&&this.json[e][t];return s||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),s}_resolveScene(e,t){return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map(s=>this.getNode(s)),e}_resolveNode(e,t){return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map(s=>this.getNode(s))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((s,i)=>{const r=this.getMesh(i);return s.id=r.id,s.primitives=s.primitives.concat(r.primitives),s},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map(s=>{s={...s};const i=s.attributes;s.attributes={};for(const r in i)s.attributes[r]=this.getAccessor(i[r]);return s.indices!==void 0&&(s.indices=this.getAccessor(s.indices)),s.material!==void 0&&(s.material=this.getMaterial(s.material)),s})),e}_resolveMaterial(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const s=e.pbrMetallicRoughness;s.baseColorTexture&&(s.baseColorTexture={...s.baseColorTexture},s.baseColorTexture.texture=this.getTexture(s.baseColorTexture.index)),s.metallicRoughnessTexture&&(s.metallicRoughnessTexture={...s.metallicRoughnessTexture},s.metallicRoughnessTexture.texture=this.getTexture(s.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){if(e.id=e.id||"accessor-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=Gd(e.componentType),e.components=Ud(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const s=e.bufferView.buffer,{ArrayType:i,byteLength:r}=ts(e,e.bufferView),o=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+s.byteOffset;let a=s.arrayBuffer.slice(o,o+r);e.bufferView.byteStride&&(a=this._getValueFromInterleavedBuffer(s,o,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new i(a)}return e}_getValueFromInterleavedBuffer(e,t,s,i,r){const o=new Uint8Array(r*i);for(let a=0;a<r;a++){const c=t+a*s;o.set(new Uint8Array(e.arrayBuffer.slice(c,c+i)),a*i)}return o.buffer}_resolveTexture(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):wd,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||"sampler-".concat(t),e.parameters={};for(const s in e){const i=this._enumSamplerParameter(s);i!==void 0&&(e.parameters[i]=e[s])}return e}_enumSamplerParameter(e){return Ld[e]}_resolveImage(e,t){e.id=e.id||"image-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const s=this.images[t];return s&&(e.image=s),e}_resolveBufferView(e,t){const s=e.buffer,i={id:"bufferView-".concat(t),...e,buffer:this.buffers[s]},r=this.buffers[s].arrayBuffer;let o=this.buffers[s].byteOffset||0;return"byteOffset"in e&&(o+=e.byteOffset),i.data=new Uint8Array(r,o,e.byteLength),i}_resolveCamera(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}function Hd(n,e){return new Nd().postProcess(n,e)}const qs=1735152710,rs=12,Kt=8,Vd=1313821514,Jd=5130562,zd=0,Kd=1,jd=0,Qe=!0;function Xd(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(n.getUint8(e+0))).concat(String.fromCharCode(n.getUint8(e+1))).concat(String.fromCharCode(n.getUint8(e+2))).concat(String.fromCharCode(n.getUint8(e+3)))}function Wd(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=new DataView(n),{magic:i=qs}=t,r=s.getUint32(e,!1);return r===i||r===qs}function kd(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=new DataView(e),i=Xd(s,t+0),r=s.getUint32(t+4,Qe),o=s.getUint32(t+8,Qe);switch(Object.assign(n,{header:{byteOffset:t,byteLength:o,hasBinChunk:!1},type:i,version:r,json:{},binChunks:[]}),t+=rs,n.version){case 1:return Qd(n,s,t);case 2:return qd(n,s,t,{});default:throw new Error("Invalid GLB version ".concat(n.version,". Only supports v1 and v2."))}}function Qd(n,e,t){L(n.header.byteLength>rs+Kt);const s=e.getUint32(t+0,Qe),i=e.getUint32(t+4,Qe);return t+=Kt,L(i===jd),Pn(n,e,t,s),t+=s,t+=xn(n,e,t,n.header.byteLength),t}function qd(n,e,t,s){return L(n.header.byteLength>rs+Kt),Yd(n,e,t,s),t+n.header.byteLength}function Yd(n,e,t,s){for(;t+8<=n.header.byteLength;){const i=e.getUint32(t+0,Qe),r=e.getUint32(t+4,Qe);switch(t+=Kt,r){case Vd:Pn(n,e,t,i);break;case Jd:xn(n,e,t,i);break;case zd:s.strict||Pn(n,e,t,i);break;case Kd:s.strict||xn(n,e,t,i);break}t+=Ct(i,4)}return t}function Pn(n,e,t,s){const i=new Uint8Array(e.buffer,t,s),o=new TextDecoder("utf8").decode(i);return n.json=JSON.parse(o),Ct(s,4)}function xn(n,e,t,s){return n.header.hasBinChunk=!0,n.binChunks.push({byteOffset:t,byteLength:s,arrayBuffer:e.buffer}),Ct(s,4)}async function Zd(n,e){var t,s,i,r;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;$d(n,e,o,a),Fd(n,{normalize:a==null||(t=a.gltf)===null||t===void 0?void 0:t.normalize}),vd(n,a,c);const l=[];if(a!=null&&(s=a.gltf)!==null&&s!==void 0&&s.loadBuffers&&n.json.buffers&&await eh(n,a,c),a!=null&&(i=a.gltf)!==null&&i!==void 0&&i.loadImages){const d=th(n,a,c);l.push(d)}const u=Id(n,a,c);return l.push(u),await Promise.all(l),a!=null&&(r=a.gltf)!==null&&r!==void 0&&r.postProcess?Hd(n,a):n}function $d(n,e,t,s){if(s.uri&&(n.baseUri=s.uri),e instanceof ArrayBuffer&&!Wd(e,t,s)&&(e=new TextDecoder().decode(e)),typeof e=="string")n.json=Sa(e);else if(e instanceof ArrayBuffer){const o={};t=kd(o,e,t,s.glb),Q(o.type==="glTF","Invalid GLB magic string ".concat(o.type)),n._glb=o,n.json=o.json}else Q(!1,"GLTF: must be ArrayBuffer or string");const i=n.json.buffers||[];if(n.buffers=new Array(i.length).fill(null),n._glb&&n._glb.header.hasBinChunk){const{binChunks:o}=n._glb;n.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const r=n.json.images||[];n.images=new Array(r.length).fill({})}async function eh(n,e,t){const s=n.json.buffers||[];for(let o=0;o<s.length;++o){const a=s[o];if(a.uri){var i,r;const{fetch:c}=t;Q(c);const l=br(a.uri,e),u=await(t==null||(i=t.fetch)===null||i===void 0?void 0:i.call(t,l)),d=await(u==null||(r=u.arrayBuffer)===null||r===void 0?void 0:r.call(u));n.buffers[o]={arrayBuffer:d,byteOffset:0,byteLength:d.byteLength},delete a.uri}else n.buffers[o]===null&&(n.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function th(n,e,t){const s=nh(n),i=n.json.images||[],r=[];for(const o of s)r.push(sh(n,i[o],o,e,t));return await Promise.all(r)}function nh(n){const e=new Set,t=n.json.textures||[];for(const s of t)s.source!==void 0&&e.add(s.source);return Array.from(e).sort()}async function sh(n,e,t,s,i){const{fetch:r,parse:o}=i;let a;if(e.uri&&!e.hasOwnProperty("bufferView")){const l=br(e.uri,s);a=await(await r(l)).arrayBuffer(),e.bufferView={data:a}}if(Number.isFinite(e.bufferView)){const l=Jl(n.json,n.buffers,e.bufferView);a=Xn(l.buffer,l.byteOffset,l.byteLength)}Q(a,"glTF image has no data");let c=await o(a,[oa,Vl],{mimeType:e.mimeType,basis:s.basis||{format:Tr()}},i);c&&c[0]&&(c={compressed:!0,mipmaps:!1,width:c[0].width,height:c[0].height,data:c[0]}),n.images=n.images||[],n.images[t]=c}const qe={name:"glTF",id:"gltf",module:"gltf",version:bl,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:ih,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function ih(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;e={...qe.options,...e},e.gltf={...qe.options.gltf,...e.gltf};const{byteOffset:s=0}=e;return await Zd({},n,s,e,t)}async function rh(n){const e=[];return n.scenes.forEach(t=>{t.traverse(s=>{Object.values(s.model.getUniforms()).forEach(i=>{i.loaded===!1&&e.push(i)})})}),await oh(()=>e.some(t=>!t.loaded))}async function oh(n){for(;n();)await new Promise(e=>requestAnimationFrame(e))}const ah=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ch=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,Lr=[255,255,255,255],lh={scenegraph:{type:"object",value:null,async:!0},getScene:n=>n&&n.scenes?typeof n.scene=="object"?n.scene:n.scenes[n.scene||0]:n,getAnimator:n=>n&&n.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:Lr},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[qe]};class kt extends Ze{constructor(...e){super(...e),f(this,"state",void 0)}getShaders(){const e=[mt,pt];return this.props._lighting==="pbr"&&e.push(Qn),super.getShaders({vs:ah,fs:ch,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:Lr,transition:!0},instanceModelMatrix:hr})}updateState(e){super.updateState(e);const{props:t,oldProps:s}=e;t.scenegraph!==s.scenegraph?this._updateScenegraph():t._animations!==s._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,t._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}get isLoaded(){var e;return((e=this.state)===null||e===void 0?void 0:e.scenegraph)&&super.isLoaded}_updateScenegraph(){const e=this.props,{gl:t}=this.context;let s=null;if(e.scenegraph instanceof Xe)s={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){const a=e.scenegraph,c=Tl(t,a,this._getModelOptions());s={gltf:a,...c},rh(c).then(()=>this.setNeedsRedraw())}else e.scenegraph&&(le.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),s=e.scenegraph);const i={layer:this,gl:t},r=e.getScene(s,i),o=e.getAnimator(s,i);r instanceof Xe?(this._deleteScenegraph(),this._applyAllAttributes(r),this._applyAnimationsProp(r,o,e._animations),this.setState({scenegraph:r,animator:o})):r!==null&&le.warn("invalid scenegraph:",r)()}_applyAllAttributes(e){if(this.state.attributesAvailable){const t=this.getAttributeManager().getAttributes();e.traverse(s=>{this._setModelAttributes(s.model,t)})}}_applyAnimationsProp(e,t,s){if(!e||!t||!s)return;const i=t.getAnimations();Object.keys(s).sort().forEach(r=>{const o=s[r];if(r==="*")i.forEach(a=>{Object.assign(a,o)});else if(Number.isFinite(Number(r))){const a=Number(r);a>=0&&a<i.length?Object.assign(i[a],o):le.warn("animation ".concat(r," not found"))()}else{const a=i.find(({name:c})=>c===r);a?Object.assign(a,o):le.warn("animation ".concat(r," not found"))()}})}_deleteScenegraph(){const{scenegraph:e}=this.state;e instanceof Xe&&e.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t=null;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:t,modelOptions:{isInstanced:!0,transpileToGLSL100:!Xt(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(e){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(t=>{this._setModelAttributes(t.model,e)})}draw({moduleParameters:e=null,parameters:t={},context:s}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(s.timeline.getTime()),this.setNeedsRedraw());const{viewport:i}=this.context,{sizeScale:r,sizeMinPixels:o,sizeMaxPixels:a,opacity:c,coordinateSystem:l}=this.props,u=this.getNumInstances();this.state.scenegraph.traverse((d,{worldMatrix:h})=>{d.model.setInstanceCount(u),d.updateModuleSettings(e),d.draw({parameters:t,uniforms:{sizeScale:r,opacity:c,sizeMinPixels:o,sizeMaxPixels:a,composeModelMatrix:fr(i,l),sceneModelMatrix:h,u_Camera:d.model.getUniforms().project_uCameraPosition}})})}}f(kt,"defaultProps",lh);f(kt,"layerName","ScenegraphLayer");const uh={...Se,gltfUrl:{type:String,required:!0},sizeScale:{type:Number,default:1},animations:{type:Object,default:()=>({})},getPosition:{type:Function,default:n=>n.position},getOrientation:{type:[Function,Array],default:()=>[0,0,90]},getScale:{type:[Function,Array],default:()=>[1,1,1]},getTranslation:{type:[Function,Array],default:()=>[0,0,0]},sizeMinPixels:{type:Number,default:0}},dh=Me,hh={class:"mb-gltf-layer"},fh={name:"MbGltfLayer"},gh=de({...fh,props:uh,emits:dh,setup(n){aa(qe);const e=n,t=i=>{const{gltfUrl:r,animations:o,sizeScale:a,getPosition:c,getOrientation:l,getScale:u,getTranslation:d,sizeMinPixels:h}=e;return new _e(Object.assign({},i,{type:kt,scenegraph:r,sizeScale:a,getPosition:c,getOrientation:l,getScale:u,getTranslation:d,sizeMinPixels:h,_lighting:"pbr",_animations:Object.assign({"*":{speed:5}},o)}))},{getLayer:s}=Be(e,t);return y(()=>e.gltfUrl,i=>{const r=s();r==null||r.setProps({scenegraph:i})}),y(()=>e.sizeScale,i=>{const r=s();r==null||r.setProps({sizeScale:i})}),y(()=>e.getPosition,i=>{const r=s();r==null||r.setProps({getPosition:i})}),y(()=>e.getOrientation,i=>{const r=s();r==null||r.setProps({getOrientation:i})}),y(()=>e.getScale,i=>{const r=s();r==null||r.setProps({getScale:i})}),y(()=>e.getTranslation,i=>{const r=s();r==null||r.setProps({getTranslation:i})}),y(()=>e.sizeMinPixels,i=>{const r=s();r==null||r.setProps({sizeMinPixels:i})}),(i,r)=>(he(),fe("i",hh))}}),mh=ge(gh),Ge={SUM:1,MEAN:2,MIN:3,MAX:4};function wr(n,e){return n+e}function ph(n,e){return e>n?e:n}function Ah(n,e){return e<n?e:n}function Ch(n,e){if(Number.isFinite(e))return n.length?e:null;const t=n.map(e).filter(Number.isFinite);return t.length?t.reduce(wr,0)/t.length:null}function Bh(n,e){if(Number.isFinite(e))return n.length?n.length*e:null;const t=n.map(e).filter(Number.isFinite);return t.length?t.reduce(wr,0):null}function _h(n,e){if(Number.isFinite(e))return n.length?e:null;const t=n.map(e).filter(Number.isFinite);return t.length?t.reduce(ph,-1/0):null}function yh(n,e){if(Number.isFinite(e))return n.length?e:null;const t=n.map(e).filter(Number.isFinite);return t.length?t.reduce(Ah,1/0):null}function Eh(n,e,t){const s=Ge[n]||Ge.SUM;switch(e=Th(e,t),s){case Ge.MIN:return i=>yh(i,e);case Ge.SUM:return i=>Bh(i,e);case Ge.MEAN:return i=>Ch(i,e);case Ge.MAX:return i=>_h(i,e);default:return null}}function Th(n,e={}){return Number.isFinite(n)?n:t=>(e.index=t.index,n(t.source,e))}function bh(n,e={}){return t=>(e.indices=t.map(s=>s.index),n(t.map(s=>s.source),e))}const Gr=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function Sh(n,e){const t={};for(const s in n)e.includes(s)||(t[s]=n[s]);return t}class os extends qn{constructor(...e){super(...e),f(this,"state",void 0)}initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:Sh(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){const s=this.getShaders({});s&&s.defines&&(s.defines.NON_INSTANCED_MODEL=1),this.updateShaders(s)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getShaderAttributes()}getModuleSettings(){const{viewport:e,mousePosition:t,gl:s}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,pickingActive:0,devicePixelRatio:ca(s)})}updateShaders(e){}isAggregationDirty(e,t={}){const{props:s,oldProps:i,changeFlags:r}=e,{compareAll:o=!1,dimension:a}=t,{ignoreProps:c}=this.state,{props:l,accessors:u=[]}=a,{updateTriggersChanged:d}=r;if(r.dataChanged)return!0;if(d){if(d.all)return!0;for(const h of u)if(d[h])return!0}if(o)return r.extensionsChanged?!0:la({oldProps:i,newProps:s,ignoreProps:c,propTypes:this.constructor._propTypes});for(const h of l)if(s[h]!==i[h])return!0;return!1}isAttributeChanged(e){const{changedAttributes:t}=this.state;return e?t&&t[e]!==void 0:!Mh(t)}_getAttributeManager(){return new ua(this.context.gl,{id:this.props.id,stats:this.context.stats})}}f(os,"layerName","AggregationLayer");function Mh(n){let e=!0;for(const t in n){e=!1;break}return e}function Qt(n,e,t){const s=t;return s.domain=()=>n,s.range=()=>e,s}function Ys(n,e){return Qt(n,e,s=>Oh(n,e,s))}function vh(n,e){return Qt(n,e,s=>Lh(n,e,s))}function Ih(n,e){const t=n.sort(Ur);let s=0;const i=Math.max(1,e.length),r=new Array(i-1);for(;++s<i;)r[s-1]=Rh(t,s/i);const o=a=>xh(r,e,a);return o.thresholds=()=>r,Qt(n,e,o)}function Ur(n,e){return n-e}function Rh(n,e){const t=n.length;if(e<=0||t<2)return n[0];if(e>=1)return n[t-1];const s=(t-1)*e,i=Math.floor(s),r=n[i],o=n[i+1];return r+(o-r)*(s-i)}function Ph(n,e){let t=0,s=n.length;for(;t<s;){const i=t+s>>>1;Ur(n[i],e)>0?s=i:t=i+1}return t}function xh(n,e,t){return e[Ph(n,t)]}function Fh(n,e,t,s){const i="".concat(s);let r=e.get(i);return r===void 0&&(r=n.push(s),e.set(i,r)),t[(r-1)%t.length]}function Dh(n,e){const t=new Map,s=[];for(const r of n){const o="".concat(r);t.has(o)||t.set(o,s.push(r))}return Qt(n,e,r=>Fh(s,t,e,r))}function Oh(n,e,t){const s=n[1]-n[0];if(s<=0)return le.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];const i=s/e.length,r=Math.floor((t-n[0])/i),o=Math.max(Math.min(r,e.length-1),0);return e[o]}function Lh(n,e,t){return(t-n[0])/(n[1]-n[0])*(e[1]-e[0])+e[0]}function Nr(n){return n!=null}function wh(n){const e=[];return n.forEach(t=>{!e.includes(t)&&Nr(t)&&e.push(t)}),e}function Hr(n,e){return(typeof e=="function"?n.map(e):n).filter(Nr)}function Gh(n,e){return Hr(n,e)}function Uh(n,e){return wh(Hr(n,e))}function Nh(n,e,t){return Math.max(e,Math.min(t,n))}function Hh(n){switch(n){case"quantize":return Ys;case"linear":return vh;case"quantile":return Ih;case"ordinal":return Dh;default:return Ys}}const Vr=n=>n.length,Vh=3402823466e29,Jr=n=>n.points,zr=n=>n.index,Zs=(n,e)=>n<e?-1:n>e?1:n>=e?0:NaN,Jh={getValue:Vr,getPoints:Jr,getIndex:zr,filterData:null};class zh{constructor(e=[],t=Jh){f(this,"maxCount",void 0),f(this,"maxValue",void 0),f(this,"minValue",void 0),f(this,"totalCount",void 0),f(this,"aggregatedBins",void 0),f(this,"sortedBins",void 0),f(this,"binMap",void 0),this.aggregatedBins=this.getAggregatedBins(e,t),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(e,t){const{getValue:s=Vr,getPoints:i=Jr,getIndex:r=zr,filterData:o}=t,a=typeof o=="function",c=e.length,l=[];let u=0;for(let d=0;d<c;d++){const h=e[d],g=i(h),m=r(h),A=a?g.filter(o):g;h.filteredPoints=a?A:null;const C=A.length?s(A):null;C!=null&&(l[u]={i:Number.isFinite(m)?m:d,value:C,counts:A.length},u++)}return l}_percentileToIndex(e){const t=this.sortedBins.length;if(t<2)return[0,0];const[s,i]=e.map(a=>Nh(a,0,100)),r=Math.ceil(s/100*(t-1)),o=Math.floor(i/100*(t-1));return[r,o]}getBinMap(){const e={};for(const t of this.aggregatedBins)e[t.i]=t;return e}_updateMinMaxValues(){let e=0,t=0,s=Vh,i=0;for(const r of this.aggregatedBins)e=e>r.counts?e:r.counts,t=t>r.value?t:r.value,s=s<r.value?s:r.value,i+=r.counts;this.maxCount=e,this.maxValue=t,this.minValue=s,this.totalCount=i}getValueRange(e){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((i,r)=>Zs(i.value,r.value))),!this.sortedBins.length)return[];let t=0,s=this.sortedBins.length-1;if(Array.isArray(e)){const i=this._percentileToIndex(e);t=i[0],s=i[1]}return[this.sortedBins[t].value,this.sortedBins[s].value]}getValueDomainByScale(e,[t=0,s=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((r,o)=>Zs(r.value,o.value))),!this.sortedBins.length)return[];const i=this._percentileToIndex([t,s]);return this._getScaleDomain(e,i)}_getScaleDomain(e,[t,s]){const i=this.sortedBins;switch(e){case"quantize":case"linear":return[i[t].value,i[s].value];case"quantile":return Gh(i.slice(t,s+1),r=>r.value);case"ordinal":return Uh(i,r=>r.value);default:return[i[t].value,i[s].value]}}}const Kr=6378e3;function Kh(n,e,t=!0){if(!t)return{xOffset:e,yOffset:e};const{yMin:s,yMax:i}=n,r=(s+i)/2;return jh(e,r)}function jh(n,e){const t=Xh(n),s=Wh(e,n);return{yOffset:t,xOffset:s}}function Xh(n){return n/Kr*(180/Math.PI)}function Wh(n,e){return e/Kr*(180/Math.PI)/Math.cos(n*Math.PI/180)}function kh(n,e){const t=Qh(n,e),s=qh(t);return{gridHash:t.gridHash,gridOffset:t.gridOffset,data:s}}function Qh(n,e){const{data:t=[],cellSize:s}=n,{attributes:i,viewport:r,projectPoints:o,numInstances:a}=e,c=i.positions.value,{size:l}=i.positions.getAccessor(),u=e.boundingBox||Yh(i.positions,a),d=e.posOffset||[180,90],h=e.gridOffset||Kh(u,s);if(h.xOffset<=0||h.yOffset<=0)return{gridHash:{},gridOffset:h};const{width:g,height:m}=r,A=Math.ceil(g/h.xOffset),C=Math.ceil(m/h.yOffset),B={},{iterable:E,objectInfo:T}=jn(t),b=new Array(3);for(const M of E){T.index++,b[0]=c[T.index*l],b[1]=c[T.index*l+1],b[2]=l>=3?c[T.index*l+2]:0;const[D,O]=o?r.project(b):b;if(Number.isFinite(D)&&Number.isFinite(O)){const P=Math.floor((O+d[1])/h.yOffset),R=Math.floor((D+d[0])/h.xOffset);if(!o||R>=0&&R<A&&P>=0&&P<C){const S="".concat(P,"-").concat(R);B[S]=B[S]||{count:0,points:[],lonIdx:R,latIdx:P},B[S].count+=1,B[S].points.push({source:M,index:T.index})}}}return{gridHash:B,gridOffset:h,offsets:[d[0]*-1,d[1]*-1]}}function qh({gridHash:n,gridOffset:e,offsets:t}){const s=new Array(Object.keys(n).length);let i=0;for(const r in n){const o=r.split("-"),a=parseInt(o[0],10),c=parseInt(o[1],10),l=i++;s[l]={index:l,position:[t[0]+e.xOffset*c,t[1]+e.yOffset*a],...n[r]}}return s}function Yh(n,e){const t=n.value,{size:s}=n.getAccessor();let i=1/0,r=-1/0,o=1/0,a=-1/0,c,l;for(let u=0;u<e;u++)l=t[u*s],c=t[u*s+1],Number.isFinite(l)&&Number.isFinite(c)&&(i=c<i?c:i,r=c>r?c:r,o=l<o?l:o,a=l>a?l:a);return{xMin:o,xMax:a,yMin:i,yMax:r}}function $s(){}const ei=["getBins","getDomain","getScaleFunc"],ti=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],Zh=n=>n.cellSize;class jr{constructor(e){this.state={layerData:{},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=e.getCellSize||Zh,this._getAggregator=e.getAggregator,this._addDimension(e.dimensions||ti)}static defaultDimensions(){return ti}updateState(e,t){const{oldProps:s,props:i,changeFlags:r}=e;this.updateGetValueFuncs(s,i,r);const o=this.needsReProjectPoints(s,i,r);let a=!1;return r.dataChanged||o?(this.getAggregatedData(i,t),a=!0):((this.getDimensionChanges(s,i,r)||[]).forEach(l=>typeof l=="function"&&l()),a=!0),this.setState({aggregationDirty:a}),this.state}setState(e){this.state={...this.state,...e}}setDimensionState(e,t){this.setState({dimensions:{...this.state.dimensions,[e]:{...this.state.dimensions[e],...t}}})}normalizeResult(e={}){return e.hexagons?{data:e.hexagons,...e}:e.layerData?{data:e.layerData,...e}:e}getAggregatedData(e,t){const i=this._getAggregator(e)(e,t);this.setState({layerData:this.normalizeResult(i)}),this.changeFlags={layerData:!0},this.getSortedBins(e)}updateGetValueFuncs(e,t,s){for(const i in this.dimensionUpdaters){const{value:r,weight:o,aggregation:a}=this.dimensionUpdaters[i].getBins.triggers;let c=t[r.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[i].getBins,e,t,s)&&(c?c=bh(c,{data:t.data}):c=Eh(t[a.prop],t[o.prop],{data:t.data})),c&&this.setDimensionState(i,{getValue:c})}}needsReProjectPoints(e,t,s){return this._getCellSize(e)!==this._getCellSize(t)||this._getAggregator(e)!==this._getAggregator(t)||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPosition)}addDimension(e){this._addDimension(e)}_addDimension(e=[]){e.forEach(t=>{const{key:s}=t;this.dimensionUpdaters[s]=this.getDimensionUpdaters(t),this.state.dimensions[s]={getValue:null,domain:null,sortedBins:null,scaleFunc:$s}})}getDimensionUpdaters({key:e,accessor:t,pickingInfo:s,getBins:i,getDomain:r,getScaleFunc:o,nullValue:a}){return{key:e,accessor:t,pickingInfo:s,getBins:{updater:this.getDimensionSortedBins,...i},getDomain:{updater:this.getDimensionValueDomain,...r},getScaleFunc:{updater:this.getDimensionScale,...o},attributeAccessor:this.getSubLayerDimensionAttribute(e,a)}}needUpdateDimensionStep(e,t,s,i){return Object.values(e.triggers).some(r=>r.updateTrigger?i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged[r.updateTrigger]):t[r.prop]!==s[r.prop])}getDimensionChanges(e,t,s){const i=[];for(const r in this.dimensionUpdaters){const o=ei.find(a=>this.needUpdateDimensionStep(this.dimensionUpdaters[r][a],e,t,s));o&&i.push(this.dimensionUpdaters[r][o].updater.bind(this,t,this.dimensionUpdaters[r]))}return i.length?i:null}getUpdateTriggers(e){const t=e.updateTriggers||{},s={};for(const i in this.dimensionUpdaters){const{accessor:r}=this.dimensionUpdaters[i];s[r]={},ei.forEach(o=>{Object.values(this.dimensionUpdaters[i][o].triggers).forEach(({prop:a,updateTrigger:c})=>{if(c){const l=t[c];typeof l=="object"&&!Array.isArray(l)?Object.assign(s[r],l):l!==void 0&&(s[r][a]=l)}else s[r][a]=e[a]})})}return s}getSortedBins(e){for(const t in this.dimensionUpdaters)this.getDimensionSortedBins(e,this.dimensionUpdaters[t])}getDimensionSortedBins(e,t){const{key:s}=t,{getValue:i}=this.state.dimensions[s],r=new zh(this.state.layerData.data||[],{getValue:i,filterData:e._filterData});this.setDimensionState(s,{sortedBins:r}),this.getDimensionValueDomain(e,t)}getDimensionValueDomain(e,t){const{getDomain:s,key:i}=t,{triggers:{lowerPercentile:r,upperPercentile:o,scaleType:a}}=s,c=this.state.dimensions[i].sortedBins.getValueDomainByScale(e[a.prop],[e[r.prop],e[o.prop]]);this.setDimensionState(i,{valueDomain:c}),this.getDimensionScale(e,t)}getDimensionScale(e,t){const{key:s,getScaleFunc:i,getDomain:r}=t,{domain:o,range:a}=i.triggers,{scaleType:c}=r.triggers,{onSet:l}=i,u=e[a.prop],d=e[o.prop]||this.state.dimensions[s].valueDomain,g=Hh(c&&e[c.prop])(d,u);typeof l=="object"&&typeof e[l.props]=="function"&&e[l.props](g.domain()),this.setDimensionState(s,{scaleFunc:g})}getSubLayerDimensionAttribute(e,t){return s=>{const{sortedBins:i,scaleFunc:r}=this.state.dimensions[e],o=i.binMap[s.index];if(o&&o.counts===0)return t;const a=o&&o.value,c=r.domain();return a>=c[0]&&a<=c[c.length-1]?r(a):t}}getSubLayerAccessors(e){const t={};for(const s in this.dimensionUpdaters){const{accessor:i}=this.dimensionUpdaters[s];t[i]=this.getSubLayerDimensionAttribute(e,s)}return t}getPickingInfo({info:e}){const t=e.picked&&e.index>-1;let s=null;if(t){const i=this.state.layerData.data[e.index],r={};for(const o in this.dimensionUpdaters){const{pickingInfo:a}=this.dimensionUpdaters[o],{sortedBins:c}=this.state.dimensions[o],l=c.binMap[i.index]&&c.binMap[i.index].value;r[a]=l}s=Object.assign(r,i,{points:i.filteredPoints||i.points})}return e.picked=!!s,e.object=s,e}getAccessor(e){return this.dimensionUpdaters.hasOwnProperty(e)?this.dimensionUpdaters[e].attributeAccessor:$s}}function ni(){}const $h={colorDomain:null,colorRange:Gr,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:ni,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:ni,gridAggregator:kh,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:n=>n.position},extruded:!1,material:!0,_filterData:{type:"function",value:null,optional:!0}};class as extends os{initializeState(){const e=new jr({getAggregator:s=>s.gridAggregator,getCellSize:s=>s.cellSize});this.state={cpuAggregator:e,aggregatorState:e.state},this.getAttributeManager().add({positions:{size:3,type:5130,accessor:"getPosition"}})}updateState(e){super.updateState(e),this.setState({aggregatorState:this.state.cpuAggregator.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes(),numInstances:this.getNumInstances()})})}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:e,extruded:t,cellSize:s,coverage:i,material:r,transitions:o}=this.props,{cpuAggregator:a}=this.state,c=this.getSubLayerClass("grid-cell",Wt),l=this._getSublayerUpdateTriggers();return new c({cellSize:s,coverage:i,material:r,elevationScale:e,extruded:t,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getFillColor:o.getColorValue||o.getColorWeight,getElevation:o.getElevationValue||o.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:l}),{data:a.state.layerData.data})}}f(as,"layerName","CPUGridLayer");f(as,"defaultProps",$h);var Ve=Math.PI/3,ef=[0,Ve,2*Ve,3*Ve,4*Ve,5*Ve];function tf(n){return n[0]}function nf(n){return n[1]}function sf(){var n=0,e=0,t=1,s=1,i=tf,r=nf,o,a,c;function l(d){var h={},g=[],m,A=d.length;for(m=0;m<A;++m)if(!(isNaN(B=+i.call(null,C=d[m],m,d))||isNaN(E=+r.call(null,C,m,d)))){var C,B,E,T=Math.round(E=E/c),b=Math.round(B=B/a-(T&1)/2),M=E-T;if(Math.abs(M)*3>1){var D=B-b,O=b+(B<b?-1:1)/2,P=T+(E<T?-1:1),R=B-O,S=E-P;D*D+M*M>R*R+S*S&&(b=O+(T&1?1:-1)/2,T=P)}var q=b+"-"+T,ne=h[q];ne?ne.push(C):(g.push(ne=h[q]=[C]),ne.x=(b+(T&1)/2)*a,ne.y=T*c)}return g}function u(d){var h=0,g=0;return ef.map(function(m){var A=Math.sin(m)*d,C=-Math.cos(m)*d,B=A-h,E=C-g;return h=A,g=C,[B,E]})}return l.hexagon=function(d){return"m"+u(d==null?o:+d).join("l")+"z"},l.centers=function(){for(var d=[],h=Math.round(e/c),g=Math.round(n/a),m=h*c;m<s+o;m+=c,++h)for(var A=g*a+(h&1)*a/2;A<t+a/2;A+=a)d.push([A,m]);return d},l.mesh=function(){var d=u(o).slice(0,4).join("l");return l.centers().map(function(h){return"M"+h+"m"+d}).join("")},l.x=function(d){return arguments.length?(i=d,l):i},l.y=function(d){return arguments.length?(r=d,l):r},l.radius=function(d){return arguments.length?(o=+d,a=o*2*Math.sin(Ve),c=o*1.5,l):o},l.size=function(d){return arguments.length?(n=e=0,t=+d[0],s=+d[1],l):[t-n,s-e]},l.extent=function(d){return arguments.length?(n=+d[0][0],e=+d[0][1],t=+d[1][0],s=+d[1][1],l):[[n,e],[t,s]]},l.radius(1)}function rf(n,e){const{data:t,radius:s}=n,{viewport:i,attributes:r}=e,o=t.length?of(t,e):null,a=af(s,i,o),c=[],{iterable:l,objectInfo:u}=jn(t),d=r.positions.value,{size:h}=r.positions.getAccessor();for(const A of l){u.index++;const C=u.index*h,B=[d[C],d[C+1]];Number.isFinite(B[0])&&Number.isFinite(B[1])?c.push({screenCoord:i.projectFlat(B),source:A,index:u.index}):le.warn("HexagonLayer: invalid position")()}return{hexagons:sf().radius(a).x(A=>A.screenCoord[0]).y(A=>A.screenCoord[1])(c).map((A,C)=>({position:i.unprojectFlat([A.x,A.y]),points:A,index:C})),radiusCommon:a}}function of(n,e){const{attributes:t}=e,s=t.positions.value,{size:i}=t.positions.getAccessor();let r=1/0,o=1/0,a=-1/0,c=-1/0,l;for(l=0;l<i*n.length;l+=i){const u=s[l],d=s[l+1];Number.isFinite(u)&&Number.isFinite(d)&&(r=Math.min(u,r),a=Math.max(u,a),o=Math.min(d,o),c=Math.max(d,c))}return[r,o,a,c].every(Number.isFinite)?[(r+a)/2,(o+c)/2]:null}function af(n,e,t){const{unitsPerMeter:s}=e.getDistanceScales(t);return n*s[0]}function si(){}const cf={colorDomain:null,colorRange:Gr,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:si,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:si,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:rf,getPosition:{type:"accessor",value:n=>n.position},material:!0,_filterData:{type:"function",value:null,optional:!0}};class cs extends os{constructor(...e){super(...e),f(this,"state",void 0)}initializeState(){const e=new jr({getAggregator:s=>s.hexagonAggregator,getCellSize:s=>s.radius});this.state={cpuAggregator:e,aggregatorState:e.state,vertices:null},this.getAttributeManager().add({positions:{size:3,type:5130,accessor:"getPosition"}})}updateState(e){if(super.updateState(e),e.changeFlags.propsOrDataChanged){const t=this.state.cpuAggregator.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes()});if(this.state.aggregatorState.layerData!==t.layerData){const{hexagonVertices:s}=t.layerData||{};this.setState({vertices:s&&this.convertLatLngToMeterOffset(s)})}this.setState({aggregatorState:t})}}convertLatLngToMeterOffset(e){const{viewport:t}=this.context;if(Array.isArray(e)&&e.length===6){const s=e[0],i=e[3],r=[(s[0]+i[0])/2,(s[1]+i[1])/2],o=t.projectFlat(r),{metersPerUnit:a}=t.getDistanceScales(r);return e.map(l=>{const u=t.projectFlat(l);return[(u[0]-o[0])*a[0],(u[1]-o[1])*a[1]]})}return le.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:e,extruded:t,coverage:s,material:i,transitions:r}=this.props,{aggregatorState:o,vertices:a}=this.state,c=this.getSubLayerClass("hexagon-cell",Bt),l=this._getSublayerUpdateTriggers(),u=a?{vertices:a,radius:1}:{radius:o.layerData.radiusCommon||1,radiusUnits:"common",angle:90};return new c({...u,diskResolution:6,elevationScale:e,extruded:t,coverage:s,material:i,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:r&&{getFillColor:r.getColorValue||r.getColorWeight,getElevation:r.getElevationValue||r.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:l}),{data:o.layerData.data})}}f(cs,"layerName","HexagonLayer");f(cs,"defaultProps",cf);const lf={...Se,cellSize:{type:Number,default:1e3},coverage:{type:Number,default:1},colorRange:{type:Array,default:()=>["rgb(255, 255, 178)","rgb(254, 217, 118)","rgb(254, 178, 76)","rgb(253, 141, 60)","rgb(240, 59, 32)","rgb(189, 0, 38)"]},extruded:{type:Boolean,default:!0},position:{type:Function,required:!0},colorValue:{type:Function},colorWeight:{type:Function,default:()=>1},colorAggregation:{type:String,default:"SUM"},elevationValue:{type:Function},elevationWeight:{type:Function,default:()=>1},elevationAggregation:{type:String,default:"SUM"},material:{type:Boolean,default:!0},elevationScale:{type:Number,default:1}},uf=Me,df={class:"mb-grid-layer"},hf={name:"MbGridLayer"},ff=de({...hf,props:lf,emits:uf,setup(n){const e=n,t=r=>{const{colorValue:o,colorWeight:a,colorAggregation:c,elevationValue:l,elevationWeight:u,elevationAggregation:d,cellSize:h,coverage:g,colorRange:m,extruded:A,elevationScale:C,material:B,position:E}=e,T=o?{getColorValue:o}:{getColorWeight:a,colorAggregation:c},b=l?{getElevationValue:l}:{getElevationWeight:u,elevationAggregation:d};return new _e(Object.assign({},r,{type:as,cellSize:h,coverage:g,colorRange:m.map(M=>i(M)),extruded:A,elevationScale:C,material:B,getPosition:E,...T,...b}))},{getLayer:s,parseColorVal:i}=Be(e,t);return y(()=>e.cellSize,r=>{const o=s();o==null||o.setProps({cellSize:r})}),y(()=>e.coverage,r=>{const o=s();o==null||o.setProps({coverage:r})}),y(()=>e.colorRange,r=>{const o=s(),a=e.colorRange.map(c=>i(c));o==null||o.setProps({colorRange:a})}),y(()=>e.extruded,r=>{const o=s();o==null||o.setProps({extruded:r})}),y(()=>e.position,r=>{const o=s();o==null||o.setProps({getPosition:r})}),y(()=>e.colorValue,r=>{const o=s();o==null||o.setProps({getColorValue:r})}),y(()=>e.colorWeight,r=>{const o=s();o==null||o.setProps({getColorWeight:r})}),y(()=>e.colorAggregation,r=>{const o=s();o==null||o.setProps({colorAggregation:r})}),y(()=>e.elevationValue,r=>{const o=s();o==null||o.setProps({getElevationValue:r})}),y(()=>e.elevationWeight,r=>{const o=s();o==null||o.setProps({getElevationWeight:r})}),y(()=>e.elevationAggregation,r=>{const o=s();o==null||o.setProps({elevationAggregation:r})}),y(()=>e.material,r=>{const o=s();o==null||o.setProps({material:r})}),y(()=>e.elevationScale,r=>{const o=s();o==null||o.setProps({elevationScale:r})}),(r,o)=>(he(),fe("i",df))}}),gf=ge(ff),mf={...Se,cellSize:{type:Number,default:1e3},filled:{type:Boolean,default:!0},stroked:{type:Boolean,default:!1},extruded:{type:Boolean,default:!0},lineWidthUnits:{type:String,default:"meters"},lineWidthScale:{type:Number,default:1},lineWidthMinPixels:{type:Number,default:0},lineWidthMaxPixels:{type:Number,default:Number.MAX_SAFE_INTEGER},position:{type:Function,required:!0},elevation:{type:[Number,Function],default:1e3},fillColor:{type:[String,Function],default:"black"},lineColor:{type:[String,Function],default:"black"},lineWidth:{type:[Number,Function],default:1}},pf=Me,Af={class:"mb-grid-cell-layer"},Cf={name:"MbGridCellLayer"},Bf=de({...Cf,props:mf,emits:pf,setup(n){const e=n,t=o=>{const{cellSize:a,filled:c,stroked:l,extruded:u,lineWidthUnits:d,lineWidthScale:h,lineWidthMinPixels:g,lineWidthMaxPixels:m,position:A,fillColor:C,lineColor:B,elevation:E,lineWidth:T}=e;return new _e(Object.assign({},o,{type:Wt,cellSize:a,filled:c,stroked:l,extruded:u,lineWidthUnits:d,lineWidthScale:h,lineWidthMinPixels:g,lineWidthMaxPixels:m,getPosition:A,getFillColor:i(C),getLineColor:i(B),getElevation:E,getLineWidth:T}))},{getLayer:s,parseColorVal:i,setColorProps:r}=Be(e,t);return y(()=>e.cellSize,o=>{const a=s();a==null||a.setProps({cellSize:o})}),y(()=>e.filled,o=>{const a=s();a==null||a.setProps({filled:o})}),y(()=>e.stroked,o=>{const a=s();a==null||a.setProps({stroked:o})}),y(()=>e.extruded,o=>{const a=s();a==null||a.setProps({extruded:o})}),y(()=>e.lineWidth,o=>{const a=s();a==null||a.setProps({getLineWidth:o})}),y(()=>e.lineWidthUnits,o=>{const a=s();a==null||a.setProps({lineWidthUnits:o})}),y(()=>e.lineWidthScale,o=>{const a=s();a==null||a.setProps({lineWidthScale:o})}),y(()=>e.lineWidthMinPixels,o=>{const a=s();a==null||a.setProps({lineWidthMinPixels:o})}),y(()=>e.lineWidthMaxPixels,o=>{const a=s();a==null||a.setProps({lineWidthMaxPixels:o})}),y(()=>e.fillColor,o=>{r("getFillColor",o)}),y(()=>e.lineColor,o=>{r("getLineColor",o)}),y(()=>e.position,o=>{const a=s();a==null||a.setProps({getPosition:o})}),y(()=>e.elevation,o=>{const a=s();a==null||a.setProps({getElevation:o})}),(o,a)=>(he(),fe("i",Af))}}),_f=ge(Bf),yf={...Se,radius:{type:Number,default:1e3},coverage:{type:Number,default:1},colorRange:{type:Array,default:()=>["rgb(255, 255, 178)","rgb(254, 217, 118)","rgb(254, 178, 76)","rgb(253, 141, 60)","rgb(240, 59, 32)","rgb(189, 0, 38)"]},extruded:{type:Boolean,default:!0},position:{type:Function,required:!0},colorValue:{type:Function},colorWeight:{type:Function,default:()=>1},colorAggregation:{type:String,default:"SUM"},elevationValue:{type:Function},elevationWeight:{type:Function,default:()=>1},elevationAggregation:{type:String,default:"SUM"},material:{type:Boolean,default:!0},elevationScale:{type:Number,default:1}},Ef=Me,Tf={class:"mb-hexagon-layer"},bf={name:"MbHexagonLayer"},Sf=de({...bf,props:yf,emits:Ef,setup(n){const e=n,t=r=>{const{colorValue:o,colorWeight:a,colorAggregation:c,elevationValue:l,elevationWeight:u,elevationAggregation:d,radius:h,coverage:g,colorRange:m,extruded:A,elevationScale:C,material:B,position:E}=e,T=o?{getColorValue:o}:{getColorWeight:a,colorAggregation:c},b=l?{getElevationValue:l}:{getElevationWeight:u,elevationAggregation:d};return new _e(Object.assign({},r,{type:cs,radius:h,coverage:g,colorRange:m.map(M=>i(M)),extruded:A,elevationScale:C,material:B,getPosition:E,...T,...b}))},{getLayer:s,parseColorVal:i}=Be(e,t);return y(()=>e.radius,r=>{const o=s();o==null||o.setProps({radius:r})}),y(()=>e.coverage,r=>{const o=s();o==null||o.setProps({coverage:r})}),y(()=>e.colorRange,r=>{const o=s(),a=e.colorRange.map(c=>i(c));o==null||o.setProps({colorRange:a})}),y(()=>e.extruded,r=>{const o=s();o==null||o.setProps({extruded:r})}),y(()=>e.position,r=>{const o=s();o==null||o.setProps({getPosition:r})}),y(()=>e.colorValue,r=>{const o=s();o==null||o.setProps({getColorValue:r})}),y(()=>e.colorWeight,r=>{const o=s();o==null||o.setProps({getColorWeight:r})}),y(()=>e.colorAggregation,r=>{const o=s();o==null||o.setProps({colorAggregation:r})}),y(()=>e.elevationValue,r=>{const o=s();o==null||o.setProps({getElevationValue:r})}),y(()=>e.elevationWeight,r=>{const o=s();o==null||o.setProps({getElevationWeight:r})}),y(()=>e.elevationAggregation,r=>{const o=s();o==null||o.setProps({elevationAggregation:r})}),y(()=>e.material,r=>{const o=s();o==null||o.setProps({material:r})}),y(()=>e.elevationScale,r=>{const o=s();o==null||o.setProps({elevationScale:r})}),(r,o)=>(he(),fe("i",Tf))}}),Mf=ge(Sf),vf={...Se,widthUnits:{type:String,default:"pixels"},widthScale:{type:Number,default:1},widthMinPixels:{type:Number,default:0},widthMaxPixels:{type:Number,default:Number.MAX_SAFE_INTEGER},sourcePosition:{type:[Array,Function],required:!0},targetPosition:{type:[Array,Function],required:!0},color:{type:[String,Function],default:"black"},width:{type:[Number,Function],default:1}},If=Me,Rf={class:"mb-line-layer"},Pf={name:"MbLineLayer"},xf=de({...Pf,props:vf,emits:If,setup(n){const e=n,t=o=>{const{widthMinPixels:a,widthMaxPixels:c,widthUnits:l,width:u,color:d,sourcePosition:h,targetPosition:g}=e;return new _e(Object.assign({},o,{type:Yn,widthMinPixels:a,widthMaxPixels:c,widthUnits:l,getWidth:u,getColor:i(d),getSourcePosition:h,getTargetPosition:g}))},{getLayer:s,parseColorVal:i,setColorProps:r}=Be(e,t);return y(()=>e.width,o=>{const a=s();a==null||a.setProps({getWidth:o})}),y(()=>e.widthUnits,o=>{const a=s();a==null||a.setProps({widthUnits:o})}),y(()=>e.widthMinPixels,o=>{const a=s();a==null||a.setProps({widthMinPixels:o})}),y(()=>e.widthMaxPixels,o=>{const a=s();a==null||a.setProps({widthMaxPixels:o})}),y(()=>e.sourcePosition,o=>{const a=s();a==null||a.setProps({getSourcePosition:o})}),y(()=>e.targetPosition,o=>{const a=s();a==null||a.setProps({getTargetPosition:o})}),y(()=>e.color,o=>{r("getColor",o)}),(o,a)=>(he(),fe("i",Rf))}}),Ff=ge(xf),Df={class:"mb-path-layer"},Of={name:"MbPathLayer"},Lf=de({...Of,props:ki,setup(n){return To(n),(e,t)=>(he(),fe("i",Df))}}),wf=ge(Lf),k={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new p;new p;const st=new p,ii=new p;class _t{constructor(e=[0,0,0],t=0){f(this,"center",void 0),f(this,"radius",void 0),this.radius=-0,this.center=new p,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=st.from(t),this.center=new p().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new _t(this.center,this.radius)}union(e){const t=this.center,s=this.radius,i=e.center,r=e.radius,o=st.copy(i).subtract(t),a=o.magnitude();if(s>=a+r)return this.clone();if(r>=a+s)return e.clone();const c=(s+a+r)*.5;return ii.copy(o).scale((-s+c)/a).add(t),this.center.copy(ii),this.radius=c,this}expand(e){const s=st.from(e).subtract(this.center).magnitude();return s>this.radius&&(this.radius=s),this}transform(e){this.center.transform(e);const t=da(st,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const s=st.from(e).subtract(this.center);return Math.max(0,s.len()-this.radius)}intersectPlane(e){const t=this.center,s=this.radius,r=e.normal.dot(t)+e.distance;return r<-s?k.OUTSIDE:r<s?k.INTERSECTING:k.INSIDE}}const Gf=new p,Uf=new p,Rt=new p,Pt=new p,xt=new p,Nf=new p,Hf=new p,me={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class yt{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){f(this,"center",void 0),f(this,"halfAxes",void 0),this.center=new p().from(e),this.halfAxes=new U(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2);return[new p(e).len(),new p(t).len(),new p(s).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2),i=new p(e).normalize(),r=new p(t).normalize(),o=new p(s).normalize();return new dt().fromMatrix3(new U([...i,...r,...o]))}fromCenterHalfSizeQuaternion(e,t,s){const i=new dt(s),r=new U().fromQuaternion(i);return r[0]=r[0]*t[0],r[1]=r[1]*t[0],r[2]=r[2]*t[0],r[3]=r[3]*t[1],r[4]=r[4]*t[1],r[5]=r[5]*t[1],r[6]=r[6]*t[2],r[7]=r[7]*t[2],r[8]=r[8]*t[2],this.center=new p().from(e),this.halfAxes=r,this}clone(){return new yt(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new _t){const t=this.halfAxes,s=t.getColumn(0,Rt),i=t.getColumn(1,Pt),r=t.getColumn(2,xt),o=Gf.copy(s).add(i).add(r);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const t=this.center,s=e.normal,i=this.halfAxes,r=s.x,o=s.y,a=s.z,c=Math.abs(r*i[me.COLUMN0ROW0]+o*i[me.COLUMN0ROW1]+a*i[me.COLUMN0ROW2])+Math.abs(r*i[me.COLUMN1ROW0]+o*i[me.COLUMN1ROW1]+a*i[me.COLUMN1ROW2])+Math.abs(r*i[me.COLUMN2ROW0]+o*i[me.COLUMN2ROW1]+a*i[me.COLUMN2ROW2]),l=s.dot(t)+e.distance;return l<=-c?k.OUTSIDE:l>=c?k.INSIDE:k.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=Uf.from(e).subtract(this.center),s=this.halfAxes,i=s.getColumn(0,Rt),r=s.getColumn(1,Pt),o=s.getColumn(2,xt),a=i.magnitude(),c=r.magnitude(),l=o.magnitude();i.normalize(),r.normalize(),o.normalize();let u=0,d;return d=Math.abs(t.dot(i))-a,d>0&&(u+=d*d),d=Math.abs(t.dot(r))-c,d>0&&(u+=d*d),d=Math.abs(t.dot(o))-l,d>0&&(u+=d*d),u}computePlaneDistances(e,t,s=[-0,-0]){let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,c=a.getColumn(0,Rt),l=a.getColumn(1,Pt),u=a.getColumn(2,xt),d=Nf.copy(c).add(l).add(u).add(o),h=Hf.copy(d).subtract(e);let g=t.dot(h);return i=Math.min(g,i),r=Math.max(g,r),d.copy(o).add(c).add(l).subtract(u),h.copy(d).subtract(e),g=t.dot(h),i=Math.min(g,i),r=Math.max(g,r),d.copy(o).add(c).subtract(l).add(u),h.copy(d).subtract(e),g=t.dot(h),i=Math.min(g,i),r=Math.max(g,r),d.copy(o).add(c).subtract(l).subtract(u),h.copy(d).subtract(e),g=t.dot(h),i=Math.min(g,i),r=Math.max(g,r),o.copy(d).subtract(c).add(l).add(u),h.copy(d).subtract(e),g=t.dot(h),i=Math.min(g,i),r=Math.max(g,r),o.copy(d).subtract(c).add(l).subtract(u),h.copy(d).subtract(e),g=t.dot(h),i=Math.min(g,i),r=Math.max(g,r),o.copy(d).subtract(c).subtract(l).add(u),h.copy(d).subtract(e),g=t.dot(h),i=Math.min(g,i),r=Math.max(g,r),o.copy(d).subtract(c).subtract(l).subtract(u),h.copy(d).subtract(e),g=t.dot(h),i=Math.min(g,i),r=Math.max(g,r),s[0]=i,s[1]=r,s}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,Rt);t.transformAsPoint(e);const s=this.halfAxes.getColumn(1,Pt);s.transformAsPoint(e);const i=this.halfAxes.getColumn(2,xt);return i.transformAsPoint(e),this.halfAxes=new U([...t,...s,...i]),this}getTransform(){throw new Error("not implemented")}}const ri=new p,oi=new p;class ie{constructor(e=[0,0,1],t=0){f(this,"normal",void 0),f(this,"distance",void 0),this.normal=new p,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return pe(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=ri.from(e),this.normal.from(t).normalize();const s=-this.normal.dot(e);return this.distance=s,this}fromCoefficients(e,t,s,i){return this.normal.set(e,t,s),pe(je(this.normal.len(),1)),this.distance=i,this}clone(){return new ie(this.normal,this.distance)}equals(e){return je(this.distance,e.distance)&&je(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=oi.copy(this.normal).transformAsVector(e).normalize(),s=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(s,t)}projectPointOntoPlane(e,t=[0,0,0]){e=ri.from(e);const s=this.getPointDistance(e),i=oi.copy(this.normal).scale(s);return e.subtract(i).to(t)}}const ai=[new p([1,0,0]),new p([0,1,0]),new p([0,0,1])],ci=new p,Vf=new p;new ie(new p(1,0,0),0);class ${constructor(e=[]){f(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*ai.length;const t=e.center,s=e.radius;let i=0;for(const r of ai){let o=this.planes[i],a=this.planes[i+1];o||(o=this.planes[i]=new ie),a||(a=this.planes[i+1]=new ie);const c=ci.copy(r).scale(-s).add(t);-r.dot(c),o.fromPointNormal(c,r);const l=ci.copy(r).scale(s).add(t),u=Vf.copy(r).negate();-u.dot(l),a.fromPointNormal(l,u),i+=2}return this}computeVisibility(e){let t=k.INSIDE;for(const s of this.planes)switch(e.intersectPlane(s)){case k.OUTSIDE:return k.OUTSIDE;case k.INTERSECTING:t=k.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(pe(Number.isFinite(t),"parentPlaneMask is required."),t===$.MASK_OUTSIDE||t===$.MASK_INSIDE)return t;let s=$.MASK_INSIDE;const i=this.planes;for(let r=0;r<this.planes.length;++r){const o=r<31?1<<r:0;if(r<31&&!(t&o))continue;const a=i[r],c=e.intersectPlane(a);if(c===k.OUTSIDE)return $.MASK_OUTSIDE;c===k.INTERSECTING&&(s|=o)}return s}}f($,"MASK_OUTSIDE",4294967295);f($,"MASK_INSIDE",0);f($,"MASK_INDETERMINATE",2147483647);new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;const ae=new U,Jf=new U,zf=new U,Ft=new U,li=new U;function Kf(n,e={}){const t=ht.EPSILON20,s=10;let i=0,r=0;const o=Jf,a=zf;o.identity(),a.copy(n);const c=t*jf(a);for(;r<s&&Xf(a)>c;)Wf(a,Ft),li.copy(Ft).transpose(),a.multiplyRight(Ft),a.multiplyLeft(li),o.multiplyRight(Ft),++i>2&&(++r,i=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function jf(n){let e=0;for(let t=0;t<9;++t){const s=n[t];e+=s*s}return Math.sqrt(e)}const Fn=[1,0,0],Dn=[2,2,1];function Xf(n){let e=0;for(let t=0;t<3;++t){const s=n[ae.getElementIndex(Dn[t],Fn[t])];e+=2*s*s}return Math.sqrt(e)}function Wf(n,e){const t=ht.EPSILON15;let s=0,i=1;for(let l=0;l<3;++l){const u=Math.abs(n[ae.getElementIndex(Dn[l],Fn[l])]);u>s&&(i=l,s=u)}const r=Fn[i],o=Dn[i];let a=1,c=0;if(Math.abs(n[ae.getElementIndex(o,r)])>t){const l=n[ae.getElementIndex(o,o)],u=n[ae.getElementIndex(r,r)],d=n[ae.getElementIndex(o,r)],h=(l-u)/2/d;let g;h<0?g=-1/(-h+Math.sqrt(1+h*h)):g=1/(h+Math.sqrt(1+h*h)),a=1/Math.sqrt(1+g*g),c=g*a}return U.IDENTITY.to(e),e[ae.getElementIndex(r,r)]=e[ae.getElementIndex(o,o)]=a,e[ae.getElementIndex(o,r)]=c,e[ae.getElementIndex(r,o)]=-c,e}const ye=new p,kf=new p,Qf=new p,qf=new p,Yf=new p,Zf=new U,$f={diagonal:new U,unitary:new U};function eg(n,e=new yt){if(!n||n.length===0)return e.halfAxes=new U([0,0,0,0,0,0,0,0,0]),e.center=new p,e;const t=n.length,s=new p(0,0,0);for(const R of n)s.add(R);const i=1/t;s.multiplyByScalar(i);let r=0,o=0,a=0,c=0,l=0,u=0;for(const R of n){const S=ye.copy(R).subtract(s);r+=S.x*S.x,o+=S.x*S.y,a+=S.x*S.z,c+=S.y*S.y,l+=S.y*S.z,u+=S.z*S.z}r*=i,o*=i,a*=i,c*=i,l*=i,u*=i;const d=Zf;d[0]=r,d[1]=o,d[2]=a,d[3]=o,d[4]=c,d[5]=l,d[6]=a,d[7]=l,d[8]=u;const{unitary:h}=Kf(d,$f),g=e.halfAxes.copy(h);let m=g.getColumn(0,Qf),A=g.getColumn(1,qf),C=g.getColumn(2,Yf),B=-Number.MAX_VALUE,E=-Number.MAX_VALUE,T=-Number.MAX_VALUE,b=Number.MAX_VALUE,M=Number.MAX_VALUE,D=Number.MAX_VALUE;for(const R of n)ye.copy(R),B=Math.max(ye.dot(m),B),E=Math.max(ye.dot(A),E),T=Math.max(ye.dot(C),T),b=Math.min(ye.dot(m),b),M=Math.min(ye.dot(A),M),D=Math.min(ye.dot(C),D);m=m.multiplyByScalar(.5*(b+B)),A=A.multiplyByScalar(.5*(M+E)),C=C.multiplyByScalar(.5*(D+T)),e.center.copy(m).add(A).add(C);const O=kf.set(B-b,E-M,T-D).multiplyByScalar(.5),P=new U([O[0],0,0,0,O[1],0,0,0,O[2]]);return e.halfAxes.multiplyRight(P),e}const tg={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:n=>n.timestamps}};class ls extends ha{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`uniform float trailLength;
attribute float instanceTimestamps;
attribute float instanceNextTimestamps;
varying float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
varying float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:t,trailLength:s,currentTime:i}=this.props;e.uniforms={...e.uniforms,fadeTrail:t,trailLength:s,currentTime:i},super.draw(e)}}f(ls,"layerName","TripsLayer");f(ls,"defaultProps",tg);const ng=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,sg=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function ig(n){n.COLOR_0||n.colors||(n.colors={constant:!0,value:new Float32Array([1,1,1])})}const rg={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class us extends es{getShaders(){const e=super.getShaders();return e.modules.push(Qn),{...e,vs:ng,fs:sg}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:s}=e;t.pbrMaterial!==s.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!t}),super.draw(e))}getModel(e){const{id:t,pbrMaterial:s}=this.props,i=this.parseMaterial(s,e);this.setState({materialParser:i});const r=this.getShaders();return ig(e.attributes),new xe(this.context.gl,{...this.getShaders(),id:t,geometry:e,defines:{...r.defines,...i==null?void 0:i.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:i==null?void 0:i.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:s}=this.props,i=this.parseMaterial(e,s);this.setState({materialParser:i}),t.setUniforms(i.uniforms)}}parseMaterial(e,t){var s;const i=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return(s=this.state.materialParser)===null||s===void 0||s.delete(),new _r(this.context.gl,{attributes:{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},material:{unlit:i,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,s=new Uint8ClampedArray(t.length*e.size),i=[];for(let r=0;r<t.length;r++)this.encodePickingColor(t[r],i),s[r*3]=i[0],s[r*3+1]=i[1],s[r*3+2]=i[2];e.value=s}finalizeState(e){var t;super.finalizeState(e),(t=this.state.materialParser)===null||t===void 0||t.delete(),this.setState({materialParser:null})}}f(us,"layerName","MeshLayer");f(us,"defaultProps",rg);const og=6378137,ag=6378137,cg=6356752314245179e-9;function qt(n){return n}new p;function lg(n,e=[],t=qt){return"longitude"in n?(e[0]=t(n.longitude),e[1]=t(n.latitude),e[2]=n.height):"x"in n?(e[0]=t(n.x),e[1]=t(n.y),e[2]=n.z):(e[0]=t(n[0]),e[1]=t(n[1]),e[2]=n[2]),e}function ug(n,e=[]){return lg(n,e,ke._cartographicRadians?qt:fa)}function dg(n,e,t=qt){return"longitude"in e?(e.longitude=t(n[0]),e.latitude=t(n[1]),e.height=n[2]):"x"in e?(e.x=t(n[0]),e.y=t(n[1]),e.z=n[2]):(e[0]=t(n[0]),e[1]=t(n[1]),e[2]=n[2]),e}function hg(n,e){return dg(n,e,ke._cartographicRadians?qt:ga)}const Ue=new p,fg=new p,gg=new p;function mg(n,e,t=[]){const{oneOverRadii:s,oneOverRadiiSquared:i,centerToleranceSquared:r}=e;Ue.from(n);const o=Ue.x,a=Ue.y,c=Ue.z,l=s.x,u=s.y,d=s.z,h=o*o*l*l,g=a*a*u*u,m=c*c*d*d,A=h+g+m,C=Math.sqrt(1/A);if(!Number.isFinite(C))return;const B=fg;if(B.copy(n).scale(C),A<r)return B.to(t);const E=i.x,T=i.y,b=i.z,M=gg;M.set(B.x*E*2,B.y*T*2,B.z*b*2);let D=(1-C)*Ue.len()/(.5*M.len()),O=0,P,R,S,q;do{D-=O,P=1/(1+D*E),R=1/(1+D*T),S=1/(1+D*b);const ne=P*P,Le=R*R,en=S*S,Bs=ne*P,tn=Le*R,nn=en*S;q=h*ne+g*Le+m*en-1;const et=-2*(h*Bs*E+g*tn*T+m*nn*b);O=q/et}while(Math.abs(q)>ht.EPSILON12);return Ue.scale([P,R,S]).to(t)}const ui=1e-14,pg=new p,di={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},gn={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},it={east:new p,north:new p,up:new p,west:new p,south:new p,down:new p},Ag=new p,Cg=new p,Bg=new p;function hi(n,e,t,s,i,r){const o=di[e]&&di[e][t];pe(o&&(!s||s===o));let a,c,l;const u=pg.copy(i);if(je(u.x,0,ui)&&je(u.y,0,ui)){const h=Math.sign(u.z);a=Ag.fromArray(gn[e]),e!=="east"&&e!=="west"&&a.scale(h),c=Cg.fromArray(gn[t]),t!=="east"&&t!=="west"&&c.scale(h),l=Bg.fromArray(gn[s]),s!=="east"&&s!=="west"&&l.scale(h)}else{const{up:h,east:g,north:m}=it;g.set(-u.y,u.x,0).normalize(),n.geodeticSurfaceNormal(u,h),m.copy(h).cross(g);const{down:A,west:C,south:B}=it;A.copy(h).scale(-1),C.copy(g).scale(-1),B.copy(m).scale(-1),a=it[e],c=it[t],l=it[s]}return r[0]=a.x,r[1]=a.y,r[2]=a.z,r[3]=0,r[4]=c.x,r[5]=c.y,r[6]=c.z,r[7]=0,r[8]=l.x,r[9]=l.y,r[10]=l.z,r[11]=0,r[12]=u.x,r[13]=u.y,r[14]=u.z,r[15]=1,r}const Dt=new p,fi=new p,_g=new p,se=new p,yg=new p,Ot=new p;class w{constructor(e=0,t=0,s=0){f(this,"radii",void 0),f(this,"radiiSquared",void 0),f(this,"radiiToTheFourth",void 0),f(this,"oneOverRadii",void 0),f(this,"oneOverRadiiSquared",void 0),f(this,"minimumRadius",void 0),f(this,"maximumRadius",void 0),f(this,"centerToleranceSquared",ht.EPSILON1),f(this,"squaredXOverSquaredZ",void 0),pe(e>=0),pe(t>=0),pe(s>=0),this.radii=new p(e,t,s),this.radiiSquared=new p(e*e,t*t,s*s),this.radiiToTheFourth=new p(e*e*e*e,t*t*t*t,s*s*s*s),this.oneOverRadii=new p(e===0?0:1/e,t===0?0:1/t,s===0?0:1/s),this.oneOverRadiiSquared=new p(e===0?0:1/(e*e),t===0?0:1/(t*t),s===0?0:1/(s*s)),this.minimumRadius=Math.min(e,t,s),this.maximumRadius=Math.max(e,t,s),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0]){const s=fi,i=_g,[,,r]=e;this.geodeticSurfaceNormalCartographic(e,s),i.copy(this.radiiSquared).scale(s);const o=Math.sqrt(s.dot(i));return i.scale(1/o),s.scale(r),i.add(s),i.to(t)}cartesianToCartographic(e,t=[0,0,0]){Ot.from(e);const s=this.scaleToGeodeticSurface(Ot,se);if(!s)return;const i=this.geodeticSurfaceNormal(s,fi),r=yg;r.copy(Ot).subtract(s);const o=Math.atan2(i.y,i.x),a=Math.asin(i.z),c=Math.sign(tr(r,Ot))*ma(r);return hg([o,a,c],t)}eastNorthUpToFixedFrame(e,t=new F){return hi(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,s,i,r=new F){return hi(this,e,t,s,i,r)}geocentricSurfaceNormal(e,t=[0,0,0]){return Dt.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0]){const s=ug(e),i=s[0],r=s[1],o=Math.cos(r);return Dt.set(o*Math.cos(i),o*Math.sin(i),Math.sin(r)).normalize(),Dt.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return Dt.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return mg(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){se.from(e);const s=se.x,i=se.y,r=se.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(s*s*o.x+i*i*o.y+r*r*o.z);return se.multiplyScalar(a).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return se.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return se.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,s=[0,0,0]){pe(je(this.radii.x,this.radii.y,ht.EPSILON15)),pe(this.radii.z>0),se.from(e);const i=se.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-t))return se.set(0,0,i).to(s)}}f(w,"WGS84",new w(og,ag,cg));class Eg{constructor(e,t,s){f(this,"item",void 0),f(this,"previous",void 0),f(this,"next",void 0),this.item=e,this.previous=t,this.next=s}}class Tg{constructor(){f(this,"head",null),f(this,"tail",null),f(this,"_length",0)}get length(){return this._length}add(e){const t=new Eg(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const s=e.next;e.next=t,this.tail===e?this.tail=t:s.previous=t,t.next=s,t.previous=e,++this._length}}class bg{constructor(){f(this,"_list",void 0),f(this,"_sentinel",void 0),f(this,"_trimTiles",void 0),this._list=new Tg,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,s){t._cacheNode||(t._cacheNode=this._list.add(t),s&&s(e,t))}unloadTile(e,t,s){const i=t._cacheNode;i&&(this._list.remove(i),t._cacheNode=null,s&&s(e,t))}unloadTiles(e,t){const s=this._trimTiles;this._trimTiles=!1;const i=this._list,r=e.maximumMemoryUsage*1024*1024,o=this._sentinel;let a=i.head;for(;a!==o&&(e.gpuMemoryUsageInBytes>r||s);){const c=a.item;a=a.next,this.unloadTile(e,c,t)}}trim(){this._trimTiles=!0}}function Sg(n,e){L(n),L(e);const{rtcCenter:t,gltfUpAxis:s}=e,{computedTransform:i,boundingVolume:{center:r}}=n;let o=new F(i);switch(t&&o.translate(t),s){case"Z":break;case"Y":const d=new F().rotateX(Math.PI/2);o=o.multiplyRight(d);break;case"X":const h=new F().rotateY(-Math.PI/2);o=o.multiplyRight(h);break}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const a=new p(r);e.cartesianModelMatrix=o,e.cartesianOrigin=a;const c=w.WGS84.cartesianToCartographic(a,new p),u=w.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=u.multiplyRight(o),e.cartographicOrigin=c,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const gi=new p,mn=new p,On=new $([new ie,new ie,new ie,new ie,new ie,new ie]);function Mg(n,e){const{cameraDirection:t,cameraUp:s,height:i}=n,{metersPerUnit:r}=n.distanceScales,o=Nt(n,n.center),a=w.WGS84.eastNorthUpToFixedFrame(o),c=n.unprojectPosition(n.cameraPosition),l=w.WGS84.cartographicToCartesian(c,new p),u=new p(a.transformAsVector(new p(t).scale(r))).normalize(),d=new p(a.transformAsVector(new p(s).scale(r))).normalize();Ig(n);const h=n.constructor,{longitude:g,latitude:m,width:A,bearing:C,zoom:B}=n,E=new h({longitude:g,latitude:m,height:i,width:A,bearing:C,zoom:B,pitch:0});return{camera:{position:l,direction:u,up:d},viewport:n,topDownViewport:E,height:i,cullingVolume:On,frameNumber:e,sseDenominator:1.15}}function vg(n,e,t){if(t===0||n.length<=t)return[n,[]];const s=[],{longitude:i,latitude:r}=e.viewport;for(const[l,u]of n.entries()){const[d,h]=u.header.mbs,g=Math.abs(i-d),m=Math.abs(r-h),A=Math.sqrt(m*m+g*g);s.push([l,A])}const o=s.sort((l,u)=>l[1]-u[1]),a=[];for(let l=0;l<t;l++)a.push(n[o[l][0]]);const c=[];for(let l=t;l<o.length;l++)c.push(n[o[l][0]]);return[a,c]}function Ig(n){const e=n.getFrustumPlanes(),t=mi(e.near,n.cameraPosition),s=Nt(n,t),i=Nt(n,n.cameraPosition,mn);let r=0;On.planes[r++].fromPointNormal(s,gi.copy(s).subtract(i));for(const o in e){if(o==="near")continue;const a=e[o],c=mi(a,t,mn),l=Nt(n,c,mn);On.planes[r++].fromPointNormal(l,gi.copy(s).subtract(l))}}function mi(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new p;const s=n.normal.dot(e);return t.copy(n.normal).scale(n.distance-s).add(e),t}function Nt(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new p;const s=n.unprojectPosition(e);return w.WGS84.cartographicToCartesian(s,t)}const Rg=6378137,Pg=6378137,Ln=6356752314245179e-9,pi=new p;function xg(n,e){if(n instanceof yt){const{halfAxes:t}=n,s=Dg(t);return Math.log2(Ln/(s+e[2]))}else if(n instanceof _t){const{radius:t}=n;return Math.log2(Ln/(t+e[2]))}else if(n.width&&n.height){const{width:t,height:s}=n,i=Math.log2(Rg/t),r=Math.log2(Pg/s);return(i+r)/2}return 1}function Xr(n,e,t){const s=w.WGS84.cartographicToCartesian([n.xmax,n.ymax,n.zmax],new p),i=Math.sqrt(Math.pow(s[0]-t[0],2)+Math.pow(s[1]-t[1],2)+Math.pow(s[2]-t[2],2));return Math.log2(Ln/(i+e[2]))}function Fg(n,e,t){const[s,i,r,o]=n;return Xr({xmin:s,xmax:r,ymin:i,ymax:o,zmin:0,zmax:0},e,t)}function Dg(n){n.getColumn(0,pi);const e=n.getColumn(1),t=n.getColumn(2);return pi.add(e).add(t).len()}const W={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},Ce={ADD:1,REPLACE:2},We={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Y={I3S:"I3S",TILES3D:"TILES3D"},Yt={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},Og={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function Wr(n){return n!=null}const V=new p,Ht=new p,Lg=new p,wg=new p;function pn(n,e,t){if(L(n,"3D Tile: boundingVolume must be defined"),n.box)return Ug(n.box,e,t);if(n.region){const[s,i,r,o,a,c]=n.region,l=w.WGS84.cartographicToCartesian([Te(s),Te(o),a],Lg),u=w.WGS84.cartographicToCartesian([Te(r),Te(i),c],wg),d=new p().addVectors(l,u).multiplyScalar(.5),h=new p().subVectors(l,u).len()/2;return Ai([d[0],d[1],d[2],h],new F)}if(n.sphere)return Ai(n.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function Gg(n,e){if(n.box)return Ng(e);if(n.region){const[t,s,i,r,o,a]=n.region;return[[Te(t),Te(s),o],[Te(i),Te(r),a]]}if(n.sphere)return Hg(e);throw new Error("Unkown boundingVolume type")}function Ug(n,e,t){const s=new p(n[0],n[1],n[2]);e.transform(s,s);let i=[];if(n.length===10){const l=n.slice(3,6),u=new dt;u.fromArray(n,6);const d=new p([1,0,0]),h=new p([0,1,0]),g=new p([0,0,1]);d.transformByQuaternion(u),d.scale(l[0]),h.transformByQuaternion(u),h.scale(l[1]),g.transformByQuaternion(u),g.scale(l[2]),i=[...d.toArray(),...h.toArray(),...g.toArray()]}else i=[...n.slice(3,6),...n.slice(6,9),...n.slice(9,12)];const r=e.transformAsVector(i.slice(0,3)),o=e.transformAsVector(i.slice(3,6)),a=e.transformAsVector(i.slice(6,9)),c=new U([r[0],r[1],r[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return Wr(t)?(t.center=s,t.halfAxes=c,t):new yt(s,c)}function Ai(n,e,t){const s=new p(n[0],n[1],n[2]);e.transform(s,s);const i=e.getScale(Ht),r=Math.max(Math.max(i[0],i[1]),i[2]),o=n[3]*r;return Wr(t)?(t.center=s,t.radius=o,t):new _t(s,o)}function Ng(n){const e=kr(),{halfAxes:t}=n,s=new p(t.getColumn(0)),i=new p(t.getColumn(1)),r=new p(t.getColumn(2));for(let o=0;o<2;o++){for(let a=0;a<2;a++){for(let c=0;c<2;c++)V.copy(n.center),V.add(s),V.add(i),V.add(r),Qr(e,V),r.negate();i.negate()}s.negate()}return e}function Hg(n){const e=kr(),{center:t,radius:s}=n,i=w.WGS84.scaleToGeodeticSurface(t,V);let r;i?r=w.WGS84.geodeticSurfaceNormal(i):r=new p(0,0,1);let o=new p(r[2],-r[1],0);o.len()>0?o.normalize():o=new p(0,1,0);const a=o.clone().cross(r);for(const c of[o,a,r]){Ht.copy(c).scale(s);for(let l=0;l<2;l++)V.copy(t),V.add(Ht),Qr(e,V),Ht.negate()}return e}function kr(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function Qr(n,e){w.WGS84.cartesianToCartographic(e,V),n[0][0]=Math.min(n[0][0],V[0]),n[0][1]=Math.min(n[0][1],V[1]),n[0][2]=Math.min(n[0][2],V[2]),n[1][0]=Math.max(n[1][0],V[0]),n[1][1]=Math.max(n[1][1],V[1]),n[1][2]=Math.max(n[1][2],V[2])}new p;new p;new F;new p;new p;new p;function Vg(n,e){const t=n*e;return 1-Math.exp(-(t*t))}function Jg(n,e){if(n.dynamicScreenSpaceError&&n.dynamicScreenSpaceErrorComputedDensity){const t=n.dynamicScreenSpaceErrorComputedDensity,s=n.dynamicScreenSpaceErrorFactor;return Vg(e,t)*s}return 0}function zg(n,e,t){const s=n.tileset,i=n.parent&&n.parent.lodMetricValue||n.lodMetricValue,r=t?i:n.lodMetricValue;if(r===0)return 0;const o=Math.max(n._distanceToCamera,1e-7),{height:a,sseDenominator:c}=e,{viewDistanceScale:l}=s.options;let u=r*a*(l||1)/(o*c);return u-=Jg(s,o),u}const An=new p,Ci=new p,Ee=new p,Bi=new p,Kg=new p,Cn=new F,_i=new F;function jg(n,e){if(n.lodMetricValue===0||isNaN(n.lodMetricValue))return"DIG";const t=2*qr(n,e);return t<2?"OUT":!n.header.children||t<=n.lodMetricValue?"DRAW":n.header.children?"DIG":"OUT"}function qr(n,e){const{topDownViewport:t}=e,s=n.header.mbs[1],i=n.header.mbs[0],r=n.header.mbs[2],o=n.header.mbs[3],a=[...n.boundingVolume.center],c=t.unprojectPosition(t.cameraPosition);w.WGS84.cartographicToCartesian(c,An),Ci.copy(An).subtract(a).normalize(),w.WGS84.eastNorthUpToFixedFrame(a,Cn),_i.copy(Cn).invert(),Ee.copy(An).transform(_i);const l=Math.sqrt(Ee[0]*Ee[0]+Ee[1]*Ee[1]),u=l*l/Ee[2];Bi.copy([Ee[0],Ee[1],u]);const h=Bi.transform(Cn).subtract(a).normalize(),m=Ci.cross(h).normalize().scale(o).add(a),A=w.WGS84.cartesianToCartographic(m),C=t.project([i,s,r]),B=t.project(A);return Kg.copy(C).subtract(B).magnitude()}function Xg(n){return{assetGltfUpAxis:n.asset&&n.asset.gltfUpAxis||"Y"}}class yi{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;f(this,"_map",new Map),f(this,"_array",void 0),f(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return L(e<this._array.length),this._array[e]}set(e,t){L(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){L(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){L(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const Wg={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class Zt{traversalFinished(e){return!0}constructor(e){f(this,"options",void 0),f(this,"root",null),f(this,"selectedTiles",{}),f(this,"requestedTiles",{}),f(this,"emptyTiles",{}),f(this,"lastUpdate",new Date().getTime()),f(this,"updateDebounceTime",1e3),f(this,"_traversalStack",new yi),f(this,"_emptyTraversalStack",new yi),f(this,"_frameNumber",null),this.options={...Wg,...e}}traverse(e,t,s){this.root=e,this.options={...this.options,...s},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const s=this._traversalStack;for(e._selectionDepth=1,s.push(e);s.length>0;){const r=s.pop();let o=!1;this.canTraverse(r,t)&&(this.updateChildTiles(r,t),o=this.updateAndPushChildren(r,t,s,r.hasRenderContent?r._selectionDepth+1:r._selectionDepth));const a=r.parent,c=!!(!a||a._shouldRefine),l=!o;r.hasRenderContent?r.refine===Ce.ADD?(this.loadTile(r,t),this.selectTile(r,t)):r.refine===Ce.REPLACE&&(this.loadTile(r,t),l&&this.selectTile(r,t)):(this.emptyTiles[r.id]=r,this.loadTile(r,t),l&&this.selectTile(r,t)),this.touchTile(r,t),r._shouldRefine=o&&c}const i=new Date().getTime();(this.traversalFinished(t)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const s=e.children;for(const i of s)this.updateTile(i,t)}updateAndPushChildren(e,t,s,i){const{loadSiblings:r,skipLevelOfDetail:o}=this.options,a=e.children;a.sort(this.compareDistanceToCamera.bind(this));const c=e.refine===Ce.REPLACE&&e.hasRenderContent&&!o;let l=!1,u=!0;for(const d of a)if(d._selectionDepth=i,d.isVisibleAndInRequestVolume?(s.find(d)&&s.delete(d),s.push(d),l=!0):(c||r)&&(this.loadTile(d,t),this.touchTile(d,t)),c){let h;if(d._inRequestVolume?d.hasRenderContent?h=d.contentAvailable:h=this.executeEmptyTraversal(d,t):h=!1,u=u&&h,!u)return!1}return l||(u=!1),u}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!i&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,t,s):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=e._screenSpaceError;return s&&(i=e.getScreenSpaceError(t,!0)),i>this.options.maximumScreenSpaceError}updateTileVisibility(e,t){const s=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===t.viewport.id&&s.push(i);else s.push(t.viewport.id);e.updateVisibility(t,s)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let s=!1;for(const i of e.children)i.updateVisibility(t),s=s||i.isVisibleAndInRequestVolume;return s}executeEmptyTraversal(e,t){let s=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0&&s;){const r=i.pop();if(this.updateTile(r,t),r.isVisibleAndInRequestVolume||this.loadTile(r,t),this.touchTile(r,t),!r.hasRenderContent&&this.canTraverse(r,t,!1,!0)){const a=r.children;for(const c of a)i.find(c)&&i.delete(c),i.push(c)}else!r.contentAvailable&&!r.hasEmptyContent&&(s=!1)}return s}}const Ei=new p;function kg(n){return n!=null}class wn{constructor(e,t,s){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";f(this,"tileset",void 0),f(this,"header",void 0),f(this,"id",void 0),f(this,"url",void 0),f(this,"parent",void 0),f(this,"refine",void 0),f(this,"type",void 0),f(this,"contentUrl",void 0),f(this,"lodMetricType","geometricError"),f(this,"lodMetricValue",0),f(this,"boundingVolume",null),f(this,"content",null),f(this,"contentState",W.UNLOADED),f(this,"gpuMemoryUsageInBytes",0),f(this,"children",[]),f(this,"depth",0),f(this,"viewportIds",[]),f(this,"transform",new F),f(this,"extensions",null),f(this,"implicitTiling",null),f(this,"userData",{}),f(this,"computedTransform",void 0),f(this,"hasEmptyContent",!1),f(this,"hasTilesetContent",!1),f(this,"traverser",new Zt({})),f(this,"_cacheNode",null),f(this,"_frameNumber",null),f(this,"_expireDate",null),f(this,"_expiredContent",null),f(this,"_boundingBox",void 0),f(this,"_distanceToCamera",0),f(this,"_screenSpaceError",0),f(this,"_visibilityPlaneMask",void 0),f(this,"_visible",void 0),f(this,"_contentBoundingVolume",void 0),f(this,"_viewerRequestVolume",void 0),f(this,"_initialTransform",new F),f(this,"_priority",0),f(this,"_selectedFrame",0),f(this,"_requestedFrame",0),f(this,"_selectionDepth",0),f(this,"_touchedFrame",0),f(this,"_centerZDepth",0),f(this,"_shouldRefine",!1),f(this,"_stackLength",0),f(this,"_visitedFrame",0),f(this,"_inRequestVolume",!1),f(this,"_lodJudge",null),this.header=t,this.tileset=e,this.id=i||t.id,this.url=t.url,this.parent=s,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===W.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===W.UNLOADED}get contentExpired(){return this.contentState===W.EXPIRED}get contentFailed(){return this.contentState===W.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=Gg(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case Y.I3S:return qr(this,e);case Y.TILES3D:return zg(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,s=this.refine===Ce.ADD||t;if(s&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===W.UNLOADED)return-1;const i=this.parent,o=i&&(!s||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,a=e.root?e.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=W.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=W.UNLOADED,!1;try{const s=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,r={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await At(s,i,r),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=W.READY,this._onContentLoaded(),!0}catch(s){throw this.contentState=W.FAILED,s}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=W.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const s=this.parent,i=s?s._visibilityPlaneMask:$.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const r=s?s.computedTransform:this.tileset.modelMatrix;this._updateTransform(r)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==$.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:s}=e,{boundingVolume:i}=this;return s.computeVisibilityWithPlaneMask(i,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:t}=e;const s=this.boundingVolume;return Ei.subVectors(s.center,t.position),t.direction.dot(Ei)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(kg(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=W.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new F(e.transform):new F;const t=this.parent,s=this.tileset,i=t&&t.computedTransform?t.computedTransform.clone():s.modelMatrix.clone();this.computedTransform=new F(i).multiplyRight(this.transform);const r=t&&t._initialTransform?t._initialTransform.clone():new F;this._initialTransform=new F(r).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=W.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=$.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||Ce.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=pn(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=pn(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=pn(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new F).clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return Xg(this.tileset.tileset)}}}class Qg extends Zt{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const s=e.children.length>0;if(e.hasTilesetContent&&s){const o=e.children[0];this.updateTileVisibility(o,t),e._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}const i=e.refine===Ce.REPLACE,r=e._optimChildrenWithinParent===Og.USE_OPTIMIZATION;if(i&&r&&s&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){const{parent:s}=e;return!s||s.hasTilesetContent||s.refine!==Ce.ADD?!1:!this.shouldRefine(e,t,!0)}}class qg{constructor(){f(this,"frameNumberMap",new Map)}register(e,t){const s=this.frameNumberMap.get(e)||new Map,i=s.get(t)||0;s.set(t,i+1),this.frameNumberMap.set(e,s)}deregister(e,t){const s=this.frameNumberMap.get(e);if(!s)return;const i=s.get(t)||1;s.set(t,i-1)}isZero(e,t){var s;return(((s=this.frameNumberMap.get(e))===null||s===void 0?void 0:s.get(t))||0)===0}}const Bn={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Yg{constructor(){f(this,"_statusMap",void 0),f(this,"pendingTilesRegister",new qg),this._statusMap={}}add(e,t,s,i){if(!this._statusMap[t]){const{frameNumber:r,viewport:{id:o}}=i;this._statusMap[t]={request:e,callback:s,key:t,frameState:i,status:Bn.REQUESTED},this.pendingTilesRegister.register(o,r),e().then(a=>{this._statusMap[t].status=Bn.COMPLETED;const{frameNumber:c,viewport:{id:l}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(l,c),this._statusMap[t].callback(a,i)}).catch(a=>{this._statusMap[t].status=Bn.ERROR;const{frameNumber:c,viewport:{id:l}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(l,c),s(a)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:s,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,s);const{frameNumber:r,viewport:{id:o}}=t;this.pendingTilesRegister.register(o,r),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class Zg extends Zt{constructor(e){super(e),f(this,"_tileManager",void 0),this._tileManager=new Yg}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=jg(e,t),e._lodJudge==="DIG"}updateChildTiles(e,t){const s=e.header.children||[],i=e.children,r=e.tileset;for(const o of s){const a="".concat(o.id,"-").concat(t.viewport.id),c=i&&i.find(l=>l.id===a);if(c)c&&this.updateTile(c,t);else{let l=()=>this._loadTile(o.id,r);this._tileManager.find(a)?this._tileManager.update(a,t):(r.tileset.nodePages&&(l=()=>r.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(l,a,d=>this._onTileLoad(d,e,a),t))}}return!1}async _loadTile(e,t){const{loader:s}=t,i=t.getTileUrl("".concat(t.url,"/nodes/").concat(e)),r={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await At(i,s,r)}_onTileLoad(e,t,s){const i=new wn(t.tileset,e,t,s);t.children.push(i);const r=this._tileManager.find(i.id).frameState;this.updateTile(i,r),this._frameNumber===r.frameNumber&&(this.traversalFinished(r)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,r)}}const $g={description:"",ellipsoid:w.WGS84,modelMatrix:new F,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:n=>n,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Lt="Tiles In Tileset(s)",_n="Tiles In Memory",Ti="Tiles In View",bi="Tiles To Render",Si="Tiles Loaded",yn="Tiles Loading",Mi="Tiles Unloaded",vi="Failed Tile Loads",Ii="Points/Vertices",En="Tile Memory Use";class em{constructor(e,t){f(this,"options",void 0),f(this,"loadOptions",void 0),f(this,"type",void 0),f(this,"tileset",void 0),f(this,"loader",void 0),f(this,"url",void 0),f(this,"basePath",void 0),f(this,"modelMatrix",void 0),f(this,"ellipsoid",void 0),f(this,"lodMetricType",void 0),f(this,"lodMetricValue",void 0),f(this,"refine",void 0),f(this,"root",null),f(this,"roots",{}),f(this,"asset",{}),f(this,"description",""),f(this,"properties",void 0),f(this,"extras",null),f(this,"attributions",{}),f(this,"credits",{}),f(this,"stats",void 0),f(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),f(this,"cartographicCenter",null),f(this,"cartesianCenter",null),f(this,"zoom",1),f(this,"boundingVolume",null),f(this,"dynamicScreenSpaceErrorComputedDensity",0),f(this,"maximumMemoryUsage",32),f(this,"gpuMemoryUsageInBytes",0),f(this,"_frameNumber",0),f(this,"_queryParams",{}),f(this,"_extensionsUsed",[]),f(this,"_tiles",{}),f(this,"_pendingCount",0),f(this,"selectedTiles",[]),f(this,"traverseCounter",0),f(this,"geometricError",0),f(this,"lastUpdatedVieports",null),f(this,"_requestedTiles",[]),f(this,"_emptyTiles",[]),f(this,"frameStateData",{}),f(this,"_traverser",void 0),f(this,"_cache",new bg),f(this,"_requestScheduler",void 0),f(this,"updatePromise",null),f(this,"tilesetInitializationPromise",void 0),this.options={...$g,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||rr(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Da({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new Qi({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(e.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const s=[];for(const i of t){const r=i.id;this._needTraverse(r)?s.push(r):this.traverseCounter--}for(const i of t){const r=i.id;if(this.roots[r]||(this.roots[r]=this._initializeTileHeaders(this.tileset,null)),!s.includes(r))continue;const o=Mg(i,this._frameNumber);this._traverser.traverse(this.roots[r],o,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const s=this.frameStateData[t],i=Object.values(this._traverser.selectedTiles),[r,o]=vg(i,e,this.options.maximumTilesSelected);s.selectedTiles=r;for(const a of o)a.unselect();s._requestedTiles=Object.values(this._traverser.requestedTiles),s._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const s=new Set(e.map(o=>o.id)),i=new Set(t.map(o=>o.id));let r=e.filter(o=>!i.has(o.id)).length>0;return r=r||t.filter(o=>!s.has(o.id)).length>0,r}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const s of this.selectedTiles)s.contentAvailable&&s.content&&(e++,s.content.pointCount?t+=s.content.pointCount:t+=s.content.vertexCount);this.stats.get(Ti).count=this.selectedTiles.length,this.stats.get(bi).count=e,this.stats.get(Ii).count=t}async _initializeTileSet(e){this.type===Y.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Y.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Y.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const t=this.tileset.fullExtent;if(t){const{xmin:i,xmax:r,ymin:o,ymax:a,zmin:c,zmax:l}=t;this.cartographicCenter=new p(i+(r-i)/2,o+(a-o)/2,c+(l-c)/2),this.cartesianCenter=w.WGS84.cartographicToCartesian(this.cartographicCenter,new p),this.zoom=Xr(t,this.cartographicCenter,this.cartesianCenter);return}const s=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(s){const[i,r,o,a]=s;this.cartographicCenter=new p(i+(o-i)/2,r+(a-r)/2,0),this.cartesianCenter=w.WGS84.cartographicToCartesian(this.cartographicCenter,new p),this.zoom=Fg(s,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new p,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new p,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?this.cartographicCenter=w.WGS84.cartesianToCartographic(t,new p):this.cartographicCenter=new p(0,0,-w.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=xg(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(Lt),this.stats.get(yn),this.stats.get(_n),this.stats.get(Ti),this.stats.get(bi),this.stats.get(Si),this.stats.get(Mi),this.stats.get(vi),this.stats.get(Ii),this.stats.get(En,"memory")}_initializeTileHeaders(e,t){const s=new wn(this,e.root,t);if(t&&(t.children.push(s),s.depth=t.depth+1),this.type===Y.TILES3D){const r=[];for(r.push(s);r.length>0;){const o=r.pop();this.stats.get(Lt).incrementCount();const a=o.header.children||[];for(const c of a){var i;const l=new wn(this,c,o);if((i=l.contentUrl)!==null&&i!==void 0&&i.includes("?session=")){const d=new URL(l.contentUrl).searchParams.get("session");d&&(this._queryParams.session=d)}o.children.push(l),l.depth=o.depth+1,r.push(l)}}}return s}_initializeTraverser(){let e;switch(this.type){case Y.TILES3D:e=Qg;break;case Y.I3S:e=Zg;break;default:e=Zt}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(s){this._onTileLoadError(e,s instanceof Error?s:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(vi).incrementCount();const s=t.message||t.toString(),i=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(s)),this.options.onTileError(e,s,i)}_onTileLoad(e,t){if(t){if(this.type===Y.I3S){var s,i;const r=((s=this.tileset)===null||s===void 0||(i=s.nodePagesTile)===null||i===void 0?void 0:i.nodesInNodePages)||0;this.stats.get(Lt).reset(),this.stats.get(Lt).addCount(r)}e&&e.content&&Sg(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===Y.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Y.TILES3D){var t;const{extensionsRemoved:s=[]}=((t=e.content)===null||t===void 0?void 0:t.gltf)||{};s.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),s.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),s.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(yn).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(yn).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(Si).incrementCount(),this.stats.get(_n).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(En).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(_n).decrementCount(),this.stats.get(Mi).incrementCount(),this.stats.get(En).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const s of t.children)e.push(s);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,s=[];for(s.push(t);s.length>0;){e=s.pop();for(const i of e.children)s.push(i);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),s=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...s}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const Yr="3.4.15",rt={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function Zr(n,e,t){L(n instanceof ArrayBuffer);const s=new TextDecoder("utf8"),i=new Uint8Array(n,e,t);return s.decode(i)}function tm(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const t=new DataView(n);return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}const nm={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},N={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},v={...nm,...N},Tn={[N.DOUBLE]:Float64Array,[N.FLOAT]:Float32Array,[N.UNSIGNED_SHORT]:Uint16Array,[N.UNSIGNED_INT]:Uint32Array,[N.UNSIGNED_BYTE]:Uint8Array,[N.BYTE]:Int8Array,[N.SHORT]:Int16Array,[N.INT]:Int32Array},sm={DOUBLE:N.DOUBLE,FLOAT:N.FLOAT,UNSIGNED_SHORT:N.UNSIGNED_SHORT,UNSIGNED_INT:N.UNSIGNED_INT,UNSIGNED_BYTE:N.UNSIGNED_BYTE,BYTE:N.BYTE,SHORT:N.SHORT,INT:N.INT},bn="Failed to convert GL type";class ue{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in Tn)if(Tn[t]===e)return t;throw new Error(bn)}static fromName(e){const t=sm[e];if(!t)throw new Error(bn);return t}static getArrayType(e){switch(e){case N.UNSIGNED_SHORT_5_6_5:case N.UNSIGNED_SHORT_4_4_4_4:case N.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=Tn[e];if(!t)throw new Error(bn);return t}}static getByteSize(e){return ue.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!ue.getArrayType(e)}static createTypedArray(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;i===void 0&&(i=(t.byteLength-s)/ue.getByteSize(e));const r=ue.getArrayType(e);return new r(t,s,i)}}function im(n,e){if(!n)throw new Error("math.gl assertion failed. ".concat(e))}function rm(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const t=n>>11&31,s=n>>5&63,i=n&31;return e[0]=t<<3,e[1]=s<<2,e[2]=i<<3,e}new Wn;new p;new Wn;new Wn;function Ri(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return pa(n,0,e)/e*2-1}function Pi(n){return n<0?-1:1}function om(n,e,t,s){if(im(s),n<0||n>t||e<0||e>t)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(t));if(s.x=Ri(n,t),s.y=Ri(e,t),s.z=1-(Math.abs(s.x)+Math.abs(s.y)),s.z<0){const i=s.x;s.x=(1-Math.abs(s.y))*Pi(i),s.y=(1-Math.abs(i))*Pi(s.y)}return s.normalize()}function am(n,e,t){return om(n,e,255,t)}class ds{constructor(e,t){f(this,"json",void 0),f(this,"buffer",void 0),f(this,"featuresLength",0),f(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:v.UNSIGNED_INT,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,t,s,1,i.byteOffset):i}getPropertyArray(e,t,s){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(t=ue.fromName(i.componentType)),this._getTypedArrayFromBinary(e,t,s,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,t,i)}getProperty(e,t,s,i,r){const o=this.json[e];if(!o)return o;const a=this.getPropertyArray(e,t,s);if(s===1)return a[i];for(let c=0;c<s;++c)r[c]=a[s*i+c];return r}_getTypedArrayFromBinary(e,t,s,i,r){const o=this._cachedTypedArrays;let a=o[e];return a||(a=ue.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+r,i*s),o[e]=a),a}_getTypedArrayFromArray(e,t,s){const i=this._cachedTypedArrays;let r=i[e];return r||(r=ue.createTypedArray(t,s),i[e]=r),r}}const cm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lm={SCALAR:(n,e)=>n[e],VEC2:(n,e)=>[n[2*e+0],n[2*e+1]],VEC3:(n,e)=>[n[3*e+0],n[3*e+1],n[3*e+2]],VEC4:(n,e)=>[n[4*e+0],n[4*e+1],n[4*e+2],n[4*e+3]],MAT2:(n,e)=>[n[4*e+0],n[4*e+1],n[4*e+2],n[4*e+3]],MAT3:(n,e)=>[n[9*e+0],n[9*e+1],n[9*e+2],n[9*e+3],n[9*e+4],n[9*e+5],n[9*e+6],n[9*e+7],n[9*e+8]],MAT4:(n,e)=>[n[16*e+0],n[16*e+1],n[16*e+2],n[16*e+3],n[16*e+4],n[16*e+5],n[16*e+6],n[16*e+7],n[16*e+8],n[16*e+9],n[16*e+10],n[16*e+11],n[16*e+12],n[16*e+13],n[16*e+14],n[16*e+15]]},um={SCALAR:(n,e,t)=>{e[t]=n},VEC2:(n,e,t)=>{e[2*t+0]=n[0],e[2*t+1]=n[1]},VEC3:(n,e,t)=>{e[3*t+0]=n[0],e[3*t+1]=n[1],e[3*t+2]=n[2]},VEC4:(n,e,t)=>{e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},MAT2:(n,e,t)=>{e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]},MAT3:(n,e,t)=>{e[9*t+0]=n[0],e[9*t+1]=n[1],e[9*t+2]=n[2],e[9*t+3]=n[3],e[9*t+4]=n[4],e[9*t+5]=n[5],e[9*t+6]=n[6],e[9*t+7]=n[7],e[9*t+8]=n[8],e[9*t+9]=n[9]},MAT4:(n,e,t)=>{e[16*t+0]=n[0],e[16*t+1]=n[1],e[16*t+2]=n[2],e[16*t+3]=n[3],e[16*t+4]=n[4],e[16*t+5]=n[5],e[16*t+6]=n[6],e[16*t+7]=n[7],e[16*t+8]=n[8],e[16*t+9]=n[9],e[16*t+10]=n[10],e[16*t+11]=n[11],e[16*t+12]=n[12],e[16*t+13]=n[13],e[16*t+14]=n[14],e[16*t+15]=n[15]}};function dm(n,e,t,s){const{componentType:i}=n;L(n.componentType);const r=typeof i=="string"?ue.fromName(i):i,o=cm[n.type],a=lm[n.type],c=um[n.type];return t+=n.byteOffset,{values:ue.createTypedArray(r,e,t,o*s),type:r,size:o,unpacker:a,packer:c}}const ce=n=>n!==void 0;function hm(n,e,t){if(!e)return null;let s=n.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,s=i),s?fm(s,t):null}function fm(n,e){let t,s,i;const r=n.instancesLength,o=n.classes;let a=n.classIds,c=n.parentCounts,l=n.parentIds,u=r;ce(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,i=getBinaryAccessor(a),a=i.createArrayBufferView(e.buffer,e.byteOffset+a.byteOffset,r));let d;if(ce(c))for(ce(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),c=i.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,r)),d=new Uint16Array(r),u=0,t=0;t<r;++t)d[t]=u,u+=c[t];ce(l)&&ce(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,i=getBinaryAccessor(l),l=i.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,u));const h=o.length;for(t=0;t<h;++t){const C=o[t].length,B=o[t].instances,E=getBinaryProperties(C,B,e);o[t].instances=combine(E,B)}const g=new Array(h).fill(0),m=new Uint16Array(r);for(t=0;t<r;++t)s=a[t],m[t]=g[s],++g[s];const A={classes:o,classIds:a,classIndexes:m,parentCounts:c,parentIndexes:d,parentIds:l};return pm(A),A}function ot(n,e,t){if(!n)return;const s=n.parentCounts;return n.parentIds?t(n,e):s>0?gm(n,e,t):mm(n,e,t)}function gm(n,e,t){const s=n.classIds,i=n.parentCounts,r=n.parentIds,o=n.parentIndexes,a=s.length,c=scratchVisited;c.length=Math.max(c.length,a);const l=++marker,u=scratchStack;for(u.length=0,u.push(e);u.length>0;){if(e=u.pop(),c[e]===l)continue;c[e]=l;const d=t(n,e);if(ce(d))return d;const h=i[e],g=o[e];for(let m=0;m<h;++m){const A=r[g+m];A!==e&&u.push(A)}}return null}function mm(n,e,t){let s=!0;for(;s;){const i=t(n,e);if(ce(i))return i;const r=n.parentIds[e];s=r!==e,e=r}throw new Error("traverseHierarchySingleParent")}function pm(n){const t=n.classIds.length;for(let s=0;s<t;++s)$r(n,s,stack)}function $r(n,e,t){const s=n.parentCounts,i=n.parentIds,r=n.parentIndexes,a=n.classIds.length;if(!ce(i))return;assert(e<a,"Parent index ".concat(e," exceeds the total number of instances: ").concat(a)),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const c=ce(s)?s[e]:1,l=ce(s)?r[e]:e;for(let u=0;u<c;++u){const d=i[l+u];d!==e&&$r(n,d,t)}t.pop(e)}function z(n){return n!=null}const wt=(n,e)=>n,Am={HIERARCHY:!0,extensions:!0,extras:!0};class eo{constructor(e,t,s){var i;let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};f(this,"json",void 0),f(this,"binary",void 0),f(this,"featureCount",void 0),f(this,"_extensions",void 0),f(this,"_properties",void 0),f(this,"_binaryProperties",void 0),f(this,"_hierarchy",void 0),L(s>=0),this.json=e||{},this.binary=t,this.featureCount=s,this._extensions=((i=this.json)===null||i===void 0?void 0:i.extensions)||{},this._properties={};for(const o in this.json)Am[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=hm(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),L(typeof t=="string",t),this._hierarchy){const s=ot(this._hierarchy,e,(i,r)=>{const o=i.classIds[r];return i.classes[o].name===t});return z(s)}return!1}isExactClass(e,t){return L(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),L(typeof t=="string",t),z(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=z(t)?t:[],t.length=0;const s=Object.keys(this._properties);return t.push(...s),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),L(typeof t=="string",t),this._binaryProperties){const i=this._binaryProperties[t];if(z(i))return this._getBinaryProperty(i,e)}const s=this._properties[t];if(z(s))return wt(s[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,t);if(z(i))return i}}setProperty(e,t,s){const i=this.featureCount;if(this._checkBatchId(e),L(typeof t=="string",t),this._binaryProperties){const o=this._binaryProperties[t];if(o){this._setBinaryProperty(o,e,s);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,s))return;let r=this._properties[t];z(r)||(this._properties[t]=new Array(i),r=this._properties[t]),r[e]=wt(s)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,s){e.pack(s,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const s=this._properties[t],i=this._initializeBinaryProperty(t,s);i&&(e=e||{},e[t]=i)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const s=t;L(this.binary,"Property ".concat(e," requires a batch table binary.")),L(s.type,"Property ".concat(e," requires a type."));const i=dm(s,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const s=ot(this._hierarchy,e,(i,r)=>{const o=i.classIds[r],a=i.classes[o].instances;return z(a[t])});return z(s)}_getPropertyNamesInHierarchy(e,t){ot(this._hierarchy,e,(s,i)=>{const r=s.classIds[i],o=s.classes[r].instances;for(const a in o)o.hasOwnProperty(a)&&t.indexOf(a)===-1&&t.push(a)})}_getHierarchyProperty(e,t){return ot(this._hierarchy,e,(s,i)=>{const r=s.classIds[i],o=s.classes[r],a=s.classIndexes[i],c=o.instances[t];return z(c)?z(c.typedArray)?this._getBinaryProperty(c,a):wt(c[a]):null})}_setHierarchyProperty(e,t,s,i){const r=ot(this._hierarchy,t,(o,a)=>{const c=o.classIds[a],l=o.classes[c],u=o.classIndexes[a],d=l.instances[s];return z(d)?(L(a===t,'Inherited property "'.concat(s,'" is read-only.')),z(d.typedArray)?this._setBinaryProperty(d,u,i):d[u]=wt(i),!0):!1});return z(r)}}const Sn=4;function $t(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=new DataView(e);if(n.magic=s.getUint32(t,!0),t+=Sn,n.version=s.getUint32(t,!0),t+=Sn,n.byteLength=s.getUint32(t,!0),t+=Sn,n.version!==1)throw new Error("3D Tile Version ".concat(n.version," not supported"));return t}const Ne=4,xi="b3dm tile in legacy format.";function hs(n,e,t){const s=new DataView(e);let i;n.header=n.header||{};let r=s.getUint32(t,!0);t+=Ne;let o=s.getUint32(t,!0);t+=Ne;let a=s.getUint32(t,!0);t+=Ne;let c=s.getUint32(t,!0);return t+=Ne,a>=570425344?(t-=Ne*2,i=r,a=o,c=0,r=0,o=0,console.warn(xi)):c>=570425344&&(t-=Ne,i=a,a=r,c=o,r=0,o=0,console.warn(xi)),n.header.featureTableJsonByteLength=r,n.header.featureTableBinaryByteLength=o,n.header.batchTableJsonByteLength=a,n.header.batchTableBinaryByteLength=c,n.header.batchLength=i,t}function fs(n,e,t,s){return t=Cm(n,e,t),t=Bm(n,e,t),t}function Cm(n,e,t,s){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:r,batchLength:o}=n.header;if(n.featureTableJson={BATCH_LENGTH:o||0},i>0){const a=Zr(e,t,i);n.featureTableJson=JSON.parse(a)}return t+=i,n.featureTableBinary=new Uint8Array(e,t,r),t+=r,t}function Bm(n,e,t,s){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:r}=n.header;if(i>0){const o=Zr(e,t,i);n.batchTableJson=JSON.parse(o),t+=i,r>0&&(n.batchTableBinary=new Uint8Array(e,t,r),n.batchTableBinary=new Uint8Array(n.batchTableBinary),t+=r)}return t}function to(n,e,t){if(!e&&(!n||!n.batchIds||!t))return null;const{batchIds:s,isRGB565:i,pointCount:r}=n;if(s&&t){const o=new Uint8ClampedArray(r*3);for(let a=0;a<r;a++){const c=s[a],u=t.getProperty(c,"dimensions").map(d=>d*255);o[a*3]=u[0],o[a*3+1]=u[1],o[a*3+2]=u[2]}return{type:v.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(i){const o=new Uint8ClampedArray(r*3);for(let a=0;a<r;a++){const c=rm(e[a]);o[a*3]=c[0],o[a*3+1]=c[1],o[a*3+2]=c[2]}return{type:v.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return e&&e.length===r*3?{type:v.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:v.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const Fi=new p;function _m(n,e){if(!e)return null;if(n.isOctEncoded16P){const t=new Float32Array(n.pointsLength*3);for(let s=0;s<n.pointsLength;s++)am(e[s*2],e[s*2+1],Fi),Fi.toArray(t,s*3);return{type:v.FLOAT,size:2,value:t}}return{type:v.FLOAT,size:2,value:e}}function ym(n,e,t){return n.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(n.isQuantized=!1,Em(n,e)):{type:v.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function Em(n,e){const t=new p,s=new Float32Array(n.pointCount*3);for(let i=0;i<n.pointCount;i++)t.set(e[i*3],e[i*3+1],e[i*3+2]).scale(1/n.quantizedRange).multiply(n.quantizedVolumeScale).add(n.quantizedVolumeOffset).toArray(s,i*3);return s}async function Tm(n,e,t,s,i){t=$t(n,e,t),t=hs(n,e,t),t=fs(n,e,t),bm(n);const{featureTable:r,batchTable:o}=Sm(n);return await Pm(n,r,o,s,i),Mm(n,r,s),vm(n,r,o),Im(n,r),t}function bm(n){n.attributes={positions:null,colors:null,normals:null,batchIds:null},n.isQuantized=!1,n.isTranslucent=!1,n.isRGB565=!1,n.isOctEncoded16P=!1}function Sm(n){const e=new ds(n.featureTableJson,n.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,n.featuresLength=t,n.pointsLength=t,n.pointCount=t,n.rtcCenter=e.getGlobalProperty("RTC_CENTER",v.FLOAT,3);const s=Rm(n,e);return{featureTable:e,batchTable:s}}function Mm(n,e,t){if(!n.attributes.positions){if(e.hasProperty("POSITION"))n.attributes.positions=e.getPropertyArray("POSITION",v.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const s=e.getPropertyArray("POSITION_QUANTIZED",v.UNSIGNED_SHORT,3);if(n.isQuantized=!0,n.quantizedRange=65535,n.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",v.FLOAT,3),!n.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(n.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",v.FLOAT,3),!n.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");n.attributes.positions=ym(n,s,t)}}if(!n.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function vm(n,e,t){if(!n.attributes.colors){let s=null;e.hasProperty("RGBA")?(s=e.getPropertyArray("RGBA",v.UNSIGNED_BYTE,4),n.isTranslucent=!0):e.hasProperty("RGB")?s=e.getPropertyArray("RGB",v.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(s=e.getPropertyArray("RGB565",v.UNSIGNED_SHORT,1),n.isRGB565=!0),n.attributes.colors=to(n,s,t)}e.hasProperty("CONSTANT_RGBA")&&(n.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",v.UNSIGNED_BYTE,4))}function Im(n,e){if(!n.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",v.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",v.UNSIGNED_BYTE,2),n.isOctEncoded16P=!0),n.attributes.normals=_m(n,t)}}function Rm(n,e){let t=null;if(!n.batchIds&&e.hasProperty("BATCH_ID")&&(n.batchIds=e.getPropertyArray("BATCH_ID",v.UNSIGNED_SHORT,1),n.batchIds)){const s=e.getGlobalProperty("BATCH_LENGTH");if(!s)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:r}=n;t=new eo(i,r,s)}return t}async function Pm(n,e,t,s,i){let r,o,a;const c=n.batchTableJson&&n.batchTableJson.extensions&&n.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(a=c.properties);const l=e.getExtension("3DTILES_draco_point_compression");if(l){o=l.properties;const d=l.byteOffset,h=l.byteLength;if(!o||!Number.isFinite(d)||!h)throw new Error("Draco properties, byteOffset, and byteLength must be defined");r=n.featureTableBinary.slice(d,d+h),n.hasPositions=Number.isFinite(o.POSITION),n.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),n.hasNormals=Number.isFinite(o.NORMAL),n.hasBatchIds=Number.isFinite(o.BATCH_ID),n.isTranslucent=Number.isFinite(o.RGBA)}if(!r)return!0;const u={buffer:r,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await xm(n,u,s,i)}async function xm(n,e,t,s){const{parse:i}=s,r={...t,draco:{...t.draco,extraAttributes:e.batchTableProperties||{}}};delete r["3d-tiles"];const o=await i(e.buffer,Rr,r),a=o.attributes.POSITION&&o.attributes.POSITION.value,c=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,l=o.attributes.NORMAL&&o.attributes.NORMAL.value,u=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,d=a&&o.attributes.POSITION.value.quantization,h=l&&o.attributes.NORMAL.value.quantization;if(d){const m=o.POSITION.data.quantization,A=m.range;n.quantizedVolumeScale=new p(A,A,A),n.quantizedVolumeOffset=new p(m.minValues),n.quantizedRange=(1<<m.quantizationBits)-1,n.isQuantizedDraco=!0}h&&(n.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,n.isOctEncodedDraco=!0);const g={};if(e.batchTableProperties)for(const m of Object.keys(e.batchTableProperties))o.attributes[m]&&o.attributes[m].value&&(g[m.toLowerCase()]=o.attributes[m].value);n.attributes={positions:a,colors:to(n,c,void 0),normals:l,batchIds:u,...g}}const Gn={URI:0,EMBEDDED:1};function no(n,e,t,s){n.rotateYtoZ=!0;const i=n.byteOffset+n.byteLength-t;if(i===0)throw new Error("glTF byte length must be greater than 0.");return n.gltfUpAxis=s["3d-tiles"]&&s["3d-tiles"].assetGltfUpAxis?s["3d-tiles"].assetGltfUpAxis:"Y",n.gltfArrayBuffer=Xn(e,t,i),n.gltfByteOffset=0,n.gltfByteLength=i,t%4===0||console.warn("".concat(n.type,": embedded glb is not aligned to a 4-byte boundary.")),n.byteOffset+n.byteLength}async function so(n,e,t,s){const i=t["3d-tiles"]||{};if(Fm(n,e),i.loadGLTF){const{parse:r,fetch:o}=s;n.gltfUrl&&(n.gltfArrayBuffer=await o(n.gltfUrl,t),n.gltfByteOffset=0),n.gltfArrayBuffer&&(n.gltf=await r(n.gltfArrayBuffer,qe,t,s),n.gpuMemoryUsageInBytes=vr(n.gltf),delete n.gltfArrayBuffer,delete n.gltfByteOffset,delete n.gltfByteLength)}}function Fm(n,e,t){switch(e){case Gn.URI:const s=new Uint8Array(n.gltfArrayBuffer,n.gltfByteOffset),r=new TextDecoder().decode(s);n.gltfUrl=r.replace(/[\s\0]+$/,""),delete n.gltfArrayBuffer,delete n.gltfByteOffset,delete n.gltfByteLength;break;case Gn.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function Dm(n,e,t,s,i){var r;t=Om(n,e,t,s),await so(n,Gn.EMBEDDED,s,i);const o=n==null||(r=n.gltf)===null||r===void 0?void 0:r.extensions;return o&&o.CESIUM_RTC&&(n.rtcCenter=o.CESIUM_RTC.center),t}function Om(n,e,t,s,i){t=$t(n,e,t),t=hs(n,e,t),t=fs(n,e,t),t=no(n,e,t,s);const r=new ds(n.featureTableJson,n.featureTableBinary);return n.rtcCenter=r.getGlobalProperty("RTC_CENTER",v.FLOAT,3),t}async function Lm(n,e,t,s,i){return t=wm(n,e,t,s),await so(n,n.gltfFormat,s,i),t}function wm(n,e,t,s,i){if(t=$t(n,e,t),n.version!==1)throw new Error("Instanced 3D Model version ".concat(n.version," is not supported"));t=hs(n,e,t);const r=new DataView(e);if(n.gltfFormat=r.getUint32(t,!0),t+=4,t=fs(n,e,t),t=no(n,e,t,s),n.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new ds(n.featureTableJson,n.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");n.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),n.rtcCenter=o.getGlobalProperty("RTC_CENTER",v.FLOAT,3);const c=new eo(n.batchTableJson,n.batchTableBinary,a);return Gm(n,o,c,a),t}function Gm(n,e,t,s){const r={instances:new Array(s),batchTable:n._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,o=new p;new p,new p,new p;const a=new U,c=new dt,l=new p,u={},d=new F,h=[],g=[],m=new p,A=new p;for(let C=0;C<s;C++){let B;if(e.hasProperty("POSITION"))B=e.getProperty("POSITION",v.FLOAT,3,C,o);else if(e.hasProperty("POSITION_QUANTIZED")){B=e.getProperty("POSITION_QUANTIZED",v.UNSIGNED_SHORT,3,C,o);const O=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",v.FLOAT,3,m);if(!O)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const P=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",v.FLOAT,3,A);if(!P)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const R=65535;for(let S=0;S<3;S++)B[S]=B[S]/R*P[S]+O[S]}if(!B)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(B),u.translation=o,n.normalUp=e.getProperty("NORMAL_UP",v.FLOAT,3,C,h),n.normalRight=e.getProperty("NORMAL_RIGHT",v.FLOAT,3,C,g),n.normalUp){if(!n.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");n.hasCustomOrientation=!0}else{if(n.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",v.UNSIGNED_SHORT,2,h),n.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",v.UNSIGNED_SHORT,2,g),n.octNormalUp)throw n.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");n.eastNorthUp?(w.WGS84.eastNorthUpToFixedFrame(o,d),d.getRotationMatrix3(a)):a.identity()}c.fromMatrix3(a),u.rotation=c,l.set(1,1,1);const E=e.getProperty("SCALE",v.FLOAT,1,C);Number.isFinite(E)&&l.multiplyByScalar(E);const T=e.getProperty("SCALE_NON_UNIFORM",v.FLOAT,3,C,h);T&&l.scale(T),u.scale=l;let b=e.getProperty("BATCH_ID",v.UNSIGNED_SHORT,1,C);b===void 0&&(b=C);const M=new F().fromQuaternion(u.rotation);d.identity(),d.translate(u.translation),d.multiplyRight(M),d.scale(u.scale);const D=d.clone();r[C]={modelMatrix:D,batchId:b}}n.instances=r}async function Um(n,e,t,s,i,r){t=$t(n,e,t);const o=new DataView(e);for(n.tilesLength=o.getUint32(t,!0),t+=4,n.tiles=[];n.tiles.length<n.tilesLength&&n.byteLength-t>12;){const a={};n.tiles.push(a),t=await r(e,t,s,i,a)}return t}async function Nm(n,e,t,s){n.rotateYtoZ=!0,n.gltfUpAxis=t["3d-tiles"]&&t["3d-tiles"].assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y";const{parse:i}=s;n.gltf=await i(e,qe,t,s),n.gpuMemoryUsageInBytes=vr(n.gltf)}async function io(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(i.byteOffset=e,i.type=tm(n,e),i.type){case rt.COMPOSITE:return await Um(i,n,e,t,s,io);case rt.BATCHED_3D_MODEL:return await Dm(i,n,e,t,s);case rt.GLTF:return await Nm(i,n,t,s);case rt.INSTANCED_3D_MODEL:return await Lm(i,n,e,t,s);case rt.POINT_CLOUD:return await Tm(i,n,e,t,s);default:throw new Error("3DTileLoader: unknown type ".concat(i.type))}}const Hm=1952609651,Vm=1;async function Jm(n,e,t){if(new Uint32Array(n.slice(0,4))[0]!==Hm)throw new Error("Wrong subtree file magic number");if(new Uint32Array(n.slice(4,8))[0]!==Vm)throw new Error("Wrong subtree file verson, must be 1");const r=Di(n.slice(8,16)),o=new Uint8Array(n,24,r),c=new TextDecoder("utf8").decode(o),l=JSON.parse(c),u=Di(n.slice(16,24));let d=new ArrayBuffer(0);return u&&(d=n.slice(24+r)),"bufferView"in l.tileAvailability&&(l.tileAvailability.explicitBitstream=await Mn(l,"tileAvailability",d,t)),"bufferView"in l.contentAvailability&&(l.contentAvailability.explicitBitstream=await Mn(l,"contentAvailability",d,t)),"bufferView"in l.childSubtreeAvailability&&(l.childSubtreeAvailability.explicitBitstream=await Mn(l,"childSubtreeAvailability",d,t)),l}function zm(n,e){if(e.startsWith("http")){const r=new URL(n,e);return decodeURI(r.toString())}const s="http://".concat(e),i=new URL(n,s);return"/".concat(i.host).concat(i.pathname)}async function Mn(n,e,t,s){const i=n[e].bufferView,r=n.bufferViews[i],o=n.buffers[r.buffer];if(!(s!=null&&s.url)||!s.fetch)throw new Error("Url is not provided");if(!s.fetch)throw new Error("fetch is not provided");if(o.uri){const a=zm(o.uri,s==null?void 0:s.url),l=await(await s.fetch(a)).arrayBuffer();return new Uint8Array(l,r.byteOffset,r.byteLength)}return new Uint8Array(t,r.byteOffset,r.byteLength)}function Di(n){const e=new DataView(n),t=e.getUint32(0,!0),s=e.getUint32(4,!0);return t+2**32*s}const ro={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:Yr,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:Jm,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var ee=null;try{ee=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function x(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}x.prototype.__isLong__;Object.defineProperty(x.prototype,"__isLong__",{value:!0});function J(n){return(n&&n.__isLong__)===!0}function Oi(n){var e=Math.clz32(n&-n);return n?31-e:e}x.isLong=J;var Li={},wi={};function Oe(n,e){var t,s,i;return e?(n>>>=0,(i=0<=n&&n<256)&&(s=wi[n],s)?s:(t=I(n,0,!0),i&&(wi[n]=t),t)):(n|=0,(i=-128<=n&&n<128)&&(s=Li[n],s)?s:(t=I(n,n<0?-1:0,!1),i&&(Li[n]=t),t))}x.fromInt=Oe;function te(n,e){if(isNaN(n))return e?Ae:re;if(e){if(n<0)return Ae;if(n>=oo)return lo}else{if(n<=-Ui)return K;if(n+1>=Ui)return co}return n<0?te(-n,e).neg():I(n%Ye|0,n/Ye|0,e)}x.fromNumber=te;function I(n,e,t){return new x(n,e,t)}x.fromBits=I;var jt=Math.pow;function gs(n,e,t){if(n.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return e?Ae:re;if(t=t||10,t<2||36<t)throw RangeError("radix");var s;if((s=n.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return gs(n.substring(1),e,t).neg();for(var i=te(jt(t,8)),r=re,o=0;o<n.length;o+=8){var a=Math.min(8,n.length-o),c=parseInt(n.substring(o,o+a),t);if(a<8){var l=te(jt(t,a));r=r.mul(l).add(te(c))}else r=r.mul(i),r=r.add(te(c))}return r.unsigned=e,r}x.fromString=gs;function oe(n,e){return typeof n=="number"?te(n,e):typeof n=="string"?gs(n,e):I(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}x.fromValue=oe;var Gi=65536,Km=1<<24,Ye=Gi*Gi,oo=Ye*Ye,Ui=oo/2,Ni=Oe(Km),re=Oe(0);x.ZERO=re;var Ae=Oe(0,!0);x.UZERO=Ae;var ze=Oe(1);x.ONE=ze;var ao=Oe(1,!0);x.UONE=ao;var Un=Oe(-1);x.NEG_ONE=Un;var co=I(-1,2147483647,!1);x.MAX_VALUE=co;var lo=I(-1,-1,!0);x.MAX_UNSIGNED_VALUE=lo;var K=I(0,-2147483648,!1);x.MIN_VALUE=K;var _=x.prototype;_.toInt=function(){return this.unsigned?this.low>>>0:this.low};_.toNumber=function(){return this.unsigned?(this.high>>>0)*Ye+(this.low>>>0):this.high*Ye+(this.low>>>0)};_.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(K)){var t=te(e),s=this.div(t),i=s.mul(t).sub(this);return s.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var r=te(jt(e,6),this.unsigned),o=this,a="";;){var c=o.div(r),l=o.sub(c.mul(r)).toInt()>>>0,u=l.toString(e);if(o=c,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};_.getHighBits=function(){return this.high};_.getHighBitsUnsigned=function(){return this.high>>>0};_.getLowBits=function(){return this.low};_.getLowBitsUnsigned=function(){return this.low>>>0};_.getNumBitsAbs=function(){if(this.isNegative())return this.eq(K)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};_.isZero=function(){return this.high===0&&this.low===0};_.eqz=_.isZero;_.isNegative=function(){return!this.unsigned&&this.high<0};_.isPositive=function(){return this.unsigned||this.high>=0};_.isOdd=function(){return(this.low&1)===1};_.isEven=function(){return(this.low&1)===0};_.equals=function(e){return J(e)||(e=oe(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};_.eq=_.equals;_.notEquals=function(e){return!this.eq(e)};_.neq=_.notEquals;_.ne=_.notEquals;_.lessThan=function(e){return this.comp(e)<0};_.lt=_.lessThan;_.lessThanOrEqual=function(e){return this.comp(e)<=0};_.lte=_.lessThanOrEqual;_.le=_.lessThanOrEqual;_.greaterThan=function(e){return this.comp(e)>0};_.gt=_.greaterThan;_.greaterThanOrEqual=function(e){return this.comp(e)>=0};_.gte=_.greaterThanOrEqual;_.ge=_.greaterThanOrEqual;_.compare=function(e){if(J(e)||(e=oe(e)),this.eq(e))return 0;var t=this.isNegative(),s=e.isNegative();return t&&!s?-1:!t&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};_.comp=_.compare;_.negate=function(){return!this.unsigned&&this.eq(K)?K:this.not().add(ze)};_.neg=_.negate;_.add=function(e){J(e)||(e=oe(e));var t=this.high>>>16,s=this.high&65535,i=this.low>>>16,r=this.low&65535,o=e.high>>>16,a=e.high&65535,c=e.low>>>16,l=e.low&65535,u=0,d=0,h=0,g=0;return g+=r+l,h+=g>>>16,g&=65535,h+=i+c,d+=h>>>16,h&=65535,d+=s+a,u+=d>>>16,d&=65535,u+=t+o,u&=65535,I(h<<16|g,u<<16|d,this.unsigned)};_.subtract=function(e){return J(e)||(e=oe(e)),this.add(e.neg())};_.sub=_.subtract;_.multiply=function(e){if(this.isZero())return this;if(J(e)||(e=oe(e)),ee){var t=ee.mul(this.low,this.high,e.low,e.high);return I(t,ee.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Ae:re;if(this.eq(K))return e.isOdd()?K:re;if(e.eq(K))return this.isOdd()?K:re;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Ni)&&e.lt(Ni))return te(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,i=this.high&65535,r=this.low>>>16,o=this.low&65535,a=e.high>>>16,c=e.high&65535,l=e.low>>>16,u=e.low&65535,d=0,h=0,g=0,m=0;return m+=o*u,g+=m>>>16,m&=65535,g+=r*u,h+=g>>>16,g&=65535,g+=o*l,h+=g>>>16,g&=65535,h+=i*u,d+=h>>>16,h&=65535,h+=r*l,d+=h>>>16,h&=65535,h+=o*c,d+=h>>>16,h&=65535,d+=s*u+i*l+r*c+o*a,d&=65535,I(g<<16|m,d<<16|h,this.unsigned)};_.mul=_.multiply;_.divide=function(e){if(J(e)||(e=oe(e)),e.isZero())throw Error("division by zero");if(ee){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?ee.div_u:ee.div_s)(this.low,this.high,e.low,e.high);return I(t,ee.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ae:re;var s,i,r;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ae;if(e.gt(this.shru(1)))return ao;r=Ae}else{if(this.eq(K)){if(e.eq(ze)||e.eq(Un))return K;if(e.eq(K))return ze;var o=this.shr(1);return s=o.div(e).shl(1),s.eq(re)?e.isNegative()?ze:Un:(i=this.sub(e.mul(s)),r=s.add(i.div(e)),r)}else if(e.eq(K))return this.unsigned?Ae:re;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=re}for(i=this;i.gte(e);){s=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),c=a<=48?1:jt(2,a-48),l=te(s),u=l.mul(e);u.isNegative()||u.gt(i);)s-=c,l=te(s,this.unsigned),u=l.mul(e);l.isZero()&&(l=ze),r=r.add(l),i=i.sub(u)}return r};_.div=_.divide;_.modulo=function(e){if(J(e)||(e=oe(e)),ee){var t=(this.unsigned?ee.rem_u:ee.rem_s)(this.low,this.high,e.low,e.high);return I(t,ee.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};_.mod=_.modulo;_.rem=_.modulo;_.not=function(){return I(~this.low,~this.high,this.unsigned)};_.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};_.clz=_.countLeadingZeros;_.countTrailingZeros=function(){return this.low?Oi(this.low):Oi(this.high)+32};_.ctz=_.countTrailingZeros;_.and=function(e){return J(e)||(e=oe(e)),I(this.low&e.low,this.high&e.high,this.unsigned)};_.or=function(e){return J(e)||(e=oe(e)),I(this.low|e.low,this.high|e.high,this.unsigned)};_.xor=function(e){return J(e)||(e=oe(e)),I(this.low^e.low,this.high^e.high,this.unsigned)};_.shiftLeft=function(e){return J(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?I(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):I(0,this.low<<e-32,this.unsigned)};_.shl=_.shiftLeft;_.shiftRight=function(e){return J(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?I(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):I(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};_.shr=_.shiftRight;_.shiftRightUnsigned=function(e){return J(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?I(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?I(this.high,0,this.unsigned):I(this.high>>>e-32,0,this.unsigned)};_.shru=_.shiftRightUnsigned;_.shr_u=_.shiftRightUnsigned;_.rotateLeft=function(e){var t;return J(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?I(this.high,this.low,this.unsigned):e<32?(t=32-e,I(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,I(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))};_.rotl=_.rotateLeft;_.rotateRight=function(e){var t;return J(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?I(this.high,this.low,this.unsigned):e<32?(t=32-e,I(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,I(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))};_.rotr=_.rotateRight;_.toSigned=function(){return this.unsigned?I(this.low,this.high,!1):this};_.toUnsigned=function(){return this.unsigned?this:I(this.low,this.high,!0)};_.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};_.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};_.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};x.fromBytes=function(e,t,s){return s?x.fromBytesLE(e,t):x.fromBytesBE(e,t)};x.fromBytesLE=function(e,t){return new x(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};x.fromBytesBE=function(e,t){return new x(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const jm=16;function uo(n){n==="X"&&(n="");const e=n.padEnd(jm,"0");return x.fromString(e,!0,16)}function Xm(n){if(n.isZero())return"X";let e=n.countTrailingZeros();const t=e%4;e=(e-t)/4;const s=e;e*=4;const r=n.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-s-r.length).join("0")+r}function Wm(n,e){const t=km(n).shiftRightUnsigned(2);return n.add(x.fromNumber(2*e+1-4).multiply(t))}function km(n){return n.and(n.not().add(1))}const Qm=3,qm=30,Ym=2*qm+1,Hi=180/Math.PI;function Zm(n){if(n.length===0)throw new Error("Invalid Hilbert quad key ".concat(n));const e=n.split("/"),t=parseInt(e[0],10),s=e[1],i=s.length;let r=0;const o=[0,0];for(let a=i-1;a>=0;a--){r=i-a;const c=s[a];let l=0,u=0;c==="1"?u=1:c==="2"?(l=1,u=1):c==="3"&&(l=1);const d=Math.pow(2,r-1);ep(d,o,l,u),o[0]+=d*l,o[1]+=d*u}if(t%2===1){const a=o[0];o[0]=o[1],o[1]=a}return{face:t,ij:o,level:r}}function $m(n){if(n.isZero())return"";let e=n.toString(2);for(;e.length<Qm+Ym;)e="0"+e;const t=e.lastIndexOf("1"),s=e.substring(0,3),i=e.substring(3,t),r=i.length/2,o=x.fromString(s,!0,2).toString(10);let a="";if(r!==0)for(a=x.fromString(i,!0,2).toString(4);a.length<r;)a="0"+a;return"".concat(o,"/").concat(a)}function ho(n,e,t){const s=1<<e;return[(n[0]+t[0])/s,(n[1]+t[1])/s]}function Vi(n){return n>=.5?1/3*(4*n*n-1):1/3*(1-4*(1-n)*(1-n))}function fo(n){return[Vi(n[0]),Vi(n[1])]}function go(n,e){let[t,s]=e;switch(n){case 0:return[1,t,s];case 1:return[-t,1,s];case 2:return[-t,-s,1];case 3:return[-1,-s,-t];case 4:return[s,-1,-t];case 5:return[s,t,-1];default:throw new Error("Invalid face")}}function mo(n){let[e,t,s]=n;const i=Math.atan2(s,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*Hi,i*Hi]}function ep(n,e,t,s){if(s===0){t===1&&(e[0]=n-1-e[0],e[1]=n-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function tp(n){const e=ho(n.ij,n.level,[.5,.5]),t=fo(e),s=go(n.face,t);return mo(s)}const np=100;function Ji(n){const{face:e,ij:t,level:s}=n,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],r=Math.max(1,Math.ceil(np*Math.pow(2,-s))),o=new Float64Array(4*r*2+2);let a=0,c=0;for(let l=0;l<4;l++){const u=i[l].slice(0),d=i[l+1],h=(d[0]-u[0])/r,g=(d[1]-u[1])/r;for(let m=0;m<r;m++){u[0]+=h,u[1]+=g;const A=ho(t,s,u),C=fo(A),B=go(e,C),E=mo(B);Math.abs(E[1])>89.999&&(E[0]=c);const T=E[0]-c;E[0]+=T>180?-360:T<-180?360:0,o[a++]=E[0],o[a++]=E[1],c=E[0]}}return o[a++]=o[0],o[a++]=o[1],o}function ms(n){const e=sp(n);return Zm(e)}function sp(n){if(n.indexOf("/")>0)return n;const e=uo(n);return $m(e)}function ip(n){const e=ms(n);return tp(e)}function rp(n){let e;if(n.face===2||n.face===5){let t=null,s=0;for(let i=0;i<4;i++){const r="".concat(n.face,"/").concat(i),o=ms(r),a=Ji(o);(typeof t>"u"||t===null)&&(t=new Float64Array(4*a.length)),t.set(a,s),s+=a.length}e=zi(t)}else{const t=Ji(n);e=zi(t)}return e}function zi(n){if(n.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let s=0;s<n.length;s+=2)e.push(n[s]),t.push(n[s+1]);return e.sort((s,i)=>s-i),t.sort((s,i)=>s-i),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function op(n,e){const t=(e==null?void 0:e.minimumHeight)||0,s=(e==null?void 0:e.maximumHeight)||0,i=ms(n),r=rp(i),o=r.west,a=r.south,c=r.east,l=r.north,u=[];return u.push(new p(o,l,t)),u.push(new p(c,l,t)),u.push(new p(c,a,t)),u.push(new p(o,a,t)),u.push(new p(o,l,s)),u.push(new p(c,l,s)),u.push(new p(c,a,s)),u.push(new p(o,a,s)),u}function po(n){const e=n.token,t={minimumHeight:n.minimumHeight,maximumHeight:n.maximumHeight},s=op(e,t),i=ip(e),r=i[0],o=i[1],a=w.WGS84.cartographicToCartesian([r,o,t.maximumHeight]),c=new p(a[0],a[1],a[2]);s.push(c);const l=eg(s);return[...l.center,...l.halfAxes]}const ap=4,cp=8,lp={QUADTREE:ap,OCTREE:cp};function up(n,e,t){if(n!=null&&n.box){const s=uo(n.s2VolumeInfo.token),i=Wm(s,e),r=Xm(i),o={...n.s2VolumeInfo};switch(o.token=r,t){case"OCTREE":const l=n.s2VolumeInfo,u=l.maximumHeight-l.minimumHeight,d=u/2,h=l.minimumHeight+u/2;l.minimumHeight=h-d,l.maximumHeight=h+d;break}return{box:po(o),s2VolumeInfo:o}}}async function Ao(n){const{options:e,parentData:t={mortonIndex:0,x:0,y:0,z:0},childIndex:s=0,globalData:i={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:r}=n;let{subtree:o,level:a=0}=n;const{subdivisionScheme:c,subtreeLevels:l,maximumLevel:u,contentUrlTemplate:d,subtreesUriTemplate:h,basePath:g}=e,m={children:[],lodMetricValue:0,contentUrl:""},A=lp[c],C=s&1,B=s>>1&1,E=s>>2&1,T=(A**a-1)/(A-1);let b=Ie(t.mortonIndex,s),M=T+b,D=Ie(t.x,C),O=Ie(t.y,B),P=Ie(t.z,E),R=!1;a+1>l&&(R=vn(o.childSubtreeAvailability,b));const S=Ie(i.x,D),q=Ie(i.y,O),ne=Ie(i.z,P),Le=a+i.level;if(R){const ve="".concat(g,"/").concat(h),et=Nn(ve,Le,S,q,ne);o=await At(et,ro),i.mortonIndex=b,i.x=D,i.y=O,i.z=P,i.level=a,b=0,M=0,D=0,O=0,P=0,a=0}if(!vn(o.tileAvailability,M)||a>u)return m;vn(o.contentAvailability,M)&&(m.contentUrl=Nn(d,Le,S,q,ne));const tn=a+1,nn={mortonIndex:b,x:D,y:O,z:P};for(let ve=0;ve<A;ve++){const et=up(r,ve,c),Et=await Ao({subtree:o,options:e,parentData:nn,childIndex:ve,level:tn,globalData:i,s2VolumeBox:et});if(Et.contentUrl||Et.children.length){const Bo=Le+1,_o=dp(Et,Bo,{childTileX:D,childTileY:O,childTileZ:P},e,r);m.children.push(_o)}}return m}function vn(n,e){return"constant"in n?!!n.constant:n.explicitBitstream?gp(e,n.explicitBitstream):!1}function dp(n,e,t,s,i){const{basePath:r,refine:o,getRefine:a,lodMetricType:c,getTileType:l,rootLodMetricValue:u,rootBoundingVolume:d}=s,h=n.contentUrl&&n.contentUrl.replace("".concat(r,"/"),""),g=u/2**e,m=i!=null&&i.box?{box:i.box}:d,A=hp(e,m,t);return{children:n.children,contentUrl:n.contentUrl,content:{uri:h},id:n.contentUrl,refine:a(o),type:l(n),lodMetricType:c,lodMetricValue:g,geometricError:g,transform:n.transform,boundingVolume:A}}function hp(n,e,t){if(e.region){const{childTileX:s,childTileY:i,childTileZ:r}=t,[o,a,c,l,u,d]=e.region,h=2**n,g=(c-o)/h,m=(l-a)/h,A=(d-u)/h,[C,B]=[o+g*s,o+g*(s+1)],[E,T]=[a+m*i,a+m*(i+1)],[b,M]=[u+A*r,u+A*(r+1)];return{region:[C,E,B,T,b,M]}}if(e.box)return e;throw new Error("Unsupported bounding volume type ".concat(e))}function Ie(n,e){return parseInt(n.toString(2)+e.toString(2),2)}function Nn(n,e,t,s,i){const r=fp({level:e,x:t,y:s,z:i});return n.replace(/{level}|{x}|{y}|{z}/gi,o=>r[o])}function fp(n){const e={};for(const t in n)e["{".concat(t,"}")]=n[t];return e}function gp(n,e){const t=Math.floor(n/8),s=n%8;return(e[t]>>s&1)===1}function ps(n){if(!n.contentUrl)return We.EMPTY;const t=n.contentUrl.split("?")[0].split(".").pop();switch(t){case"pnts":return We.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return We.SCENEGRAPH;default:return t}}function As(n){switch(n){case"REPLACE":case"replace":return Ce.REPLACE;case"ADD":case"add":return Ce.ADD;default:return n}}function Hn(n,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const s=new URL(n,"".concat(e,"/"));return decodeURI(s.toString())}else if(n.startsWith("/"))return n;return"".concat(e,"/").concat(n)}function Ki(n,e){if(!n)return null;if(n.content){const t=n.content.uri||n.content.url;n.contentUrl=Hn(t,e.basePath)}return n.id=n.contentUrl,n.lodMetricType=Yt.GEOMETRIC_ERROR,n.lodMetricValue=n.geometricError,n.transformMatrix=n.transform,n.type=ps(n),n.refine=As(n.refine),n}async function mp(n,e){const t=n.basePath;let s;const i=Xi(n==null?void 0:n.root);i&&n.root?s=await ji(n.root,n,i,e):s=Ki(n.root,n);const r=[];for(r.push(s);r.length>0;){const a=(r.pop()||{}).children||[];for(let c of a){const l=Xi(c);l?c=await ji(c,n,l,e):Ki(c,{basePath:t}),r.push(c)}}return s}async function ji(n,e,t,s){var i,r;const o=e.basePath,{subdivisionScheme:a,maximumLevel:c,subtreeLevels:l,subtrees:{uri:u}}=t,d=Nn(u,0,0,0,0),h=Hn(d,o),g=await At(h,ro,s),m=Hn(n.content.uri,o),A=e==null||(i=e.root)===null||i===void 0?void 0:i.refine,C=n.geometricError,B=(r=n.boundingVolume.extensions)===null||r===void 0?void 0:r["3DTILES_bounding_volume_S2"];if(B){const M={box:po(B),s2VolumeInfo:B};n.boundingVolume=M}const E=n.boundingVolume,T={contentUrlTemplate:m,subtreesUriTemplate:u,subdivisionScheme:a,subtreeLevels:l,maximumLevel:c,refine:A,basePath:o,lodMetricType:Yt.GEOMETRIC_ERROR,rootLodMetricValue:C,rootBoundingVolume:E,getTileType:ps,getRefine:As};return await pp(n,g,T)}async function pp(n,e,t){if(!n)return null;n.lodMetricType=Yt.GEOMETRIC_ERROR,n.lodMetricValue=n.geometricError,n.transformMatrix=n.transform;const{children:s,contentUrl:i}=await Ao({subtree:e,options:t,s2VolumeBox:n});return i&&(n.contentUrl=i,n.content={uri:i.replace("".concat(t.basePath,"/"),"")}),n.refine=As(n.refine),n.type=ps(n),n.children=s,n.id=n.contentUrl,n}function Xi(n){var e;return(n==null||(e=n.extensions)===null||e===void 0?void 0:e["3DTILES_implicit_tiling"])||(n==null?void 0:n.implicitTiling)}const Co={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:Yr,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:_p,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function Ap(n){return rr(n.url)}async function Cp(n,e,t){const s={content:{featureIds:null}};return await io(n,0,e,t,s.content),s.content}async function Bp(n,e,t){var s;const i=JSON.parse(new TextDecoder().decode(n));return i.loader=e.loader||Co,i.url=t.url,i.queryString=t.queryString,i.basePath=Ap(i),i.root=await mp(i,e),i.type=Y.TILES3D,i.lodMetricType=Yt.GEOMETRIC_ERROR,i.lodMetricValue=((s=i.root)===null||s===void 0?void 0:s.lodMetricValue)||0,i}async function _p(n,e,t){const s=e["3d-tiles"]||{};let i;return s.isTileset==="auto"?i=t.url&&t.url.indexOf(".json")!==-1:i=s.isTileset,i?n=await Bp(n,e,t):n=await Cp(n,e,t),n}const Wi=[0],yp={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:Co,onTilesetLoad:{type:"function",value:n=>{}},onTileLoad:{type:"function",value:n=>{}},onTileUnload:{type:"function",value:n=>{}},onTileError:{type:"function",value:(n,e,t)=>{}},_getMeshColor:{type:"function",value:n=>[255,255,255]}};class Cs extends qn{constructor(...e){super(...e),f(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&le.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return!!(!((e=this.state)===null||e===void 0||(t=e.tileset3d)===null||t===void 0)&&t.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:s}){if(e.data&&e.data!==t.data&&this._loadTileset(e.data),s.viewportChanged){const{activeViewports:i}=this.state;Object.keys(i).length&&(this._updateTileset(i),this.state.lastUpdatedViewports=i,this.state.activeViewports={})}if(s.propsChanged){const{layerMap:i}=this.state;for(const r in i)i[r].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:s}=this.state;this.internalState.viewport=e,t[e.id]=e;const i=s==null?void 0:s[e.id];(!i||!e.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:t}){const s=t&&t.props.tile;return e.picked&&(e.object=s),e.sourceTile=s,e}filterSubLayer({layer:e,viewport:t}){const{tile:s}=e.props,{id:i}=t;return s.selected&&s.viewportIds.includes(i)}_updateAutoHighlight(e){const t=e.sourceTile,s=this.state.layerMap[t==null?void 0:t.id];s&&s.layer&&s.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props;let s=this.props.loader||this.props.loaders;Array.isArray(s)&&(s=s[0]);const i={loadOptions:{...t}};let r=e;if(s.preload){const c=await s.preload(e,t);c.url&&(r=c.url),c.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:c.headers}),Object.assign(i,c)}const o=await At(r,s,i.loadOptions),a=new em(o,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:a,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(a)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:s}=this.context,i=Object.keys(e).length;!s||!i||!t||t.selectTiles(Object.values(e)).then(r=>{this.state.frameNumber!==r&&this.setState({frameNumber:r})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case We.POINTCLOUD:return this._makePointCloudLayer(e,t);case We.SCENEGRAPH:return this._make3DModelLayer(e);case We.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,t){const{attributes:s,pointCount:i,constantRGBA:r,cartographicOrigin:o,modelMatrix:a}=e.content,{positions:c,normals:l,colors:u}=s;if(!c)return null;const d=t&&t.props.data||{header:{vertexCount:i},attributes:{POSITION:c,NORMAL:l,COLOR_0:u}},{pointSize:h,getPointColor:g}=this.props,m=this.getSubLayerClass("pointcloud",Zn);return new m({pointSize:h},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:d,coordinateSystem:Ke.METER_OFFSETS,coordinateOrigin:o,modelMatrix:a,getColor:r||g,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:s,cartographicOrigin:i,modelMatrix:r}=e.content,o=this.getSubLayerClass("scenegraph",kt);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:s||Wi,scenegraph:t,coordinateSystem:Ke.METER_OFFSETS,coordinateOrigin:i,modelMatrix:r,getTransformMatrix:a=>a.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const s=e.content,{attributes:i,indices:r,modelMatrix:o,cartographicOrigin:a,coordinateSystem:c=Ke.METER_OFFSETS,material:l,featureIds:u}=s,{_getMeshColor:d}=this.props,h=t&&t.props.mesh||new be({drawMode:4,attributes:Ep(i),indices:r}),g=this.getSubLayerClass("mesh",us);return new g(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:h,data:Wi,getColor:d(e),pbrMaterial:l,modelMatrix:o,coordinateOrigin:a,coordinateSystem:c,featureIds:u,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(s=>{const i=t[s.id]=t[s.id]||{tile:s};let{layer:r}=i;return s.selected&&(r?i.needsUpdate&&(r=this._getSubLayer(s,r),i.needsUpdate=!1):r=this._getSubLayer(s)),i.layer=r,r}).filter(Boolean):null}}f(Cs,"defaultProps",yp);f(Cs,"layerName","Tile3DLayer");function Ep(n){const e={};return e.positions={...n.positions,value:new Float32Array(n.positions.value)},n.normals&&(e.normals=n.normals),n.texCoords&&(e.texCoords=n.texCoords),n.colors&&(e.colors=n.colors),n.uvRegions&&(e.uvRegions=n.uvRegions),e}const Tp={...Se,data:{type:String,required:!0},pointSize:{type:Number,default:1}},bp={...Me,loaded:n=>!0},Sp={class:"mb-tile-3d-layer"},Mp={name:"MbTile3dLayer"},vp=de({...Mp,props:Tp,emits:bp,setup(n,{emit:e}){const t=n,s=e,i=o=>{const{pointSize:a}=t;return new _e(Object.assign({},o,{type:Cs,pointSize:a,onTilesetLoad:c=>{s("loaded",c)}}))},{getLayer:r}=Be(t,i);return y(()=>t.pointSize,o=>{const a=r();a==null||a.setProps({pointSize:o})}),(o,a)=>(he(),fe("i",Sp))}}),Ip=ge(vp),Rp={...Se,...ki,currentTime:{type:Number,default:0},trailLength:{type:Number,default:120},getPath:{type:Function},getTimestamps:{type:Function}},Pp=Me,xp={class:"mb-trips-layer"},Fp={name:"MbTripsLayer"},Dp=de({...Fp,props:Rp,emits:Pp,setup(n){const e=n,t=o=>{const{currentTime:a,trailLength:c,getPath:l,getTimestamps:u,widthUnits:d,widthScale:h,widthMinPixels:g,widthMaxPixels:m,jointRounded:A,miterLimit:C,getWidth:B,getColor:E}=e;return new _e(Object.assign({},o,{type:ls,currentTime:a,trailLength:c,getPath:l,getTimestamps:u,widthUnits:d,widthScale:h,widthMinPixels:g,widthMaxPixels:m,rounded:A,miterLimit:C,getWidth:B,getColor:i(E)}))},{getLayer:s,parseColorVal:i,setColorProps:r}=Be(e,t);return bo(e,{getLayer:s,parseColorVal:i,setColorProps:r}),y(()=>e.currentTime,o=>{const a=s();a==null||a.setProps({currentTime:o})}),y(()=>e.trailLength,o=>{const a=s();a==null||a.setProps({trailLength:o})}),y(()=>e.getPath,o=>{const a=s();a==null||a.setProps({getPath:o})}),y(()=>e.getTimestamps,o=>{const a=s();a==null||a.setProps({getTimestamps:o})}),(o,a)=>(he(),fe("i",xp))}}),Op=ge(Dp),Lp="1.0.0",wp=[Lc,Vc,mh,gf,_f,Mf,Ff,wf,Ip,Op],Gp=function(n,e={}){wp.forEach(t=>{n.component(t.name,t)})},jp={version:Lp,install:Gp};export{Lc as MbArcLayer,Vc as MbColumnLayer,mh as MbGltfLayer,_f as MbGridCellLayer,gf as MbGridLayer,Mf as MbHexagonLayer,Ff as MbLineLayer,wf as MbPathLayer,Ip as MbTile3dLayer,Op as MbTripsLayer,yo as arcLayerProps,Se as deckLayerProps,jp as default,Gp as install,ki as pathLayerProps,Be as useDeckLayer,To as usePathLayer,bo as usePathLayerWatcher};
