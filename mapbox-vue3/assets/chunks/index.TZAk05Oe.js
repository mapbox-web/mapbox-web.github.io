import{s as g,d as h,t as L,a as b,b as w}from"./index.j3JAmpb-.js";import{$ as M}from"./mapbox-web-draw.BO1nkz54.js";import"./index.B0YS06CC.js";import"./mapbox-gl-enhance.DI11R9zg.js";import"./commonjsHelpers.Cpj98o6Y.js";function C(l,e={}){return g(l,(n,a)=>{const s=a.geometry.coordinates;return n+h(s[0],s[1],e)},0)}var _=C;const k="1.0.0",i={STATIC:"static",SIMPLE_SELECT:"simple_select",LENGTH:"length",AREA:"area"};function x(l,e={showTooltip:!0,styles:void 0,maxboxDrawInstance:void 0,lengthTitle:"长度测量",areaTitle:"面积测量",unitLabel:{m:"米",km:"千米"}}){let n;e.maxboxDrawInstance?n=e.maxboxDrawInstance:n=new M(l,Object.assign({userProperties:!0},e.styles?{styles:e.styles}:{}));let a=i.SIMPLE_SELECT,s="";const r={items:{},length:0},p=o=>{if(!o.features.length)return;o.feature=o.features[0];const m=o.feature.id,t=r.items[m];delete r.items[m],r.length--,t.marker.remove(),e.delete&&e.delete({mode:a,event:o,tooltip:t,featuresCount:r.length})},d=o=>{if(!o.features.length)return;o.feature=o.features[0];const m=o.feature.id;if(s==="before_draw"){s="drawing";let t=v(e);r.items[m]=t,r.length++,t.id=m,t.marker.setLngLat([0,0]).addTo(l),t.marker.setOffset([0,-20]),t.closeButton.onclick=()=>{delete r.items[m],r.length--,t==null||t.marker.remove(),n.delete([m]),t=void 0,e.delete&&e.delete({mode:a,event:o,tooltip:t,featuresCount:r.length})}}else if(s==="end_draw"){const t=r.items[m];if(!t)return;t.measureTooltipElement.classList.replace("mb-measure-tooltip-static","mb-measure-tooltip-measure"),t.marker.setOffset([0,-20]),s="drawing"}else if(s==="drawing"){if(a===i.LENGTH){const t=o.feature.geometry.coordinates,u=r.items[m];if(!u)return;u.measureTooltipElement.classList.remove("mb-measure-tooltip-hidden"),u.marker.setLngLat(t[t.length-1]),u.measureTooltipElementTitle.innerHTML=`${e.lengthTitle}`;const c=_(o.feature);c<.1?u.measureTooltipElementContent.innerHTML=`${(c*1e3).toFixed(2)} ${e.unitLabel.m}`:u.measureTooltipElementContent.innerHTML=`${c.toFixed(2)} ${e.unitLabel.km}`,e.update&&e.update({result:c,mode:i.LENGTH,event:o,tooltip:u,featuresCount:r.length})}else if(a===i.AREA){if(o.feature.geometry.coordinates[0].length<4)return;const t=r.items[m];if(!t)return;t.measureTooltipElement.classList.remove("mb-measure-tooltip-hidden"),t.marker.setLngLat(L(o.feature).geometry.coordinates),t.measureTooltipElementTitle.innerHTML=`${e.areaTitle}`;const u=b(o.feature);u>1e4?t.measureTooltipElementContent.innerHTML=`${Math.round(u/1e6*100)/100} ${e.unitLabel.km}<sup>2</sup>`:t.measureTooltipElementContent.innerHTML=`${Math.round(u*100)/100} ${e.unitLabel.m}<sup>2</sup>`,e.update&&e.update({result:u,mode:i.AREA,event:o,tooltip:t,featuresCount:r.length})}}};l.on("draw.delete",p),l.on("draw.create",d),l.on("draw.selectionchange",d),l.on("draw.update",d);const f=(o,m={})=>{switch(o){case i.STATIC:a=i.STATIC,s="static",n.changeMode("static");break;case i.SIMPLE_SELECT:a=i.SIMPLE_SELECT,s="simple_select",n.changeMode("simple_select");break;case i.LENGTH:a=i.LENGTH,s="before_draw",n.changeMode("draw_line_string");break;case i.AREA:a=i.AREA,s="before_draw",n.changeMode("draw_polygon");break}},E=()=>{T(),l.off("draw.delete",p),l.off("draw.create",d),l.off("draw.selectionchange",d),l.off("draw.update",d),n.destroy()};function T(){f(i.SIMPLE_SELECT);for(const[o,m]of Object.entries(r.items))m.marker.remove(),n.delete([o]);r.items={},r.length=0}return{currentModeName:()=>a,changeMode:f,clearAll:T,destroy:E}}function v(l){const e=document.createElement("div");e.className=`mb-measure-tooltip mb-measure-tooltip-measure mb-measure-tooltip-hidden${l.showTooltip?"":" mb-measure-tooltip-force-hidden"}`;const n=document.createElement("div");n.className="mb-measure-tooltip-wapper",e.appendChild(n);const a=document.createElement("a");a.className="mb-measure-tooltip-close-button",a.innerHTML="x",e.appendChild(a);const s=document.createElement("h3"),r=document.createElement("div");return n.appendChild(s),n.appendChild(r),{id:"",marker:new w.mapboxgl.Marker({element:e,offset:[0,-20],anchor:"bottom"}),closeButton:a,measureTooltipElement:e,measureTooltipElementTitle:s,measureTooltipElementContent:r}}const y={version:k};export{i as MODES,x as createMeasure,y as default};
